%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 528622143_99701464
  Name: "GS.Зарплата.Пролог.Начисление отпусков и больничных"
  Caption: "Начисление отпусков, больничных, по-среднему"
  Version: "1.0.0.118"
  Optional: False
  Internal: True
  MD5: D5614EF7484B47B50F9017DD90CE5243
Uses: 
  - "152690130_258063421 GS.Зарплата.Пролог"
  - "147729074_43451302 Зарплата - хранилище"
  - "147769863_84733194 Зарплата - Evt_Object"
  - "147730392_43451302 Зарплата - макросы"
  - "151049506_187967073 GS.Зарплата.Пролог.Общие"
Objects: 
  - 
    Properties: 
      Class: "TgdcStoredProc"
      RUID: 151162335_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      RDB$DESCRIPTION: | 
        USR$WG_TBLCALDAY_P
      PROCEDURENAME: "USR$WG_TBLCALDAY_P"
      PROCEDURESOURCE: | 
        CREATE OR ALTER PROCEDURE USR$WG_TBLCALDAY_P (
            IN_EMPLKEY INTEGER,
            IN_FIRSTMOVE INTEGER,
            IN_DATEFROM DATE,
            IN_DATETO DATE)
        RETURNS ( 
            EMPLKEY INTEGER,
            FIRSTMOVEKEY INTEGER,
            THEDAY DATE,
            WYEAR INTEGER,
            WMONTH INTEGER,
            WDAY INTEGER,
            WDURATION INTEGER,
            WORKDAY INTEGER,
            SCHEDULEKEY INTEGER)
         AS
         BEGIN
        FOR
        
        SELECT * FROM
        (
        SELECT
          ml.USR$EMPLKEY,
          ml.USR$FIRSTMOVE AS FirstMoveKey,
          tcd.THEDAY,
          EXTRACT(YEAR FROM tcd.THEDAY) AS WYEAR,
          EXTRACT(MONTH FROM tcd.THEDAY) AS WMONTH,
          EXTRACT(DAY FROM tcd.THEDAY) AS WDAY,
          tcd.WDURATION,
          tcd.WORKDAY,
          ml.USR$SCHEDULEKEY
        FROM
          (
          SELECT FIRST 1 * FROM USR$WG_MOVEMENTLINE
          WHERE
            USR$EMPLKEY = :IN_EMPLKEY
            AND
            USR$FIRSTMOVE = :IN_FIRSTMOVE
          ORDER BY USR$DATEBEGIN
          ) ml
        JOIN
          WG_TBLCAL tc
            ON tc.ID = ml.USR$SCHEDULEKEY
        JOIN
          WG_TBLCALDAY tcd
            ON tcd.TBLCALKEY = tc.ID
        WHERE
          ml.USR$EMPLKEY = :IN_EMPLKEY
          AND
          ml.USR$FIRSTMOVE = :IN_FIRSTMOVE
          AND
          COALESCE(tcd.WDURATION, 0) > 0
          AND
          tcd.THEDAY >= :IN_DATEFROM
          AND
          tcd.THEDAY < :IN_DATETO
          AND
          tcd.THEDAY < ml.USR$DATEBEGIN
        UNION ALL
        SELECT
          ml.USR$EMPLKEY,
          ml.USR$FIRSTMOVE AS FirstMoveKey,
          tcd.THEDAY,
          EXTRACT(YEAR FROM tcd.THEDAY) AS WYEAR,
          EXTRACT(MONTH FROM tcd.THEDAY) AS WMONTH,
          EXTRACT(DAY FROM tcd.THEDAY) AS WDAY,
          tcd.WDURATION,
          tcd.WORKDAY,
          ml.USR$SCHEDULEKEY
        FROM
          USR$WG_MOVEMENTLINE ml
        RIGHT JOIN
          WG_TBLCAL tc
            ON tc.ID = ml.USR$SCHEDULEKEY
        JOIN
          WG_TBLCALDAY tcd
            ON tcd.TBLCALKEY = tc.ID
        WHERE
          ml.USR$EMPLKEY = :IN_EMPLKEY
          AND
          ml.USR$FIRSTMOVE = :IN_FIRSTMOVE
          AND
          ml.USR$DATEBEGIN < :IN_DATETO
          AND
          COALESCE(tcd.WDURATION, 0) > 0
          AND
          tcd.THEDAY >= :IN_DATEFROM
          AND
          tcd.THEDAY < :IN_DATETO
          AND
          tcd.THEDAY >= ml.USR$DATEBEGIN
          AND
          tcd.THEDAY <
            COALESCE(
              (
              SELECT
                FIRST 1
                ml_next.USR$DATEBEGIN
              FROM
                USR$WG_MOVEMENTLINE ml_next
              WHERE
                ml_next.USR$EMPLKEY = :IN_EMPLKEY
                AND
                ml_next.USR$FIRSTMOVE = :IN_FIRSTMOVE
                AND
                ml_next.USR$DATEBEGIN > ml.USR$DATEBEGIN
              ORDER BY
                ml_next.USR$DATEBEGIN
              ),
            :IN_DATETO
            )
        ) ml_union
        ORDER BY
          THEDAY
        
        INTO
            :EMPLKEY,
            :FirstMoveKey,
            :THEDAY,
            :WYEAR,
            :WMONTH,
            :WDAY,
            :WDURATION,
            :WORKDAY,
            :SCHEDULEKEY
        DO
          SUSPEND;
        
        END
        
      EDITIONDATE: 2013-11-18T12:13:11+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 156299481_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151163587_5956463
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalary_CoefOption"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_WageSettings
        
        Sub wg_AvgSalary_CoefOption(ByRef Sender)
        '
          Dim InflType, InflFCType
          Dim rbFCRate, rbRateInf, rbMovementRate, rbSalaryInf
          
          InflType = wg_WageSettings.Inflation.InflType
          InflFCType = wg_WageSettings.Inflation.InflFCType
          '
          'От оклада
          Set rbSalaryInf = Sender.GetComponent("usrg_rbSalaryInf")
          rbSalaryInf.Checked = False
          'От ставки 1-го разряда
          Set rbRateInf = Sender.FindComponent("usrg_rbRateInf")
          rbRateInf.Checked = False
          '  справочника
          Set rbFCRate = Sender.FindComponent("usrg_rbFCRate")
          rbFCRate.Checked = False
          '  кадрового движения
          Set rbMovementRate = Sender.FindComponent("usrg_rbMovementRate")
          rbMovementRate.Checked = False
          '
          Select Case InflType
            'usrg_rbSalaryInf - От оклада
            Case 0
              rbSalaryInf.Checked = True
            'usrg_rbRateInf - От ставки 1-го разряда
            Case 1
              rbRateInf.Checked = True
              '
              Select Case InflFCType
                'usrg_rbFCRate - справочника
                Case 0
                  rbFCRate.Checked = True
                'usrg_rbMovementRate - кадрового движения
                Case 2
                  rbMovementRate.Checked = True
              End Select
              '
          End Select
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARY_COEFOPTION
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-02-27T10:57:15+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151163587_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_WageSettings
        '#include wg_EnableFieldChange
        '#include pl_GetScriptIDByName
        '#include wg_AvgSalary_CoefOption
        
        Function wg_AvgSalaryStrGenerate_pl(ByRef Sender, ByVal CalcType)
        '
          Dim T, T1, T2
          
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim gdcObject, gdcSalary
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile, Scope
          'avg_wage
          Dim P_main, Tv_main, Q_main
          'avg_wage_in
          Dim P_in, Tv_in, Q_in
          Dim EmplKey, FirstMoveKey, DateCalc
          Dim InflType, InflFCType
          Dim MonthOffset, CoefOption
          'avg_wage_run, avg_wage_sql
          Dim P_run, Tv_run, Q_run, P_sql, Tv_sql, Q_sql, P_kb
          Dim DateCalcFrom, DateCalcTo
          Dim PredicateName, Arity, SQL
          'avg_wage_out, avg_wage_det
          Dim P_out, Tv_out, Q_out, P_det, Tv_det, Q_det
          Dim AvgWage, AvgWageRule
          Dim Period, PeriodRule, Wage, ModernWage, ModernCoef
          Dim TabDays, TabHoures, NormDays, NormHoures
          Dim SalaryOld, SalaryNew
          Dim IsFull, IsCheck
        
          T1 = Timer
          wg_AvgSalaryStrGenerate_pl = False
          Set Creator = New TCreator
          
          Sender.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.gdcObject
          '
          EmplKey = gdcObject.FieldByName("usr$emplkey").AsInteger
          FirstMoveKey = gdcObject.FieldByName("usr$firstmovekey").AsInteger
          '
          if CalcType = 0 then
            dim IBSQL
            set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
            IBSQL.Transaction = gdcBaseManager.ReadTransaction
            IBSQL.SQL.Text = _
              "select " & _
              "  t.USR$DATEBEGIN " & _
              "from " & _
              "  usr$wg_total t " & _
              "where " & _
              "  t.DOCUMENTKEY = :TDK "
            IBSQL.ParamByName("TDK").asInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
            IBSQL.ExecQuery
            DateCalc = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          else
            DateCalc = gdcObject.FieldByName("usr$from").AsDateTime
          end if
          '
          MonthOffset = 0
          '
          InflType = wg_WageSettings.Inflation.InflType
          InflFCType = wg_WageSettings.Inflation.InflFCType
          'CoefOption: fc_fcratesum ; ml_rate ; ml_msalary
          Select Case InflType
            'usrg_rbSalaryInf - От оклада
            Case 0
              CoefOption = "ml_msalary"
            'usrg_rbRateInf - От ставки 1-го разряда
            Case 1
              Select Case InflFCType
                'usrg_rbFCRate - справочника
                Case 0
                  CoefOption = "fc_fcratesum"
                'usrg_rbMovementRate - кадрового движения
                Case 2
                  CoefOption = "ml_rate"
              End Select
          End Select
          '
        
          'проблема wg_WageSettings
          'CoefOption = "ml_rate" 'только для ММК, иначе эту строку закомментировать
        
          wg_AvgSalary_CoefOption(Sender)
        
          'init
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          Scope = "wg_avg_wage_vacation"
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          Set gdcSalary = Sender.GetComponent("usrg_gdcAvgSalaryStr")
          '
          Call wg_DisableFieldChange(gdcSalary, "AVGSALARYCALC")
          '
          gdcSalary.First
          While Not gdcSalary.EOF
            gdcSalary.Delete
          Wend
          '
          gdcObject.FieldByName("USR$AVGSUMMA").Clear
          '
          Sender.Repaint
        
          'avg_wage_in(EmplKey, FirstMoveKey, DateCalc, MonthOffset, CoefOption)
          P_in = "avg_wage_in"
          Set Tv_in = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutInteger 0, EmplKey
          Tv_in.PutInteger 1, FirstMoveKey
          Tv_in.PutDate 2, DateCalc
          Tv_in.PutInteger 3, MonthOffset
          Tv_in.PutAtom 4, CoefOption
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'avg_wage(Scope) - prepare data
          P_main = "avg_wage"
          Set Tv_main = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_main = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_main.PredicateName = P_main
          Q_main.Termv = Tv_main
          '
          Tv_main.PutAtom 0, Scope
          '
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_run(Scope, EmplKey, FirstMoveKey, DateCalcFrom, DateCalcTo)
          P_run = "avg_wage_run"
          Set Tv_run = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_run = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_run.PredicateName = P_run
          Q_run.Termv = Tv_run
          'avg_wage_sql(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL)
          P_sql = "avg_wage_sql"
          P_kb = "avg_wage_kb"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Tv_run.PutAtom 0, Scope
          '
          Q_run.OpenQuery
          If Q_run.EOF Then
            Exit Function
          End If
          '
          Append = False
          '
          Do Until Q_run.EOF
            EmplKey = Tv_run.ReadInteger(1)
            FirstMoveKey = Tv_run.ReadInteger(2)
            DateCalcFrom = Tv_run.ReadDate(3)
            DateCalcTo = Tv_run.ReadDate(4)
            '
            Tv_sql.Reset
            Tv_sql.PutAtom 0, Scope
            Tv_sql.PutInteger 1, EmplKey
            Tv_sql.PutInteger 2, FirstMoveKey
            Q_sql.OpenQuery
            '
            Do Until Q_sql.EOF
              PredicateName = Tv_sql.ReadAtom(3)
              Arity = Tv_sql.ReadInteger(4)
              SQL = Tv_sql.ReadString(5)
              '
              Ret =  PL.MakePredicatesOfSQLSelect _
                        (SQL, _
                        gdcBaseManager.ReadTransaction, _
                        PredicateName, PredicateName, Append)
              If Ret >= 0 Then
                 Ret = PL.Call(P_kb, Tv_sql)
              End If
              '
              Q_sql.NextSolution
            Loop
            Q_sql.Close
            '
            Append = True
            '
            Q_run.NextSolution
          Loop
          Q_run.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage(Scope) - calc result
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_out(Scope, EmplKey, FirstMoveKey, AvgWage, AvgWageVariant)
          P_out = "avg_wage_out"
          Set Tv_out = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          'avg_wage_det(EmplKey, FirstMoveKey,
          '   Period, PeriodRule, Wage, ModernCoef, ModernWage,
          '   TabDays, NormDays, TabHoures, NormHoures,
          '   SalaryOld, SalaryNew)
          P_det = "avg_wage_det"
          Set Tv_det = Creator.GetObject(13, "TgsPLTermv", "")
          Set Q_det = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_det.PredicateName = P_det
          Q_det.Termv = Tv_det
          '
          Tv_out.PutAtom 0, Scope
          '
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            EmplKey = Tv_out.ReadInteger(1)
            FirstMoveKey = Tv_out.ReadInteger(2)
            AvgWage = Tv_out.ReadFloat(3)
            AvgWageRule = Tv_out.ReadAtom(4)
            '
            Tv_det.Reset
            Tv_det.PutInteger 0, EmplKey
            Tv_det.PutInteger 1, FirstMoveKey
            Q_det.OpenQuery
            '
            Do Until Q_det.EOF
              Period = Tv_det.ReadDate(2)
              PeriodRule = Tv_det.ReadAtom(3)
              IsFull = _
                Abs( PeriodRule = "by_days_houres" _
                    Or PeriodRule = "by_houres" _
                    Or PeriodRule = "by_days" )
              IsCheck = Abs( Not (PeriodRule = "none") )
              '
              If AvgWageRule = "by_calc_month" Then
                Select Case PeriodRule
                  Case "by_days_houres"
                    PeriodRule = "табель равен графику по дням и часам"
                  Case "by_days"
                    PeriodRule = "табель покрывает график по дням"
                  Case "by_houres"
                    PeriodRule = "табель покрывает график по часам"
                  Case "by_month_wage_all"
                    PeriodRule = "по размеру заработка (не меньше всех полных)"
                  Case "by_month_wage_any"
                    PeriodRule = "по размеру заработка (не меньше любого полного)"
                  Case "by_month_avg_wage"
                    PeriodRule = "по размеру заработка (не меньше среднего по полным месяцам)"
                  Case "by_month_no_bad_type"
                    PeriodRule = "виды начислений и типы часов в норме"
                  Case Else
                    PeriodRule = ""
                End Select
              ElseIf AvgWageRule = "by_avg_houre" Then
                PeriodRule = "по среднечасовому"
              End If
              '
              Wage = Tv_det.ReadFloat(4)
              ModernCoef = Tv_det.ReadFloat(5)
              ModernWage = Tv_det.ReadFloat(6)
              TabDays = Tv_det.ReadFloat(7)
              NormDays = Tv_det.ReadFloat(8)
              TabHoures = Tv_det.ReadFloat(9)
              NormHoures = Tv_det.ReadFloat(10)
              SalaryOld = Tv_det.ReadFloat(11)
              SalaryNew = Tv_det.ReadFloat(12)
              '
              gdcSalary.Append
              gdcSalary.FieldByName("USR$DATE").AsVariant = Period
              gdcSalary.FieldByName("USR$SALARY").AsVariant = Wage
              gdcSalary.FieldByName("USR$COEFF").AsVariant = ModernCoef
              gdcSalary.FieldByName("USR$MODERNSALARY").AsVariant = ModernWage
              gdcSalary.FieldByName("USR$DOW").AsVariant = TabDays
              gdcSalary.FieldByName("USR$HOW").AsVariant = TabHoures
              gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = NormDays
              gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = NormHoures
              gdcSalary.FieldByName("USR$ISCHECK").AsVariant = IsCheck
              gdcSalary.FieldByName("USR$ISFULL").AsVariant = IsFull
              gdcSalary.FieldByName("USR$DESCRIPTION").AsVariant = PeriodRule
              gdcSalary.FieldByName("USR$OLDSALARY").AsVariant = SalaryOld
              gdcSalary.FieldByName("USR$NEWSALARY").AsVariant = SalaryNew
              gdcSalary.Post
              '
              Q_det.NextSolution
            Loop
            Q_det.Close
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
        
          gdcSalary.First
          '
          Call wg_EnableFieldChange(gdcSalary, "AVGSALARYCALC")
          '
          If AvgWage > 0 Then
            gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = AvgWage
            gdcObject.Post
          End If
          '
        
          wg_AvgSalaryStrGenerate_pl = True
          
          T2 = Timer
          T = T2 - T1
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        UFJTVAgAAABDQUxDVFlQRQgAAABDQUxDVFlQRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2015-01-25T22:43:47+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
          - 
            ADDFUNCTIONKEY: "156299481_119200397 wg_AvgSalary_CoefOption"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 156300136_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryDetailGenerate_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include pl_GetScriptIDByName
        
        Function wg_AvgSalaryDetailGenerate_pl(ByRef Sender)
        '
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim gdcObject, gdcDetail
          '
          Dim PL, Ret, Pred, Tv, Append
          'struct_vacation_sql
          Dim P_sql, Tv_sql, Q_sql
          Dim DocKey, DateBegin, DateEnd, PredicateName, Arity, SQL
          'struct_vacation_in
          Dim P_in, Tv_in, Q_in
          Dim DateCalc, AvgWage, SliceOption
          'struct_vacation_out
          Dim P_out, Tv_out, Q_out
          Dim AccDate, IncludeDate, Duration, Summa, VcType
        
          wg_AvgSalaryDetailGenerate_pl = False
          Set Creator = New TCreator
        
          Sender.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.gdcObject
          '
          DocKey = gdcObject.FieldByName("DOCUMENTKEY").AsInteger
          DateBegin = gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime
          DateEnd = gdcObject.FieldByName("USR$DATEEND").AsDateTime
          AvgWage = gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency
          SliceOption = 0
          '
          Dim IBSQL
          Set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = gdcBaseManager.ReadTransaction
          IBSQL.SQL.Text = _
              "select " & _
              "  t.USR$DATEBEGIN " & _
              "from " & _
              "  usr$wg_total t " & _
              "where " & _
              "  t.DOCUMENTKEY = :TDK "
          IBSQL.ParamByName("TDK").asInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
          IBSQL.ExecQuery
          DateCalc = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          '
        
          'init
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          Set gdcDetail = Sender.gdcDetailObject
          '
          gdcDetail.First
          While Not gdcDetail.EOF
            gdcDetail.Delete
          Wend
          '
          Sender.Repaint
        
          'struct_vacation_sql(DocKey, DateBegin, DateEnd, PredicateName, Arity, SQL)
          P_sql = "struct_vacation_sql"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Append = False
          '
          Tv_sql.PutInteger 0, DocKey
          Tv_sql.PutDate 1, DateBegin
          Tv_sql.PutDate 2, DateEnd
          '
          Q_sql.OpenQuery
          If Q_sql.EOF Then
            Exit Function
          End If
          '
          Do Until Q_sql.EOF
            PredicateName = Tv_sql.ReadAtom(3)
            Arity = Tv_sql.ReadInteger(4)
            SQL = Tv_sql.ReadString(5)
            '
            Ret =  PL.MakePredicatesOfSQLSelect _
                      (SQL, _
                      gdcBaseManager.ReadTransaction, _
                      PredicateName, PredicateName, Append)
            '
            Q_sql.NextSolution
          Loop
          Q_sql.Close
          '
        
          'struct_vacation_in(DateCalc, DateBegin, DateEnd, AvgWage, SliceOption)
          P_in = "struct_vacation_in"
          Set Tv_in = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutDate 0, DateCalc
          Tv_in.PutDate 1, DateBegin
          Tv_in.PutDate 2, DateEnd
          Tv_in.PutFloat 3, AvgWage
          Tv_in.PutInteger 4, SliceOption
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'struct_vacation_out(AccDate, IncludeDate, Duration, Summa, DateBegin, DateEnd, VcType)
          P_out = "struct_vacation_out"
          Set Tv_out = Creator.GetObject(7, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            '
            AccDate = Tv_out.ReadDate(0)
            IncludeDate = Tv_out.ReadDate(1)
            Duration = Tv_out.ReadFloat(2)
            Summa = Tv_out.ReadFloat(3)
            DateBegin = Tv_out.ReadDate(4)
            DateEnd = Tv_out.ReadDate(5)
            VcType = Tv_out.ReadInteger(6)
            '
            gdcDetail.Append
            gdcDetail.FieldByName("USR$ACCDATE").AsVariant = AccDate
            gdcDetail.FieldByName("USR$INCLUDEDATE").AsVariant = IncludeDate
            gdcDetail.FieldByName("USR$DURATION").AsVariant = Duration
            gdcDetail.FieldByName("USR$SUMMA").AsVariant = Summa
            gdcDetail.FieldByName("USR$DATEBEGIN").AsVariant = DateBegin
            gdcDetail.FieldByName("USR$DATEEND").AsVariant = DateEnd
            'gdcDetail.FieldByName("USR$VCTYPE").AsVariant = VcType
            gdcDetail.Post
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
          gdcDetail.First
        
          wg_AvgSalaryDetailGenerate_pl = True
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYDETAILGENERATE_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-08-25T13:13:33+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123484_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      PARENT: "147240236_1234867257 GLOBAL\\DFM\\Tgdc_dlgUserComplexDocument"
      NAME: "147020774_119619099"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: | 
        object gdc_dlgUserComplexDocument147020774_119619099: Tgdc_dlgUserComplexDocument
          Left = -8
          Top = -8
          Width = 1382
          Height = 744
          ActiveControl = nil
          PixelsPerInch = 96
          TextHeight = 13
          object btnAccess: TButton
            Top = 682
            TabOrder = 3
          end
          object btnNew: TButton
            Top = 682
            TabOrder = 4
          end
          object btnHelp: TButton
            Top = 682
            TabOrder = 5
          end
          object btnOK: TButton
            Left = 1188
            Top = 682
            Anchors = [akRight, akBottom]
            TabOrder = 1
          end
          object btnCancel: TButton
            Left = 1280
            Top = 682
            Anchors = [akRight, akBottom]
            TabOrder = 2
          end
          object pnlMain: TPanel
            Width = 1366
            Height = 679
            TabOrder = 0
            object splMain: TSplitter
              Width = 1366
            end
            object usrg_Splitter1: TSplitter
              Tag = 0
              Left = 575
              Top = 277
              Width = 6
              Height = 402
              Cursor = crHSplit
              Hint = ''
              Align = alLeft
              AutoSnap = True
              Beveled = False
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              MinSize = 30
              ParentColor = True
              ResizeStyle = rsPattern
              Visible = True
            end
            object pnlDetail: TPanel
              Left = 0
              Top = 277
              Width = 575
              Height = 402
              Align = alLeft
              Alignment = taLeftJustify
              Anchors = [akLeft, akTop, akBottom]
              AutoSize = False
              TabOrder = 2
              object ibgrDetail: TgsIBGrid
                Left = 0
                Width = 575
                Height = 376
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                ReadOnly = True
                Expands = <>
                Conditions = <>
                ScaleColumns = False
                MinColWidth = 12
                ColumnEditors = <>
                Aliases = <>
                Columns = <
                  item
                    Expanded = False
                    FieldName = 'USR$ACCDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата начисления'
                    Width = 108
                    Visible = True
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$INCLUDEDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата зачисления'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$DURATION'
                    ReadOnly = False
                    Title.Caption = 'Дни'
                    Width = 36
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$SUMMA'
                    ReadOnly = False
                    Title.Caption = 'Сумма'
                    Width = 72
                    Visible = True
                    DisplayFormat = '#.##'
                    TotalType = ttSum
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEBEGIN'
                    ReadOnly = False
                    Title.Caption = 'Дата начала'
                    Width = 108
                    Visible = True
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEEND'
                    ReadOnly = False
                    Title.Caption = 'Дата окончания'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'SUMNCU'
                    ReadOnly = False
                    Title.Caption = 'sumncu'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DESCRIPTION'
                    ReadOnly = False
                    Title.Caption = 'Описание'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$SORTNUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер для сортировки'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'ID'
                    ReadOnly = False
                    Title.Caption = 'Ключ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PARENT'
                    ReadOnly = False
                    Title.Caption = 'Родитель'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип транзакции'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRANSACTIONKEY'
                    ReadOnly = False
                    Title.Caption = 'Транзакция'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'NUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMCURR'
                    ReadOnly = False
                    Title.Caption = 'Сумма в валюте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DELAYED'
                    ReadOnly = False
                    Title.Caption = 'Отложенный'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CURRKEY'
                    ReadOnly = False
                    Title.Caption = 'Валюта'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'COMPANYKEY'
                    ReadOnly = False
                    Title.Caption = 'Компания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто создал'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата создания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто исправил'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата изменения'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PRINTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата печати'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DISABLED'
                    ReadOnly = False
                    Title.Caption = 'Отключено'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED'
                    ReadOnly = False
                    Title.Caption = 'Зарезервировано'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTKEY'
                    Title.Caption = 'Ключ документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'MASTERKEY'
                    Title.Caption = 'Родитель (Начисление отпусков(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED1'
                    Title.Caption = 'Зарезервировано (Начисление отпусков(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMEQ'
                    ReadOnly = False
                    Title.Caption = 'Сумма в эквиваленте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$EQRATE'
                    ReadOnly = False
                    Title.Caption = 'Курс экв.'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AFULL'
                    ReadOnly = False
                    Title.Caption = 'Полный доступ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'ACHAG'
                    ReadOnly = False
                    Title.Caption = 'Просмотр и редактирование'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AVIEW'
                    ReadOnly = False
                    Title.Caption = 'Только просмотр'
                    Width = -1
                    Visible = False
                  end>
              end
              object tbdTop: TTBDock
                Width = 575
                object tbDetail: TTBToolbar
                  Align = alClient
                  Anchors = [akLeft, akTop, akRight, akBottom]
                  DockPos = 0
                  SavedAtRunTime = True
                  object tbNew: TTBItem
                  end
                  object tbEdit: TTBItem
                  end
                  object tbDelete: TTBItem
                  end
                  object tbDuplicate: TTBItem
                  end
                  object tbiDetailProperties: TTBItem
                  end
                  object TBSeparatorItem1: TTBSeparatorItem
                  end
                  object tbCopy: TTBItem
                  end
                  object tbCut: TTBItem
                  end
                  object tbPaste: TTBItem
                  end
                  object TBSeparatorItem2: TTBSeparatorItem
                  end
                  object tbMacro: TTBItem
                  end
                  object usrg_TBSeparatorItem1: TTBSeparatorItem
                    Tag = 0
                    Blank = False
                    Hint = ''
                    Visible = True
                  end
                  object usrg_TBItem6: TTBItem
                    Tag = 0
                    Action = usrg_actGenerate
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_TBItem1: TTBItem
                    Tag = 0
                    Action = usrg_actGenStr
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_tbFeesByEmpl: TTBItem
                    Tag = 0
                    Action = nil
                    AutoCheck = False
                    Caption = 'Итоговое'
                    Checked = False
                    DisplayMode = nbdmDefault
                    Enabled = True
                    GroupIndex = 0
                    HelpContext = 0
                    Hint = ''
                    ImageIndex = -1
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                    ShortCut = 0
                    Visible = True
                  end
                end
              end
              object tbdLeft: TTBDock
                Left = 0
                Width = 0
                Height = 376
              end
              object tbdRight: TTBDock
                Left = 575
                Width = 0
                Height = 376
              end
              object tbdBottom: TTBDock
                Top = 402
                Width = 575
                Height = 0
              end
            end
            object pnlMaster: TPanel
              Width = 1366
              TabOrder = 0
              object pnlHolding: TPanel
                Width = 1366
                TabOrder = 1
                object lblCompany: TLabel
                  Width = 64
                  Caption = 'Органзация:'
                end
                object iblkCompany: TgsIBLookupComboBox
                end
              end
              object usrg_PageControl1: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 1366
                Height = 273
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet1
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet1: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Основные'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_GroupBox1: TGroupBox
                    Tag = 0
                    Left = 0
                    Top = 121
                    Width = 1358
                    Height = 124
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    Caption = ' Средний заработок '
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ParentBiDiMode = True
                    ParentColor = True
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 0
                    TabStop = False
                    Visible = True
                    object usrat_DBEdit_USR_AVGPERIOD_Label: TLabel
                      Left = 13
                      Top = 44
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY_Label: TLabel
                      Left = 13
                      Top = 20
                    end
                    object usrat_DBEdit_USR_AVGSUMMA_Label: TLabel
                      Left = 14
                      Top = 69
                    end
                    object usrg_chboxCoefInflation: TCheckBox
                      Tag = 0
                      Left = 669
                      Top = 51
                      Width = 225
                      Height = 17
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      TabStop = True
                      Action = nil
                      Alignment = taRightJustify
                      AllowGrayed = False
                      Anchors = [akLeft, akTop]
                      Caption = 'Коэ-т инфляции от ставки 1 разряда'
                      Checked = True
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = True
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      State = cbChecked
                      TabOrder = 4
                      Visible = False
                    end
                    object usrg_GroupBox2: TGroupBox
                      Tag = 0
                      Left = 341
                      Top = 10
                      Width = 225
                      Height = 101
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      Caption = 'Осовременивание'
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DockSite = False
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = False
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      TabOrder = 5
                      TabStop = False
                      Visible = True
                      object usrg_rbSalaryInf: TRadioButton
                        Tag = 0
                        Left = 12
                        Top = 17
                        Width = 169
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'От оклада'
                        Checked = False
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 0
                        TabStop = False
                        Visible = True
                      end
                      object usrg_rbRateInf: TRadioButton
                        Tag = 0
                        Left = 12
                        Top = 36
                        Width = 169
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'От ставки 1-го разряда'
                        Checked = True
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 1
                        TabStop = True
                        Visible = True
                      end
                    end
                    object usrg_rbPersCoeffInf: TRadioButton
                      Tag = 0
                      Left = 796
                      Top = 23
                      Width = 241
                      Height = 17
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      Action = nil
                      Alignment = taRightJustify
                      Anchors = [akLeft, akTop]
                      Caption = 'От персонального коэффициента'
                      Checked = True
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = True
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      TabOrder = 7
                      TabStop = True
                      Visible = False
                    end
                    object usrg_Panel2: TPanel
                      Tag = 0
                      Left = 377
                      Top = 59
                      Width = 177
                      Height = 49
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      Align = alNone
                      Alignment = taCenter
                      Anchors = [akLeft, akTop]
                      AutoSize = False
                      BevelInner = bvNone
                      BevelOuter = bvNone
                      BevelWidth = 1
                      BorderWidth = 0
                      BorderStyle = bsNone
                      Caption = ''
                      Color = clBtnFace
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      Ctl3D = False
                      UseDockManager = True
                      DockSite = False
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = False
                      FullRepaint = True
                      Locked = False
                      ParentBiDiMode = True
                      ParentColor = False
                      ParentCtl3D = False
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      TabOrder = 6
                      TabStop = False
                      Visible = True
                      object usrg_rbFCRate: TRadioButton
                        Tag = 0
                        Left = 6
                        Top = 9
                        Width = 113
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'справочника'
                        Checked = False
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 0
                        TabStop = False
                        Visible = True
                      end
                      object usrg_rbMovementRate: TRadioButton
                        Tag = 0
                        Left = 6
                        Top = 27
                        Width = 161
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'кадрового движения'
                        Checked = True
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 1
                        TabStop = True
                        Visible = True
                      end
                    end
                    object usrat_DBEdit_USR_AVGPERIOD: TxDBCalculatorEdit
                      Left = 243
                      Top = 40
                      Width = 76
                      Cursor = crIBeam
                      TabOrder = 1
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY: TgsIBLookupComboBox
                      Left = 139
                      Top = 16
                      Width = 180
                      ListTable = 
                        'USR$WG_FEEGROUP fg LEFT JOIN USR$WG_FEEGROUP fg1 ON fg.lb > fg1.' +
                        'lb AND fg.rb < fg1.rb'
                      Condition = 'fg1.id = <RUID XID = 147274328 DBID = 274788016/>'
                      TabOrder = 0
                    end
                    object usrat_DBCheckBox_USR_MODERNSALARY: TDBCheckBox
                      Left = 677
                      Top = 19
                      Width = 106
                      Caption = 'Осовременивать'
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_DBEdit_USR_AVGSUMMA: TxDBCalculatorEdit
                      Left = 179
                      Top = 65
                      Cursor = crIBeam
                      ReadOnly = True
                      TabOrder = 3
                    end
                  end
                  object usrg_Panel1: TPanel
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 1358
                    Height = 121
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alTop
                    Alignment = taCenter
                    Anchors = [akLeft, akTop, akRight]
                    AutoSize = False
                    BevelInner = bvRaised
                    BevelOuter = bvLowered
                    BevelWidth = 1
                    BorderWidth = 0
                    BorderStyle = bsNone
                    Caption = ''
                    Color = clBtnFace
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    UseDockManager = True
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    FullRepaint = True
                    Locked = False
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 1
                    TabStop = False
                    Visible = True
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY_Label: TLabel
                      Top = 12
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY_Label: TLabel
                      Top = 37
                    end
                    object usrat_gsIBLookupComboBox_USR_VACATIONTYPE_Label: TLabel
                      Top = 62
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY_Label: TLabel
                      Left = 5
                      Top = 87
                      Width = 76
                      Caption = 'По должности:'
                    end
                    object usrat_xDateDBEdit_USR_DATEEND_Label: TLabel
                      Left = 317
                      Top = 62
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN_Label: TLabel
                      Left = 317
                      Top = 37
                    end
                    object usrat_xDateDBEdit_USR_FROM_Label: TLabel
                      Left = 317
                      Top = 11
                    end
                    object usrat_DBEdit_USR_DURATION_Label: TLabel
                      Left = 501
                      Top = 12
                    end
                    object usrat_DBEdit_USR_EXTRADURATION_Label: TLabel
                      Left = 501
                      Top = 36
                    end
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY: TgsIBLookupComboBox
                      Left = 100
                      Top = 8
                      Width = 180
                      ListTable = 
                        'usr$wg_total t LEFT JOIN GD_DOCUMENT doc ON doc.id = t.documentk' +
                        'ey'
                      ListField = 'usr$name'
                      KeyField = 'documentkey'
                      SortOrder = soAsc
                      Condition = 'parent is null and doc.companykey = <companykey/>'
                      gdClassName = 'TgdcUserDocument'
                      SubType = '147567052_119619099'
                      DropDownCount = 8
                      ParentShowHint = False
                      ShowHint = True
                      TabOrder = 0
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY: TgsIBLookupComboBox
                      Left = 100
                      Top = 33
                      Width = 180
                      Fields = 'usr$wg_listnum'
                      ListTable = 'GD_CONTACT C'
                      SortOrder = soAsc
                      Condition = 
                        'ID in (SELECT usr$emplkey FROM usr$wg_emplworkterm term LEFT JOI' +
                        'N GD_DOCUMENT doc ON doc.id = term.usr$firstmovekey WHERE usr$da' +
                        'tebegin <= :dateend AND (usr$dateend >= :datebegin or usr$dateen' +
                        'd is NULL) AND doc.companykey = <COMPANYKEY/>)'
                      SubType = ''
                      TabOrder = 1
                    end
                    object usrat_gsIBLookupComboBox_USR_VACATIONTYPE: TgsIBLookupComboBox
                      Left = 100
                      Top = 58
                      Width = 180
                      Condition = 'USR$TYPE <> 3'
                      TabOrder = 2
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY: TgsIBLookupComboBox
                      Left = 100
                      Top = 83
                      Width = 180
                      Fields = 'l.POSNAME, l.DEPTNAME, l.KINDOFWORKNAME'
                      ListTable = 'USR$WG_P_FMKLOOKUPSETTINGS (:emplkey, :dateend)  l'
                      ListField = 'l.POSID'
                      KeyField = 'l.FMK'
                      Condition = ''
                      gdClassName = ''
                      ParentShowHint = False
                      ShowHint = True
                      TabOrder = 3
                    end
                    object usrat_DBCheckBox_USR_COMPENSATION: TDBCheckBox
                      Left = 317
                      Top = 87
                      TabOrder = 4
                    end
                    object usrat_xDateDBEdit_USR_FROM: TxDateDBEdit
                      Left = 411
                      Top = 8
                      Width = 68
                      TabOrder = 5
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN: TxDateDBEdit
                      Left = 411
                      Top = 33
                      Width = 68
                      TabOrder = 6
                    end
                    object usrat_xDateDBEdit_USR_DATEEND: TxDateDBEdit
                      Left = 411
                      Top = 58
                      Width = 68
                      TabOrder = 7
                    end
                    object usrat_DBEdit_USR_DURATION: TxDBCalculatorEdit
                      Left = 656
                      Top = 8
                      Width = 60
                      Cursor = crIBeam
                      TabOrder = 8
                    end
                    object usrat_DBEdit_USR_EXTRADURATION: TxDBCalculatorEdit
                      Left = 656
                      Top = 33
                      Width = 60
                      Cursor = crArrow
                      TabOrder = 9
                    end
                  end
                end
                object usrg_TabSheet2: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Атрибуты'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object atContainer: TatContainer
                    Top = 0
                    Width = 1358
                    Height = 245
                    VertScrollBar.Position = 187
                    TabOrder = 0
                    object usrat_DBEdit_NUMBER_Label: TLabel
                      Left = 5
                      Top = -156
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE_Label: TLabel
                      Top = -179
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER_Label: TLabel
                      Left = 5
                      Top = -134
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE_Label: TLabel
                      Top = 228
                    end
                    object usrat_DBEdit_NUMBER: TDBEdit
                      Left = 131
                      Top = -159
                      Width = 100
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE: TxDateDBEdit
                      Left = 131
                      Top = -182
                      Width = 100
                      TabOrder = 1
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER: TxDBCalculatorEdit
                      Left = 131
                      Top = -136
                      Width = 100
                      Cursor = crIBeam
                      TabOrder = 0
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE: TxDBCalculatorEdit
                      Top = 224
                      Cursor = crIBeam
                      TabOrder = 3
                    end
                  end
                end
              end
            end
            object usrg_pAvgSalary: TPanel
              Tag = 0
              Left = 581
              Top = 277
              Width = 785
              Height = 402
              Cursor = crDefault
              Hint = ''
              HelpContext = 0
              Align = alClient
              Alignment = taCenter
              Anchors = [akLeft, akTop, akRight, akBottom]
              AutoSize = False
              BevelInner = bvNone
              BevelOuter = bvNone
              BevelWidth = 1
              BorderWidth = 0
              BorderStyle = bsNone
              Caption = ''
              Color = clBtnFace
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              UseDockManager = True
              DockSite = False
              DragCursor = crDrag
              DragKind = dkDrag
              DragMode = dmManual
              Enabled = True
              FullRepaint = True
              Locked = False
              ParentBiDiMode = True
              ParentColor = False
              ParentCtl3D = True
              ParentFont = True
              ParentShowHint = True
              PopupMenu = nil
              TabOrder = 1
              TabStop = False
              Visible = True
              object usrg_PageControl2: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 785
                Height = 402
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet3
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet3: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Расчет структуры ср. заработка'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_grAvgSalaryStr: TgsIBGrid
                    Tag = 0
                    Left = 0
                    Top = 26
                    Width = 777
                    Height = 348
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    TabStop = True
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    BorderStyle = bsNone
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DataSource = usrg_dsAvgSalaryStr
                    DefaultDrawing = True
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ImeMode = imDontCare
                    ImeName = ''
                    Options = [dgEditing, dgTitles, dgIndicator, dgColumnResize, dgColLines, dgRowLines, dgTabs, dgConfirmDelete, dgCancelOnExit]
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    ReadOnly = True
                    TabOrder = 0
                    Visible = True
                    TableColor = clWindow
                    SelectedColor = clHighlight
                    TitleColor = clBtnFace
                    RefreshType = rtCloseOpen
                    Striped = True
                    StripeOdd = 15201271
                    StripeEven = 14084071
                    InternalMenuKind = imkWithSeparator
                    Expands = <
                      item
                        DisplayField = 'USR$DOW'
                        FieldName = 'USR$HOW'
                        LineCount = 1
                        Options = [ceoAddField]
                      end
                      item
                        DisplayField = 'USR$SCHEDULERDOW'
                        FieldName = 'USR$SCHEDULERHOW'
                        LineCount = 1
                        Options = [ceoAddField]
                      end
                      item
                        DisplayField = 'USR$NEWSALARY'
                        FieldName = 'USR$OLDSALARY'
                        LineCount = 1
                        Options = [ceoAddField]
                      end
                      item
                        DisplayField = 'USR$SALARY'
                        FieldName = 'USR$MODERNSALARY'
                        LineCount = 1
                        Options = [ceoAddField]
                      end>
                    ExpandsActive = False
                    ExpandsSeparate = False
                    TitlesExpanding = False
                    Conditions = <>
                    ConditionsActive = False
                    CheckBox.DisplayField = ''
                    CheckBox.FieldName = ''
                    CheckBox.Visible = True
                    CheckBox.CheckList.Strings = (
                      '')
                    CheckBox.FirstColumn = False
                    ScaleColumns = False
                    MinColWidth = 40
                    ToolBar = nil
                    FinishDrawing = True
                    RememberPosition = True
                    SaveSettings = True
                    ColumnEditors = <
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISCHECK'
                        DisplayField = 'USR$ISCHECK'
                        ValueList.Strings = (
                          'Нет=0'
                          'Да=1')
                        DropDownCount = 3
                      end
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISFULL'
                        DisplayField = 'USR$ISFULL'
                        ValueList.Strings = (
                          'Да=1'
                          'Нет=0')
                        DropDownCount = 3
                      end>
                    Aliases = <>
                    ShowFooter = False
                    ShowTotals = True
                    Columns = <
                      item
                        Expanded = False
                        FieldName = 'USR$ISFULL'
                        ReadOnly = False
                        Title.Caption = 'Полный месяц'
                        Width = 48
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$ISCHECK'
                        ReadOnly = False
                        Title.Caption = 'Вкл.'
                        Width = 48
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = 72
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$SALARY'
                        ReadOnly = False
                        Title.Caption = 'Зарплата'
                        Width = 72
                        Visible = True
                        DisplayFormat = '#.##'
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$COEFF'
                        ReadOnly = False
                        Title.Caption = 'Коэф-т'
                        Width = 52
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$MODERNSALARY'
                        ReadOnly = False
                        Title.Caption = 'Современная зарплата'
                        Width = 84
                        Visible = True
                        DisplayFormat = '#.##'
                        TotalType = ttSum
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$DOW'
                        ReadOnly = False
                        Title.Caption = 'Дни'
                        Width = 36
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERDOW'
                        ReadOnly = False
                        Title.Caption = 'Дней по гр.'
                        Width = 72
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$HOW'
                        ReadOnly = False
                        Title.Caption = 'Часы'
                        Width = 43
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERHOW'
                        ReadOnly = False
                        Title.Caption = 'Часов по гр.'
                        Width = 76
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DESCRIPTION'
                        ReadOnly = False
                        Title.Caption = 'Описание'
                        Width = 222
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$OLDSALARY'
                        ReadOnly = False
                        Title.Caption = 'Оклад'
                        Width = 60
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$NEWSALARY'
                        ReadOnly = False
                        Title.Caption = 'Текущий оклад'
                        Width = 96
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'ID'
                        Title.Caption = 'Идентификатор'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DOCUMENTKEY'
                        ReadOnly = False
                        Title.Caption = 'Документ'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_NUMBER'
                        ReadOnly = False
                        Title.Caption = 'Номер'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOCUMENTDATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOC2715260478'
                        ReadOnly = False
                        Title.Caption = 'Тип документа'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$CALCDAYS'
                        ReadOnly = False
                        Title.Caption = 'Дни расчет.'
                        Width = -1
                        Visible = False
                      end>
                  end
                  object usrg_TBDock1: TTBDock
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 777
                    Height = 26
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    AllowDrag = True
                    Background = nil
                    BackgroundOnToolbars = True
                    BoundLines = []
                    Color = clBtnFace
                    FixAlign = False
                    LimitToOneRow = False
                    PopupMenu = nil
                    Position = dpTop
                    Visible = True
                    object usrg_TBToolbar1: TTBToolbar
                      Tag = 0
                      Left = 0
                      Top = 0
                      Cursor = crDefault
                      HelpContext = 0
                      ActivateParent = True
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      AutoResize = True
                      BorderStyle = bsSingle
                      Caption = 'tbDetail'
                      ChevronMoveItems = True
                      ChevronPriorityForNewItems = tbcpHighest
                      CloseButton = False
                      CloseButtonWhenDocked = False
                      Color = clBtnFace
                      DefaultDock = nil
                      DockableTo = [dpTop, dpBottom, dpLeft, dpRight]
                      DockMode = dmCannotFloatOrChangeDocks
                      DockPos = 0
                      DockRow = 0
                      DragHandleStyle = dhSingle
                      FloatingMode = fmOnTopOfParentForm
                      FloatingWidth = 0
                      FullSize = False
                      HideWhenInactive = True
                      Images = dmImages.il16x16
                      LinkSubitems = nil
                      MenuBar = False
                      Options = []
                      ParentFont = True
                      ParentShowHint = False
                      PopupMenu = nil
                      ProcessShortCuts = False
                      Resizable = True
                      ShowCaption = True
                      ShowHint = True
                      ShrinkMode = tbsmChevron
                      SmoothDrag = True
                      Stretch = True
                      SystemFont = True
                      TabOrder = 0
                      UpdateActions = True
                      UseLastDock = True
                      Visible = True
                      SavedAtRunTime = True
                      object usrg_TBItem2: TTBItem
                        Tag = 0
                        Action = usrg_actAvgNew
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem3: TTBItem
                        Tag = 0
                        Action = usrg_actAvgEdit
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem4: TTBItem
                        Tag = 0
                        Action = usrg_actAvgDelete
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem5: TTBItem
                        Tag = 0
                        Action = usrg_actAvgCopy
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = dmImages.il16x16
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBSeparatorItem3: TTBSeparatorItem
                        Tag = 0
                        Blank = False
                        Hint = ''
                        Visible = True
                      end
                      object usrg_TBItem11: TTBItem
                        Tag = 0
                        Action = usrg_actAvgGenerate
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                    end
                  end
                end
              end
            end
          end
          object alBase: TActionList
            Left = 388
            Top = 8
            object actNew: TAction
            end
            object actHelp: TAction
            end
            object actSecurity: TAction
            end
            object actOk: TAction
            end
            object actCancel: TAction
            end
            object actNextRecord: TAction
            end
            object actPrevRecord: TAction
            end
            object actApply: TAction
            end
            object actFirstRecord: TAction
            end
            object actLastRecord: TAction
            end
            object actProperty: TAction
            end
            object actCopySettingsFromUser: TAction
            end
            object actAddToSetting: TAction
            end
            object actDocumentType: TAction
            end
            object actDistributeUserSettings: TAction
            end
            object actHistory: TAction
            end
            object actDetailNew: TAction
            end
            object actDetailEdit: TAction
            end
            object actDetailDelete: TAction
            end
            object actDetailDuplicate: TAction
            end
            object actDetailPrint: TAction
            end
            object actDetailCut: TAction
            end
            object actDetailCopy: TAction
            end
            object actDetailPaste: TAction
            end
            object actDetailMacro: TAction
            end
            object actDetailProp: TAction
            end
            object usrg_actGenStr: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'usrg_actGenStr'
              Checked = False
              Enabled = False
              HelpContext = 0
              Hint = ''
              ImageIndex = -1
              ShortCut = 0
              Visible = False
            end
            object usrg_actAvgNew: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Новый'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Новый'
              ImageIndex = 0
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgEdit: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Редактировать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Редактировать'
              ImageIndex = 1
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgDelete: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Удалить'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Удалить'
              ImageIndex = 2
              ShortCut = 0
              Visible = True
            end
            object usrg_actGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Рассчитать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Рассчитать ср. заработок'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать ср. заработок'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgCopy: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Копировать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = ''
              ImageIndex = 3
              ShortCut = 0
              Visible = True
            end
          end
          object dsgdcBase: TDataSource
            Left = 421
            Top = 7
          end
          object pm_dlgG: TPopupMenu
            Left = 144
            Top = 232
            object actSecurity1: TMenuItem
            end
            object actHistory1: TMenuItem
            end
            object N1: TMenuItem
            end
            object sepFirst: TMenuItem
            end
            object actNextRecord1: TMenuItem
            end
            object actPrevRecord1: TMenuItem
            end
            object actFirstRecord1: TMenuItem
            end
            object actLastRecord1: TMenuItem
            end
            object sepSecond: TMenuItem
            end
            object actApply1: TMenuItem
            end
            object sepThird: TMenuItem
            end
            object actProperty1: TMenuItem
            end
            object actCopySettings1: TMenuItem
            end
            object nAddToSetting1: TMenuItem
            end
          end
          object ibtrCommon: TIBTransaction
            Params.Strings = (
              'read_committed'
              'rec_version'
              'nowait')
            Left = 752
            Top = 256
          end
          object dsDetail: TDataSource
            Left = 461
            Top = 14
          end
          object gdMacrosMenu: TgdMacrosMenu
            Left = 729
            Top = 119
          end
          object usrg_gdcAvgSalaryStr: TgdcAttrUserDefined
            Tag = 0
            ForcedRefresh = False
            AutoCalcFields = True
            ObjectView = False
            AllowStreamedActive = False
            SubType = 'USR$WG_AVGSALARYSTR'
            MasterSource = dsgdcBase
            MasterField = 'ID'
            DetailField = 'parent'
            SubSet = 'ByParent'
            SetTable = ''
            Active = True
            CachedUpdates = False
            ReadTransaction = gdcUserDocument.ibtrInternal
            Filtered = False
            Left = 684
            Top = 256
          end
          object usrg_dsAvgSalaryStr: TDataSource
            Tag = 0
            AutoEdit = True
            DataSet = usrg_gdcAvgSalaryStr
            Enabled = True
            Left = 717
            Top = 252
          end
        end
        
      EDITIONDATE: 2014-12-18T17:56:03+03:00
  - 
    Properties: 
      Class: "TgdcMacrosGroup"
      RUID: 147021904_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      HASCHILDREN: 1
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTPARENT: ~
      CLASSNAME: ""
      SUBTYPE: ""
      PARENT: ~
      NAME: "Локальные макросы"
      ISGLOBAL: 0
      DESCRIPTION: ~
      EDITIONDATE: 2004-05-05T14:36:35+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147021903_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      NAME: "gdc_dlgUserComplexDocument147020774_119619099"
      DESCRIPTION: ~
      PARENT: ~
      OBJECTTYPE: 0
      MACROSGROUPKEY: "147021904_119619099 Локальные макросы"
      REPORTGROUPKEY: "147021905_119619099 Отчеты(gdc_dlgUserComplexDocument147020774_119619099)"
      CLASSNAME: ""
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      SUBTYPE: ""
      EDITIONDATE: 2004-05-05T14:36:35+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147489128_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_EnableFieldChange
        '#include wg_GetAvgSalarySum
        '#include wg_WageSettings
        option explicit
        function wg_AvgSalaryStrGenerate(ByRef Sender, ByVal CalcType)
        
          dim gdcObject, wg_AvgWage, P, gdcSalary ' wg_Periods,
          dim Avg, i
          dim Creator
          set Creator = New TCreator
        
          Sender.GetComponent("actApply").Execute
        
          set gdcObject = Sender.gdcObject
        
        '  set wg_Periods = New Twg_Periods
          set wg_AvgWage = New Twg_AvgWage
          wg_AvgWage.EmployeeKey = gdcObject.FieldByName("usr$emplkey").AsInteger
            wg_AvgWage.EmployeeKey = gdcObject.FieldByName("usr$emplkey").AsInteger
          if CalcType = 0 then
            wg_AvgWage.FirstMoveKey = gdcObject.FieldByName("usr$firstmovekey").AsInteger
            dim IBSQL
            set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
            IBSQL.Transaction = gdcBaseManager.ReadTransaction
            IBSQL.SQL.Text = _
              "select " & _
              "  t.USR$DATEBEGIN " & _
              "from " & _
              "  usr$wg_total t " & _
              "where " & _
              "  t.DOCUMENTKEY = :TDK "
            IBSQL.ParamByName("TDK").asInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
            IBSQL.ExecQuery
            wg_AvgWage.BeginDate = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          else
            wg_AvgWage.BeginDate = gdcObject.FieldByName("usr$from").AsVariant
          end if
          wg_AvgWage.EndDate =  gdcObject.FieldByName("usr$dateend").AsVariant
          wg_AvgWage.Compensation = (gdcObject.FieldByName("USR$COMPENSATION").AsInteger = 1 )
          wg_AvgWage.FeeGroupKey = gdcObject.FieldByName("USR$FEEGROUPKEY").AsInteger
          wg_AvgWage.Period = gdcObject.FieldByName("USR$AVGPERIOD").AsInteger
          wg_AvgWage.CalcType = CalcType
        
          Avg = wg_AvgWage.AvgWage
          set P = wg_AvgWage.Periods
        
          ' если больничные - только сумма и выходим
          if CalcType = 1 then
            gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = Avg
            exit function
          end if
        
          set gdcSalary = Sender.GetComponent("usrg_gdcAvgSalaryStr")
          call wg_DisableFieldChange(gdcSalary, "AVGSALARYCALC")
        
          gdcSalary.First
          while not gdcSalary.EOF
            gdcSalary.Delete
          wend
        
          for i = 1 to P.Count
            if not ((P.Item(i).Sum = 0) and (P.Item(i).WorkDays =0) and (P.Item(i).WorkHours = 0)) and P.Item(i).ExistMove then
              gdcSalary.Append
              gdcSalary.FieldByName("USR$DATE").AsVariant = P.Item(i).DateBegin
              gdcSalary.FieldByName("USR$SALARY").AsVariant = P.Item(i).Sum
              gdcSalary.FieldByName("USR$COEFF").AsVariant = P.Item(i).coeff
              gdcSalary.FieldByName("USR$DOW").AsVariant = P.Item(i).WorkDays 'wg_WageSettings.Wage.AvgDayInMonth '29.7
              gdcSalary.FieldByName("USR$HOW").AsVariant = P.Item(i).WorkHours
              gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = P.Item(i).SchedulerWorkDays 'wg_WageSettings.Wage.AvgDayInMonth '29.7
              gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = P.Item(i).SchedulerWorkHours
              gdcSalary.FieldByName("USR$OLDSALARY").AsVariant = P.Item(i).OldSalary
              gdcSalary.FieldByName("USR$NEWSALARY").AsVariant = P.Item(i).NewSalary
              gdcSalary.FieldByName("USR$ISCHECK").AsVariant = Abs(CInt(P.Item(i).IsCheck))
              gdcSalary.FieldByName("USR$ISFULL").AsVariant = Abs(CInt(P.Item(i).IsFull))
              gdcSalary.Post
            end if
          next
          gdcSalary.First
        
          call wg_EnableFieldChange(gdcSalary, "AVGSALARYCALC")
          wg_GetAvgSalarySum(gdcSalary)
        end function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        UFJTVAgAAABDQUxDVFlQRQgAAABDQUxDVFlQRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-22T14:33:31+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "147368587_274788016 wg_GetAvgSalarySum"
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151164077_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros151164077_5956463"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate
        
        Sub Macros151164077_5956463(OwnerForm)
          'Dim Ret
          
          call wg_AvgSalaryStrGenerate(OwnerForm, 0)
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS151164077_5956463
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-01-10T16:42:52+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147489128_336327731 wg_AvgSalaryStrGenerate"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 151164075_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MACROSGROUPKEY: "147021904_119619099 Локальные макросы"
      FUNCTIONKEY: "151164077_5956463 Macros151164077_5956463"
      NAME: "Рассчитать ср. заработок"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-01-10T16:42:52+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147488902_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147488903_336327731
    Fields: 
      NAME: "usrg_actAvgGenerate"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actAvgGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-03-17T12:29:19+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147488905_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147488903_336327731
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actAvgGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_AvgSalaryStrGenerate_pl
        option explicit
        sub usrg_actAvgGenerateOnExecute(ByVal Sender)
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          Dim Ret
          Ret = wg_AvgSalaryStrGenerate_pl(Sender.OwnerForm, 0)
        
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_ACTAVGGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-01-10T16:18:57+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151163587_5956463 wg_AvgSalaryStrGenerate_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147488903_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actAvgGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147488902_336327731 gdc_dlgUserComplexDocument147020774_119619099\\usrg_actAvgGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147488905_336327731 usrg_actAvgGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2005-06-30T10:58:02+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147352480_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147352481_274788016
    Fields: 
      NAME: "usrg_actGenerate"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-01-20T15:51:14+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147352483_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147352481_274788016
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#wg_LastDayInMonth
        '#include wg_AvgSalaryDetailGenerate_pl
        
        sub usrg_actGenerateOnExecute(ByVal Sender)
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          Dim Ret
          Ret = wg_AvgSalaryDetailGenerate_pl(Sender.OwnerForm)
        
          'Sender.OwnerForm.GetComponent("ibgrDetail").SetFocus
          'set wg_Structure = Sender.OwnerForm.Objects("Structure")
          'call wg_Structure.CreateHolidayStructure(Sender.OwnerForm)
        
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_ACTGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-13T18:35:55+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "156300136_119200397 wg_AvgSalaryDetailGenerate_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147352481_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147352480_274788016 gdc_dlgUserComplexDocument147020774_119619099\\usrg_actGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147352483_274788016 usrg_actGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-03-13T18:35:56+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147107645_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147107643_584838465
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "gdc_dlgUserComplexDocument147020774_119619099OnLoadSettingsAfterCreate"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        '#include wg_AvgSalary_CoefOption
        
        sub gdc_dlgUserComplexDocument147020774_119619099OnLoadSettingsAfterCreate(ByVal Sender)
        '*** Данный код необходим для вызова встроенного обработчика ***
        '*** В случае его удаления возможно нарушение работы системы ***
          call   Inherited(Sender, "OnLoadSettingsAfterCreate", Array(Sender))
        '*** конец кода поддержки встроенного обработчика            ***
          set S = wg_WageSettings
        
          ''оключено
          'set chboxCoefInflation = Sender.GetComponent("usrg_chboxCoefInflation")
          'chboxCoefInflation.Checked = S.Wage.CoefInflation
          ''сейчас используется
          wg_AvgSalary_CoefOption(Sender)
          '
        
          'Устарело
          if not Sender.VariableExists("Coeff") then
           Sender.AddVariableItem("Coeff")
          end if
          Sender.Variables("Coeff") = S.Wage.CoefInflation
          'Новые
          set rbSalaryInf = Sender.GetComponent("usrg_rbSalaryInf")
          set rbRateInf = Sender.GetComponent("usrg_rbRateInf")
          set rbPersCoeffInf = Sender.GetComponent("usrg_rbPersCoeffInf")
          select case S.Inflation.InflType
            case 0
              Sender.GetComponent("usrg_rbSalaryInf").Checked = True
            case 1
              Sender.GetComponent("usrg_rbRateInf").Checked = True
            case 2
              Sender.GetComponent("usrg_rbPersCoeffInf").Checked = True
          end select
          if not Sender.VariableExists("NewCoeff") then
            Sender.AddVariableItem("NewCoeff")
          end if
          Sender.Variables("NewCoeff") = S.Inflation.InflType
        end sub
        
      DISPLAYSCRIPT: | 
        GDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099ONLOADSETTINGSAFTERCREATE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONLOADSETTINGSAFTERCREATE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-26T14:18:46+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
          - 
            ADDFUNCTIONKEY: "156299481_119200397 wg_AvgSalary_CoefOption"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147107643_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      PARENTNAME: ~
      OBJECTKEY: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      EVENTNAME: "ONLOADSETTINGSAFTERCREATE"
      FUNCTIONKEY: "147107645_584838465 gdc_dlgUserComplexDocument147020774_119619099OnLoadSettingsAfterCreate"
      DISABLE: ~
      EDITIONDATE: 2014-03-26T14:18:46+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147107754_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147107903_584838465
    Fields: 
      NAME: "usrg_chboxCoefInflation"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_chboxCoefInflation"
      SUBTYPE: ""
      EDITIONDATE: 2006-06-15T10:53:41+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147107905_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147107903_584838465
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_chboxCoefInflationOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        sub usrg_chboxCoefInflationOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          set S = wg_WageSettings
          set chboxCoefInflation = Sender
          S.Wage.CoefInflation = chboxCoefInflation.Checked
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_CHBOXCOEFINFLATIONONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:26:40+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147107903_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_chboxCoefInflation"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147107754_584838465 gdc_dlgUserComplexDocument147020774_119619099\\usrg_chboxCoefInflation"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147107905_584838465 usrg_chboxCoefInflationOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:26:41+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147036259_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036260_781744915
    Fields: 
      NAME: "usrg_rbPersCoeffInf"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_rbPersCoeffInf"
      SUBTYPE: ""
      EDITIONDATE: 2007-04-02T14:55:25+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147036262_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036260_781744915
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_rbPersCoeffInfOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        option explicit
        sub usrg_rbPersCoeffInfOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          dim S
          set S = wg_WageSettings
          if Sender.Checked then
            S.Inflation.InflType = 2
          end if
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_RBPERSCOEFFINFONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:06:09+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147036260_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_rbPersCoeffInf"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147036259_781744915 gdc_dlgUserComplexDocument147020774_119619099\\usrg_rbPersCoeffInf"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147036262_781744915 usrg_rbPersCoeffInfOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:06:09+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147036255_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036256_781744915
    Fields: 
      NAME: "usrg_rbRateInf"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_rbRateInf"
      SUBTYPE: ""
      EDITIONDATE: 2007-04-02T14:55:17+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147036258_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036256_781744915
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_rbRateInfOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        option explicit
        sub usrg_rbRateInfOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          dim S
          set S = wg_WageSettings
          if Sender.Checked then
            S.Inflation.InflType = 1
          end if
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_RBRATEINFONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:26:35+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147036256_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_rbRateInf"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147036255_781744915 gdc_dlgUserComplexDocument147020774_119619099\\usrg_rbRateInf"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147036258_781744915 usrg_rbRateInfOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:26:35+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147036251_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036252_781744915
    Fields: 
      NAME: "usrg_rbSalaryInf"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_rbSalaryInf"
      SUBTYPE: ""
      EDITIONDATE: 2007-04-02T14:55:00+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147036254_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036252_781744915
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_rbSalaryInfOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        option explicit
        sub usrg_rbSalaryInfOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          dim S
          set S = wg_WageSettings
          if Sender.Checked then
            S.Inflation.InflType = 0
          end if
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_RBSALARYINFONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:26:29+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147036252_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_rbSalaryInf"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147036251_781744915 gdc_dlgUserComplexDocument147020774_119619099\\usrg_rbSalaryInf"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147036254_781744915 usrg_rbSalaryInfOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:26:29+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123486_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      PARENT: "147240236_1234867257 GLOBAL\\DFM\\Tgdc_dlgUserComplexDocument"
      NAME: "147022845_119619099"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: | 
        object gdc_dlgUserComplexDocument147022845_119619099: Tgdc_dlgUserComplexDocument
          Left = -8
          Top = -8
          ActiveControl = nil
          WindowState = wsMaximized
          PixelsPerInch = 96
          TextHeight = 13
          object btnAccess: TButton
            TabOrder = 3
          end
          object btnNew: TButton
            TabOrder = 4
          end
          object btnHelp: TButton
            TabOrder = 5
          end
          object btnOK: TButton
            TabOrder = 1
          end
          object btnCancel: TButton
            TabOrder = 2
          end
          object pnlMain: TPanel
            TabOrder = 0
            object splMain: TSplitter
            end
            object usrg_Splitter1: TSplitter
              Tag = 0
              Left = 541
              Top = 291
              Width = 6
              Height = 388
              Cursor = crHSplit
              Hint = ''
              Align = alLeft
              AutoSnap = True
              Beveled = False
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              MinSize = 30
              ParentColor = True
              ResizeStyle = rsPattern
              Visible = True
            end
            object pnlDetail: TPanel
              Width = 541
              Align = alLeft
              Anchors = [akLeft, akTop, akBottom]
              TabOrder = 1
              object ibgrDetail: TgsIBGrid
                Left = 0
                Width = 541
                Height = 362
                ReadOnly = True
                Expands = <>
                Conditions = <>
                ColumnEditors = <>
                Aliases = <>
                Columns = <
                  item
                    Expanded = False
                    FieldName = 'USR$INCLUDEDATE'
                    ReadOnly = False
                    Title.Caption = 'Месяц зачисления'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$PERCENT'
                    ReadOnly = False
                    Title.Caption = '%'
                    Width = 36
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$DOI'
                    ReadOnly = False
                    Title.Caption = 'Дни'
                    Width = 48
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$HOI'
                    ReadOnly = False
                    Title.Caption = 'Часы'
                    Width = 48
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$SUMMA'
                    ReadOnly = False
                    Title.Caption = 'Сумма'
                    Width = 72
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEBEGIN'
                    ReadOnly = False
                    Title.Caption = 'Дата начала'
                    Width = 84
                    Visible = True
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEEND'
                    ReadOnly = False
                    Title.Caption = 'Дата окончания'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'SUMNCU'
                    ReadOnly = False
                    Title.Caption = 'Начислено'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DESCRIPTION'
                    ReadOnly = False
                    Title.Caption = 'Описание'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$SORTNUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер для сортировки'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'ID'
                    ReadOnly = False
                    Title.Caption = 'Ключ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PARENT'
                    ReadOnly = False
                    Title.Caption = 'Родитель'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип транзакции'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRANSACTIONKEY'
                    ReadOnly = False
                    Title.Caption = 'Транзакция'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'NUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMCURR'
                    ReadOnly = False
                    Title.Caption = 'Сумма в валюте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DELAYED'
                    ReadOnly = False
                    Title.Caption = 'Отложенный'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CURRKEY'
                    ReadOnly = False
                    Title.Caption = 'Валюта'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'COMPANYKEY'
                    ReadOnly = False
                    Title.Caption = 'Компания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто создал'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата создания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто исправил'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата изменения'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PRINTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата печати'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DISABLED'
                    ReadOnly = False
                    Title.Caption = 'Отключено'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED'
                    ReadOnly = False
                    Title.Caption = 'Зарезервировано'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTKEY'
                    Title.Caption = 'Ключ документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'MASTERKEY'
                    Title.Caption = 'Родитель (05.Начисление болничных(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED1'
                    Title.Caption = 'Зарезервировано (05.Начисление болничных(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$ACCDATE'
                    ReadOnly = False
                    Title.Caption = 'Месяц начисления'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMEQ'
                    ReadOnly = False
                    Title.Caption = 'Сумма в эквиваленте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$EQRATE'
                    ReadOnly = False
                    Title.Caption = 'Курс экв.'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AFULL'
                    ReadOnly = False
                    Title.Caption = 'Полный доступ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'ACHAG'
                    ReadOnly = False
                    Title.Caption = 'Просмотр и редактирование'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AVIEW'
                    ReadOnly = False
                    Title.Caption = 'Только просмотр'
                    Width = -1
                    Visible = False
                  end>
              end
              object tbdTop: TTBDock
                Width = 541
                object tbDetail: TTBToolbar
                  DockPos = 1
                  SavedAtRunTime = True
                  object tbNew: TTBItem
                  end
                  object tbEdit: TTBItem
                  end
                  object tbDelete: TTBItem
                  end
                  object tbDuplicate: TTBItem
                  end
                  object tbiDetailProperties: TTBItem
                  end
                  object TBSeparatorItem1: TTBSeparatorItem
                  end
                  object tbCopy: TTBItem
                  end
                  object tbCut: TTBItem
                  end
                  object tbPaste: TTBItem
                  end
                  object TBSeparatorItem2: TTBSeparatorItem
                  end
                  object tbMacro: TTBItem
                  end
                  object usrg_TBSeparatorItem1: TTBSeparatorItem
                    Tag = 0
                    Blank = False
                    Hint = ''
                    Visible = True
                  end
                  object usrg_TBItem2: TTBItem
                    Tag = 0
                    Action = usrg_actGenerate
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_TBItem1: TTBItem
                    Tag = 0
                    Action = usrg_actStrGen
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_tbFeesByEmpl: TTBItem
                    Tag = 0
                    Action = nil
                    AutoCheck = False
                    Caption = 'Итоговое'
                    Checked = False
                    DisplayMode = nbdmDefault
                    Enabled = True
                    GroupIndex = 0
                    HelpContext = 0
                    Hint = ''
                    ImageIndex = -1
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                    ShortCut = 0
                    Visible = True
                  end
                end
              end
              object tbdLeft: TTBDock
                Width = 0
                Height = 362
              end
              object tbdRight: TTBDock
                Left = 541
                Width = 0
                Height = 362
              end
              object tbdBottom: TTBDock
                Top = 388
                Width = 541
                Height = 0
              end
            end
            object pnlMaster: TPanel
              Constraints.MinHeight = 215
              TabOrder = 0
              object pnlHolding: TPanel
                Width = 1366
                TabOrder = 1
                object lblCompany: TLabel
                end
                object iblkCompany: TgsIBLookupComboBox
                end
              end
              object usrg_PageControl1: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 1366
                Height = 287
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet1
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet1: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Основные'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_GroupBox1: TGroupBox
                    Tag = 0
                    Left = 0
                    Top = 128
                    Width = 1358
                    Height = 131
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    Caption = ' Средний заработок '
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ParentBiDiMode = True
                    ParentColor = True
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 1
                    TabStop = False
                    Visible = True
                    object usrat_DBEdit_USR_AVGPERIOD_Label: TLabel
                      Left = 7
                      Top = 44
                      Width = 119
                      Caption = 'Период формирования:'
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY_Label: TLabel
                      Left = 7
                      Top = 20
                    end
                    object usrat_DBEdit_USR_AVGSUMMA_Label: TLabel
                      Left = 373
                      Top = 20
                    end
                    object usrat_DBEdit_USR_AVGPERIOD: TxDBCalculatorEdit
                      Left = 143
                      Top = 40
                      Width = 100
                      Cursor = crIBeam
                      TabOrder = 1
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY: TgsIBLookupComboBox
                      Left = 143
                      Top = 16
                      Width = 212
                      ListTable = 
                        'USR$WG_FEEGROUP fg LEFT JOIN USR$WG_FEEGROUP fg1 ON fg.lb > fg1.' +
                        'lb AND fg.rb < fg1.rb'
                      Condition = 'fg1.id = <RUID XID = 147274328 DBID = 274788016/>'
                      TabOrder = 0
                    end
                    object usrat_DBEdit_USR_AVGSUMMA: TxDBCalculatorEdit
                      Left = 467
                      Top = 16
                      Width = 93
                      Cursor = crIBeam
                      ReadOnly = True
                      TabOrder = 4
                    end
                    object usrat_DBCheckBox_USR_BYSTAFFSALARY: TDBCheckBox
                      Left = 375
                      Top = 56
                      Width = 161
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_DBCheckBox_USR_CALCBYHOUR: TDBCheckBox
                      Left = 375
                      Top = 73
                      Width = 114
                      TabOrder = 3
                      ValueChecked = '1'
                      ValueUnchecked = '0'
                      Visible = False
                    end
                    object usrat_DBCheckBox_USR_CALCBYBUDGET: TDBCheckBox
                      Left = 8
                      Top = 86
                      Hint = '50% от БМП'
                      Caption = '50% от БПМ'
                      ReadOnly = True
                    end
                    object usrat_DBCheckBox_USR_THIRDMETHOD: TDBCheckBox
                      Left = 8
                      Top = 67
                      Width = 117
                      Caption = 'Расчёт от ставки'
                      ReadOnly = True
                    end
                    object usrat_DBCheckBox_USR_REFERENCE: TDBCheckBox
                      Left = 143
                      Top = 77
                      TabOrder = 7
                    end
                    object usrat_DBCheckBox_USR_AVERAGE: TDBCheckBox
                      Left = 8
                      Top = 103
                      Width = 149
                      Caption = 'От среднего заработка'
                      ReadOnly = True
                      TabOrder = 8
                    end
                  end
                  object usrg_Panel1: TPanel
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 1358
                    Height = 128
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alTop
                    Alignment = taCenter
                    Anchors = [akLeft, akTop, akRight]
                    AutoSize = False
                    BevelInner = bvRaised
                    BevelOuter = bvLowered
                    BevelWidth = 1
                    BorderWidth = 0
                    BorderStyle = bsNone
                    Caption = ''
                    Color = clBtnFace
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    UseDockManager = True
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    FullRepaint = True
                    Locked = False
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 0
                    TabStop = False
                    Visible = True
                    object usrg_Label1: TLabel
                      Tag = 0
                      Left = 7
                      Top = 80
                      Width = 66
                      Height = 13
                      Cursor = crDefault
                      Hint = ''
                      Align = alNone
                      Alignment = taLeftJustify
                      Anchors = [akLeft, akTop]
                      AutoSize = True
                      Caption = 'Тип расчета:'
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = True
                      FocusControl = nil
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      ShowAccelChar = True
                      Transparent = True
                      Layout = tlTop
                      Visible = True
                      WordWrap = False
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY_Label: TLabel
                      Left = 7
                      Top = 35
                    end
                    object usrat_xDateDBEdit_USR_FROM_Label: TLabel
                      Left = 317
                      Top = 12
                    end
                    object usrat_gsIBLookupComboBox_USR_ILLTYPEKEY_Label: TLabel
                      Left = 7
                      Top = 58
                    end
                    object usrat_xDateDBEdit_USR_DATEEND_Label: TLabel
                      Left = 317
                      Top = 58
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN_Label: TLabel
                      Left = 317
                      Top = 35
                    end
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY_Label: TLabel
                      Left = 7
                      Top = 12
                    end
                    object usrat_DBEdit_USR_PERCENT_Label: TLabel
                      Left = 317
                      Top = 81
                      Width = 91
                      Caption = 'Процент пособия:'
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY_Label: TLabel
                      Left = 8
                      Top = 104
                      Width = 76
                      Caption = 'По должности:'
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDE_Label: TLabel
                      Left = 586
                      Top = 58
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDB_Label: TLabel
                      Left = 587
                      Top = 35
                    end
                    object usrg_cbCalcType: TComboBox
                      Tag = 0
                      Left = 133
                      Top = 77
                      Width = 156
                      Height = 21
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      TabStop = True
                      Style = csDropDownList
                      Anchors = [akLeft, akTop]
                      Color = clWindow
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      DropDownCount = 3
                      Enabled = True
                      ImeMode = imDontCare
                      ImeName = ''
                      ItemHeight = 13
                      MaxLength = 0
                      ParentBiDiMode = True
                      ParentColor = False
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      Sorted = False
                      TabOrder = 3
                      Text = '12 дн. 80%, ост. 100%'
                      Visible = True
                      Items.Strings = (
                        '12 дн. 80%, ост. 100%'
                        'Все дни 100%'
                        '12 дн. 40% (6 дн. не оплач), ост. 50%'
                        '12 дн. 40%, ост. 50%')
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 31
                      Width = 156
                      ListTable = 
                        'GD_CONTACT C JOIN GD_CONTACT CC ON CC.LB <= C.LB AND CC.RB >= C.' +
                        'RB'
                      SortOrder = soAsc
                      Condition = 'c.contacttype = 2 AND cc.id = <COMPANYKEY/>'
                      SubType = ''
                      TabOrder = 1
                    end
                    object usrat_xDateDBEdit_USR_FROM: TxDateDBEdit
                      Left = 491
                      Top = 8
                      Width = 68
                      TabOrder = 5
                    end
                    object usrat_gsIBLookupComboBox_USR_ILLTYPEKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 54
                      Width = 156
                      TabOrder = 2
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN: TxDateDBEdit
                      Left = 491
                      Top = 31
                      Width = 68
                      TabOrder = 6
                    end
                    object usrat_xDateDBEdit_USR_DATEEND: TxDateDBEdit
                      Left = 491
                      Top = 54
                      Width = 68
                      TabOrder = 7
                    end
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 8
                      Width = 156
                      ListTable = 
                        'usr$wg_total t LEFT JOIN GD_DOCUMENT doc ON doc.id = t.documentk' +
                        'ey'
                      ListField = 'usr$name'
                      KeyField = 'documentkey'
                      SortOrder = soAsc
                      Condition = 'parent is null and doc.companykey = <companykey/>'
                      gdClassName = 'TgdcUserDocument'
                      SubType = '147567052_119619099'
                      ParentShowHint = False
                      ShowHint = True
                      TabOrder = 0
                    end
                    object usrat_DBEdit_USR_PERCENT: TxDBCalculatorEdit
                      Left = 491
                      Top = 77
                      Width = 69
                      Cursor = crIBeam
                      TabOrder = 8
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 101
                      Width = 156
                      Fields = 'l.POSNAME, l.DEPTNAME, l.KINDOFWORKNAME'
                      ListTable = 'USR$WG_P_FMKLOOKUPSETTINGS (:emplkey, :dateend)  l'
                      ListField = 'l.POSID'
                      KeyField = 'l.FMK'
                      Condition = ''
                      TabOrder = 4
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDB: TxDateDBEdit
                      Left = 716
                      Top = 31
                      Width = 68
                      TabOrder = 9
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDE: TxDateDBEdit
                      Left = 716
                      Top = 54
                      Width = 68
                      TabOrder = 10
                    end
                  end
                end
                object usrg_TabSheet2: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Атрибуты'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object atContainer: TatContainer
                    Top = 0
                    Width = 1358
                    Height = 234
                    VertScrollBar.Position = 274
                    TabOrder = 0
                    Visible = False
                    object usrat_DBEdit_USR_DURATION_Label: TLabel
                      Top = -58
                      Visible = False
                    end
                    object usrat_DBEdit_USR_CALCTYPE_Label: TLabel
                      Left = 29
                      Top = -169
                      Visible = False
                    end
                    object usrat_DBEdit_NUMBER_Label: TLabel
                      Left = 5
                      Top = -242
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE_Label: TLabel
                      Top = -266
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER_Label: TLabel
                      Left = 5
                      Top = -213
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE_Label: TLabel
                      Top = 217
                    end
                    object usrat_DBEdit_USR_DURATION: TxDBCalculatorEdit
                      Top = -62
                      Cursor = crIBeam
                      TabOrder = 4
                      Visible = False
                    end
                    object usrat_DBEdit_USR_CALCTYPE: TxDBCalculatorEdit
                      Left = 157
                      Top = -173
                      Width = 156
                      Cursor = crIBeam
                      TabOrder = 3
                      Visible = False
                    end
                    object usrat_DBEdit_NUMBER: TDBEdit
                      Left = 163
                      Top = -246
                      Width = 101
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE: TxDateDBEdit
                      Left = 163
                      Top = -270
                      Width = 102
                      TabOrder = 1
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER: TxDBCalculatorEdit
                      Left = 163
                      Top = -213
                      Cursor = crIBeam
                      TabOrder = 0
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE: TxDBCalculatorEdit
                      Top = 213
                      Cursor = crIBeam
                      TabOrder = 5
                    end
                  end
                end
              end
            end
            object usrg_pAvgSalary: TPanel
              Tag = 0
              Left = 547
              Top = 291
              Width = 819
              Height = 388
              Cursor = crDefault
              Hint = ''
              HelpContext = 0
              Align = alClient
              Alignment = taCenter
              Anchors = [akLeft, akTop, akRight, akBottom]
              AutoSize = False
              BevelInner = bvNone
              BevelOuter = bvNone
              BevelWidth = 1
              BorderWidth = 0
              BorderStyle = bsNone
              Caption = ''
              Color = clBtnFace
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              UseDockManager = True
              DockSite = False
              DragCursor = crDrag
              DragKind = dkDrag
              DragMode = dmManual
              Enabled = True
              FullRepaint = True
              Locked = False
              ParentBiDiMode = True
              ParentColor = False
              ParentCtl3D = True
              ParentFont = True
              ParentShowHint = True
              PopupMenu = nil
              TabOrder = 2
              TabStop = False
              Visible = True
              object usrg_PageControl2: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 819
                Height = 388
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet3
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet3: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Расчет структуры ср. заработка'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_grAvgSalaryStr: TgsIBGrid
                    Tag = 0
                    Left = 0
                    Top = 26
                    Width = 811
                    Height = 334
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    TabStop = True
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    BorderStyle = bsNone
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DataSource = usrg_dsAvgSalaryStr
                    DefaultDrawing = True
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ImeMode = imDontCare
                    ImeName = ''
                    Options = [dgEditing, dgTitles, dgIndicator, dgColumnResize, dgColLines, dgRowLines, dgTabs, dgConfirmDelete, dgCancelOnExit, dgMultiSelect]
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    ReadOnly = True
                    TabOrder = 0
                    Visible = True
                    TableColor = clWindow
                    SelectedColor = clHighlight
                    TitleColor = clBtnFace
                    RefreshType = rtCloseOpen
                    Striped = True
                    StripeOdd = 15201271
                    StripeEven = 14084071
                    InternalMenuKind = imkWithSeparator
                    Expands = <>
                    ExpandsActive = False
                    ExpandsSeparate = False
                    TitlesExpanding = False
                    Conditions = <>
                    ConditionsActive = False
                    CheckBox.DisplayField = 'USR$ISCHECK'
                    CheckBox.FieldName = 'USR$ISCHECK'
                    CheckBox.Visible = False
                    CheckBox.FirstColumn = False
                    ScaleColumns = False
                    MinColWidth = 40
                    ToolBar = nil
                    FinishDrawing = True
                    RememberPosition = True
                    SaveSettings = True
                    ColumnEditors = <
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISCHECK'
                        DisplayField = 'USR$ISCHECK'
                        ValueList.Strings = (
                          'Нет=0'
                          'Да=1')
                        DropDownCount = 3
                      end
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISFULL'
                        DisplayField = 'USR$ISFULL'
                        ValueList.Strings = (
                          'Да=1'
                          'Нет=0')
                        DropDownCount = 3
                      end>
                    Aliases = <>
                    ShowFooter = False
                    ShowTotals = True
                    Columns = <
                      item
                        Expanded = False
                        FieldName = 'USR$ISFULL'
                        ReadOnly = False
                        Title.Caption = 'Полный месяц'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = 72
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$CALCDAYS'
                        ReadOnly = False
                        Title.Caption = 'Дни расчет.'
                        Width = 78
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$SALARY'
                        ReadOnly = False
                        Title.Caption = 'Зарплата'
                        Width = 72
                        Visible = True
                        DisplayFormat = '#.##'
                        TotalType = ttSum
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$DOW'
                        ReadOnly = False
                        Title.Caption = 'Дни работы'
                        Width = 78
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERDOW'
                        ReadOnly = False
                        Title.Caption = 'Дней по графику'
                        Width = 84
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$HOW'
                        ReadOnly = False
                        Title.Caption = 'Часы работы'
                        Width = 66
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERHOW'
                        ReadOnly = False
                        Title.Caption = 'Часов по графику'
                        Width = 90
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DESCRIPTION'
                        ReadOnly = False
                        Title.Caption = 'Описание'
                        Width = 121
                        Visible = True
                      end
                      item
                        Color = clWhite
                        Expanded = False
                        FieldName = 'USR$MODERNSALARY'
                        ReadOnly = False
                        Title.Caption = 'Современная зарплата'
                        Width = -1
                        Visible = False
                        DisplayFormat = '#.##'
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$COEFF'
                        ReadOnly = False
                        Title.Caption = 'Коэф-т'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$ISCHECK'
                        ReadOnly = False
                        Title.Caption = 'Вкл.'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$OLDSALARY'
                        ReadOnly = False
                        Title.Caption = 'Оклад'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$NEWSALARY'
                        ReadOnly = False
                        Title.Caption = 'Ставка'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'ID'
                        Title.Caption = 'Идентификатор'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DOCUMENTKEY'
                        ReadOnly = False
                        Title.Caption = 'Документ'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_NUMBER'
                        ReadOnly = False
                        Title.Caption = 'Номер'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOCUMENTDATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOC2715260478'
                        ReadOnly = False
                        Title.Caption = 'Тип документа'
                        Width = -1
                        Visible = False
                      end>
                  end
                  object usrg_TBDock1: TTBDock
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 811
                    Height = 26
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    AllowDrag = True
                    Background = nil
                    BackgroundOnToolbars = True
                    BoundLines = []
                    Color = clBtnFace
                    FixAlign = False
                    LimitToOneRow = False
                    PopupMenu = nil
                    Position = dpTop
                    Visible = True
                    object usrg_TBToolbar1: TTBToolbar
                      Tag = 0
                      Left = 0
                      Top = 0
                      Cursor = crDefault
                      HelpContext = 0
                      ActivateParent = True
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      AutoResize = True
                      BorderStyle = bsSingle
                      Caption = 'tbDetail'
                      ChevronMoveItems = True
                      ChevronPriorityForNewItems = tbcpHighest
                      CloseButton = False
                      CloseButtonWhenDocked = False
                      Color = clBtnFace
                      DefaultDock = nil
                      DockableTo = [dpTop, dpBottom, dpLeft, dpRight]
                      DockMode = dmCannotFloatOrChangeDocks
                      DockPos = 0
                      DockRow = 0
                      DragHandleStyle = dhSingle
                      FloatingMode = fmOnTopOfParentForm
                      FloatingWidth = 0
                      FullSize = False
                      HideWhenInactive = True
                      Images = dmImages.il16x16
                      LinkSubitems = nil
                      MenuBar = False
                      Options = []
                      ParentFont = True
                      ParentShowHint = False
                      PopupMenu = nil
                      ProcessShortCuts = False
                      Resizable = True
                      ShowCaption = True
                      ShowHint = True
                      ShrinkMode = tbsmChevron
                      SmoothDrag = True
                      Stretch = True
                      SystemFont = True
                      TabOrder = 0
                      UpdateActions = True
                      UseLastDock = True
                      Visible = True
                      SavedAtRunTime = True
                      object usrg_TBItem3: TTBItem
                        Tag = 0
                        Action = usrg_actAvgSalaryNew
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem4: TTBItem
                        Tag = 0
                        Action = usrg_actAvgSalaryEdit
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem5: TTBItem
                        Tag = 0
                        Action = usrg_actAvgSalaryDelete
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem6: TTBItem
                        Tag = 0
                        Action = nil
                        AutoCheck = False
                        Caption = 'Дубликат'
                        Checked = False
                        DisplayMode = nbdmDefault
                        Enabled = True
                        GroupIndex = 0
                        HelpContext = 0
                        Hint = 'Дубликат'
                        ImageIndex = 3
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                        ShortCut = 49237
                        Visible = False
                      end
                      object usrg_TBSeparatorItem2: TTBSeparatorItem
                        Tag = 0
                        Blank = False
                        Hint = ''
                        Visible = True
                      end
                      object usrg_TBItem7: TTBItem
                        Tag = 0
                        Action = usrg_actAvgGenerate
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                    end
                  end
                end
                object usrg_TabSheet4: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Структура больничного'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = False
                  object usrg_TBDock2: TTBDock
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 811
                    Height = 26
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    AllowDrag = True
                    Background = nil
                    BackgroundOnToolbars = True
                    BoundLines = []
                    Color = clBtnFace
                    FixAlign = False
                    LimitToOneRow = False
                    PopupMenu = nil
                    Position = dpTop
                    Visible = True
                    object usrg_TBToolbar2: TTBToolbar
                      Tag = 0
                      Left = 0
                      Top = 0
                      Cursor = crDefault
                      HelpContext = 0
                      ActivateParent = True
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      AutoResize = True
                      BorderStyle = bsSingle
                      Caption = 'usrg_TBToolbar2'
                      ChevronMoveItems = True
                      ChevronPriorityForNewItems = tbcpHighest
                      CloseButton = False
                      CloseButtonWhenDocked = False
                      Color = clBtnFace
                      DefaultDock = nil
                      DockableTo = [dpTop, dpBottom, dpLeft, dpRight]
                      DockMode = dmCannotFloatOrChangeDocks
                      DockPos = -1
                      DockRow = 0
                      DragHandleStyle = dhSingle
                      FloatingMode = fmOnTopOfParentForm
                      FloatingWidth = 0
                      FullSize = False
                      HideWhenInactive = True
                      Images = dmImages.il16x16
                      LinkSubitems = nil
                      MenuBar = False
                      Options = []
                      ParentFont = True
                      ParentShowHint = False
                      PopupMenu = nil
                      ProcessShortCuts = False
                      Resizable = True
                      ShowCaption = True
                      ShowHint = True
                      ShrinkMode = tbsmChevron
                      SmoothDrag = True
                      Stretch = True
                      SystemFont = True
                      TabOrder = 0
                      UpdateActions = True
                      UseLastDock = True
                      Visible = True
                      SavedAtRunTime = True
                      object usrg_TBItem8: TTBItem
                        Tag = 0
                        Action = usrg_actStrCalcOnUpdate
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = dmImages.il16x16
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                    end
                  end
                  object usrg_grSickStr: TgsDBGrid
                    Tag = 0
                    Left = 0
                    Top = 26
                    Width = 811
                    Height = 334
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    TabStop = True
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    BorderStyle = bsSingle
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    Ctl3D = True
                    DataSource = usrg_dsSickStr
                    DefaultDrawing = True
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ImeMode = imDontCare
                    ImeName = ''
                    Options = [dgEditing, dgTitles, dgIndicator, dgColumnResize, dgColLines, dgTabs, dgConfirmDelete, dgCancelOnExit]
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = False
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    ReadOnly = False
                    RefreshType = rtCloseOpen
                    TabOrder = 1
                    Visible = True
                    TableColor = clWindow
                    SelectedColor = clHighlight
                    TitleColor = clBtnFace
                    Striped = True
                    StripeOdd = 15201271
                    StripeEven = 14084071
                    InternalMenuKind = imkWithSeparator
                    Expands = <>
                    ExpandsActive = False
                    ExpandsSeparate = False
                    TitlesExpanding = False
                    Conditions = <>
                    ConditionsActive = False
                    CheckBox.DisplayField = ''
                    CheckBox.FieldName = ''
                    CheckBox.Visible = False
                    CheckBox.FirstColumn = False
                    ScaleColumns = True
                    MinColWidth = 40
                    ToolBar = nil
                    FinishDrawing = True
                    RememberPosition = True
                    SaveSettings = True
                    ShowTotals = True
                    ShowFooter = False
                    Columns = <
                      item
                        Expanded = False
                        FieldName = 'Дата'
                        Width = 83
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'Рабочий день'
                        Width = 75
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'Часы'
                        Width = 66
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'Процент'
                        Width = 567
                        Visible = True
                      end>
                  end
                end
              end
            end
          end
          object alBase: TActionList
            Left = 548
            Top = 8
            object actNew: TAction
            end
            object actHelp: TAction
            end
            object actSecurity: TAction
            end
            object actOk: TAction
            end
            object actCancel: TAction
            end
            object actNextRecord: TAction
            end
            object actPrevRecord: TAction
            end
            object actApply: TAction
            end
            object actFirstRecord: TAction
            end
            object actLastRecord: TAction
            end
            object actProperty: TAction
            end
            object actCopySettingsFromUser: TAction
            end
            object actAddToSetting: TAction
            end
            object actDocumentType: TAction
            end
            object actDistributeUserSettings: TAction
            end
            object actHistory: TAction
            end
            object actDetailNew: TAction
            end
            object actDetailEdit: TAction
            end
            object actDetailDelete: TAction
            end
            object actDetailDuplicate: TAction
            end
            object actDetailPrint: TAction
            end
            object actDetailCut: TAction
            end
            object actDetailCopy: TAction
            end
            object actDetailPaste: TAction
            end
            object actDetailMacro: TAction
            end
            object actDetailProp: TAction
            end
            object usrg_actAvgSalaryNew: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Добавить'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Добавить'
              ImageIndex = 0
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgSalaryEdit: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Редактировать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Редактировать'
              ImageIndex = 1
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgSalaryDelete: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Удалить'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Удалить'
              ImageIndex = 2
              ShortCut = 0
              Visible = True
            end
            object usrg_actStrGen: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'usrg_actStrGen'
              Checked = False
              Enabled = False
              HelpContext = 0
              Hint = ''
              ImageIndex = -1
              ShortCut = 0
              Visible = False
            end
            object usrg_actGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Рассчитать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = ''
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать ср. заработок'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actStrCalcOnUpdate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Расчитать по структуре'
              Checked = False
              Enabled = False
              HelpContext = 0
              Hint = 'Расчитать по структуре'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
          end
          object dsgdcBase: TDataSource
            Left = 589
            Top = 7
          end
          object pm_dlgG: TPopupMenu
            Left = 472
            Top = 8
            object actSecurity1: TMenuItem
            end
            object actHistory1: TMenuItem
            end
            object N1: TMenuItem
            end
            object sepFirst: TMenuItem
            end
            object actNextRecord1: TMenuItem
            end
            object actPrevRecord1: TMenuItem
            end
            object actFirstRecord1: TMenuItem
            end
            object actLastRecord1: TMenuItem
            end
            object sepSecond: TMenuItem
            end
            object actApply1: TMenuItem
            end
            object sepThird: TMenuItem
            end
            object actProperty1: TMenuItem
            end
            object actCopySettings1: TMenuItem
            end
            object nAddToSetting1: TMenuItem
            end
          end
          object ibtrCommon: TIBTransaction
            Active = False
            Params.Strings = (
              'read_committed'
              'rec_version'
              'nowait')
            Left = 504
            Top = 8
          end
          object dsDetail: TDataSource
            Left = 293
            Top = 342
          end
          object gdMacrosMenu: TgdMacrosMenu
            Left = 441
            Top = 7
          end
          object usrg_gdcAvgSalaryStr: TgdcAttrUserDefined
            Tag = 0
            ForcedRefresh = False
            AutoCalcFields = True
            ObjectView = False
            AllowStreamedActive = False
            SubType = 'USR$WG_AVGSALARYSTR'
            MasterSource = dsgdcBase
            MasterField = 'id'
            DetailField = 'parent'
            SubSet = 'ByParent'
            SetTable = ''
            Active = True
            CachedUpdates = False
            ReadTransaction = gdcUserDocument.ibtrInternal
            Filtered = False
            Left = 644
            Top = 208
          end
          object usrg_dsAvgSalaryStr: TDataSource
            Tag = 0
            AutoEdit = True
            DataSet = usrg_gdcAvgSalaryStr
            Enabled = True
            Left = 675
            Top = 208
          end
          object usrg_dsSickStr: TDataSource
            Tag = 0
            AutoEdit = True
            Enabled = True
            Left = 769
            Top = 424
          end
        end
        
      EDITIONDATE: 2014-11-28T10:14:45+03:00
  - 
    Properties: 
      Class: "TgdcMacrosGroup"
      RUID: 147022905_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      HASCHILDREN: 1
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTPARENT: ~
      CLASSNAME: ""
      SUBTYPE: ""
      PARENT: ~
      NAME: "Локальные макросы"
      ISGLOBAL: 0
      DESCRIPTION: ~
      EDITIONDATE: 2004-05-07T12:05:09+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147022904_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      NAME: "gdc_dlgUserComplexDocument147022845_119619099"
      DESCRIPTION: ~
      PARENT: ~
      OBJECTTYPE: 0
      MACROSGROUPKEY: "147022905_119619099 Локальные макросы"
      REPORTGROUPKEY: "147022906_119619099 Отчеты(gdc_dlgUserComplexDocument147022845_119619099)"
      CLASSNAME: ""
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      SUBTYPE: ""
      EDITIONDATE: 2004-05-07T12:05:09+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 520236113_2108071301
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate_Sick_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include pl_GetScriptIDByName
        '#include wg_GetConstByIDAndDate
        
        Function wg_AvgSalaryStrGenerate_Sick_pl(ByRef gdcObject, ByRef gdcSalary)
        '
          Dim T, T1, T2
          '
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile, Scope
          'avg_wage
          Dim P_main, Tv_main, Q_main
          'avg_wage_sick_in
          Dim P_in, Tv_in, Q_in
          Dim EmplKey, FirstMoveKey, DateCalc, IsAvgWageDoc, IsPregnancy
          Dim IllType, CalcType
          'avg_wage_run, avg_wage_sql
          Dim P_run, Tv_run, Q_run, P_sql, Tv_sql, Q_sql, P_kb
          Dim DateCalcFrom, DateCalcTo
          Dim PredicateName, Arity, SQL
          'avg_wage_err
          Dim P_err, Tv_err, Q_err
          Dim ErrMessage
          'avg_wage_out, avg_wage_sick_det
          Dim P_out, Tv_out, Q_out, P_det, Tv_det, Q_det
          Dim AvgWage, AvgWageRule
          Dim Period, PeriodRule, MonthDays, ExclDays, CalcDays, IsFullMonth, IsSpecMonth
          Dim Wage
          Dim TabDays, TabHoures, NormDays, NormHoures
        
          T1 = Timer
          wg_AvgSalaryStrGenerate_Sick_pl = False
        
          'init
          Set Creator = New TCreator
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          Scope = "wg_avg_wage_sick"
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          'params
          EmplKey = gdcObject.FieldByName("USR$EMPLKEY").AsInteger
          FirstMoveKey = gdcObject.FieldByName("USR$FIRSTMOVEKEY").AsInteger
          DateCalc = gdcObject.FieldByName("USR$FROM").AsDateTime
          IsAvgWageDoc = gdcObject.FieldByName("USR$REFERENCE").AsInteger
          IsPregnancy = abs(gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger = _
                 gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID))
          IllType = gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger
        
          Dim IBSQL
          '
          Set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = gdcBaseManager.ReadTransaction
          IBSQL.SQL.Text = _
              "SELECT " & _
              "  it.USR$CALCTYPE " & _
              "FROM " & _
              "  USR$WG_ILLTYPE it " & _
              "WHERE " & _
              "  it.ID = :ILLTYPEKEY "
          IBSQL.ParamByName("ILLTYPEKEY").AsInteger = IllType
          IBSQL.ExecQuery
          '
          CalcType = IBSQL.FieldByName("USR$CALCTYPE").AsInteger
          '
          IBSQL.Close
        
          'clean
          gdcSalary.First
          While Not gdcSalary.EOF
            gdcSalary.Delete
          Wend
          '
          gdcSalary.OwnerForm.Repaint
        
          'avg_wage_sick_in(EmplKey, FirstMoveKey, DateCalc, IsAvgWageDoc, IsPregnancy, IllType)
          P_in = "avg_wage_sick_in"
          Set Tv_in = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutInteger 0, EmplKey
          Tv_in.PutInteger 1, FirstMoveKey
          Tv_in.PutDate 2, DateCalc
          Tv_in.PutInteger 3, IsAvgWageDoc
          Tv_in.PutInteger 4, IsPregnancy
          Tv_in.PutInteger 5, IllType
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'avg_wage(Scope) - prepare data
          P_main = "avg_wage"
          Set Tv_main = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_main = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_main.PredicateName = P_main
          Q_main.Termv = Tv_main
          '
          Tv_main.PutAtom 0, Scope
          '
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage_run(Scope, EmplKey, FirstMoveKey, DateCalcFrom, DateCalcTo)
          P_run = "avg_wage_run"
          Set Tv_run = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_run = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_run.PredicateName = P_run
          Q_run.Termv = Tv_run
          'avg_wage_sql(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL)
          P_sql = "avg_wage_sql"
          P_kb = "avg_wage_kb"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Tv_run.PutAtom 0, Scope
          '
          Q_run.OpenQuery
          If Q_run.EOF Then
            Exit Function
          End If
          '
          Append = False
          '
          Do Until Q_run.EOF
            EmplKey = Tv_run.ReadInteger(1)
            FirstMoveKey = Tv_run.ReadInteger(2)
            DateCalcFrom = Tv_run.ReadDate(3)
            DateCalcTo = Tv_run.ReadDate(4)
            '
            Tv_sql.Reset
            Tv_sql.PutAtom 0, Scope
            Tv_sql.PutInteger 1, EmplKey
            Tv_sql.PutInteger 2, FirstMoveKey
            Q_sql.OpenQuery
            '
            Do Until Q_sql.EOF
              PredicateName = Tv_sql.ReadAtom(3)
              Arity = Tv_sql.ReadInteger(4)
              SQL = Tv_sql.ReadString(5)
              '
              Ret =  PL.MakePredicatesOfSQLSelect _
                        (SQL, _
                        gdcBaseManager.ReadTransaction, _
                        PredicateName, PredicateName, Append)
              If Ret >= 0 Then
                 Ret = PL.Call(P_kb, Tv_sql)
              End If
              '
              Q_sql.NextSolution
            Loop
            Q_sql.Close
            '
            Append = True
            '
            Q_run.NextSolution
          Loop
          Q_run.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage(Scope) - calc result
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_err(Scope, ErrMessage)
          P_err = "avg_wage_err"
          Set Tv_err = Creator.GetObject(2, "TgsPLTermv", "")
          Set Q_err = Creator.GetObject(nil, "TgsPLQuery", "")
          '
          Q_err.PredicateName = P_err
          Q_err.Termv = Tv_err
          '
          Tv_err.PutAtom 0, Scope
          '
          Q_err.OpenQuery
          If Not Q_err.EOF Then
            Do Until Q_err.EOF
              '
              ErrMessage = Tv_err.ReadString(1)
              Call MsgBox(ErrMessage, vbCritical + vbOKOnly, "Ошибка!")
              '
              Q_err.NextSolution
            Loop
            Exit Function
          End If
          Q_err.Close
        
          'avg_wage_out(Scope, EmplKey, FirstMoveKey, AvgWage, AvgWageVariant)
          P_out = "avg_wage_out"
          Set Tv_out = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          'avg_wage_sick_det(EmplKey, FirstMoveKey,
          '                  Period, Rule,
          '                  MonthDays, ExclDays, CalcDays, IsFullMonth, IsSpecMonth,
          '                  Wage,
          '                  TabDays, NormDays, TabHoures, NormHoures)
          P_det = "avg_wage_sick_det"
          Set Tv_det = Creator.GetObject(14, "TgsPLTermv", "")
          Set Q_det = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_det.PredicateName = P_det
          Q_det.Termv = Tv_det
          '
          Tv_out.PutAtom 0, Scope
          '
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            EmplKey = Tv_out.ReadInteger(1)
            FirstMoveKey = Tv_out.ReadInteger(2)
            AvgWage = Tv_out.ReadFloat(3)
            AvgWageRule = Tv_out.ReadAtom(4)
            '
            Tv_det.Reset
            Tv_det.PutInteger 0, EmplKey
            Tv_det.PutInteger 1, FirstMoveKey
            Q_det.OpenQuery
            '
            Do Until Q_det.EOF
              Period = Tv_det.ReadDate(2)
              PeriodRule = Tv_det.ReadAtom(3)
              MonthDays = Tv_det.ReadInteger(4)
              ExclDays= Tv_det.ReadInteger(5)
              CalcDays = Tv_det.ReadInteger(6)
              IsFullMonth = Tv_det.ReadInteger(7)
              IsSpecMonth = Tv_det.ReadInteger(8)
              Wage = Tv_det.ReadFloat(9)
              TabDays = Tv_det.ReadFloat(10)
              NormDays = Tv_det.ReadFloat(11)
              TabHoures = Tv_det.ReadFloat(12)
              NormHoures = Tv_det.ReadFloat(13)
              '
              Select Case AvgWageRule
                Case "by_calc_days_total", "by_calc_days", "by_calc_days_doc"
                  Select Case PeriodRule
                    Case "by_cal_flex"
                      PeriodRule = "по табелю мастера"
                    Case "by_cal"
                      PeriodRule = "по табелю"
                    Case "by_orders"
                      PeriodRule = "по приказам"
                    Case Else
                      PeriodRule = ""
                  End Select
                  '
                  If Not IsFullMonth = 1 And IsSpecMonth = 1 Then
                    PeriodRule = "условно полный"
                  End If
                  '
                Case "by_budget"
                  PeriodRule = "от БПМ"
                Case "by_avg_wage"
                  PeriodRule = "по среднему заработку"
                Case "by_rate", "by_rate_doc"
                  PeriodRule = "от ставки (оклада)"
                Case "by_not_full"
                  PeriodRule = "по не полным месяцам"
                Case Else
                  PeriodRule = ""
              End Select
              '
              gdcSalary.Append
              gdcSalary.FieldByName("USR$ISFULL").AsVariant = IsFullMonth
              gdcSalary.FieldByName("USR$DATE").AsVariant = Period
              gdcSalary.FieldByName("USR$CALCDAYS").AsVariant = CalcDays
              gdcSalary.FieldByName("USR$SALARY").AsVariant = Wage
              gdcSalary.FieldByName("USR$DOW").AsVariant = TabDays
              gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = NormDays
              gdcSalary.FieldByName("USR$HOW").AsVariant = TabHoures
              gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = NormHoures
              gdcSalary.FieldByName("USR$DESCRIPTION").AsVariant = PeriodRule
              gdcSalary.Post
              '
              Q_det.NextSolution
            Loop
            Q_det.Close
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
        
          gdcSalary.First
        
          If AvgWage > 0 then
            gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = AvgWage
          End If
          '
          Select Case AvgWageRule
            Case "by_budget"
              gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1
            Case "by_rate"
              gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger = 1
            Case "by_avg_wage"
              gdcObject.FieldByName("USR$AVERAGE").AsInteger = 1
          End select
          '
          gdcObject.Post
        
          wg_AvgSalaryStrGenerate_Sick_pl = True
        
          T2 = Timer
          T = T2 - T1
        '
        End Function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE_SICK_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAR0RDT0JKRUNUCQAAAEdEQ09CSkVDVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AABGTlNUUFJTVAkAAABHRENTQUxBUlkJAAAAR0RDU0FMQVJZAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-12-18T11:19:44+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
          - 
            ADDFUNCTIONKEY: "147043669_974374174 wg_GetConstByIDAndDate"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151515573_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_EmplMoveList
        
        function wg_AvgSalaryStrGenerate_Sick(ByRef Sender)
        '
        'Есть 3 варианта расчета, которые зависят от того в какой момент произошло изменение оклада (ставки):
        ' 1. Расчет стандартный:
        '    - последнее повышение было до периода расчета среднего заработка
        ' 2. Период расчета: с момента повышения зрп до начала нетрудоспособности
        '    - повышение попало с первого числа месяца расчета ср. заработка и до начала нетрудоспособности
        ' 3. Расчет стандартный, но сумма увеличивается на коэффициент повышения оклада (ставки)
        '    - повышение попало на период нетрудоспособности
          Sender.GetComponent("actApply").Execute
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          set gdcObject = Sender.gdcObject
          set gdcAvgStr = Sender.FindComponent("usrg_gdcAvgSalaryStr")
          
          gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0
        
          'Выключаем автоперерасчет среднего заработка
          gdcAvgStr.Tag = 1
          'Удалим старые значения
          gdcAvgStr.First
          while not gdcAvgStr.Eof
            gdcAvgStr.Delete
        '    gdcAvgStr.Next
          wend
          'Дата начала нетрудоспособности
          DateFrom = gdcObject.FieldByName("usr$from").AsDateTime
          'Первое число месяца больничного
          FirstDateBeginIll = DateSerial(Year(DateFrom), Month(DateFrom), 1)
          DateEnd = gdcObject.FieldByName("usr$dateend").AsDateTime
          AddDuration = DateDiff("m", DateFrom, DateEnd) + 1
        
          'Расчет по часам
          ByHourFlg = (gdcObject.FieldByName("usr$calcbyhour").AsInteger = 1)
        
          'Определим по карточке сотрудника (на дату окончания) прослеживать изменения оклада или ставки
          BySalaryFlg = False
          set EmplMoveList = wg_EmplMoveList.MoveCardList(gdcObject.FieldByName("usr$emplkey").AsInteger, Null)
          if Assigned(EmplMoveList) then
            set MoveCard = EmplMoveList.ExistMoveCardByDate(DateEnd)
            if Assigned(MoveCard) then
              BySalaryFlg = MoveCard.PayFormKey = gdcBaseManager.GetIDByRUIDString(wg_PayForm_Salary_RUID)
              if IsNull(BySalaryFlg) then BySalaryFlg = 0
            end if
          end if
          set AvgPeriodsObj = New Twg_AvgPeriods
          AvgPeriodsObj.EmplKey = gdcObject.FieldByName("usr$emplkey").AsInteger
          AvgPeriodsObj.FirstMoveKey = gdcObject.FieldByName("usr$firstmovekey").AsInteger
          Duration = gdcObject.FieldByName("usr$avgperiod").AsInteger
          AvgPeriodsObj.DateBegin = DateAdd("m", - Duration, FirstDateBeginIll)
          AvgPeriodsObj.Duration = Duration '+ AddDuration
          AvgPeriodsObj.FeeGroupKey = gdcObject.FieldByName("usr$feegroupkey").Value
          AvgPeriodsObj.BySalary = BySalaryFlg
          AvgPeriodsObj.ByStaffSalary = (gdcObject.FieldByName("usr$bystaffsalary").AsInteger = 1)
          AvgPeriodsObj.DateFrom = DateFrom
          AvgPeriodsObj.IsPregnancy = _
              (gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger = _
                 gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID))
        
          set AvgPeriodItems = AvgPeriodsObj.Items
          AvgPeriodItemsArr = AvgPeriodItems.Items
          'Дата последнего изменения
          LastDateChange = AvgPeriodsObj.LastDateChange
        
          NoMovingFlg = False
          ChangeOnIllPeriodFlg = False
          if IsNull(LastDateChange) then
            'Движений за период расчета и больничного не было
            LastDateChange = AvgPeriodsObj.DateBegin
            NoMovingFlg = True
          else
            ChangeOnIllPeriodFlg = (LastDateChange >= DateFrom and LastDateChange <= DateEnd)
            if ChangeOnIllPeriodFlg then _
              NoMovingFlg = True
          end if
        
          Coeff = 1
          NewSalary = 0
          AllSum = 0
          AllWorkDay = 0
          AllWorkHour = 0
          for i = AvgPeriodItems.Count - 1 to 0 step -1
            'Интересуют все месяцы, кроме тех, которые идут после начала больничного без движений
            if AvgPeriodItemsArr(i).DateChange <= FirstDateBeginIll or _
                (AvgPeriodItemsArr(i).DateChange > FirstDateBeginIll and AvgPeriodItemsArr(i).DateChange <= DateEnd and AvgPeriodItemsArr(i).IsChange) then
        
              'Подсчет коэффициента изменения оклада (ставки)
              if NewSalary > 0 and AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll and Coeff = 1 then
                if AvgPeriodsObj.BySalary then
                  Coeff = NewSalary / AvgPeriodItemsArr(i).Salary
                else
                  Coeff = NewSalary / AvgPeriodItemsArr(i).FCRate
                end if
              end if
        
              gdcAvgStr.Insert
        '      gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 0
              gdcAvgStr.FieldByName("usr$date").AsDateTime = AvgPeriodItemsArr(i).DateBegin
              gdcAvgStr.FieldByName("usr$salary").AsCurrency = AvgPeriodItemsArr(i).SumByGroup
              gdcAvgStr.FieldByName("usr$oldsalary").AsCurrency = AvgPeriodItemsArr(i).Salary
              gdcAvgStr.FieldByName("usr$newsalary").AsCurrency = AvgPeriodItemsArr(i).FCRate
              gdcAvgStr.FieldByName("usr$dow").AsCurrency = AvgPeriodItemsArr(i).WorkDays
              gdcAvgStr.FieldByName("usr$how").AsCurrency = AvgPeriodItemsArr(i).WorkHours
              gdcAvgStr.FieldByName("usr$schedulerdow").AsCurrency = AvgPeriodItemsArr(i).SchedulerDays
              gdcAvgStr.FieldByName("usr$schedulerhow").AsCurrency = AvgPeriodItemsArr(i).SchedulerHours
              gdcAvgStr.FieldByName("usr$coeff").AsCurrency = Coeff
              gdcAvgStr.FieldByName("usr$description").AsString = AvgPeriodItemsArr(i).Description
        
              ' added 19.07.13
              ' если декретный или дата > 11.07.13, то признак во всех периодах =1
              if DateFrom >= CDate("11.07.2013") or AvgPeriodsObj.IsPregnancy then
                gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
              else
                gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 0
              end if
              ' end added
        
        
        '      if (NoMovingFlg and AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll) or _
        '          (AvgPeriodItemsArr(i).DateChange >= LastDateChange) then
        '        gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
        '      end if
        
              if AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll then
              'Периоды, до начала месяца болезни
                if AvgPeriodItemsArr(i).DateChange >= LastDateChange or LastDateChange >= DateFrom then
                  gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
                end if
              else
                if AvgPeriodItemsArr(i).DateChange < DateFrom and AvgPeriodItemsArr(i).DateChange >= LastDateChange and (not NoMovingFlg) then
                  gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
                end if
              end if
        
        '      IsCheck = AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll
        
              if ChangeOnIllPeriodFlg and AvgPeriodItemsArr(i).DateChange = LastDateChange then
               'Изменение попадает в период болезни, т.е. сумма будет проиндексирована
                if AvgPeriodsObj.BySalary then
                  NewSalary = AvgPeriodItemsArr(i).Salary
                else
                  NewSalary = AvgPeriodItemsArr(i).FCRate
                end if
              end if
              if gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1 then
                AllSum = AllSum + gdcAvgStr.FieldByName("usr$salary").AsCurrency
                AllWorkDay = AllWorkDay + gdcAvgStr.FieldByName("usr$dow").AsCurrency
                AllWorkHour = AllWorkHour + gdcAvgStr.FieldByName("usr$how").AsCurrency
              end if
              gdcAvgStr.Post
            end if
          next
          AvgSum = 0
          if ByHourFlg then
            AllWorkPoint = AllWorkHour
          else
            AllWorkPoint = AllWorkDay
          end if
          if AllWorkPoint > 0 then
            AvgSum = AllSum / AllWorkPoint
          end if
          gdcAvgStr.Tag = 0
        
          gdcObject.FieldByName("usr$thirdmethod").AsInteger = 0
          if gdcObject.OwnerForm.Name = "gdc_dlgUserComplexDocument147022845_119619099" and (gdcObject.FieldByName("usr$reference").AsInteger = 1 or gdcAvgStr.RecordCount = 6) then
            dim q, Creator
            set Creator = new TCreator
            set q = Creator.GetObject(null, "TIBSQL", "")
            q.Transaction = gdcObject.Transaction
        '    q.SQL.Text = _
        '    "SELECT * " & _
        '    "FROM USR$WG_AVGSALARYSTR " & _
        '    "WHERE " & _
        '    "  USR$DOCUMENTKEY = :parent " & _
        '    " AND " & _
        '    "  EXTRACT(DAY FROM DATEADD(DAY, -1, CAST(EXTRACT(YEAR FROM USR$DATE)||'.'||(EXTRACT(MONTH FROM USR$DATE)+1)||'.01' AS DATE))) = USR$DOW "
        '    q.ParamByName("parent").AsInteger = gdcObject.ID
        '    q.ExecQuery
        
            q.SQL.Text = _
                "EXECUTE BLOCK( " & _
                "  PARENT INTEGER = :PARENT) " & _
                "RETURNS " & _
                "( " & _
                "  OK INTEGER " & _
                ") " & _
                " AS " & _
                "DECLARE VARIABLE EMPLKEY INTEGER; " & _
                "DECLARE VARIABLE FDATE DATE; " & _
                "DECLARE VARIABLE DOW INTEGER; " & _
                "DECLARE VARIABLE LEAVEDAY INTEGER; " & _
                "DECLARE VARIABLE MONTHDAY INTEGER; " & _
                "DECLARE VARIABLE TempM INTEGER; " & _
                "DECLARE VARIABLE TempY INTEGER; " & _
                "DECLARE VARIABLE TempNextDate DATE; " & _
                "BEGIN " & _
                "  OK = 0; " & _
                "  FOR " & _
                "    SELECT LIST.USR$EMPLKEY, STR.USR$DATE, STR.USR$DOW " & _
                "    FROM USR$WG_AVGSALARYSTR STR " & _
                "    JOIN USR$WG_SICKLIST LIST ON LIST.DOCUMENTKEY = STR.USR$DOCUMENTKEY " & _
                "    WHERE " & _
                "      USR$DOCUMENTKEY = :parent " & _
                "    INTO :EMPLKEY, :FDATE, :DOW " & _
                "  DO " & _
                "  BEGIN " & _
                "   " & _
                "    TempM = EXTRACT(MONTH FROM CAST(:FDATE AS DATE)); " & _
                "    TempY = EXTRACT(YEAR FROM CAST(:FDATE AS DATE)); " & _
                "    TempM = TempM + 1; " & _
                "    IF (TempM = 13) THEN " & _
                "    BEGIN " & _
                "      TempY = TempY + 1; " & _
                "      TempM = 1; " & _
                "    END " & _
                "    TempNextDate = CAST('01.' ||  RIGHT('0' || TempM, 2) || '.' || TempY  AS DATE); " & _
                "    MONTHDAY = EXTRACT(DAY FROM( DATEADD(DAY, -1, TempNextDate))); " & _
                "    SELECT " & _
                "      SUM(CASE " & _
                "      WHEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) = EXTRACT(MONTH FROM U.USR$DATEEND) THEN U.USR$DATEEND - U.USR$DATEBEGIN + 1 " & _
                "      WHEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) < EXTRACT(MONTH FROM U.USR$DATEEND) AND EXTRACT(MONTH FROM U.USR$DATEBEGIN) = EXTRACT(MONTH FROM CAST(:FDATE AS DATE)) THEN DATEADD(DAY, -1, :TempNextDate) - U.USR$DATEBEGIN + 1 " & _
                "      WHEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) < EXTRACT(MONTH FROM U.USR$DATEEND) AND EXTRACT(MONTH FROM U.USR$DATEEND) = EXTRACT(MONTH FROM CAST(:FDATE AS DATE)) THEN U.USR$DATEEND - :FDATE + 1 " & _
                "      END) AS LEAVEDAY " & _
                "    FROM GD_DOCUMENT Z " & _
                "    JOIN USR$WG_LEAVEDOCLINE U ON Z.ID = U.DOCUMENTKEY " & _
                "    WHERE " & _
                "      Z.DOCUMENTTYPEKEY = 328606656 " & _
                "     AND " & _
                "      U.USR$EMPLKEY = :EMPLKEY " & _
                "     AND " & _
                "      EXTRACT(MONTH FROM CAST(:FDATE AS DATE)) BETWEEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) AND EXTRACT(MONTH FROM U.USR$DATEEND) " & _
                "    INTO :LEAVEDAY; " & _
                "    IF (LEAVEDAY IS NULL) THEN " & _
                "        LEAVEDAY = 0; " & _
                " " & _
                " " & _
                "    IF (DOW + LEAVEDAY = MONTHDAY) THEN " & _
                "        OK = OK + 1; " & _
                "  END " & _
                "  SUSPEND; " & _
                "END "
        
        
            q.ParamByName("parent").AsInteger = gdcObject.ID
            q.ExecQuery
        
            if q.FieldByName("OK").AsInteger = 0 or (gdcObject.FieldByName("usr$reference").AsInteger = 1) then
              q.Close
              q.SQL.Text = _
              "SELECT FIRST 1 COALESCE(ML.USR$THOURRATE, 0) AS RATE " & _
              "FROM USR$WG_TOTAL T " & _
              "JOIN USR$WG_MOVEMENTLINE ML ON ML.USR$DATEBEGIN <= T.USR$DATEBEGIN " & _
              "WHERE " & _
              "  T.DOCUMENTKEY = :totalkey " & _
              "  AND ML.USR$EMPLKEY = :emplkey " & _
              "ORDER BY ML.USR$DATEBEGIN DESC "
              q.ParamByName("totalkey").AsInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
              q.ParamByName("emplkey").AsInteger = gdcObject.FieldByName("USR$EMPLKEY").AsInteger
              q.ExecQuery
        
              gdcObject.FieldByName("usr$thirdmethod").AsInteger = 1
        
              if not q.EOF then
                AvgSum = 8*q.FieldByName("RATE").AsCurrency
              else
                AvgSum = 0
              end if
            end if
          end if
          gdcObject.FieldByName("usr$avgsumma").AsCurrency = Round(AvgSum)
        end function
        
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:26:34+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147743985_374487969 wg_EmplMoveList"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 520236116_2108071301
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_AvgSalaryStrGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate_Sick
        
        Sub Macros_AvgSalaryStrGenerate_Sick(OwnerForm)
        '
          call wg_AvgSalaryStrGenerate_Sick(OwnerForm)
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS_AVGSALARYSTRGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:00:17+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151515573_101633588 wg_AvgSalaryStrGenerate_Sick"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 520236114_2108071301
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MACROSGROUPKEY: "147022905_119619099 Локальные макросы"
      FUNCTIONKEY: "520236116_2108071301 Macros_AvgSalaryStrGenerate_Sick"
      NAME: "Расчет структуры ср. заработка"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-04-03T15:20:01+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 528605649_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 528605678_99701464
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryDetailGenerate_Sick_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include pl_GetScriptIDByName
        
        Function wg_AvgSalaryDetailGenerate_Sick_pl(ByRef gdcObject, ByRef gdcDetail)
        '
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile
          'struct_sick_sql
          Dim P_sql, Tv_sql, Q_sql
          Dim EmplKey, FirstMoveKey, DateBegin, DateEnd, PredicateName, Arity, SQL
          'struct_sick_in
          Dim P_in, Tv_in, Q_in
          Dim DateCalc, AvgWage, CalcType
          Dim BudgetOption, ByRateOption, IsPregnancy, IllType
          Dim ViolatDB, ViolatDE
          'struct_sick_err
          Dim P_err, Tv_err, Q_err
          Dim ErrMessage
          'struct_sick_out
          Dim P_out, Tv_out, Q_out
          Dim AccDate, IncludeDate, Percent, DOI, HOI, Summa
        
          wg_AvgSalaryDetailGenerate_Sick_pl = False
        
          'init
          Set Creator = New TCreator
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          'params
          EmplKey = gdcObject.FieldByName("USR$EMPLKEY").AsInteger
          FirstMoveKey = gdcObject.FieldByName("USR$FIRSTMOVEKEY").AsInteger
          DateCalc = gdcObject.FieldByName("USR$FROM").AsDateTime
          DateBegin = gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime
          DateEnd = gdcObject.FieldByName("USR$DATEEND").AsDateTime
          AvgWage = gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency
          BudgetOption = gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger
          ByRateOption = gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger
          IsPregnancy = abs(gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger = _
                 gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID))
          IllType = gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger
          ViolatDB = gdcObject.FieldByName("USR$VIOLATDB").AsDateTime
          ViolatDE = gdcObject.FieldByName("USR$VIOLATDE").AsDateTime
          
          Dim IBSQL
          '
          Set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = gdcBaseManager.ReadTransaction
          IBSQL.SQL.Text = _
              "SELECT " & _
              "  it.USR$CALCTYPE " & _
              "FROM " & _
              "  USR$WG_ILLTYPE it " & _
              "WHERE " & _
              "  it.ID = :ILLTYPEKEY "
          IBSQL.ParamByName("ILLTYPEKEY").AsInteger = IllType
          IBSQL.ExecQuery
          '
          CalcType = IBSQL.FieldByName("USR$CALCTYPE").AsInteger
          '
          IBSQL.Close
        
          'clean
          gdcDetail.First
          While Not gdcDetail.EOF
            gdcDetail.Delete
          Wend
          '
          gdcDetail.OwnerForm.Repaint
        
          'struct_sick_sql(EmplKey, FirstMoveKey, DateBegin, DateEnd, PredicateName, Arity, SQL)
          P_sql = "struct_sick_sql"
          Set Tv_sql = Creator.GetObject(7, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Append = False
          '
          Tv_sql.PutInteger 0, EmplKey
          Tv_sql.PutInteger 1, FirstMoveKey
          Tv_sql.PutDate 2, DateBegin
          Tv_sql.PutDate 3, DateEnd
          '
          Q_sql.OpenQuery
          If Q_sql.EOF Then
            Exit Function
          End If
          '
          Do Until Q_sql.EOF
            PredicateName = Tv_sql.ReadAtom(4)
            Arity = Tv_sql.ReadInteger(5)
            SQL = Tv_sql.ReadString(6)
            '
            Ret =  PL.MakePredicatesOfSQLSelect _
                      (SQL, _
                      gdcBaseManager.ReadTransaction, _
                      PredicateName, PredicateName, Append)
            '
            Q_sql.NextSolution
          Loop
          Q_sql.Close
          
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'struct_sick_in(DateCalc, DateBegin, DateEnd, AvgWage, CalcType, BudgetOption, ByRateOption, IsPregnancy, IllType, ViolatDB, ViolatDE)
          P_in = "struct_sick_in"
          Set Tv_in = Creator.GetObject(11, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutDate 0, DateCalc
          Tv_in.PutDate 1, DateBegin
          Tv_in.PutDate 2, DateEnd
          Tv_in.PutFloat 3, AvgWage
          Tv_in.PutInteger 4, CalcType
          Tv_in.PutInteger 5, BudgetOption
          Tv_in.PutInteger 6, ByRateOption
          Tv_in.PutInteger 7, IsPregnancy
          Tv_in.PutInteger 8, IllType
          Tv_in.PutDate 9, ViolatDB
          Tv_in.PutDate 10, ViolatDE
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'struct_sick_err(ErrMessage)
          P_err = "struct_sick_err"
          Set Tv_err = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_err = Creator.GetObject(nil, "TgsPLQuery", "")
          '
          Q_err.PredicateName = P_err
          Q_err.Termv = Tv_err
          '
          Q_err.OpenQuery
          If Not Q_err.EOF Then
            Do Until Q_err.EOF
              '
              ErrMessage = Tv_err.ReadString(0)
              Call MsgBox(ErrMessage, vbCritical + vbOKOnly, "Ошибка!")
              '
              Q_err.NextSolution
            Loop
            Exit Function
          End If
          Q_err.Close
          
          'struct_sick_out(AccDate, IncludeDate, Percent, DOI, HOI, Summa, DateBegin, DateEnd)
          P_out = "struct_sick_out"
          Set Tv_out = Creator.GetObject(8, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            '
            AccDate = Tv_out.ReadDate(0)
            IncludeDate = Tv_out.ReadDate(1)
            Percent = Tv_out.ReadFloat(2)
            DOI = Tv_out.ReadFloat(3)
            HOI = Tv_out.ReadFloat(4)
            Summa = Tv_out.ReadFloat(5)
            DateBegin = Tv_out.ReadDate(6)
            DateEnd = Tv_out.ReadDate(7)
            '
            gdcDetail.Append
            gdcDetail.FieldByName("USR$ACCDATE").AsVariant = AccDate
            gdcDetail.FieldByName("USR$INCLUDEDATE").AsVariant = IncludeDate
            gdcDetail.FieldByName("USR$PERCENT").AsVariant = Percent
            gdcDetail.FieldByName("USR$DOI").AsVariant = DOI
            gdcDetail.FieldByName("USR$HOI").AsVariant = HOI
            gdcDetail.FieldByName("USR$SUMMA").AsVariant = Summa
            gdcDetail.FieldByName("USR$DATEBEGIN").AsVariant = DateBegin
            gdcDetail.FieldByName("USR$DATEEND").AsVariant = DateEnd
            gdcDetail.Post
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
          gdcDetail.First
        
          wg_AvgSalaryDetailGenerate_Sick_pl = True
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYDETAILGENERATE_SICK_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAR0RDT0JKRUNUCQAAAEdEQ09CSkVDVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AABGTlNUUFJTVAkAAABHRENERVRBSUwJAAAAR0RDREVUQUlMAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-12-03T10:52:12+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151515700_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryDetailGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_LastDayInMonth
        sub wg_AvgSalaryDetailGenerate_Sick(ByVal Sender)
          if not Sender.OwnerForm.gdcObject.VariableExists("DontRecalcLine") then
            Sender.OwnerForm.gdcObject.AddVariableItem("DontRecalcLine")
          end if
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = True
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          ' added 18.07.13   FromDate checking
          if gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = _
             Sender.OwnerForm.gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger or _
             Sender.OwnerForm.gdcObject.FieldByName("USR$FROM").AsDateTime >= CDate("11.07.2013")   then
            if Sender.OwnerForm.gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0 then
              dim gdcAvgStr, MonthNum
              set gdcAvgStr = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
              gdcAvgStr.First
              while not gdcAvgStr.EoF
                gdcAvgStr.Next
              wend
              MonthNum = gdcAvgStr.RecNo
              if MonthNum < Sender.OwnerForm.gdcObject.FieldByName("USR$AVGPERIOD").AsInteger then
                if Application.MessageBox("Позиций среднего заработка " & MonthNum & _
                  " , это меньше, чем период формирования ( " & _
                  Sender.OwnerForm.gdcObject.FieldByName("USR$AVGPERIOD").AsInteger& " )." & VBCR & _
                  "Рассчитать средний заработок как 50% от бюджета прожиточного минимума?", _
                  "Внимание", vbSystemModal + vbYesNo) = vbYes then
                  if not (Sender.OwnerForm.gdcObject.State = dsEdit or Sender.OwnerForm.gdcObject.State = dsInsert) then
                    Sender.OwnerForm.gdcObject.Edit
                  end if
                  Sender.OwnerForm.gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1
                  Sender.OwnerForm.gdcObject.Post
                end if
              end if
            end if
          end if
          Sender.OwnerForm.GetComponent("ibgrDetail").SetFocus
        
          set wg_Structure = Sender.OwnerForm.Objects("Structure")
          call wg_Structure.CreateSickStructure(Sender.OwnerForm)
        
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = False
        end sub
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYDETAILGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:45:34+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147022228_119619099 wg_LastDayInMonth"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 528605680_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 528605678_99701464
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_AvgSalaryDetailGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryDetailGenerate_Sick
        
        Sub Macros_AvgSalaryDetailGenerate_Sick(OwnerForm)
        '
          Call wg_AvgSalaryDetailGenerate_Sick(OwnerForm)
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS_AVGSALARYDETAILGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:43:26+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151515700_101633588 wg_AvgSalaryDetailGenerate_Sick"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 528605678_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MACROSGROUPKEY: "147022905_119619099 Локальные макросы"
      FUNCTIONKEY: "528605680_99701464 Macros_AvgSalaryDetailGenerate_Sick"
      NAME: "Расчет структуры больничного"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-04-03T17:43:26+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147489068_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489069_336327731
    Fields: 
      NAME: "usrg_actAvgGenerate"
      DESCRIPTION: ~
      PARENT: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actAvgGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-03-18T12:54:01+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147489071_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489069_336327731
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actAvgGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate_Sick_pl
        '#include wg_Prolog
        
        Sub usrg_actAvgGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcSalary, Ret
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Call wg_Prolog.SyncField(Sender.OwnerForm.gdcObject, True)
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          '
          gdcObject.FieldByName("USR$AVGSUMMA").Clear
          gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger = 0
          gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0
          gdcObject.FieldByName("USR$AVERAGE").AsInteger = 0
          
          Set gdcSalary = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
        
          Ret = wg_AvgSalaryStrGenerate_Sick_pl(gdcObject, gdcSalary)
        
          Call wg_Prolog.SyncField(Sender.OwnerForm.gdcObject, False)
        '
        End Sub
        
        
        
        
      DISPLAYSCRIPT: | 
        USRG_ACTAVGGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-05-05T12:05:20+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "520236113_2108071301 wg_AvgSalaryStrGenerate_Sick_pl"
          - 
            ADDFUNCTIONKEY: "528612032_99701464 wg_Prolog"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147489069_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actAvgGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147489068_336327731 gdc_dlgUserComplexDocument147022845_119619099\\usrg_actAvgGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147489071_336327731 usrg_actAvgGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-05-05T12:05:20+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147368561_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368562_274788016
    Fields: 
      NAME: "usrg_actGenerate"
      DESCRIPTION: ~
      PARENT: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-01-26T11:39:41+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147368564_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368562_274788016
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryDetailGenerate_Sick_pl
        
        Sub usrg_actGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcDetail, Ret
        
          If Not Sender.OwnerForm.gdcObject.VariableExists("DontRecalcLine") Then
            Sender.OwnerForm.gdcObject.AddVariableItem("DontRecalcLine")
          End If
          '
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = True
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          Set gdcDetail = Sender.OwnerForm.gdcDetailObject
        
          Ret = wg_AvgSalaryDetailGenerate_Sick_pl(gdcObject, gdcDetail)
        
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = False
        '
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_ACTGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-04-03T17:42:33+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "528605649_99701464 wg_AvgSalaryDetailGenerate_Sick_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147368562_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147368561_274788016 gdc_dlgUserComplexDocument147022845_119619099\\usrg_actGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147368564_274788016 usrg_actGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-04-03T17:42:33+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147368583_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489065_336327731
    Fields: 
      NAME: "usrg_gdcAvgSalaryStr"
      DESCRIPTION: ~
      PARENT: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_gdcAvgSalaryStr"
      SUBTYPE: ""
      EDITIONDATE: 2005-01-26T12:28:17+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147489067_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489065_336327731
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_gdcAvgSalaryStrAfterDelete"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_GetAvgSalarySum
        '#include wg_EnableFieldChange
        '#include wg_SetSilkAvgSum
        option explicit
        sub usrg_gdcAvgSalaryStrAfterDelete(ByVal DataSet)
          Exit Sub 'отключено
        ' пересчитываем сумму среднего заработка
          wg_SetSilkAvgSum(DataSet)
        '  if wg_EnabledFieldChange(DataSet, "AVGSALARYCALC") then
        '    wg_GetAvgSalarySum(DataSet)
        '  end if
        
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_GDCAVGSALARYSTRAFTERDELETE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "AFTERDELETE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAREFUQVNFVAcAAABEQVRBU0VUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-12T10:57:53+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147368587_274788016 wg_GetAvgSalarySum"
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "147302770_531940465 wg_SetSilkAvgSum"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147489065_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_gdcAvgSalaryStr"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147368583_274788016 gdc_dlgUserComplexDocument147022845_119619099\\usrg_gdcAvgSalaryStr"
      EVENTNAME: "AFTERDELETE"
      FUNCTIONKEY: "147489067_336327731 usrg_gdcAvgSalaryStrAfterDelete"
      DISABLE: 1
      EDITIONDATE: 2014-03-12T10:57:53+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147368586_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368584_274788016
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_gdcAvgSalaryStrAfterPost"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_GetAvgSalarySum
        '#include wg_EnableFieldChange
        '#include wg_SetSilkAvgSum
        option explicit
        sub usrg_gdcAvgSalaryStrAfterPost(ByVal DataSet)
          Exit Sub 'отключено
        ' пересчитываем сумму среднего заработка
        '  if wg_EnabledFieldChange(DataSet, "AVGSALARYCALC") then
        '    wg_GetAvgSalarySum(DataSet)
        '  end if
          call wg_SetSilkAvgSum(DataSet)
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_GDCAVGSALARYSTRAFTERPOST
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "AFTERPOST"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAREFUQVNFVAcAAABEQVRBU0VUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-12T10:46:17+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147368587_274788016 wg_GetAvgSalarySum"
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "147302770_531940465 wg_SetSilkAvgSum"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147368584_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_gdcAvgSalaryStr"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147368583_274788016 gdc_dlgUserComplexDocument147022845_119619099\\usrg_gdcAvgSalaryStr"
      EVENTNAME: "AFTERPOST"
      FUNCTIONKEY: "147368586_274788016 usrg_gdcAvgSalaryStrAfterPost"
      DISABLE: 1
      EDITIONDATE: 2014-03-12T10:46:18+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147022925_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368574_274788016
    Fields: 
      NAME: "Tgdc_dlgUserComplexDocument147022845_119619099"
      DESCRIPTION: ~
      PARENT: "147005312_31587988 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument"
      OBJECTTYPE: 1
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: "Tgdc_dlgUserComplexDocument"
      OBJECTNAME: ""
      SUBTYPE: "147022845_119619099"
      EDITIONDATE: 2004-05-07T14:03:57+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147368576_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368574_274788016
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "METHOD"
      LANGUAGE: "VBScript"
      NAME: "Tgdc_dlgUserComplexDocument147022845_119619099SyncField"
      COMMENT: ~
      SCRIPT: | 
        '#include WG_GETCONSTBYIDANDDATE
        '#include WG_CALCSICLLISTCOEFF
        '#include wg_SetWageDocLookupParams
        '#include wg_MonthHour
        '#include wg_RoundSum
        '#include wg_CalcSchedulerWorkTime
        '#include wg_Total
        '#include wg_Prolog
        option explicit
        sub Tgdc_dlgUserComplexDocument147022845_119619099SyncField(Self, Field, SyncList)
        '*** Данный код необходим для вызова кода определенного в gdc-классе.***
        '*** При его удаления  возможно нарушение  правильной работы системы.***
          call Inherited(Self, "SyncField", Array(Self, Field, SyncList))
        '***               Конец кода поддержки gdc-класса.                  ***
          dim MoveCardList, TotalDateEnd, MoveCard, LineSum
          dim gdcDetailObject, gdcObject, FeeTypeKey, IBSQL
          dim LimitPercent, ByHour, ByBudget, DateFrom, AvgSalaryByRB, LastDay
          dim Creator, DT, Pregnancy, DB, DE, WorkDays, WorkHours
          dim Scheduler, ShedulerKey, wg_EmployeeMovement
          dim K
        
          set Creator = New TCreator
          set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = Self.gdcObject.ReadTransaction
          IBSQL.SQL.Text = " SELECT " + _
            " USR$DATEBEGIN, USR$DATEEND " + _
            " FROM USR$WG_SICKLIST SICK " + _
            " WHERE SICK.USR$FROM = :DT " + _
            " AND SICK.USR$EMPLKEY = :emplkey "
            
          dim q
          set q = creator.GetObject(nil, "TIBSQL", "")
          q.Transaction = Self.gdcObject.ReadTransaction
        
          if Field.DataSet.Self = Self.gdcObject.Self then
            select case Field.FieldName
              case "USR$TOTALDOCKEY"
                wg_SetWageDocLookupParams(Self)
                
        
        
              case "USR$EMPLKEY"
                'Определим карточку сотрудника на конец месяца начисления
                if not Self.gdcObject.FieldByName("usr$totaldockey").IsNull then
                  Self.gdcObject.FieldByName("usr$calcbyhour").AsInteger = 0
                  set MoveCardList = wg_EmplMoveList.MoveCardList(Field.AsInteger, Null)
                  if Assigned(MoveCardList) then
                    TotalDateEnd = wg_Total.DateEnd(Self.gdcObject.FieldByName("usr$totaldockey").AsInteger)
                    set MoveCard = MoveCardList.ExistMoveCardByDate(TotalDateEnd)
                    if Assigned(MoveCard) then
                      if MoveCard.PayFormKey = gdcBaseManager.GetIDByRUIDString(wg_PayForm_Salary_RUID) and not(MoveCard.ByHour) then
                        Self.gdcObject.FieldByName("usr$calcbyhour").AsInteger = 0
                      end if
                    end if
                  end if
                end if
        
        
                wg_SetWageDocLookupParams(Self)
        
              case "USR$ILLTYPEKEY"
                q.Close
                q.SQL.Text = _
                "select it.USR$CALCTYPE as ctype " & _
                "from USR$WG_ILLTYPE it " & _
                "where it.ID = :id "
                q.ParamByName("id").AsInteger = Field.AsInteger
                q.ExecQuery
                Self.GetComponent("usrg_cbCalcType").ItemIndex = q.FieldByName("ctype").AsInteger
                Field.DataSet.FieldByName("usr$calctype").AsInteger = q.FieldByName("ctype").AsInteger
        
                  Pregnancy = (gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = Self.gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger)
                  if Pregnancy then
                    Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 6
                    Self.GetComponent("usrg_cbCalcType").ItemIndex = wg_SickType100
                    Field.DataSet.FieldByName("usr$calctype").AsInteger = wg_SickType100
                    Field.DataSet.FieldByName("USR$CALCBYHOUR").AsInteger = 0
                  'added 18.07.13
                  elseif Field.DataSet.FieldByName("USR$FROM").AsDateTime < CDate("11.07.2013") then
                    Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 2
                  elseif Field.DataSet.FieldByName("USR$FROM").AsDateTime >= CDate("11.07.2013") then
                    Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 6
                  'end added
                  end if
        
            'added 18.07.13
            case "USR$FROM"
              Pregnancy = (gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = Self.gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger)
              if Field.DataSet.FieldByName("USR$FROM").AsDateTime >= CDate("11.07.2013") or Pregnancy then
                Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 6
              else
                Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 2
              end if
            ' added end
                
              case wg_Prolog.SyncField_Name(Self.gdcObject, "USR$AVGSUMMA")
                set gdcDetailObject = Self.gdcDetailObject
                set gdcObject = Self.gdcObject
                FeeTypeKey = gdcBaseManager.GetIDByRUIDString(wg_FeeType_SickList_RUID)
                'Декретный или нет
                Pregnancy = (gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger)
                gdcDetailObject.Cancel
                gdcDetailObject.First
                if not gdcObject.FieldByName("usr$percent").IsNull then
                  LimitPercent = gdcObject.FieldByName("usr$percent").AsCurrency
                else
                  LimitPercent = 100
                end if
                ByHour = (gdcObject.FieldByName("usr$calcbyhour").AsInteger = 1)
                ByBudget = (gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1)
        
                'Максимальный размер пособий, исчисленных в соответствии с настоящим Положением,
                'кроме пособий по беременности и родам, исчисленных в соответствии с пунктами 39 и 40 настоящего Положения,
                'за календарный месяц по каждому месту работы устанавливается в размере трехкратной величины
                'средней заработной платы рабочих и служащих в республике в месяце, предшествующем каждому месяцу
                'временной нетрудоспособности, отпуска по беременности и родам.
                '
                'Максимальный размер пособий за неполный месяц устанавливается в размере величины,
                'получаемой путем деления трехкратной величины средней заработной платы рабочих и служащих в
                'республике в месяце, предшествующем месяцу временной нетрудоспособности, отпуска по беременности и родам,
                'на количество рабочих дней (часов) по графику работы работника в месяце временной нетрудоспособности,
                'отпуска по беременности и родам с последующим умножением полученного результата на
                'количество рабочих дней (часов) временной нетрудоспособности, отпуска по беременности и родам, в этом месяце.
        
                while (not gdcDetailObject.EOF)
                  gdcDetailObject.Edit
                  if not ByBudget then
                    if not ByHour then
                      LineSum = _
                        gdcDetailObject.FieldByName("USR$DOI").AsCurrency * gdcDetailObject.FieldByName("USR$PERCENT").AsCurrency * _
                        Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency / 100
                    else
                      LineSum = _
                        gdcDetailObject.FieldByName("USR$HOI").AsCurrency * gdcDetailObject.FieldByName("USR$PERCENT").AsCurrency * _
                        Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency / 100
                    end if
                    K = wg_CalcSiclListCoeff(gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime, _
                      gdcDetailObject.FieldByName("USR$DATEBEGIN").AsDateTime)
        
                    LineSum = LineSum * LimitPercent / 100 * K
                  else
                    LastDay = Day(DateAdd("m", 1, DateSerial( _
                      Year(gdcDetailObject.FieldByName("USR$DATEBEGIN").AsDateTime), _
                      Month(gdcDetailObject.FieldByName("USR$DATEBEGIN").AsDateTime), 1)) - 1)
                    if LastDay > 0 then
                      LineSum = _
                        Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency * _
                        gdcDetailObject.FieldByName("USR$DOI").AsInteger / LastDay
                    else
                      LineSum = 0
                    end if
                  end if
                  'if not Pregnancy then
                    set wg_EmployeeMovement = wg_EmplMoveList.MoveCardList(gdcObject.FieldByName("USR$EMPLKEY").AsInteger, Null)
                    if Assigned(wg_EmployeeMovement) then
                      'Зредняя зрп за месяц предыдущий месяцу болезни
                      DateFrom = gdcDetailObject.FieldByName("USR$INCLUDEDATE").AsDateTime
                      set MoveCard = wg_EmployeeMovement.ExistMoveCardByDate(DateFrom)
                      if Assigned(MoveCard) then
                        WorkDays = 0
                        WorkHours = 0
                        ' определяем период начала и конца итогового начисления
                        DB = wg_Total.DateBegin(wg_Total.TotalDocByDate(DateFrom))
                        DE = wg_Total.DateEnd(wg_Total.TotalDocByDate(DateFrom))
                        call wg_CalcSchedulerWorkTime(gdcObject.FieldByName("usr$emplkey").AsInteger, _
                          MoveCard.FirstMoveKey, DB, DE, gdcObject.ReadTransaction, True, WorkDays, WorkHours)
        
                        if not ByHour then
                          if WorkDays > 0 then
                            AvgSalaryByRB = 3 * wg_MonthHour.AvgSalaryByRB(_
                              DateSerial(Year(DateFrom), Month(DateFrom), 1) -1) / WorkDays * gdcDetailObject.FieldByName("USR$DOI").AsCurrency
                          else
                            AvgSalaryByRB = 0
                          end if
                        else
                          if WorkHours > 0 then
                            AvgSalaryByRB = 3 * wg_MonthHour.AvgSalaryByRB(_
                              DateSerial(Year(DateFrom), Month(DateFrom), 1) -1) / WorkHours * gdcDetailObject.FieldByName("USR$HOI").AsCurrency
                          else
                            AvgSalaryByRB = 0
                          end if
                        end if
                        
                        if AvgSalaryByRB <> 0 and LineSum > AvgSalaryByRB then
                          LineSum = AvgSalaryByRB
                        end if
                      end if
                   ' end if
                  end if
                  Self.gdcDetailObject.FieldByName("usr$summa").AsCurrency = wg_RoundSum(FeeTypeKey, LineSum)
                  gdcDetailObject.Post
                  gdcDetailObject.Next
                wend
                gdcDetailObject.First
        
              ' 50% от бюджета прожиточного минимума
              ' срабатывает, если при пересчете декрета пользователь выбрал "50% БМП"
              case wg_Prolog.SyncField_Name(Self.gdcObject, "USR$CALCBYBUDGET")
                if Field.AsInteger = 0 then
                  Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = 0
                else
                  dim gdcAvgStr
                  set gdcAvgStr = Self.GetComponent("usrg_gdcAvgSalaryStr")
                  'Выключаем автоперерасчет среднего заработка
                  gdcAvgStr.Tag = 1
                  'Удалим старые значения
                  gdcAvgStr.First
                  while not gdcAvgStr.Eof
                    gdcAvgStr.Delete
                  wend
                  call Tgdc_dlgUserComplexDocument147022845_119619099SyncField_CalcAvgSumBudget(Self.gdcObject)
                  gdcAvgStr.Tag = 0
                end if
              case "USR$FROM"
                if (not Field.IsNull) and Self.gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1 then
                  call Tgdc_dlgUserComplexDocument147022845_119619099SyncField_CalcAvgSumBudget(Self.gdcObject)
                end if
            end select
          end if
        end sub
        
        ' 50% от бюджета прожиточного минимума
        sub Tgdc_dlgUserComplexDocument147022845_119619099SyncField_CalcAvgSumBudget(gdcO)
          dim AvgSum, OnDate
          if gdcO.FieldByName("USR$FROM").IsNull then
            OnDate = Date
          else
            OnDate = gdcO.FieldByName("USR$FROM").AsDateTime
          end if
          ' бюджет прожиточного минимума
          AvgSum = wg_GetConstByIDAndDate(gdcBaseManager.GetIDByRUIDString(wg_cnst_LivingWage_RUID), OnDate)
          gdcO.FieldByName("usr$avgsumma").AsCurrency = Round(AvgSum  / 2)
        end sub
        
      DISPLAYSCRIPT: | 
        TGDC_DLGUSERCOMPLEXDOCUMENT147022845_119619099SYNCFIELD
        TGDC_DLGUSERCOMPLEXDOCUMENT147022845_119619099SYNCFIELD_CALCAVGSUMBUDGET
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022925_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QEAAAAU0VMRgQAAABTRUxGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNU
        BQAAAEZJRUxEBQAAAEZJRUxEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNUCAAAAFNZ
        TkNMSVNUCAAAAFNZTkNMSVNUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-26T13:18:56+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147043669_974374174 wg_GetConstByIDAndDate"
          - 
            ADDFUNCTIONKEY: "155074107_1698257362 wg_CalcSiclListCoeff"
          - 
            ADDFUNCTIONKEY: "147025267_449804462 wg_SetWageDocLookupParams"
          - 
            ADDFUNCTIONKEY: "147019334_119619099 wg_MonthHour"
          - 
            ADDFUNCTIONKEY: "147804276_375143752 wg_RoundSum"
          - 
            ADDFUNCTIONKEY: "147523125_336327731 wg_CalcSchedulerWorkTime"
          - 
            ADDFUNCTIONKEY: "147586119_119619099 wg_Total"
          - 
            ADDFUNCTIONKEY: "528612032_99701464 wg_Prolog"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147368574_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147022845_119619099"
      PARENTNAME: "Tgdc_dlgUserComplexDocument"
      OBJECTKEY: "147022925_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147022845_119619099"
      EVENTNAME: "SYNCFIELD"
      FUNCTIONKEY: "147368576_274788016 Tgdc_dlgUserComplexDocument147022845_119619099SyncField"
      DISABLE: ~
      EDITIONDATE: 2014-03-26T13:18:58+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 147063986_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "990010_17 USER - Administrator"
      NAME: "gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2010-04-20T13:32:16+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648252_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "WS"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 2
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:44:25+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648251_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Width"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 1382
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:44:25+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648250_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Left"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:44:25+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648249_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Top"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:44:25+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648248_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 744
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:44:25+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 147063987_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "ibgrDetail(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2010-04-20T13:32:16+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123779_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063987_1439110857
    Fields: 
      PARENT: "147063987_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)\\ibgrDetail(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4ACAgOAAgOAQhFeHBhbmRlZAgJRmllbGROYW1lBgtVU1IkQUNDREFURQ1UaXRsZS5D
        YXB0aW9uBg/E4PLgIO3g9+jx6+Xt6P8FV2lkdGgCbAdWaXNpYmxlCQABCEV4cGFuZGVkCAlGaWVs
        ZE5hbWUGD1VTUiRJTkNMVURFREFURQ1UaXRsZS5DYXB0aW9uBg/E4PLgIOfg9+jx6+Xt6P8FV2lk
        dGgCbAdWaXNpYmxlCQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5kZWQICUZpZWxk
        TmFtZQYMVVNSJERVUkFUSU9ODVRpdGxlLkNhcHRpb24GA8Tt6AVXaWR0aAIkB1Zpc2libGUJCVRv
        dGFsVHlwZQcFdHRTdW0AAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVs
        ZE5hbWUGCVVTUiRTVU1NQQ1UaXRsZS5DYXB0aW9uBgXR8+zs4AVXaWR0aAJIB1Zpc2libGUJDURp
        c3BsYXlGb3JtYXQGBCMuIyMJVG90YWxUeXBlBwV0dFN1bQABCEV4cGFuZGVkCAlGaWVsZE5hbWUG
        DVVTUiREQVRFQkVHSU4NVGl0bGUuQ2FwdGlvbgYLxODy4CDt4Pfg6+AFV2lkdGgCbAdWaXNpYmxl
        CQABCEV4cGFuZGVkCAlGaWVsZE5hbWUGC1VTUiREQVRFRU5EDVRpdGxlLkNhcHRpb24GDsTg8uAg
        7uru7ffg7ej/BVdpZHRoAmwHVmlzaWJsZQkAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4
        cGFuZGVkCAlGaWVsZE5hbWUGBlNVTU5DVQ1UaXRsZS5DYXB0aW9uBgZzdW1uY3UFV2lkdGgC/wdW
        aXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGDERPQ1VNRU5UREFURQ1UaXRsZS5DYXB0aW9u
        BgTE4PLgBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgtERVNDUklQVElP
        Tg1UaXRsZS5DYXB0aW9uBgjO7+jx4O3o5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYOVVNSJFNPUlROVU1CRVIIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GFM3u7OXwIOTr
        /yDx7vDy6PDu4uroBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgJJRA1U
        aXRsZS5DYXB0aW9uBgTK6/73BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1l
        BgZQQVJFTlQNVGl0bGUuQ2FwdGlvbgYI0O7k6PLl6/wFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGD0RPQ1VNRU5UVFlQRUtFWQ1UaXRsZS5DYXB0aW9uBg3S6O8g5O7q8+zl
        7fLgBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBglUUlRZUEVLRVkNVGl0
        bGUuQ2FwdGlvbgYO0ujvIPLw4O3n4Or26OgFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlG
        aWVsZE5hbWUGDlRSQU5TQUNUSU9OS0VZDVRpdGxlLkNhcHRpb24GCtLw4O3n4Or26P8FV2lkdGgC
        /wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGBk5VTUJFUg1UaXRsZS5DYXB0aW9uBgXN
        7uzl8AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYHU1VNQ1VSUg1UaXRs
        ZS5DYXB0aW9uBg7R8+zs4CDiIOLg6/7y5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYHREVMQVlFRA1UaXRsZS5DYXB0aW9uBgrO8uvu5uXt7fvpBVdpZHRoAv8HVmlzaWJs
        ZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgdDVVJSS0VZDVRpdGxlLkNhcHRpb24GBsLg6/7y4AVX
        aWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKQ09NUEFOWUtFWQ1UaXRsZS5D
        YXB0aW9uBgjK7uzv4O3o/wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYK
        Q1JFQVRPUktFWQ1UaXRsZS5DYXB0aW9uBgrK8u4g8e7n5ODrBVdpZHRoAv8HVmlzaWJsZQgAAQhF
        eHBhbmRlZAgJRmllbGROYW1lBgxDUkVBVElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYNxODy4CDx7ufk
        4O3o/wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYJRURJVE9SS0VZDVRp
        dGxlLkNhcHRpb24GDMry7iDo8e/w4OLo6wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYLRURJVElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYOxODy4CDo5+zl7eXt6P8FV2lkdGgC
        /wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGCVBSSU5UREFURQ1UaXRsZS5DYXB0aW9u
        BgvE4PLgIO/l9+Dy6AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYIRElT
        QUJMRUQNVGl0bGUuQ2FwdGlvbgYJzvLq6/735e3uBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRl
        ZAgJRmllbGROYW1lBghSRVNFUlZFRA1UaXRsZS5DYXB0aW9uBg/H4PDl5+Xw4ujw7uLg7e4FV2lk
        dGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGC0RPQ1VNRU5US0VZCFJlYWRPbmx5
        CQ1UaXRsZS5DYXB0aW9uBg7K6/73IOTu6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYJTUFTVEVSS0VZCFJlYWRPbmx5CQ1UaXRsZS5DYXB0aW9uBifQ7uTo8uXr
        /CAozeD36PHr5e3o5SDu8u/z8eru4ijv7ufo9uj/KSkFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGCVJFU0VSVkVEMQhSZWFkT25seQkNVGl0bGUuQ2FwdGlvbgYux+Dw5efl
        8OLo8O7i4O3uICjN4Pfo8evl7ejlIO7y7/Px6u7iKO/u5+j26P8pKQVXaWR0aAL/B1Zpc2libGUI
        AAEIRXhwYW5kZWQICUZpZWxkTmFtZQYFU1VNRVENVGl0bGUuQ2FwdGlvbgYT0fPs7OAg4iD96uLo
        4uDr5e3y5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKVVNSJEVRUkFU
        RQ1UaXRsZS5DYXB0aW9uBgnK8/DxIP3q4i4FV2lkdGgC/wdWaXNpYmxlCAABCUFsaWdubWVudAcO
        dGFSaWdodEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYFQUZVTEwNVGl0bGUuQ2FwdGlvbgYN
        z+7r7fvpIOTu8fLz7wVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlm
        eQhFeHBhbmRlZAgJRmllbGROYW1lBgVBQ0hBRw1UaXRsZS5DYXB0aW9uBhnP8O7x7O7y8CDoIPDl
        5ODq8ujw7uLg7ejlBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5
        CEV4cGFuZGVkCAlGaWVsZE5hbWUGBUFWSUVXDVRpdGxlLkNhcHRpb24GD9Lu6/zq7iDv8O7x7O7y
        8AVXaWR0aAL/B1Zpc2libGUIAAAICP0cCQg=
      EDITIONDATE: 2014-02-26T15:58:19+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 154648246_77029543
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "pnlMaster(TPanel)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2013-08-12T19:08:11+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648247_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 154648246_77029543
    Fields: 
      PARENT: "154648246_77029543 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)\\pnlMaster(TPanel)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 283
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-08-20T15:26:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 147063989_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "usrg_grAvgSalaryStr(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2010-04-20T13:32:16+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123780_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063989_1439110857
    Fields: 
      PARENT: "147063989_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)\\usrg_grAvgSalaryStr(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4BDERpc3BsYXlGaWVsZAYHVVNSJERPVwlGaWVsZE5hbWUGB1VTUiRIT1cJTGluZUNv
        dW50AgEHT3B0aW9ucwsLY2VvQWRkRmllbGQAAAEMRGlzcGxheUZpZWxkBhBVU1IkU0NIRURVTEVS
        RE9XCUZpZWxkTmFtZQYQVVNSJFNDSEVEVUxFUkhPVwlMaW5lQ291bnQCAQdPcHRpb25zCwtjZW9B
        ZGRGaWVsZAAAAQxEaXNwbGF5RmllbGQGDVVTUiRORVdTQUxBUlkJRmllbGROYW1lBg1VU1IkT0xE
        U0FMQVJZCUxpbmVDb3VudAIBB09wdGlvbnMLC2Nlb0FkZEZpZWxkAAABDERpc3BsYXlGaWVsZAYK
        VVNSJFNBTEFSWQlGaWVsZE5hbWUGEFVTUiRNT0RFUk5TQUxBUlkJTGluZUNvdW50AgEHT3B0aW9u
        cwsLY2VvQWRkRmllbGQAAAAICA4ACA4BCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgpVU1IkSVNGVUxMCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgzP7uvt++kg
        7OXx//YFV2lkdGgCMAdWaXNpYmxlCQABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgtVU1IkSVNDSEVDSwhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYEwurrLgVX
        aWR0aAIwB1Zpc2libGUJCVRvdGFsVHlwZQcFdHRTdW0AAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3Rp
        ZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYIVVNSJERBVEUIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24G
        BMTg8uAFV2lkdGgCSAdWaXNpYmxlCQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYKVVNSJFNBTEFSWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYIx+Dw7+vg
        8uAFV2lkdGgCSAdWaXNpYmxlCQ1EaXNwbGF5Rm9ybWF0BgQjLiMjAAEJQWxpZ25tZW50Bw50YVJp
        Z2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBglVU1IkQ09FRkYIUmVhZE9ubHkIDVRpdGxl
        LkNhcHRpb24GBsru/fQt8gVXaWR0aAI0B1Zpc2libGUJAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVz
        dGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1IkTU9ERVJOU0FMQVJZCFJlYWRPbmx5CA1UaXRs
        ZS5DYXB0aW9uBhTR7uLw5ezl7e3g/yDn4PDv6+Dy4AVXaWR0aAJUB1Zpc2libGUJDURpc3BsYXlG
        b3JtYXQGBCMuIyMJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkI
        RXhwYW5kZWQICUZpZWxkTmFtZQYHVVNSJERPVwhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYDxO3o
        BVdpZHRoAiQHVmlzaWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcNdGFMZWZ0SnVz
        dGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1IkU0NIRURVTEVSRE9XCFJlYWRPbmx5CA1UaXRs
        ZS5DYXB0aW9uBgvE7eXpIO/uIOPwLgVXaWR0aAJIB1Zpc2libGUJAAEJQWxpZ25tZW50Bw50YVJp
        Z2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBgdVU1IkSE9XCFJlYWRPbmx5CA1UaXRsZS5D
        YXB0aW9uBgTX4PH7BVdpZHRoAisHVmlzaWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVu
        dAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1IkU0NIRURVTEVSSE9XCFJl
        YWRPbmx5CA1UaXRsZS5DYXB0aW9uBgzX4PHu4iDv7iDj8C4FV2lkdGgCTAdWaXNpYmxlCQABCUFs
        aWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBg9VU1IkREVTQ1JJUFRJ
        T04IUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GCM7v6PHg7ejlBVdpZHRoA94AB1Zpc2libGUJAAEJ
        QWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBg1VU1IkT0xEU0FM
        QVJZCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgXO6uvg5AVXaWR0aAL/B1Zpc2libGUIAAEJQWxp
        Z25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBg1VU1IkTkVXU0FMQVJZ
        CFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBg3S5erz+ejpIO7q6+DkBVdpZHRoAv8HVmlzaWJsZQgA
        AQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYCSUQNVGl0bGUu
        Q2FwdGlvbgYNyOTl7fLo9Ojq4PLu8AVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw10YUxl
        ZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGD1VTUiRET0NVTUVOVEtFWQhSZWFkT25seQgN
        VGl0bGUuQ2FwdGlvbgYIxO7q8+zl7fIFV2lkdGgC/wdWaXNpYmxlCAABCUFsaWdubWVudAcNdGFM
        ZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhhaX1VTUiRET0NVTUVOVEtFWV9OVU1CRVII
        UmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBc3u7OXwBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1l
        bnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYeWl9VU1IkRE9DVU1FTlRLRVlf
        RE9DVU1FTlREQVRFCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgTE4PLgBVdpZHRoAv8HVmlzaWJs
        ZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYfWl9VU1Ik
        RE9DVU1FTlRLRVlfRE9DMjcxNTI2MDQ3OAhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYN0ujvIOTu
        6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGDFVTUiRDQUxDREFZUwhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYLxO3o
        IPDg8ffl8i4FV2lkdGgC/wdWaXNpYmxlCAAACAj9DAkI
      EDITIONDATE: 2014-10-28T09:48:51+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 394420819_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "990010_17 USER - Administrator"
      NAME: "gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2012-02-21T12:09:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420826_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "WS"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 2
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:30:24+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420825_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Width"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 1382
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:30:24+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420824_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Left"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:30:24+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420823_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Top"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:30:24+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420822_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 744
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-18T11:30:24+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 497125569_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "ibgrDetail(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2013-09-12T10:36:15+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 497125570_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 497125569_99701464
    Fields: 
      PARENT: "497125569_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)\\ibgrDetail(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4ACAgOAAgOAQhFeHBhbmRlZAgJRmllbGROYW1lBg9VU1IkSU5DTFVERURBVEUNVGl0
        bGUuQ2FwdGlvbgYQzOXx//Yg5+D36PHr5e3o/wVXaWR0aAJsB1Zpc2libGUJAAEJQWxpZ25tZW50
        Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBgtVU1IkUEVSQ0VOVA1UaXRsZS5D
        YXB0aW9uBgElBVdpZHRoAiQHVmlzaWJsZQkAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4
        cGFuZGVkCAlGaWVsZE5hbWUGB1VTUiRET0kNVGl0bGUuQ2FwdGlvbgYDxO3oBVdpZHRoAjAHVmlz
        aWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYHVVNSJEhPSQ1UaXRsZS5DYXB0aW9uBgTX4PH7BVdpZHRoAjAHVmlzaWJs
        ZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5kZWQI
        CUZpZWxkTmFtZQYJVVNSJFNVTU1BDVRpdGxlLkNhcHRpb24GBdHz7OzgBVdpZHRoAkgHVmlzaWJs
        ZQkJVG90YWxUeXBlBwV0dFN1bQABCEV4cGFuZGVkCAlGaWVsZE5hbWUGDVVTUiREQVRFQkVHSU4N
        VGl0bGUuQ2FwdGlvbgYLxODy4CDt4Pfg6+AFV2lkdGgCVAdWaXNpYmxlCQABCEV4cGFuZGVkCAlG
        aWVsZE5hbWUGC1VTUiREQVRFRU5EDVRpdGxlLkNhcHRpb24GDsTg8uAg7uru7ffg7ej/BVdpZHRo
        AmwHVmlzaWJsZQkAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5h
        bWUGBlNVTU5DVQ1UaXRsZS5DYXB0aW9uBgnN4Pfo8evl7e4FV2lkdGgC/wdWaXNpYmxlCAABCEV4
        cGFuZGVkCAlGaWVsZE5hbWUGDERPQ1VNRU5UREFURQ1UaXRsZS5DYXB0aW9uBgTE4PLgBVdpZHRo
        Av8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgtERVNDUklQVElPTg1UaXRsZS5DYXB0
        aW9uBgjO7+jx4O3o5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYOVVNS
        JFNPUlROVU1CRVIIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GFM3u7OXwIOTr/yDx7vDy6PDu4uro
        BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgJJRA1UaXRsZS5DYXB0aW9u
        BgTK6/73BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgZQQVJFTlQNVGl0
        bGUuQ2FwdGlvbgYI0O7k6PLl6/wFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5h
        bWUGD0RPQ1VNRU5UVFlQRUtFWQ1UaXRsZS5DYXB0aW9uBg3S6O8g5O7q8+zl7fLgBVdpZHRoAv8H
        VmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBglUUlRZUEVLRVkNVGl0bGUuQ2FwdGlvbgYO
        0ujvIPLw4O3n4Or26OgFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGDlRS
        QU5TQUNUSU9OS0VZDVRpdGxlLkNhcHRpb24GCtLw4O3n4Or26P8FV2lkdGgC/wdWaXNpYmxlCAAB
        CEV4cGFuZGVkCAlGaWVsZE5hbWUGBk5VTUJFUg1UaXRsZS5DYXB0aW9uBgXN7uzl8AVXaWR0aAL/
        B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYHU1VNQ1VSUg1UaXRsZS5DYXB0aW9uBg7R
        8+zs4CDiIOLg6/7y5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYHREVM
        QVlFRA1UaXRsZS5DYXB0aW9uBgrO8uvu5uXt7fvpBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgdDVVJSS0VZDVRpdGxlLkNhcHRpb24GBsLg6/7y4AVXaWR0aAL/B1Zpc2li
        bGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKQ09NUEFOWUtFWQ1UaXRsZS5DYXB0aW9uBgjK7uzv
        4O3o/wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKQ1JFQVRPUktFWQ1U
        aXRsZS5DYXB0aW9uBgrK8u4g8e7n5ODrBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmll
        bGROYW1lBgxDUkVBVElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYNxODy4CDx7ufk4O3o/wVXaWR0aAL/
        B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYJRURJVE9SS0VZDVRpdGxlLkNhcHRpb24G
        DMry7iDo8e/w4OLo6wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYLRURJ
        VElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYOxODy4CDo5+zl7eXt6P8FV2lkdGgC/wdWaXNpYmxlCAAB
        CEV4cGFuZGVkCAlGaWVsZE5hbWUGCVBSSU5UREFURQ1UaXRsZS5DYXB0aW9uBgvE4PLgIO/l9+Dy
        6AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYIRElTQUJMRUQNVGl0bGUu
        Q2FwdGlvbgYJzvLq6/735e3uBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1l
        BghSRVNFUlZFRA1UaXRsZS5DYXB0aW9uBg/H4PDl5+Xw4ujw7uLg7e4FV2lkdGgC/wdWaXNpYmxl
        CAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGC0RPQ1VNRU5US0VZCFJlYWRPbmx5CQ1UaXRsZS5DYXB0
        aW9uBg7K6/73IOTu6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFt
        ZQYJTUFTVEVSS0VZCFJlYWRPbmx5CQ1UaXRsZS5DYXB0aW9uBivQ7uTo8uXr/CAoMDUuzeD36PHr
        5e3o5SDh7uvt6Pft+/Uo7+7n6Pbo/ykpBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmll
        bGROYW1lBglSRVNFUlZFRDEIUmVhZE9ubHkJDVRpdGxlLkNhcHRpb24GMsfg8OXn5fDi6PDu4uDt
        7iAoMDUuzeD36PHr5e3o5SDh7uvt6Pft+/Uo7+7n6Pbo/ykpBVdpZHRoAv8HVmlzaWJsZQgAAQhF
        eHBhbmRlZAgJRmllbGROYW1lBgtVU1IkQUNDREFURQ1UaXRsZS5DYXB0aW9uBhDM5fH/9iDt4Pfo
        8evl7ej/BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgVTVU1FUQ1UaXRs
        ZS5DYXB0aW9uBhPR8+zs4CDiIP3q4uji4Ovl7fLlBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgpVU1IkRVFSQVRFDVRpdGxlLkNhcHRpb24GCcrz8PEg/eriLgVXaWR0aAL/
        B1Zpc2libGUIAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1l
        BgVBRlVMTA1UaXRsZS5DYXB0aW9uBg3P7uvt++kg5O7x8vPvBVdpZHRoAv8HVmlzaWJsZQgAAQlB
        bGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGBUFDSEFHDVRpdGxl
        LkNhcHRpb24GGc/w7vHs7vLwIOgg8OXk4Ory6PDu4uDt6OUFV2lkdGgC/wdWaXNpYmxlCAABCUFs
        aWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYFQVZJRVcNVGl0bGUu
        Q2FwdGlvbgYP0u7r/OruIO/w7vHs7vLwBVdpZHRoAv8HVmlzaWJsZQgAAAgI/RwJCA==
      EDITIONDATE: 2014-04-08T17:59:41+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 394420820_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "pnlMaster(TPanel)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2012-02-21T12:09:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420821_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420820_99701464
    Fields: 
      PARENT: "394420820_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)\\pnlMaster(TPanel)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 304
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-09T10:54:27+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 489119204_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "usrg_grAvgSalaryStr(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2013-07-30T17:00:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 489119205_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 489119204_99701464
    Fields: 
      PARENT: "489119204_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)\\usrg_grAvgSalaryStr(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4ACAgOAAgOAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxk
        TmFtZQYKVVNSJElTRlVMTAhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYMz+7r7fvpIOzl8f/2BVdp
        ZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxk
        TmFtZQYIVVNSJERBVEUIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBMTg8uAFV2lkdGgCSAdWaXNp
        YmxlCQABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBgxVU1Ik
        Q0FMQ0RBWVMIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GC8Tt6CDw4PH35fIuBVdpZHRoAk4HVmlz
        aWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYKVVNSJFNBTEFSWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYIx+Dw7+vg
        8uAFV2lkdGgCSAdWaXNpYmxlCQ1EaXNwbGF5Rm9ybWF0BgQjLiMjCVRvdGFsVHlwZQcFdHRTdW0A
        AQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGB1VTUiRET1cI
        UmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GCsTt6CDw4OHu8vsFV2lkdGgCTgdWaXNpYmxlCQlUb3Rh
        bFR5cGUHBXR0U3VtAAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5h
        bWUGEFVTUiRTQ0hFRFVMRVJET1cIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GD8Tt5ekg7+4g4/Dg
        9Ojq8wVXaWR0aAJUB1Zpc2libGUJAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgdVU1IkSE9XCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgvX4PH7IPDg4e7y
        +wVXaWR0aAJMB1Zpc2libGUJCVRvdGFsVHlwZQcFdHRTdW0AAQlBbGlnbm1lbnQHDXRhTGVmdEp1
        c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYQVVNSJFNDSEVEVUxFUkhPVwhSZWFkT25seQgNVGl0
        bGUuQ2FwdGlvbgYQ1+Dx7uIg7+4g4/Dg9Ojq8wVXaWR0aAJgB1Zpc2libGUJAAEJQWxpZ25tZW50
        Bw10YUxlZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGD1VTUiRERVNDUklQVElPTghSZWFk
        T25seQgNVGl0bGUuQ2FwdGlvbgYIzu/o8eDt6OUFV2lkdGgCeQdWaXNpYmxlCQABCUFsaWdubWVu
        dAcNdGFMZWZ0SnVzdGlmeQVDb2xvcgcHY2xXaGl0ZQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1Ik
        TU9ERVJOU0FMQVJZCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBhTR7uLw5ezl7e3g/yDn4PDv6+Dy
        4AVXaWR0aAL/B1Zpc2libGUIDURpc3BsYXlGb3JtYXQGBCMuIyMAAQlBbGlnbm1lbnQHDXRhTGVm
        dEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYJVVNSJENPRUZGCFJlYWRPbmx5CA1UaXRsZS5D
        YXB0aW9uBgbK7v30LfIFV2lkdGgC/wdWaXNpYmxlCAABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlm
        eQhFeHBhbmRlZAgJRmllbGROYW1lBgtVU1IkSVNDSEVDSwhSZWFkT25seQgNVGl0bGUuQ2FwdGlv
        bgYEwurrLgVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGDVVTUiRPTERTQUxBUlkIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBc7q
        6+DkBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQI
        CUZpZWxkTmFtZQYNVVNSJE5FV1NBTEFSWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYG0fLg4urg
        BVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYCSUQNVGl0bGUuQ2FwdGlvbgYNyOTl7fLo9Ojq4PLu8AVXaWR0aAL/B1Zpc2libGUI
        AAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGD1VTUiRET0NV
        TUVOVEtFWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYIxO7q8+zl7fIFV2lkdGgC/wdWaXNpYmxl
        CAABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhhaX1VTUiRE
        T0NVTUVOVEtFWV9OVU1CRVIIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBc3u7OXwBVdpZHRoAv8H
        VmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYe
        Wl9VU1IkRE9DVU1FTlRLRVlfRE9DVU1FTlREQVRFCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgTE
        4PLgBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQI
        CUZpZWxkTmFtZQYfWl9VU1IkRE9DVU1FTlRLRVlfRE9DMjcxNTI2MDQ3OAhSZWFkT25seQgNVGl0
        bGUuQ2FwdGlvbgYN0ujvIOTu6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAAICP0cCQg=
      EDITIONDATE: 2014-12-09T11:30:19+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151516266_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151516264_101633588
    Fields: 
      OBJECTNAME: "gdc_frmUserComplexDocument147022845_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_Sick_Recalc"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate_Sick_pl
        '#include wg_Prolog
        '#include wg_AvgSalaryDetailGenerate_Sick_pl
        
        Sub Macros_Sick_Recalc(OwnerForm)
        '
          Dim gdcObject, gdcDetail, gdcAvgStr, Creator, inID, Ret
          Set gdcObject = OwnerForm.gdcObject
          Set gdcDetail = OwnerForm.gdcDetailObject
        
          Call wg_Prolog.SyncField(OwnerForm.gdcObject, True)
        
          If Not OwnerForm.gdcObject.VariableExists("DontRecalcLine") Then
            OwnerForm.gdcObject.AddVariableItem("DontRecalcLine")
          End If
          '
          OwnerForm.gdcObject.Variables("DontRecalcLine") = True
        
          gdcObject.First
          inID = ""
          '
          While Not gdcObject.eof
            If inID = "" Then
              inID = gdcObject.ID
            Else
              inID = inID & ", " & gdcObject.ID
            End If
            '
            gdcObject.Next
          Wend
          '
          inID = "(" & inID & ")"
          gdcObject.ExtraConditions.Add(" z.id in " & inID )
        
          Set Creator = New TCreator
          Set gdcAvgStr = Creator.GetObject(OwnerForm, "TgdcAttrUserDefined", "")
          gdcAvgStr.SubType = "USR$WG_AVGSALARYSTR"
          gdcAvgStr.Transaction = gdcObject.Transaction
          gdcAvgStr.ReadTransaction = gdcObject.ReadTransaction
          gdcAvgStr.SubSet = "ByParent"
          gdcAvgStr.MasterSource = OwnerForm.GetComponent("dsMain")
          gdcAvgStr.MasterField = "ID"
          gdcAvgStr.DetailField = "PARENT"
          gdcAvgStr.Open
        
          gdcObject.First
          '
          While Not gdcObject.EOF
            gdcObject.Edit
            gdcObject.FieldByName("USR$AVGSUMMA").Clear
            gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger = 0
            gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0
            gdcObject.FieldByName("USR$AVERAGE").AsInteger = 0
        
            Ret = wg_AvgSalaryStrGenerate_Sick_pl(gdcObject, gdcAvgStr)
            Ret = wg_AvgSalaryDetailGenerate_Sick_pl(gdcObject, gdcDetail)
            '
            gdcObject.Next
          Wend
        
          OwnerForm.gdcObject.Variables("DontRecalcLine") = False
          Call wg_Prolog.SyncField(OwnerForm.gdcObject, False)
          gdcObject.ExtraConditions.Clear
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS_SICK_RECALC
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147014155_274788016 gdc_frmUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-05-05T12:05:29+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "520236113_2108071301 wg_AvgSalaryStrGenerate_Sick_pl"
          - 
            ADDFUNCTIONKEY: "528612032_99701464 wg_Prolog"
          - 
            ADDFUNCTIONKEY: "528605649_99701464 wg_AvgSalaryDetailGenerate_Sick_pl"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 151516264_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_frmUserComplexDocument147022845_119619099"
      MACROSGROUPKEY: "147071380_375139087 Локальные макросы"
      FUNCTIONKEY: "151516266_101633588 Macros_Sick_Recalc"
      NAME: "Пересчет больничных (Пролог-скрипт)"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-05-05T12:05:29+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 540049114_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_CalcAvgAddPay_pl"
      COMMENT: ~
      SCRIPT: | 
        '#include pl_GetScriptIDByName
        Option Explicit
        
        Function wg_CalcAvgAddPay_pl(ByRef gdcObject, ByRef gdcDetailObject, ByRef gdcSalary, _
                                     ByVal MonthBefore, ByVal MonthOffset)
        '
          Dim T, T1, T2
          '
          Dim Creator
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile, Scope
          'avg_wage
          Dim P_main, Tv_main, Q_main
          'avg_wage_avg_in
          Dim P_in, Tv_in, Q_in
          Dim EmplKey, FirstMoveKey, DateCalc, CalcByHoure
          'avg_wage_run, avg_wage_sql
          Dim P_run, Tv_run, Q_run, P_sql, Tv_sql, Q_sql, P_kb
          Dim DateCalcFrom, DateCalcTo
          Dim PredicateName, Arity, SQL
          'avg_wage_out, avg_wage_avg_det
          Dim P_out, Tv_out, Q_out, P_det, Tv_det, Q_det
          Dim AvgWage, AvgWageRule
          Dim Period, Wage
          Dim TabDays, TabHoures, NormDays, NormHoures
        
          T1 = Timer
          wg_CalcAvgAddPay_pl = ""
        
          'init
          Set Creator = New TCreator
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = True
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          Scope = "wg_avg_wage_avg"
        
          'params
          CalcByHoure = gdcObject.FieldByName("USR$CALCBYHOUR").AsInteger
          EmplKey = gdcDetailObject.FieldByName("usr$emplkey").AsInteger
          FirstMoveKey = gdcDetailObject.FieldByName("usr$firstmovekey").AsInteger
          '
          Dim IBSQL
          '
          Set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = gdcBaseManager.ReadTransaction
          IBSQL.SQL.Text = _
              "SELECT " & _
              "  t.USR$DATEBEGIN " & _
              "FROM " & _
              "  USR$WG_TOTAL t " & _
              "WHERE " & _
              "  t.DOCUMENTKEY = :TDK "
          IBSQL.ParamByName("TDK").AsInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
          IBSQL.ExecQuery
          '
          DateCalc = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          '
          IBSQL.Close
          '
        
          'clean
          gdcSalary.First
          While Not gdcSalary.EOF
            gdcSalary.Delete
          Wend
          '
          gdcSalary.OwnerForm.Repaint
        
          'avg_wage_avg_in(EmplKey, FirstMoveKey, DateCalc, CalcByHoure, MonthBefore, MonthOffset)
          P_in = "avg_wage_avg_in"
          Set Tv_in = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutInteger 0, EmplKey
          Tv_in.PutInteger 1, FirstMoveKey
          Tv_in.PutDate 2, DateCalc
          Tv_in.PutInteger 3, CalcByHoure
          Tv_in.PutInteger 4, MonthBefore
          Tv_in.PutInteger 5, MonthOffset
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'avg_wage(Scope) - prepare data
          P_main = "avg_wage"
          Set Tv_main = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_main = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_main.PredicateName = P_main
          Q_main.Termv = Tv_main
          '
          Tv_main.PutAtom 0, Scope
          '
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage_run(Scope, EmplKey, FirstMoveKey, DateCalcFrom, DateCalcTo)
          P_run = "avg_wage_run"
          Set Tv_run = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_run = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_run.PredicateName = P_run
          Q_run.Termv = Tv_run
          'avg_wage_sql(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL)
          P_sql = "avg_wage_sql"
          P_kb = "avg_wage_kb"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Tv_run.PutAtom 0, Scope
          '
          Q_run.OpenQuery
          If Q_run.EOF Then
            Exit Function
          End If
          '
          Append = False
          '
          Do Until Q_run.EOF
            EmplKey = Tv_run.ReadInteger(1)
            FirstMoveKey = Tv_run.ReadInteger(2)
            DateCalcFrom = Tv_run.ReadDate(3)
            DateCalcTo = Tv_run.ReadDate(4)
            '
            Tv_sql.Reset
            Tv_sql.PutAtom 0, Scope
            Tv_sql.PutInteger 1, EmplKey
            Tv_sql.PutInteger 2, FirstMoveKey
            Q_sql.OpenQuery
            '
            Do Until Q_sql.EOF
              PredicateName = Tv_sql.ReadAtom(3)
              Arity = Tv_sql.ReadInteger(4)
              SQL = Tv_sql.ReadString(5)
              '
              Ret =  PL.MakePredicatesOfSQLSelect _
                        (SQL, _
                        gdcBaseManager.ReadTransaction, _
                        PredicateName, PredicateName, Append)
              If Ret >= 0 Then
                 Ret = PL.Call(P_kb, Tv_sql)
              End If
              '
              Q_sql.NextSolution
            Loop
            Q_sql.Close
            '
            Append = True
            '
            Q_run.NextSolution
          Loop
          Q_run.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage(Scope) - calc result
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_out(Scope, EmplKey, FirstMoveKey, AvgWage, AvgWageVariant)
          P_out = "avg_wage_out"
          Set Tv_out = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          'avg_wage_avg_det(EmplKey, FirstMoveKey,
          '                  Period, Wage,
          '                  TabDays, NormDays, TabHoures, NormHoures) :-
          P_det = "avg_wage_avg_det"
          Set Tv_det = Creator.GetObject(8, "TgsPLTermv", "")
          Set Q_det = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_det.PredicateName = P_det
          Q_det.Termv = Tv_det
          '
          Tv_out.PutAtom 0, Scope
          '
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            EmplKey = Tv_out.ReadInteger(1)
            FirstMoveKey = Tv_out.ReadInteger(2)
            AvgWage = Tv_out.ReadFloat(3)
            AvgWageRule = Tv_out.ReadAtom(4)
            '
            wg_CalcAvgAddPay_pl = AvgWageRule
            Select Case AvgWageRule
              Case "avg_houre", "avg_day"
                '
              Case Else
                Exit Function
            End Select
            '
            Tv_det.Reset
            Tv_det.PutInteger 0, EmplKey
            Tv_det.PutInteger 1, FirstMoveKey
            Q_det.OpenQuery
            '
            Do Until Q_det.EOF
              Period = Tv_det.ReadDate(2)
              Wage = Tv_det.ReadFloat(3)
              TabDays = Tv_det.ReadFloat(4)
              NormDays = Tv_det.ReadFloat(5)
              TabHoures = Tv_det.ReadFloat(6)
              NormHoures = Tv_det.ReadFloat(7)
              '
              gdcSalary.Append
              gdcSalary.FieldByName("USR$ISCHECK").AsVariant = Abs( Wage > 0 )
              gdcSalary.FieldByName("USR$DATE").AsVariant = Period
              If Wage > 0 Then
                gdcSalary.FieldByName("USR$SALARY").AsVariant = Wage
                gdcSalary.FieldByName("USR$DOW").AsVariant = TabDays
                gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = NormDays
                gdcSalary.FieldByName("USR$HOW").AsVariant = TabHoures
                gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = NormHoures
              End If
              gdcSalary.Post
              '
              Q_det.NextSolution
            Loop
            Q_det.Close
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
        
          gdcSalary.First
        
          gdcDetailObject.Edit
          gdcDetailObject.FieldByName("USR$AVGSUM").AsCurrency = AvgWage
          gdcDetailObject.Post
        
          T2 = Timer
          T = T2 - T1
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_CALCAVGADDPAY_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAR0RDT0JKRUNUCQAAAEdEQ09CSkVDVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AABGTlNUUFJTVA8AAABHRENERVRBSUxPQkpFQ1QPAAAAR0RDREVUQUlMT0JKRUNUAAAAAAAAAAAA
        AAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNUCQAAAEdEQ1NBTEFSWQkAAABHRENTQUxBUlkAAAAAAAAA
        AAAAAAAAAAAAAAAAAAAAAAAARk5TVFBSU1QLAAAATU9OVEhCRUZPUkULAAAATU9OVEhCRUZPUkUA
        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVFBSU1QLAAAATU9OVEhPRkZTRVQLAAAATU9OVEhP
        RkZTRVQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVEZMUFI=
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-09-10T16:17:36+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
  - 
    Properties: 
      Class: "TgdcMacrosGroup"
      RUID: 147113652_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049106_99701464
    Fields: 
      HASCHILDREN: 1
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTPARENT: ~
      CLASSNAME: ""
      SUBTYPE: ""
      PARENT: ~
      NAME: "Локальные макросы"
      ISGLOBAL: 0
      DESCRIPTION: ~
      EDITIONDATE: 2010-03-31T16:02:14+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147113651_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049106_99701464
    Fields: 
      NAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      DESCRIPTION: ~
      PARENT: ~
      OBJECTTYPE: 0
      MACROSGROUPKEY: "147113652_1354510846 Локальные макросы"
      REPORTGROUPKEY: "147113653_1354510846 Отчеты(gdc_dlgUserComplexDocument147113610_1354510846)"
      CLASSNAME: ""
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      SUBTYPE: ""
      EDITIONDATE: 2010-03-31T16:02:14+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 540049108_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049106_99701464
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_CalcAvgAddPay"
      COMMENT: ~
      SCRIPT: | 
        '#include WG_CALCAVGADDPAY
        option explicit
        sub Macros_CalcAvgAddPay(OwnerForm)
          call wg_CalcAvgAddPay(OwnerForm)
        end sub
        
        
      DISPLAYSCRIPT: | 
        MACROS_CALCAVGADDPAY
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-06-06T11:40:43+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147113827_1354510846 wg_CalcAvgAddPay"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 540049106_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MACROSGROUPKEY: "147113652_1354510846 Локальные макросы"
      FUNCTIONKEY: "540049108_99701464 Macros_CalcAvgAddPay"
      NAME: "Расчет структуры ср. заработка"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-06-06T11:40:43+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 540049113_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049109_99701464
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_CalcAvgAddPay_Total"
      COMMENT: ~
      SCRIPT: | 
        '#include WG_CALCAVGADDPAY
        option explicit
        sub Macros_CalcAvgAddPay_Total(OwnerForm)
          dim gdcObject, gdcDetailObject
          set gdcObject = OwnerForm.gdcObject
          set gdcDetailObject = OwnerForm.gdcDetailObject
        
          if (gdcObject.State = dsEdit) then gdcObject.Post
          if (gdcDetailObject.State = dsEdit) or (gdcDetailObject.State = dsInsert) then gdcDetailObject.Post
          gdcDetailObject.First
          while not gdcDetailObject.EoF
            call wg_CalcAvgAddPay(OwnerForm)
            gdcDetailObject.Next
          wend
        end sub
        
        
      DISPLAYSCRIPT: | 
        MACROS_CALCAVGADDPAY_TOTAL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-06-06T11:46:26+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147113827_1354510846 wg_CalcAvgAddPay"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 540049109_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MACROSGROUPKEY: "147113652_1354510846 Локальные макросы"
      FUNCTIONKEY: "540049113_99701464 Macros_CalcAvgAddPay_Total"
      NAME: "Произвести итоговый расчет"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-06-06T11:46:26+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147113745_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113746_1354510846
    Fields: 
      NAME: "usrg_actAvgGenerate"
      DESCRIPTION: ~
      PARENT: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actAvgGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2010-03-31T16:53:56+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147113748_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113746_1354510846
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actAvgGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_CalcAvgAddPay_pl
        Option Explicit
        
        Sub usrg_actAvgGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcDetailObject, gdcSalary, Ret
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          Set gdcDetailObject = Sender.OwnerForm.gdcDetailObject
          Set gdcSalary = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
        
          Dim MonthBefore, MonthOffset
          MonthBefore = 0
          MonthOffset = 0
          Do
            Ret = wg_CalcAvgAddPay_pl(gdcObject, gdcDetailObject, gdcSalary, MonthBefore, MonthOffset)
            Select Case Ret
              Case "need_more"
                MonthBefore = MonthBefore + 1
              Case "by_current_month"
                '
                If Not MonthOffset < 0 Then
                  '
                  Dim Msg
                  Msg = "Сотрудник: " & _
                        gdcDetailObject.FieldByName("U_USR$EMPLKEY_NAME").AsString & _
                        vbCrLf & _
                        "Требуется итоговый расчет для текущего месяца." & _
                        vbCrLf & _
                        "Продолжить?"
                  '
                  If MsgBox(Msg, vbExclamation + vbYesNoCancel, "Предупреждение") = vbYes Then
                    MonthBefore = 0
                    MonthOffset = -1
                  Else
                    Exit Do
                  End If
                  '
                Else
                  Exit Do
                End If
                '
              Case Else
                Exit Do
            End Select
          Loop
        '
        End Sub
        
        
        
      DISPLAYSCRIPT: | 
        USRG_ACTAVGGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-09-10T16:20:07+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "540049114_99701464 wg_CalcAvgAddPay_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147113746_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actAvgGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTKEY: "147113745_1354510846 gdc_dlgUserComplexDocument147113610_1354510846\\usrg_actAvgGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147113748_1354510846 usrg_actAvgGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-06-06T11:36:53+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147113836_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113842_1354510846
    Fields: 
      NAME: "usrg_actGenerate"
      DESCRIPTION: ~
      PARENT: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2010-03-31T18:03:13+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147113844_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113842_1354510846
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_CalcAvgAddPay_pl
        Option Explicit
        
        Sub usrg_actGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcDetailObject, gdcSalary, Ret
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          Set gdcDetailObject = Sender.OwnerForm.gdcDetailObject
          Set gdcSalary = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
        
          Dim MonthBefore, MonthOffset
        
          gdcDetailObject.First
          While Not gdcDetailObject.EoF
            '
          MonthBefore = 0
          MonthOffset = 0
          Do
            Ret = wg_CalcAvgAddPay_pl(gdcObject, gdcDetailObject, gdcSalary, MonthBefore, MonthOffset)
            Select Case Ret
              Case "need_more"
                MonthBefore = MonthBefore + 1
              Case "by_current_month"
                '
                If Not MonthOffset < 0 Then
                  '
                  Dim Msg
                  Msg = "Сотрудник: " & _
                        gdcDetailObject.FieldByName("U_USR$EMPLKEY_NAME").AsString & _
                        vbCrLf & _
                        "Требуется итоговый расчет для текущего месяца." & _
                        vbCrLf & _
                        "Продолжить?"
                  '
                  If MsgBox(Msg, vbExclamation + vbYesNoCancel, "Предупреждение") = vbYes Then
                    MonthBefore = 0
                    MonthOffset = -1
                  Else
                    Exit Do
                  End If
                  '
                Else
                  Exit Do
                End If
                '
              Case Else
                Exit Do
            End Select
          Loop
            '
            gdcDetailObject.Next
          Wend
        '
        End Sub
        
        
      DISPLAYSCRIPT: | 
        USRG_ACTGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-09-10T17:51:25+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "540049114_99701464 wg_CalcAvgAddPay_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147113842_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTKEY: "147113836_1354510846 gdc_dlgUserComplexDocument147113610_1354510846\\usrg_actGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147113844_1354510846 usrg_actGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-06-06T11:46:22+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147021956_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147021954_119619099
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "METHOD"
      LANGUAGE: "VBScript"
      NAME: "Tgdc_dlgUserComplexDocument147020774_119619099SyncField"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_SetWageDocLookupParams
        '#include wg_RoundSum
        option explicit
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField(Self, Field, SyncList)
          call Inherited(Self, "SyncField", Array(Self, Field, SyncList))
          
          call Tgdc_dlgUserComplexDocument147020774_119619099SyncField_(Self, Field, SyncList)
        end sub
        
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField_(Self, Field, SyncList)
          dim Creator
          set Creator = New TCreator
          
          if Assigned(Field) then
            ' шапка
            if Field.DataSet.Self = Self.gdcObject.Self then
              select case Field.FieldName
                case "USR$TOTALDOCKEY"
        '          Self.gdcObject.FieldByName("usr$emplkey").value = Null
        '          Self.gdcObject.FieldByName("usr$firstmovekey").value = Null
                  wg_SetWageDocLookupParams(Self)
                case "USR$EMPLKEY"
                  wg_SetWageDocLookupParams(Self)
                case "USR$FROM"
                  if Field.AsDateTime < Self.gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime then
                    Self.gdcObject.FieldByName("usr$datebegin").AsDateTime = Field.AsDateTime
                  end if
                case "USR$DATEBEGIN"
                  if Field.AsDateTime > Self.gdcObject.FieldByName("USR$DATEEND").AsDateTime then
                    Self.gdcObject.FieldByName("USR$DATEEND").AsDateTime = Field.AsDateTime
                  else
                    Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(Self)
                  end if
                case "USR$DATEEND"
                  Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(Self)
        '        case "USR$DURATION"
        
                'Вид отпуска
                case "USR$VACATIONTYPE"
                  Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(Self)
                  
                ' ср. заработок - пересчитываем сумму отпускных
                case "USR$AVGSUMMA"
                  Tgdc_dlgUserComplexDocument147020774_119619099SyncField_ReCalcStrSum(Self.gdcDetailObject)
              end select
        
            else           ' позиция
              select case Field.FieldName
                case "USR$DURATION"
                  Self.gdcDetailObject.FieldByName("usr$summa").AsCurrency = wg_RoundSum(gdcBaseManager.GetIDByRUIDString(wg_FeeType_Holiday_RUID), _
                    Field.AsCurrency * Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency)
              end select
            end if
          end if
        end sub
        
        ' расчет продолжительности отпуска
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(ByRef Self)
          dim gdcObject, wg_Structure
          set gdcObject = Self.gdcObject
        
          if not gdcObject.FieldByName("USR$DATEEND").IsNull and _
             not gdcObject.FieldByName("USR$DATEBEGIN").IsNull then
        
             set wg_Structure = Self.Objects("Structure")
             
        '     if Self.gdcObject.FieldByName("USR$VACATIONTYPE").asInteger = _
        '        gdcBaseManager.GetIDByRUIDString("147480589_336327731") then
        
                gdcObject.FieldByName("USR$DURATION").AsInteger = _
                  wg_Structure.CalcHolidayDuration( _
                    gdcObject.FieldByName("usr$datebegin").AsVariant, _
                    gdcObject.FieldByName("usr$dateend").AsVariant,_
                    gdcObject.FieldByName("usr$vacationtype").asInteger)
        '     else
        '       gdcObject.FieldByName("USR$DURATION").AsInteger = _
        '         gdcObject.FieldByName("usr$dateend").AsVariant - _
        '         gdcObject.FieldByName("usr$datebegin").AsVariant + 1
        '     end if
             
          else
            gdcObject.FieldByName("USR$DURATION").AsInteger = 0
          end if
        end sub
        
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField_ReCalcStrSum(ByRef DataSet)
        ' пересохраняем позиции начисления для перерасчета сумм
        
          DataSet.Cancel
          DataSet.First
          while not DataSet.EOF
            DataSet.Edit
            DataSet.FieldByName("USR$DURATION").AsCurrency = _
              DataSet.FieldByName("USR$DURATION").AsCurrency
            DataSet.Post
            DataSet.Next
          wend
          DataSet.First
        end sub
        
      DISPLAYSCRIPT: | 
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD_
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD_CALCDURATION
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD_RECALCSTRSUM
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021953_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QEAAAAU0VMRgQAAABTRUxGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNU
        BQAAAEZJRUxEBQAAAEZJRUxEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNUCAAAAFNZ
        TkNMSVNUCAAAAFNZTkNMSVNUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-09-22T16:55:27+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147025267_449804462 wg_SetWageDocLookupParams"
          - 
            ADDFUNCTIONKEY: "147804276_375143752 wg_RoundSum"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147021954_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147020774_119619099"
      PARENTNAME: "Tgdc_dlgUserComplexDocument"
      OBJECTKEY: "147021953_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147020774_119619099"
      EVENTNAME: "SYNCFIELD"
      FUNCTIONKEY: "147021956_119619099 Tgdc_dlgUserComplexDocument147020774_119619099SyncField"
      DISABLE: ~
      EDITIONDATE: 2014-09-22T16:55:27+03:00