%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 528622143_99701464
  Name: "GS.Зарплата.Пролог.Начисление отпусков и больничных"
  Caption: "Начисление отпусков, больничных, по-среднему"
  Version: "1.0.0.105"
  Optional: False
  Internal: True
  MD5: 6A9FC5B38B8FAD791D01E0C732E3646E
Uses: 
  - "151049506_187967073 GS.Зарплата.Пролог.Общие"
Objects: 
  - 
    Properties: 
      Class: "TgdcStoredProc"
      RUID: 151162335_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      RDB$DESCRIPTION: | 
        USR$WG_TBLCALDAY_P
      PROCEDURENAME: "USR$WG_TBLCALDAY_P"
      PROCEDURESOURCE: | 
        CREATE OR ALTER PROCEDURE USR$WG_TBLCALDAY_P (
            IN_EMPLKEY INTEGER,
            IN_FIRSTMOVE INTEGER,
            IN_DATEFROM DATE,
            IN_DATETO DATE)
        RETURNS ( 
            EMPLKEY INTEGER,
            FIRSTMOVEKEY INTEGER,
            THEDAY DATE,
            WYEAR INTEGER,
            WMONTH INTEGER,
            WDAY INTEGER,
            WDURATION INTEGER,
            WORKDAY INTEGER,
            SCHEDULEKEY INTEGER)
         AS
         BEGIN
        FOR
        
        SELECT * FROM
        (
        SELECT
          ml.USR$EMPLKEY,
          ml.USR$FIRSTMOVE AS FirstMoveKey,
          tcd.THEDAY,
          EXTRACT(YEAR FROM tcd.THEDAY) AS WYEAR,
          EXTRACT(MONTH FROM tcd.THEDAY) AS WMONTH,
          EXTRACT(DAY FROM tcd.THEDAY) AS WDAY,
          tcd.WDURATION,
          tcd.WORKDAY,
          ml.USR$SCHEDULEKEY
        FROM
          (
          SELECT FIRST 1 * FROM USR$WG_MOVEMENTLINE
          WHERE
            USR$EMPLKEY = :IN_EMPLKEY
            AND
            USR$FIRSTMOVE = :IN_FIRSTMOVE
          ORDER BY USR$DATEBEGIN
          ) ml
        JOIN
          WG_TBLCAL tc
            ON tc.ID = ml.USR$SCHEDULEKEY
        JOIN
          WG_TBLCALDAY tcd
            ON tcd.TBLCALKEY = tc.ID
        WHERE
          ml.USR$EMPLKEY = :IN_EMPLKEY
          AND
          ml.USR$FIRSTMOVE = :IN_FIRSTMOVE
          AND
          COALESCE(tcd.WDURATION, 0) > 0
          AND
          tcd.THEDAY >= :IN_DATEFROM
          AND
          tcd.THEDAY < :IN_DATETO
          AND
          tcd.THEDAY < ml.USR$DATEBEGIN
        UNION ALL
        SELECT
          ml.USR$EMPLKEY,
          ml.USR$FIRSTMOVE AS FirstMoveKey,
          tcd.THEDAY,
          EXTRACT(YEAR FROM tcd.THEDAY) AS WYEAR,
          EXTRACT(MONTH FROM tcd.THEDAY) AS WMONTH,
          EXTRACT(DAY FROM tcd.THEDAY) AS WDAY,
          tcd.WDURATION,
          tcd.WORKDAY,
          ml.USR$SCHEDULEKEY
        FROM
          USR$WG_MOVEMENTLINE ml
        RIGHT JOIN
          WG_TBLCAL tc
            ON tc.ID = ml.USR$SCHEDULEKEY
        JOIN
          WG_TBLCALDAY tcd
            ON tcd.TBLCALKEY = tc.ID
        WHERE
          ml.USR$EMPLKEY = :IN_EMPLKEY
          AND
          ml.USR$FIRSTMOVE = :IN_FIRSTMOVE
          AND
          ml.USR$DATEBEGIN < :IN_DATETO
          AND
          COALESCE(tcd.WDURATION, 0) > 0
          AND
          tcd.THEDAY >= :IN_DATEFROM
          AND
          tcd.THEDAY < :IN_DATETO
          AND
          tcd.THEDAY >= ml.USR$DATEBEGIN
          AND
          tcd.THEDAY <
            COALESCE(
              (
              SELECT
                FIRST 1
                ml_next.USR$DATEBEGIN
              FROM
                USR$WG_MOVEMENTLINE ml_next
              WHERE
                ml_next.USR$EMPLKEY = :IN_EMPLKEY
                AND
                ml_next.USR$FIRSTMOVE = :IN_FIRSTMOVE
                AND
                ml_next.USR$DATEBEGIN > ml.USR$DATEBEGIN
              ORDER BY
                ml_next.USR$DATEBEGIN
              ),
            :IN_DATETO
            )
        ) ml_union
        ORDER BY
          THEDAY
        
        INTO
            :EMPLKEY,
            :FirstMoveKey,
            :THEDAY,
            :WYEAR,
            :WMONTH,
            :WDAY,
            :WDURATION,
            :WORKDAY,
            :SCHEDULEKEY
        DO
          SUSPEND;
        
        END
        
      EDITIONDATE: 2013-11-18T12:13:11+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151189470_18175251
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151189370_18175251
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "PROLOG"
      LANGUAGE: "VBScript"
      NAME: "twg_avg_wage_sql"
      COMMENT: ~
      SCRIPT: | 
        %% twg_avg_wage_sql
        %  спецификации и sql-шаблоны для базы знаний twg_avg_wage
        %
        
        :-  style_check(-atom),
            GetSQL = [gd_pl_ds/5, get_sql/5],
            %dynamic(GetSQL),
            multifile(GetSQL),
            discontiguous(GetSQL).
        
        %
        wg_valid_sql([
                    % section twg_avg_wage
                    %  05. Начисление отпусков
                    -usr_wg_DbfSums/7, % 05, 06, 12
                    usr_wg_MovementLine/15, % 05, 06, 12
                    usr_wg_FCRate/4,
                    usr_wg_TblCalDay/9, % 05, 06, 12
                    -usr_wg_TblDayNorm/8, % 05, 06
                    -usr_wg_TblYearNorm/5,
                    usr_wg_TblCalLine/7, % 05, 06, 12
                    usr_wg_TblCal_FlexLine/68, % 05, 06, 12
                    usr_wg_HourType/13, % 05, 06
                    usr_wg_TblCharge/10, % 05, 06, 12
                    usr_wg_FeeType/5, % 05, 06, 12
                    usr_wg_FeeTypeNoCoef/4,
                    usr_wg_BadHourType/3,
                    usr_wg_BadFeeType/3,
                    usr_wg_SpecDep/3,
                    %  06. Начисление больничных
                    usr_wg_AvgWage/6,
                    usr_wg_FeeTypeProp/4, % 06, 12
                    wg_holiday/1,
                    usr_wg_ExclDays/7,
                    % 12. Начисление по-среднему
                    usr_wg_TblChargeBonus/8,
                    % section twg_struct
                    %wg_holiday/1,
                    wg_vacation_slice/2,
                    wg_vacation_compensation/3,
                    gd_const_budget/2,
                    gd_const_AvgSalaryRB/2, % 06, 12
                    %usr_wg_TblDayNorm/8,
                    wg_job_ill_type/1,
                    % section twg_rule
                    usr_wg_pl_Rule/2,
                    -
                    ]).
        
        %
        is_valid_sql(Functor/Arity) :-
            wg_valid_sql(ValidSQL),
            memberchk(Functor/Arity, ValidSQL),
            !.
        
        %  05. Начисление отпусков
        gd_pl_ds(wg_avg_wage_vacation, kb, usr_wg_DbfSums, 7, [
            fEmplKey-integer, fInSum-float, fInHoures-float,
            fInYear-integer, fInMonth-integer, fDateBegin-date,
            fSickProp-boolean
            ]).
        % usr_wg_DbfSums(EmplKey, InSum, InHoures, InYear, InMonth, DateBegin, SickProp)
        get_sql(wg_avg_wage_vacation, kb, usr_wg_DbfSums/7,
        "
        SELECT
          Z.USR$EMPLKEY,
          COALESCE(Z.USR$SUM, 0) AS INSUM,
          COALESCE(Z.USR$MID_HOW, 0) AS INHOURES,
          EXTRACT(YEAR FROM IDK.USR$DATEBEGIN) AS InYear,
          EXTRACT(MONTH FROM IDK.USR$DATEBEGIN) AS InMonth,
          IDK.USR$DATEBEGIN,
          USR$SICK_PROP AS SickProp
        FROM
          USR$GMK_SUMS Z
        JOIN
          USR$WG_TOTAL IDK
            ON IDK.DOCUMENTKEY  =  Z.USR$INDOCKEY
        WHERE
          Z.USR$EMPLKEY = pEmplKey
          AND
          IDK.USR$DATEBEGIN >= 'pDateCalcFrom'
          AND
          IDK.USR$DATEBEGIN < 'pDateCalcTo'
        ORDER BY
          Z.USR$EMPLKEY,
          IDK.USR$DATEBEGIN
        ",
            [
            pEmplKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]).
        
        gd_pl_ds(Scope, kb, usr_wg_MovementLine, 15, [
            fEmplKey-integer, fDocumentKey-integer, fFirstMoveKey-integer,
            fMoveYear-integer, fMoveMonth-integer, fDateBegin-date,
            fScheduleKey-integer, fMovementType-integer,
            fRate-float, fListNumber-string, fMSalary-float,
            fPayFormKey-integer, fSalaryKey-integer,
            fTSalary-float, fTHoureRate-float
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        % usr_wg_MovementLine(EmplKey, DocumentKey, FirstMoveKey,
        %   MoveYear, MoveMonth, DateBegin,
        %   ScheduleKey, MovementType, Rate, ListNumber, MSalary,
        %   PayFormKey, SalaryKey, TSalary, THoureRate)
        get_sql(Scope, kb, usr_wg_MovementLine/15,
        "
        SELECT
          ml.USR$EMPLKEY,
          ml.DOCUMENTKEY,
          ml.USR$FIRSTMOVE AS FirstMoveKey,
          EXTRACT(YEAR FROM ml.USR$DATEBEGIN) AS MoveYear,
          EXTRACT(MONTH FROM ml.USR$DATEBEGIN) AS MoveMonth,
          ml.USR$DATEBEGIN,
          ml.USR$SCHEDULEKEY,
          ml.USR$MOVEMENTTYPE,
          COALESCE(ml.USR$RATE, 0) AS Rate,
          ml.USR$LISTNUMBER,
          COALESCE(ml.USR$MSALARY, 0) AS MSalary,
          COALESCE(ml.USR$PAYFORMKEY, 0) AS PayFormKey,
          (SELECT id FROM GD_P_GETID(pPayFormSalary_ruid)) AS SalaryKey,
          COALESCE(ml.USR$TSALARY, 0) AS TSalary,
          COALESCE(USR$THOURRATE, 0) AS THoureRate
        FROM
          USR$WG_MOVEMENTLINE ml
        WHERE
          ml.USR$EMPLKEY = pEmplKey
          AND
          ml.USR$FIRSTMOVE = pFirstMoveKey
        ORDER BY
          ml.USR$EMPLKEY,
          ml.USR$FIRSTMOVE,
          ml.USR$DATEBEGIN
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pPayFormSalary_ruid-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        
        gd_pl_ds(wg_avg_wage_vacation, kb, usr_wg_FCRate, 4, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fDate-date, fFCRateSum-float
            ]).
        % usr_wg_FCRate(EmplKey, FirstMoveKey, Date, FCRateSum)
        get_sql(wg_avg_wage_vacation, kb, usr_wg_FCRate/4,
        "
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          fc.USR$WG_DATE,
          fc.USR$WG_FCRATESUM
        FROM
          USR$WG_FCRATE fc
        ORDER BY
          fc.USR$WG_DATE
        ",
            [
            pEmplKey-_, pFirstMoveKey-_
            ]).
        
        gd_pl_ds(Scope, kb, usr_wg_TblCalDay, 9, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fTheDay-date, fWYear-integer, fWMonth-integer, fWDay-integer,
            fWDuration-float, fWorkDay-integer, fScheduleKey-integer
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        % usr_wg_TblCalDay(EmplKey, FirstMoveKey, TheDay, WYear, WMonth, WDay,
        %    WDuration, WorkDay, ScheduleKey)
        get_sql(Scope, kb, usr_wg_TblCalDay/9,
        "
        SELECT
          ml.USR$EMPLKEY,
          ml.USR$FIRSTMOVE AS FirstMoveKey,
          tcd.THEDAY,
          EXTRACT(YEAR FROM tcd.THEDAY) AS WYEAR,
          EXTRACT(MONTH FROM tcd.THEDAY) AS WMONTH,
          EXTRACT(DAY FROM tcd.THEDAY) AS WDAY,
          tcd.WDURATION,
          tcd.WORKDAY,
          ml.USR$SCHEDULEKEY
        FROM
        (
        SELECT DISTINCT
          USR$EMPLKEY,
          USR$FIRSTMOVE,
          USR$SCHEDULEKEY
        FROM
          USR$WG_MOVEMENTLINE
        WHERE
          USR$EMPLKEY = pEmplKey
          AND
          USR$FIRSTMOVE = pFirstMoveKey
        ) ml
        JOIN
          WG_TBLCAL tc
            ON tc.ID = ml.USR$SCHEDULEKEY
        JOIN
          WG_TBLCALDAY tcd
            ON tcd.TBLCALKEY = tc.ID
        WHERE
          COALESCE(tcd.WDURATION, 0) > 0
          AND
          (tcd.THEDAY >= 'pDateCalcFrom' OR tcd.THEDAY >= 'pDateNormFrom')
          AND
          (tcd.THEDAY < 'pDateCalcTo' OR tcd.THEDAY < 'pDateNormTo')
        ORDER BY
          tcd.THEDAY
        ",
            [
            pEmplKey-_, pFirstMoveKey-_,
            pDateCalcFrom-_, pDateCalcTo-_,
            pDateNormFrom-_, pDateNormTo-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        
        gd_pl_ds(Scope, kb, usr_wg_TblDayNorm, 8, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fWYear-integer, fWMonth-integer, fTheDay-date, fWDay-integer,
            fWDuration-float, fWorkDay-integer
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        % usr_wg_TblDayNorm(EmplKey, FirstMoveKey, WYear, WMonth, TheDay, WDay, WDuration, WorkDay)
        get_sql(Scope, kb, usr_wg_TblDayNorm/8,
        "
        SELECT EmplKey, FirstMoveKey, WYear, WMonth, TheDay, WDay, WDuration, WorkDay
        FROM USR$WG_TBLCALDAY_P(pEmplKey, pFirstMoveKey, 'pDateCalcFrom', 'pDateCalcTo')
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        
        gd_pl_ds(wg_avg_wage_vacation, kb, usr_wg_TblYearNorm, 5,
            [
            fEmplKey-integer, fFirstMoveKey-integer,
            fWYear-integer,
            fWHoures-float, fWDays-integer
            ]).
        % usr_wg_TblYearNorm(EmplKey, FirstMoveKey, WYear, WHoures, WDays)
        get_sql(wg_avg_wage_vacation, kb, usr_wg_TblYearNorm/5,
        "
        SELECT EmplKey, FirstMoveKey, WYear, SUM(WDuration) AS WHoures, SUM(WorkDay) AS WDays
        FROM USR$WG_TBLCALDAY_P(pEmplKey, pFirstMoveKey, 'pDateNormFrom', 'pDateNormTo')
        GROUP BY EmplKey, FirstMoveKey, WYear
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateNormFrom-_, pDateNormTo-_
            ]).
        
        gd_pl_ds(Scope, kb, usr_wg_TblCalLine, 7, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fCalYear-integer, fCalMonth-integer, fDate-date,
            fDuration-float, fHoureType-integer
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        % usr_wg_TblCalLine(EmplKey, FirstMoveKey, CalYear, CalMonth, Date, Duration, HoureType)
        get_sql(Scope, kb, usr_wg_TblCalLine/7,
        "
        SELECT
          tc.USR$EMPLKEY,
          tc.USR$FIRSTMOVEKEY,
          EXTRACT(YEAR FROM tcl.USR$DATE) AS CalYear,
          EXTRACT(MONTH FROM tcl.USR$DATE) AS CalMonth,
          tcl.USR$DATE,
          tcl.USR$DURATION,
          tcl.USR$HOURTYPE
        FROM
          USR$WG_TBLCAL tc
        JOIN
          USR$WG_TBLCALLINE tcl
            ON tcl.MASTERKEY = tc.DOCUMENTKEY
        WHERE
          tc.USR$EMPLKEY = pEmplKey
          AND
          tc.USR$FIRSTMOVEKEY = pFirstMoveKey
          AND
          tcl.USR$DATE >= 'pDateCalcFrom'
          AND
          tcl.USR$DATE < 'pDateCalcTo'
        ORDER BY
          tc.USR$EMPLKEY,
          tc.USR$FIRSTMOVEKEY,
          tcl.USR$DATE
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        
        gd_pl_ds(Scope, kb, usr_wg_TblCal_FlexLine, 68, [
            fFlexType-string,
            fEmplKey-integer, fFirstMoveKey-integer,
            fCalYear-integer, fCalMonth-integer, fDateBegin-date,
            fS1-variant, fH1-variant, fS2-variant, fH2-variant,
            fS3-variant, fH3-variant, fS4-variant, fH4-variant,
            fS5-variant, fH5-variant, fS6-variant, fH6-variant,
            fS7-variant, fH7-variant, fS8-variant, fH8-variant,
            fS9-variant, fH9-variant, fS10-variant, fH10-variant,
            fS11-variant, fH11-variant, fS12-variant, fH12-variant,
            fS13-variant, fH13-variant, fS14-variant, fH14-variant,
            fS15-variant, fH15-variant, fS16-variant, fH16-variant,
            fS17-variant, fH17-variant, fS18-variant, fH18-variant,
            fS19-variant, fH19-variant, fS20-variant, fH20-variant,
            fS21-variant, fH21-variant, fS22-variant, fH22-variant,
            fS23-variant, fH23-variant, fS24-variant, fH24-variant,
            fS25-variant, fH25-variant, fS26-variant, fH26-variant,
            fS27-variant, fH27-variant, fS28-variant, fH28-variant,
            fS29-variant, fH29-variant, fS30-variant, fH30-variant,
            fS31-variant, fH31-variant
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        % usr_wg_TblCal_FlexLine(FlexType, EmplKey, FirstMoveKey, CalYear, CalMonth, DateBegin, S1, H1, ..., S31, H31)
        get_sql(Scope, kb, usr_wg_TblCal_FlexLine/68,
        "
        SELECT
          CASE gd.DOCUMENTTYPEKEY
            WHEN
              (SELECT id FROM gd_ruid WHERE xid = pTblCal_DocType_Plan_xid1 AND dbid = pTblCal_DocType_Plan_dbid1)
                THEN 'plan'
            WHEN
              (SELECT id FROM gd_ruid WHERE xid = pTblCal_DocType_Plan_xid2 AND dbid = pTblCal_DocType_Plan_dbid2)
                THEN 'plan'
            WHEN
              (SELECT id FROM GD_P_GETID(pTblCal_DocType_Fact_ruid))
                THEN 'fact'
            ELSE
                'unknown'
          END
            AS FlexType,
          tcfl.USR$EMPLKEY,
          tcfl.USR$FIRSTMOVEKEY,
          EXTRACT(YEAR FROM t.USR$DATEBEGIN) AS CalYear,
          EXTRACT(MONTH FROM t.USR$DATEBEGIN) AS CalMonth,
          t.USR$DATEBEGIN,
          tcfl.USR$S1, tcfl.USR$H1, tcfl.USR$S2, tcfl.USR$H2,
          tcfl.USR$S3, tcfl.USR$H3, tcfl.USR$S4, tcfl.USR$H4,
          tcfl.USR$S5, tcfl.USR$H5, tcfl.USR$S6, tcfl.USR$H6,
          tcfl.USR$S7, tcfl.USR$H7, tcfl.USR$S8, tcfl.USR$H8,
          tcfl.USR$S9, tcfl.USR$H9, tcfl.USR$S10, tcfl.USR$H10,
          tcfl.USR$S11, tcfl.USR$H11, tcfl.USR$S12, tcfl.USR$H12,
          tcfl.USR$S13, tcfl.USR$H13, tcfl.USR$S14, tcfl.USR$H14,
          tcfl.USR$S15, tcfl.USR$H15, tcfl.USR$S16, tcfl.USR$H16,
          tcfl.USR$S17, tcfl.USR$H17, tcfl.USR$S18, tcfl.USR$H18,
          tcfl.USR$S19, tcfl.USR$H19, tcfl.USR$S20, tcfl.USR$H20,
          tcfl.USR$S21, tcfl.USR$H21, tcfl.USR$S22, tcfl.USR$H22,
          tcfl.USR$S23, tcfl.USR$H23, tcfl.USR$S24, tcfl.USR$H24,
          tcfl.USR$S25, tcfl.USR$H25, tcfl.USR$S26, tcfl.USR$H26,
          tcfl.USR$S27, tcfl.USR$H27, tcfl.USR$S28, tcfl.USR$H28,
          tcfl.USR$S29, tcfl.USR$H29, tcfl.USR$S30, tcfl.USR$H30,
          tcfl.USR$S31, tcfl.USR$H31
        FROM
          GD_DOCUMENT gd
        JOIN
          USR$WG_TBLCAL_FLEXLINE tcfl
            ON gd.ID = tcfl.DOCUMENTKEY
        JOIN
          USR$WG_TBLCAL_FLEX tcf
            ON tcf.DOCUMENTKEY = tcfl.MASTERKEY
        JOIN
          USR$WG_TOTAL t
            ON t.DOCUMENTKEY = tcf.USR$TOTALDOCKEY
        WHERE
          tcfl.USR$EMPLKEY = pEmplKey
          AND
          tcfl.USR$FIRSTMOVEKEY = pFirstMoveKey
          AND
          t.USR$DATEBEGIN >= 'pDateCalcFrom'
          AND
          t.USR$DATEBEGIN < 'pDateCalcTo'
         ORDER BY
           tcfl.USR$EMPLKEY,
           tcfl.USR$FIRSTMOVEKEY,
           t.USR$DATEBEGIN
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateCalcFrom-_, pDateCalcTo-_,
            pTblCal_DocType_Plan_xid1-_, pTblCal_DocType_Plan_dbid1-_,
            pTblCal_DocType_Plan_xid2-_, pTblCal_DocType_Plan_dbid2-_,
            pTblCal_DocType_Fact_ruid-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg,
                wg_struct_sick
                ]).
        
        gd_pl_ds(Scope, kb, usr_wg_HourType, 13, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fID-integer, fCode-string, fDigitCode-string,
            fDiscription-string, fIsWorked-integer, fShortName-string,
            fForCalFlex-integer, fForOverTime-integer, fForFlex-integer,
            fExcludeForSickList-integer, fExclType-string
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick
                ]).
        % usr_wg_HourType(EmplKey, FirstMoveKey,
        %   ID, Code, DigitCode, Description, IsWorked, ShortName,
        %   ForCalFlex, ForOverTime, ForFlex, ExcludeForSickList, ExclType)
        get_sql(Scope, kb, usr_wg_HourType/13,
        "
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          ht.ID,
          ht.USR$CODE,
          ht.USR$DIGITCODE,
          ht.USR$DISCRIPTION,
          ht.USR$ISWORKED,
          ht.USR$SHORTNAME,
          ht.USR$FORCALFLEX,
          ht.USR$FOROVERTIME,
          ht.USR$FORFLEX,
          ht.USR$WG_EXCLUDEFORSICKLIST,
          CASE ht.ID
            WHEN
              (SELECT id FROM GD_P_GETID(pKindDayHourType_ruid))
                THEN 'kind_day'
            ELSE
                'unknown'
          END
            AS ExclType
        FROM
          USR$WG_HOURTYPE ht
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pKindDayHourType_ruid-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick
                ]).
        
        gd_pl_ds(Scope, kb, usr_wg_TblCharge, 10, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fCalYear-integer, fCalMonth-integer, fDateBegin-date,
            fDebit-float, fFeeTypeKey-integer, fDOW-float, fHOW-float,
            fPayPeriod-integer
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        % usr_wg_TblCharge(EmplKey, FirstMoveKey, CalYear, CalMonth, DateBegin, Debit, FeeTypeKey, DOW, HOW, PayPeriod)
        get_sql(Scope, kb, usr_wg_TblCharge/10,
        "
        SELECT
          tch.USR$EMPLKEY,
          tch.USR$FIRSTMOVEKEY,
          EXTRACT(YEAR FROM tch.USR$DATEBEGIN) AS CalYear,
          EXTRACT(MONTH FROM tch.USR$DATEBEGIN) AS CalMonth,
          tch.USR$DATEBEGIN,
          tch.USR$DEBIT,
          tch.USR$FEETYPEKEY,
          tch.USR$DOW,
          tch.USR$HOW,
          COALESCE(ft.USR$PAYPERIOD, 0) AS PayPeriod
        FROM
          USR$WG_TBLCHARGE tch
        JOIN
          USR$WG_FEETYPE ft
            ON ft.ID = tch.USR$FEETYPEKEY
        WHERE
          tch.USR$EMPLKEY = pEmplKey
          AND
          NOT tch.USR$DEBIT = 0
          AND
          tch.USR$DATEBEGIN >= 'pDateCalcFrom'
          AND
          tch.USR$DATEBEGIN < 'pDateCalcTo'
          AND
          COALESCE(ft.USR$PAYPERIOD, 0) >= 0
        ORDER BY
          tch.USR$EMPLKEY,
          tch.USR$DATEBEGIN
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        
        gd_pl_ds(Scope, kb, usr_wg_TblChargeBonus, 8, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fCalYear-integer, fCalMonth-integer, fDateBegin-date,
            fDebit-float, fFeeTypeKey-integer,
            fPayPeriod-integer
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_avg
                ]).
        % usr_wg_TblChargeBonus(EmplKey, FirstMoveKey, CalYear, CalMonth, DateBegin,
        %   Debit, FeeTypeKey, PayPeriod)
        get_sql(Scope, kb, usr_wg_TblChargeBonus/8,
        "
        SELECT
          tch.USR$EMPLKEY,
          tch.USR$FIRSTMOVEKEY,
          EXTRACT(YEAR FROM tch.USR$DATEBEGIN) AS CalYear,
          EXTRACT(MONTH FROM tch.USR$DATEBEGIN) AS CalMonth,
          tch.USR$DATEBEGIN,
          tch.USR$DEBIT,
          tch.USR$FEETYPEKEY,
          COALESCE(ft.USR$PAYPERIOD, 0) AS PayPeriod
        FROM
          USR$WG_TBLCHARGE tch
        JOIN
          USR$WG_FEETYPE ft
            ON ft.ID = tch.USR$FEETYPEKEY
        WHERE
          tch.USR$EMPLKEY = pEmplKey
          AND
          NOT tch.USR$DEBIT = 0
          AND
          tch.USR$DATEBEGIN >= 'pDateBonusFrom'
          AND
          tch.USR$DATEBEGIN < 'pDateBonusTo'
          AND
          COALESCE(ft.USR$PAYPERIOD, 0) > 1
        ORDER BY
          tch.USR$EMPLKEY,
          tch.USR$DATEBEGIN
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateBonusFrom-_, pDateBonusTo-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_avg
                ]).
        
        gd_pl_ds(Scope, kb, usr_wg_FeeType, 5, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fFeeGroupKey-integer, fFeeTypeKey-integer,
            fAvgDayHOW-integer
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        % usr_wg_FeeType(EmplKey, FirstMoveKey, FeeGroupKey, FeeTypeKey, AvgDayHOW)
        get_sql(Scope, kb, usr_wg_FeeType/5,
        "
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          ft.USR$WG_FEEGROUPKEY,
          ft.USR$WG_FEETYPEKEY,
          ft_avg.USR$AVGDAYHOW
        FROM
          USR$CROSS179_256548741 ft
        JOIN
          USR$WG_FEETYPE ft_avg
            ON ft_avg.ID = ft.USR$WG_FEETYPEKEY
        WHERE
          ft.USR$WG_FEEGROUPKEY IN
            (SELECT id FROM GD_P_GETID(pFeeGroupKey_ruid))
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pFeeGroupKey_ruid-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        
        gd_pl_ds(wg_avg_wage_vacation, kb, usr_wg_FeeTypeNoCoef, 4, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fFeeGroupKeyNoCoef-integer, fFeeTypeKeyNoCoef-integer
            ]).
        % usr_wg_FeeTypeNoCoef(EmplKey, FirstMoveKey, FeeGroupKeyNoCoef, FeeTypeKeyNoCoef)
        get_sql(wg_avg_wage_vacation, kb, usr_wg_FeeTypeNoCoef/4,
        "
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          ft.USR$WG_FEEGROUPKEY,
          ft.USR$WG_FEETYPEKEY
        FROM
          USR$CROSS179_256548741 ft
        JOIN
          USR$WG_FEETYPE ft_avg
            ON ft_avg.ID = ft.USR$WG_FEETYPEKEY
        WHERE
          ft.USR$WG_FEEGROUPKEY =
            (SELECT id FROM GD_P_GETID(pFeeGroupKeyNoCoef_ruid))
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pFeeGroupKeyNoCoef_ruid-_
            ]).
        
        gd_pl_ds(wg_avg_wage_vacation, kb, usr_wg_BadHourType, 3, [
            fEmplKey-integer, fFirstMoveKey-integer, fID-integer
            ]).
        % usr_wg_BadHourType(EmplKey, FirstMoveKey, ID)
        get_sql(wg_avg_wage_vacation, kb, usr_wg_BadHourType/3,
        "
        SELECT
          pEmplKey AS EmplKey, pFirstMoveKey AS FirstMoveKey, id
        FROM USR$WG_HOURTYPE
        WHERE id IN
        (SELECT id FROM gd_ruid
        WHERE xid IN (pBadHourType_xid_IN)
        AND dbid = pBadHourType_dbid
        )
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pBadHourType_xid_IN-_, pBadHourType_dbid-_
            ]).
        
        gd_pl_ds(wg_avg_wage_vacation, kb, usr_wg_BadFeeType, 3, [
            fEmplKey-integer, fFirstMoveKey-integer, fID-integer
            ]).
        % usr_wg_BadFeeType(EmplKey, FirstMoveKey, ID)
        get_sql(wg_avg_wage_vacation, kb, usr_wg_BadFeeType/3,
        "
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          ft.USR$WG_FEETYPEKEY AS id
        FROM
          USR$CROSS179_256548741 ft
        JOIN
          USR$WG_FEETYPE ft_avg
            ON ft_avg.ID = ft.USR$WG_FEETYPEKEY
        WHERE
          ft.USR$WG_FEEGROUPKEY =
            (SELECT id FROM GD_P_GETID(pBadFeeGroupKey_ruid))
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pBadFeeGroupKey_ruid-_
            ]).
        
        gd_pl_ds(-wg_avg_wage_vacation, kb, usr_wg_BadFeeType, 3, [
            fEmplKey-integer, fFirstMoveKey-integer, fID-integer
            ]).
        % usr_wg_BadFeeType(EmplKey, FirstMoveKey, ID)
        get_sql(-wg_avg_wage_vacation, kb, usr_wg_BadFeeType/3,
        "
        SELECT
          pEmplKey AS EmplKey, pFirstMoveKey AS FirstMoveKey, id
        FROM USR$WG_FEETYPE
        WHERE id IN
        (SELECT id FROM gd_ruid
        WHERE xid IN (pBadFeeType_xid_IN)
        AND dbid = pBadFeeType_dbid
        )
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pBadFeeType_xid_IN-_, pBadFeeType_dbid-_
            ]).
        
        gd_pl_ds(wg_avg_wage_vacation, kb, usr_wg_SpecDep, 3, [
            fEmplKey-integer, fFirstMoveKey-integer, fID-integer
            ]).
        % usr_wg_SpecDep(EmplKey, FirstMoveKey, ID)
        get_sql(wg_avg_wage_vacation, kb, usr_wg_SpecDep/3,
        "
        SELECT
          pEmplKey AS EmplKey, pFirstMoveKey AS FirstMoveKey, id
        FROM
          GD_P_GETID(pSpecDep_ruid)
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pSpecDep_ruid-_
            ]).
        
        %  06. Начисление больничных
        gd_pl_ds(Scope, kb, usr_wg_DbfSums, 7, [
            fEmplKey-integer, fInSum-float, fInHoures-float,
            fInYear-integer, fInMonth-integer, fDateBegin-date,
            fSickProp-boolean
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        % usr_wg_DbfSums(EmplKey, InSum, InHoures, InYear, InMonth, DateBegin, SickProp)
        get_sql(Scope, kb, usr_wg_DbfSums/7,
        "
        SELECT
          Z.USR$EMPLKEY,
          COALESCE(Z.USR$SUMSICK, 0) AS INSUM,
          COALESCE(Z.USR$MID_HOW, 0) AS INHOURES,
          EXTRACT(YEAR FROM IDK.USR$DATEBEGIN) AS InYear,
          EXTRACT(MONTH FROM IDK.USR$DATEBEGIN) AS InMonth,
          IDK.USR$DATEBEGIN,
          USR$SICK_PROP AS SickProp
        FROM
          USR$GMK_SUMS Z
        JOIN
          USR$WG_TOTAL IDK
            ON IDK.DOCUMENTKEY  =  Z.USR$INDOCKEY
        WHERE
          Z.USR$EMPLKEY = pEmplKey
          AND
          IDK.USR$DATEBEGIN >= 'pDateCalcFrom'
          AND
          IDK.USR$DATEBEGIN < 'pDateCalcTo'
        ORDER BY
          Z.USR$EMPLKEY,
          IDK.USR$DATEBEGIN
        ",
            [
            pEmplKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        
        gd_pl_ds(wg_avg_wage_sick, kb, usr_wg_AvgWage, 6, [
            fAvgType-string,
            fEmplKey-integer, fFirstMoveKey-integer,
            fCalYear-integer, fCalMonth-integer,
            fAvgSumma-float
            ]).
        % usr_wg_AvgWage(AvgType, EmplKey, FirstMoveKey, CalYear, CalMonth, AvgSumma)
        get_sql(wg_avg_wage_sick, kb, usr_wg_AvgWage/6,
        "
        SELECT
          'vacation' AS AvgType,
          v.USR$EMPLKEY,
          v.USR$FIRSTMOVEKEY,
          EXTRACT(YEAR FROM vl.USR$DATEBEGIN) AS CalYear,
          EXTRACT(MONTH FROM vl.USR$DATEBEGIN) AS CalMonth,
          v.USR$AVGSUMMA
        FROM
          USR$WG_VACATION v
        JOIN
          USR$WG_VACATIONLINE vl
            ON vl.MASTERKEY = v.DOCUMENTKEY
        WHERE
          v.USR$EMPLKEY = pEmplKey
          AND
          v.USR$FIRSTMOVEKEY = pFirstMoveKey
          AND
          vl.USR$DATEBEGIN >= 'pDateCalcFrom'
          AND
          vl.USR$DATEBEGIN < 'pDateCalcTo'
        UNION ALL
        SELECT
          'sick' AS AvgType,
          s.USR$EMPLKEY,
          s.USR$FIRSTMOVEKEY,
          EXTRACT(YEAR FROM sl.USR$DATEBEGIN) AS CalYear,
          EXTRACT(MONTH FROM sl.USR$DATEBEGIN) AS CalMonth,
          s.USR$AVGSUMMA
        FROM
          USR$WG_SICKLIST s
        JOIN
          USR$WG_SICKLISTLINE sl
            ON sl.MASTERKEY = s.DOCUMENTKEY
        WHERE
          s.USR$EMPLKEY = pEmplKey
          AND
          s.USR$FIRSTMOVEKEY = pFirstMoveKey
          AND
          sl.USR$DATEBEGIN >= 'pDateCalcFrom'
          AND
          sl.USR$DATEBEGIN < 'pDateCalcTo'
        UNION ALL
        SELECT
          'avg' AS AvgType,
          al.USR$EMPLKEY,
          al.USR$FIRSTMOVEKEY,
          EXTRACT(YEAR FROM t.USR$DATEBEGIN) AS CalYear,
          EXTRACT(MONTH FROM t.USR$DATEBEGIN) AS CalMonth,
          CASE COALESCE(a.USR$CALCBYHOUR, 0)
            WHEN 1 THEN
              8 * COALESCE(al.USR$AVGSUM, 0)
            ELSE
              COALESCE(al.USR$AVGSUM, 0)
          END
            AS AvgSumma
        FROM
          USR$WG_AVGADDPAYLINE al
        JOIN
          USR$WG_AVGADDPAY a
            ON a.DOCUMENTKEY = al.MASTERKEY
        JOIN
          USR$WG_TOTAL t
            ON t.DOCUMENTKEY = a.USR$TOTALDOCKEY
        WHERE
          al.USR$EMPLKEY = pEmplKey
          AND
          al.USR$FIRSTMOVEKEY = pFirstMoveKey
          AND
          t.USR$DATEBEGIN >= 'pDateCalcFrom'
          AND
          t.USR$DATEBEGIN < 'pDateCalcTo'
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]).
        
        gd_pl_ds(Scope, kb, usr_wg_FeeTypeProp, 4, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fFeeGroupKeyProp-integer, fFeeTypeKeyProp-integer
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        % usr_wg_FeeTypeProp(EmplKey, FirstMoveKey, FeeGroupKeyProp, FeeTypeKeyProp)
        get_sql(Scope, kb, usr_wg_FeeTypeProp/4,
        "
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          ft.USR$WG_FEEGROUPKEY,
          ft.USR$WG_FEETYPEKEY
        FROM
          USR$CROSS179_256548741 ft
        JOIN
          USR$WG_FEETYPE ft_avg
            ON ft_avg.ID = ft.USR$WG_FEETYPEKEY
        WHERE
          ft.USR$WG_FEEGROUPKEY = (SELECT id FROM GD_P_GETID(pFeeGroupKeyProp_ruid))
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pFeeGroupKeyProp_ruid-_
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        
        gd_pl_ds(wg_avg_wage_sick, kb, wg_holiday, 1, [
            fHolidayDate-date
            ]).
        % wg_holiday(HolidayDate)
        get_sql(wg_avg_wage_sick, kb, wg_holiday/1,
        "
        SELECT
          h.holidaydate
        FROM
          wg_holiday h
        WHERE
          h.holidaydate BETWEEN 'pDateCalcFrom' AND 'pDateCalcTo'
          AND COALESCE(h.disabled, 0) = 0
        ",
            [
            pDateCalcFrom-_, pDateCalcTo-_
            ]).
        
        gd_pl_ds(wg_avg_wage_sick, kb, usr_wg_ExclDays, 7, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fExclType-string, fOrderType-integer,
            fExclWeekDay-integer,
            fFromDate-date, fToDate-date
            ]).
        % usr_wg_ExclDays(EmplKey, FirstMoveKey, ExclType, OrderType, ExclWeekDay, FromDate, ToDate)
        get_sql(wg_avg_wage_sick, kb, usr_wg_ExclDays/7,
        "
        SELECT
          EmplKey, FirstMoveKey, ExclType, OrderType, ExclWeekDay, FromDate, ToDate
        FROM (
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          'LIGHTWORKLINE' AS ExclType,
          0 AS OrderType,
          0 AS ExclWeekDay,
          CAST( IIF(lw.USR$DATEBEGIN < 'pDateCalcFrom', 'pDateCalcFrom', lw.USR$DATEBEGIN) AS DATE) AS FromDate,
          CAST( IIF(lw.USR$DATEEND IS NULL, 'pDateCalcTo', IIF(lw.USR$DATEEND > 'pDateCalcTo', 'pDateCalcTo', lw.USR$DATEEND)) AS DATE) AS ToDate
        FROM USR$WG_LIGHTWORKLINE lw
        WHERE lw.USR$FIRSTMOVEKEY = pFirstMoveKey
          AND lw.USR$EMPLKEY = pEmplKey
          AND lw.USR$DATEBEGIN <= 'pDateCalcTo'
          AND COALESCE(lw.USR$DATEEND, 'pDateCalcTo') >= 'pDateCalcFrom'
        UNION ALL
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          'LEAVEDOCLINE' AS ExclType,
          t.USR$TYPE AS OrderType,
          0 AS ExclWeekDay,
          CAST( IIF(ld.USR$DATEBEGIN < 'pDateCalcFrom', 'pDateCalcFrom', ld.USR$DATEBEGIN) AS DATE) AS FromDate,
          CAST( IIF(ld.USR$DATEEND IS NULL, 'pDateCalcTo', IIF(ld.USR$DATEEND > 'pDateCalcTo', 'pDateCalcTo', ld.USR$DATEEND)) AS DATE) AS ToDate
        FROM USR$WG_LEAVEDOCLINE ld
        JOIN USR$WG_VACATIONTYPE t ON t.ID = ld.USR$VACATIONTYPEKEY
        WHERE ld.USR$FIRSTMOVEKEY = pFirstMoveKey
          AND ld.USR$EMPLKEY = pEmplKey
          AND ld.USR$DATEBEGIN <= 'pDateCalcTo'
          AND COALESCE(ld.USR$DATEEND, 'pDateCalcTo') >= 'pDateCalcFrom'
          AND COALESCE(t.USR$EXCLUDEFORSICKLIST, 0) = 1
        UNION ALL
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          'SICKLISTJOURNAL' AS ExclType,
          0 AS OrderType,
          0 AS ExclWeekDay,
          CAST( IIF(s.USR$DATEBEGIN < 'pDateCalcFrom', 'pDateCalcFrom', s.USR$DATEBEGIN) AS DATE) AS FromDate,
          CAST( IIF(s.USR$DATEEND IS NULL, 'pDateCalcTo', IIF(s.USR$DATEEND > 'pDateCalcTo', 'pDateCalcTo', s.USR$DATEEND)) AS DATE) AS ToDate
        FROM USR$WG_SICKLISTJOURNAL s
        WHERE s.USR$EMPLKEY = pEmplKey
          AND s.USR$DATEBEGIN <= 'pDateCalcTo'
          AND COALESCE(s.USR$DATEEND, 'pDateCalcTo') >= 'pDateCalcFrom'
        UNION ALL
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          'LEAVEEXTDOC' AS ExclType,
          0 AS OrderType,
          0 AS ExclWeekDay,
          CAST( IIF(ext.USR$DATEBEGIN < 'pDateCalcFrom', 'pDateCalcFrom', ext.USR$DATEBEGIN) AS DATE) AS FromDate,
          CAST( IIF(ext.USR$DATEEND IS NULL, 'pDateCalcTo', IIF(ext.USR$DATEEND > 'pDateCalcTo', 'pDateCalcTo', ext.USR$DATEEND)) AS DATE) AS ToDate
        FROM USR$WG_LEAVEEXTDOC ext
        WHERE ext.USR$EMPLKEY = pEmplKey
          AND ext.USR$DATEBEGIN <= 'pDateCalcTo'
          AND COALESCE(ext.USR$DATEEND, 'pDateCalcTo') >= 'pDateCalcFrom'
        UNION ALL
        SELECT
          pEmplKey AS EmplKey,
          pFirstMoveKey AS FirstMoveKey,
          'KINDDAYLINE' AS ExclType,
          0 AS OrderType,
          kdl.USR$DAY AS ExclWeekDay,
          CAST( IIF(kdl.USR$DATEBEGIN < 'pDateCalcFrom', 'pDateCalcFrom', kdl.USR$DATEBEGIN) AS DATE) AS FromDate,
          CAST( IIF(kdl.USR$DATEEND IS NULL, 'pDateCalcTo', IIF(kdl.USR$DATEEND > 'pDateCalcTo', 'pDateCalcTo', kdl.USR$DATEEND)) AS DATE) AS ToDate
        FROM USR$WG_KINDDAYLINE kdl
        WHERE kdl.USR$EMPLKEY = pEmplKey
          AND kdl.USR$DATEBEGIN <= 'pDateCalcTo'
          AND COALESCE(kdl.USR$DATEEND, 'pDateCalcTo') >= 'pDateCalcFrom'
        )
        ORDER BY
          ExclWeekDay,
          FromDate
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]).
        
        % twg_struct
        
        gd_pl_ds(wg_struct_vacation, kb, wg_holiday, 1, [
            fHolidayDate-date
            ]).
        % wg_holiday(HolidayDate)
        get_sql(wg_struct_vacation, kb, wg_holiday/1,
        "
        SELECT
          h.holidaydate
        FROM
          wg_holiday h
        WHERE
          h.holidaydate BETWEEN 'pDateBegin' AND 'pDateEnd'
          AND COALESCE(h.disabled, 0) = 0
        ",
            [
            pDateBegin-_, pDateEnd-_
            ]).
        
        gd_pl_ds(wg_struct_vacation, kb, wg_vacation_slice, 2, [
            fVcType-integer, fSlice-float
            ]).
        % wg_vacation_slice(VcType, Slice)
        get_sql(wg_struct_vacation, kb, wg_vacation_slice/2,
        "
        SELECT
          0 AS VcType, COALESCE(USR$DURATION,0) AS Slice
        FROM
          USR$WG_VACATION
        WHERE
          DOCUMENTKEY = pDocKey
        UNION ALL
        SELECT
          1 AS VcType, COALESCE(USR$EXTRADURATION,0) AS Slice
        FROM
          USR$WG_VACATION
        WHERE
          DOCUMENTKEY = pDocKey
        /*
        UNION ALL
        SELECT
          2 AS VcType, COALESCE(USR$UNHEALTHY,0) AS Slice
        FROM
          USR$WG_VACATION
        WHERE
          DOCUMENTKEY = pDocKey
        UNION ALL
        SELECT
          3 AS VcType, COALESCE(USR$UNFIXED,0) AS Slice
        FROM
          USR$WG_VACATION
        WHERE
          DOCUMENTKEY = pDocKey
        UNION ALL
        SELECT
          4 AS VcType, COALESCE(USR$COMPENSATIONDAY,0) AS Slice
        FROM
          USR$WG_VACATION
        WHERE
          DOCUMENTKEY = pDocKey
        */
        ",
            [
            pDocKey-_
            ]).
        
        gd_pl_ds(wg_struct_vacation, kb, wg_vacation_compensation, 3, [
            fDateFrom-integer, fDuration-float, fCompensation-integer
            ]).
        % wg_vacation_compensation(DateFrom, Duration, Compensation)
        get_sql(wg_struct_vacation, kb, wg_vacation_compensation/3,
        "
        SELECT
          USR$FROM AS DateFrom,
          COALESCE(USR$DURATION,0) AS Duration,
          COALESCE(USR$COMPENSATION,0) AS Compensation
        FROM
          USR$WG_VACATION
        WHERE
          DOCUMENTKEY = pDocKey
        ",
            [
            pDocKey-_
            ]).
        
        gd_pl_ds(wg_struct_sick, kb, gd_const_budget, 2, [
            fConstDate-date, fBudget-float
            ]).
        % gd_const_budget(ConstDate, Budget)
        get_sql(wg_struct_sick, kb, gd_const_budget/2,
        "
        SELECT
          cv.CONSTDATE,
          CAST(cv.CONSTVALUE AS DECIMAL(15,4)) AS Budget
        FROM
          GD_CONSTVALUE cv
        JOIN
          GD_CONST c
            ON c.ID  =  cv.CONSTKEY
        WHERE
          cv.CONSTKEY = (SELECT id FROM GD_P_GETID(pBudget_ruid))
        ORDER BY
          cv.CONSTDATE
        ",
            [
            pBudget_ruid-_
            ]).
        
        gd_pl_ds(Scope, kb, gd_const_AvgSalaryRB, 2, [
            fConstDate-date, fAvgSalaryRB-float
            ]) :-
            memberchk(Scope, [
                wg_struct_sick, wg_avg_wage_sick
                ]).
        % gd_const_AvgSalaryRB(ConstDate, AvgSalaryRB)
        get_sql(Scope, kb, gd_const_AvgSalaryRB/2,
        "
        SELECT
          cv.CONSTDATE,
          CAST(cv.CONSTVALUE AS DECIMAL(15,4)) AS AvgSalaryRB
        FROM
          GD_CONSTVALUE cv
        JOIN
          GD_CONST c
            ON c.ID  =  cv.CONSTKEY
        WHERE
          cv.CONSTKEY = (SELECT id FROM GD_P_GETID(pAvgSalaryRB_ruid))
        ORDER BY
          cv.CONSTDATE
        ",
            [
            pAvgSalaryRB_ruid-_
            ]) :-
            memberchk(Scope, [
                wg_struct_sick, wg_avg_wage_sick
                ]).
        
        gd_pl_ds(wg_struct_sick, kb, usr_wg_TblDayNorm, 8, [
            fEmplKey-integer, fFirstMoveKey-integer,
            fWYear-integer, fWMonth-integer, fTheDay-date, fWDay-integer,
            fWDuration-float, fWorkDay-integer
            ]).
        % usr_wg_TblDayNorm(EmplKey, FirstMoveKey, WYear, WMonth, TheDay, WDay, WDuration, WorkDay)
        get_sql(wg_struct_sick, kb, usr_wg_TblDayNorm/8,
        "
        SELECT EmplKey, FirstMoveKey, WYear, WMonth, TheDay, WDay, WDuration, WorkDay
        FROM USR$WG_TBLCALDAY_P(pEmplKey, pFirstMoveKey, 'pDateCalcFrom', 'pDateCalcTo')
        ",
            [
            pEmplKey-_, pFirstMoveKey-_, pDateCalcFrom-_, pDateCalcTo-_
            ]).
        
        gd_pl_ds(wg_struct_sick, kb, wg_job_ill_type, 1, [
            fJobIllType-integer
            ]).
        % wg_job_ill_type(ID)
        get_sql(wg_struct_sick, kb, wg_job_ill_type/1,
        "
        SELECT id FROM GD_P_GETID(pJobIllType_ruid)
        ",
            [
            pJobIllType_ruid-_
            ]).
        
        gd_pl_ds(Scope, kb, usr_wg_pl_Rule, 2, [
            fAtom-string, fEnabled-boolean
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        % usr_wg_pl_Rule(Atom, Enabled)
        get_sql(Scope, kb, usr_wg_pl_Rule/2,
        "
        SELECT
          r.USR$ATOM,
          r.USR$ENABLED
        FROM
          USR$WG_PL_RULE r
        WHERE
          NOT r.USR$ATOM IS NULL
        ORDER BY
          r.PARENT,
          r.USR$ORDER
        ",
            [
            ]) :-
            memberchk(Scope, [
                wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg
                ]).
        
         %
        %%
        
        
      DISPLAYSCRIPT: ~
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: ~
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-12-09T14:52:15+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151189471_18175251
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151189370_18175251
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "PROLOG"
      LANGUAGE: "VBScript"
      NAME: "twg_avg_wage_in_params"
      COMMENT: ~
      SCRIPT: | 
        %% twg_avg_wage_in_params
        %  входные параметры для twg_avg_wage
        %
        
        %:- ['../common/lib', '../common/params'].
        
        twg_avg_wage_in_params:-
            member(Scope, [
                wg_avg_wage_vacation,
                wg_avg_wage_sick,
                wg_avg_wage_avg,
                wg_struct_sick
                ]),
            new_param_list(Scope, in, [
                pCommon-1,
                pPayFormSalary_ruid-'147009181,119619099',
                %pTblCal_DocType_Plan_ruid-'147567935,1514418708',
                pTblCal_DocType_Plan_xid1-147567935,
                pTblCal_DocType_Plan_dbid1-1514418708,
                pTblCal_DocType_Plan_xid2-147117601,
                pTblCal_DocType_Plan_dbid2-1481574092,
                pTblCal_DocType_Fact_ruid-'187613422,1596169984'
                ]),
            fail.
        twg_avg_wage_in_params:-
            new_param_list(wg_avg_wage_vacation, in, [
                pMonthQty-12, pAvgDays-29.7,
                pFeeGroupKey_ruid-'147071456,274788016',
                pFeeGroupKeyNoCoef_ruid-'147757383,84733194',
                % Постановление №31 (исключение пособий для среднего)
                pBadFeeGroupKey_ruid-'147077036,222160651',
                % Больничный (80%)
                %pBadFeeType_xid_IN-'151000730',
                %pBadFeeType_dbid-2109681374,
                % А, УБЗ, Т
                pBadHourType_xid_IN-'147650804, 147650786, 147650802',
                pBadHourType_dbid-119619099,
                % Ненормированный график
                pSpecDep_ruid-'156913837,131572570'
                ]),
            fail.
        twg_avg_wage_in_params:-
            new_param_list(wg_avg_wage_sick, in, [
                pMonthQty-6, pLimitDays-30,
                pFeeGroupKey_ruid-'147071457,274788016',
                % Группа Пропорциональных начислений
                pFeeGroupKeyProp_ruid-'147119175,1354510846',
                pKindDayHourType_ruid-'147650798,119619099',
                pAvgSalaryRB_ruid-'147105585,1224850260'
                ]),
            fail.
        twg_avg_wage_in_params:-
            new_param_list(wg_avg_wage_avg, in, [
                pMonthQty-2, pMonthBonusQty-12, pMonthLimitQty-2,
                pFeeGroupKey_ruid-'147113780,1354510846',
                % Группа Пропорциональных начислений
                pFeeGroupKeyProp_ruid-'151471645,212040444'
                ]),
            fail.
        twg_avg_wage_in_params:-
            new_param_list(wg_struct_vacation, in, [
                ]),
            fail.
        twg_avg_wage_in_params:-
            new_param_list(wg_struct_sick, in, [
                pFirstCalcType-0, pFirstDuration-12, pFirstPart-0.8,
                pBugetCalcType-1, pBudgetPart-0.5, pViolatPart-0.5,
                % Травма производственная
                pJobIllType_ruid-'147036273,151520244',
                pBudget_ruid-'147073065,1224850260',
                pAvgSalaryRB_ruid-'147105585,1224850260',
                pAvgSalaryRB_Coef-3
                ]),
            fail.
        twg_avg_wage_in_params :-
            member([CutCalcType, CutDuration, CutPart], [[2, 6, 0.5], [3, 0, 0.5]]),
            new_param_list(wg_struct_sick, in,
                [pCutCalcType-CutCalcType, pCutDuration-CutDuration, pCutPart-CutPart]),
            fail.
        twg_avg_wage_in_params.
        
        :- twg_avg_wage_in_params.
        
         %
        %%
        
        
      DISPLAYSCRIPT: ~
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: ~
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-11-28T17:27:22+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151189370_18175251
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "PROLOG"
      LANGUAGE: "VBScript"
      NAME: "twg_avg_wage"
      COMMENT: ~
      SCRIPT: | 
        %% twg_avg_wage
        % Зарплата и Отдел кадров -> Зарплата -> 03. Начисление зарплаты
        %   05. Начисление отпусков
        %   06. Начисление больничных
        %   12. Начисление по-среднему
        %
        
        :- style_check([-atom]).
        
        :- dynamic(debug_mode/0).
        % ! при использовании в ТП Гедымин
        % ! комментировать следующую строку
        %:- assertz(debug_mode).
        
        %%% begin debug mode section
        :- if(debug_mode).
        
        %% saved state
        :- ['../gd_pl_state/load_atom', '../gd_pl_state/date', '../gd_pl_state/dataset'].
        %%
        
        %% include
        %#INCLUDE lib
        %#INCLUDE params
        %#INCLUDE wg_data_mix
        :- ['../common/lib', '../common/params', '../common/wg_data_mix'].
        %#INCLUDE twg_avg_wage_sql
        :- [twg_avg_wage_sql].
        %#INCLUDE twg_avg_wage_in_params
        %:- [twg_avg_wage_in_params].
        %%
        
        %% facts
        :-  init_data,
            working_directory(_, 'kb'),
            [
            % section twg_avg_wage
            %  05. Начисление отпусков
            usr_wg_DbfSums, % 05, 06, 12
            usr_wg_MovementLine, % 05, 06, 12
            usr_wg_FCRate,
            usr_wg_TblCalDay, % 05, 06, 12
            %usr_wg_TblDayNorm, % 05, 06, 12
            %usr_wg_TblYearNorm,
            usr_wg_TblCalLine, % 05, 06, 12
            usr_wg_TblCal_FlexLine, % 05, 06, 12
            usr_wg_HourType, % 05, 06
            usr_wg_TblCharge, % 05, 06, 12
            usr_wg_FeeType, % 05, 06, 12
            usr_wg_FeeTypeNoCoef,
            usr_wg_BadHourType,
            usr_wg_BadFeeType,
            usr_wg_SpecDep,
            %  06. Начисление больничных
            usr_wg_AvgWage,
            usr_wg_FeeTypeProp, % 06, 12
            wg_holiday,
            usr_wg_ExclDays,
            % 12. Начисление по-среднему
            usr_wg_TblChargeBonus,
            % section twg_struct
            %wg_holiday,
            wg_vacation_slice,
            wg_vacation_compensation,
            gd_const_budget,
            gd_const_AvgSalaryRB,
            %usr_wg_TblDayNorm,
            wg_job_ill_type,
            % section twg_rule
            usr_wg_pl_Rule
            ],
            working_directory(_, '..').
        %%
        
        %% dynamic state
        :- ['kb/param_list'].
        %%
        
        :- ps32k_lgt(64, 128, 64).
        
        :- endif.
        %%% end debug mode section
        
        % section twg_avg_wage
        % среднедневной заработок
        % - для отпусков
        % - для больничных
        % - для начисления по-среднему
        %
        
        /* реализация - секция правил */
        
        :- dynamic(wg_valid_rules/1).
        
        %% варианты правил расчета
        %  - для отпусков
        % [по расчетным месяцам, по среднечасовому]
        wg_valid_rules([by_calc_month, by_avg_houre]).
        %% варианты правил включения месяца в расчет
        % табель за месяц покрывает график [по дням и часам, по часам, по дням]
        wg_valid_rules([by_days_houres, by_houres, by_days]).
        %% дополнительные правила для включения месяца в расчет
        % [заработок за месяц не меньше любого из полных месяцев]
        % (для одинаковых коэфициентов осовременивания)
        wg_valid_rules([by_month_wage_any]).
        % [заработок за месяц не меньше каждого из полных месяцев]
        % (для одинаковых коэфициентов осовременивания)
        wg_valid_rules([-by_month_wage_all]).
        % [отсутствие в месяце плохих типов начислений и часов]
        wg_valid_rules([-by_month_no_bad_type]).
        
        %% варианты правил расчета
        %  - для больничных
        % [по расчетным дням итого за период]
        wg_valid_rules([by_calc_days_total]).
        % [по расчетным дням, по расчетным дням со справкой]
        wg_valid_rules([-by_calc_days, -by_calc_days_doc]).
        % [от ставки, по среднему заработку, по не полным месяцам]
        wg_valid_rules([by_rate, by_avg_wage, -by_not_full]).
        % [от БПМ]
        wg_valid_rules([by_budget]).
        %% варианты правил для исключения дней
        % [по табелю мастера, по табелю, по приказам]
        wg_valid_rules([by_cal_flex, by_cal, by_orders]).
        %% дополнительные правила для учета расчетных дней
        % [хотя бы один месяц полный, все месяцы полные]
        wg_valid_rules([by_calc_days_any, -by_calc_days_all]).
        
        %% варианты правил полных месяцев
        %  - для отпусков
        % табель за месяц покрывает график [по дням и часам, по часам, по дням]
        wg_full_month_rules([by_days_houres, by_houres, by_days]).
        
        % правила запрещены по признаку
        %  - для отпусков
        wg_deny_flag_rules(flag_spec_dep, [by_days_houres, by_houres, by_days]).
        wg_deny_flag_rules(flag_spec_dep, [by_month_wage_all]).
        wg_deny_flag_rules(flag_spec_dep, [by_month_wage_any]).
        
        % правило действительно
        is_valid_rule(Scope, PK, Y-M, Rule) :-
            wg_valid_rules(ValidRules),
            member(Rule, ValidRules),
            \+ is_deny_rule(Scope, PK, Y-M, Rule),
            !.
        
        % правило отвергается по признаку
        is_deny_rule(Scope, PK, Y-M, Rule) :-
            get_flag_rule(Scope, PK, Y-M, Flag),
            wg_deny_flag_rules(Flag, FlagRules),
            member(Rule, FlagRules),
            !.
        
        % получить признак
        get_flag_rule(Scope, PK, _, Flag) :-
            Flag = flag_spec_dep,
            % последний график рабочего времени
            get_last_schedule(Scope, PK, ScheduleKey),
            % равен графику специального отдела
            get_spec_dep(Scope, PK, ScheduleKey),
            !.
        
        % взять график специального отдела
        get_spec_dep(Scope, PK, SpecDepKey) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять данные по графику специального отдела
            get_data(Scope, kb, usr_wg_SpecDep, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fID-SpecDepKey]),
            !.
        
        /* реализация - расчет */
        
        % среднедневной заработок
        % Scope: wg_avg_wage_vacation ; wg_avg_wage_sick ; wg_avg_wage_avg
        %        для отпусков ; для больничных ; для начисления по-среднему
        avg_wage(Scope) :-
            % взять локальное время
            get_local_date_time(DT),
            % записать отладочную информацию
            new_param_list(Scope, debug, [start-Scope-DT]),
            % шаблон первичного ключа
            PK = [pEmplKey-_, pFirstMoveKey-_],
            % для каждого первичного ключа расчета из входных параметров
            get_param_list(Scope, in, PK),
            % запустить цикл механизма подготовки данных
            engine_loop(Scope, in, PK),
            % настроить правила
            wg_config_rules(Scope),
            % выполнить расчет
            eval_avg_wage(Scope, PK),
            % найти альтернативу
            fail.
        avg_wage(_) :-
            % больше альтернатив нет
            !.
        
        % выполнить расчет
        eval_avg_wage(Scope, PK) :-
            % взять локальное время
            get_local_date_time(DT1),
            % записать отладочную информацию
            new_param_list(Scope, debug, [begin-DT1|PK]),
            % удалить временные данные по расчету
            forall( get_param_list(Scope, temp, PK, Pairs),
                    dispose_param_list(Scope, temp, Pairs) ),
            % вычислить среднедневной заработок по сотруднику
            calc_avg_wage(Scope, PK, AvgWage, Variant),
            % записать результат
            ret_avg_wage(Scope, PK, AvgWage, Variant),
            % взять локальное время
            get_local_date_time(DT2),
            % записать отладочную информацию
            new_param_list(Scope, debug, [end-DT2|PK]),
            !.
        
        % записать результат
        ret_avg_wage(Scope, PK, AvgWage, Variant) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять дополнительные данные из первого движения
            get_data(Scope, kb, usr_wg_MovementLine, [
                        fEmplKey-EmplKey,
                        fDocumentKey-FirstMoveKey, fFirstMoveKey-FirstMoveKey,
                        fDateBegin-DateBegin, fMovementType-1,
                        fListNumber-ListNumber
                 ]),
            % для даты последнего приема на работу
            get_last_hire(Scope, PK, DateBegin),
            % записать выходные данные
            append(PK, [pListNumber-ListNumber,
                        pAvgWage-AvgWage, pVariant-Variant],
                    OutPairs),
            new_param_list(Scope, out, OutPairs),
            !.
        
        % среднедневной заработок по сотруднику
        calc_avg_wage(Scope, PK, AvgWage, Rule) :-
            % - для отпусков (по расчетным месяцам)
            Scope = wg_avg_wage_vacation, Rule = by_calc_month,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % проверка по табелю
            check_month_tab(Scope, PK, Periods),
            % если есть хотя бы один расчетный месяц
            ( once( get_month_incl(Scope, PK, _, _, _) )
            ->
              % то проверка по заработку
              check_month_wage(Scope, PK, Periods)
              % иначе далее
            ; true ),
            % проверка на отсутствие плохих типов начислений и часов
            check_month_no_bad_type(Scope, PK, Periods),
            % есть хотя бы один расчетный месяц
            once( get_month_incl(Scope, PK, _, _, _) ),
            % взять заработок
            findall( Wage,
                       % за каждый расчетный месяц
                     ( get_month_incl(Scope, PK, Y, M, _),
                       % взять данные по заработку
                       get_month_wage(Scope, PK, Y, M, _, Wage) ),
            % в список заработков
            Wages ),
            % итоговый заработок за расчетные месяцы
            sum_list(Wages, Amount),
            % количество расчетных месяцев
            length(Wages, Num),
            % среднемесячное количество календарных дней
            get_param(Scope, in, pAvgDays-AvgDays),
            % среднедневной заработок
            catch( AvgWage0 is Amount / Num / AvgDays, _, fail ),
            AvgWage is round(AvgWage0),
            !.
        calc_avg_wage(Scope, PK, AvgWage, Rule) :-
            % - для отпусков (по среднечасовому)
            Scope = wg_avg_wage_vacation, Rule = by_avg_houre,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % взять заработок
            findall( Wage,
                       % за каждый период проверки
                     ( member(Y1-M1, Periods),
                       % взять данные по заработку
                       get_month_wage(Scope, PK, Y1, M1, _, Wage),
                       Wage > 0 ),
            % в список заработков
            Wages ),
            % есть заработок
            \+ Wages = [],
            % всего за период
            sum_list(Wages, Amount),
            % взять часы
            findall( THoures,
                       % за период проверки
                     ( member(Y2-M2, Periods),
                       % взять данные по часам за месяц
                       get_month_norm_tab(Scope, PK, Y2-M2, _, _, _, THoures) ),
            % в список часов
            Durations),
            % всего часов по табелю
            sum_list(Durations, TotalTab),
            % среднечасовой заработок
            catch( AvgHoureWage is Amount / TotalTab, _, fail ),
            % расчитать график за год
            calc_year_norm(Scope, PK, NormDays),
            % сумма дней и часов по графику
            sum_days_houres(NormDays, _, TotalNorm),
            % среднемесячное количество расчетных рабочих часов
            AvgMonthNorm is TotalNorm / 12,
            % среднемесячное количество календарных дней
            get_param(Scope, in, pAvgDays-AvgDays),
            % среднедневной заработок
            catch( AvgWage0 is AvgHoureWage * AvgMonthNorm / AvgDays, _, fail ),
            AvgWage is round(AvgWage0),
            !.
        calc_avg_wage(Scope, PK, AvgWage, Rule) :-
            % - для больничных (по расчетным дням / со справкой)
            Scope = wg_avg_wage_sick,
            Rules = [by_calc_days_total-1, by_calc_days-2, by_calc_days_doc-1] ,
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % есть рабочие периоды
            \+ Periods = [],
            % для правила из списка
            member(Rule-IsAvgWageDoc, Rules),
            % где правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            get_param(Scope, run, pMonthQty-MonthQty),
              % если есть требуемое количество месяцев
            ( length(Periods, MonthQty) -> true
            ; % или соспоставление с признаком Справка
              get_param_list(Scope, run, [pIsAvgWageDoc-IsAvgWageDoc | PK])
            ),
            % и выполняется одно из правил по расчетным дням
            rule_month_days_sick(Scope, PK, Periods, _),
            % то выполнить расчет
            % взять заработок
            findall( Wage,
                       % за каждый период проверки
                     ( member(Y1-M1, Periods),
                       % взять данные по заработку
                       get_month_wage(Scope, PK, Y1, M1, _, Wage) ),
            % в список заработков
            Wages ),
            % итоговый заработок
            sum_list(Wages, Amount),
            % взять расчетные дни
            findall( CalcDays,
                       % за каждый период проверки
                     ( member(Y2-M2, Periods),
                       % взять данные по расчетным дням
                       get_month_days_sick(Scope, PK, Y2, M2, _, CalcDays, _, _) ),
            % в список расчетных дней
            CalcDaysList ),
            % всего расчетных дней
            sum_list(CalcDaysList, TotalCalcDays),
            !,
            % среднедневной заработок
            catch( AvgWage0 is Amount / TotalCalcDays, _, fail ),
            AvgWage is round(AvgWage0),
            !.
        calc_avg_wage(Scope, PK, AvgWage, Rule) :-
            % - для больничных (от ставки при отсутствии заработка)
            Scope = wg_avg_wage_sick,
            Rule = by_rate,
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % есть требуемое количество месяцев
            get_param(Scope, run, pMonthQty-MonthQty),
            length(Periods, MonthQty),
            % взять заработок
            findall( Wage,
                       % за каждый период проверки
                     ( member(Y-M, Periods),
                       % взять данные по заработку
                       get_month_wage(Scope, PK, Y, M, _, Wage),
                       Wage > 0
                     ),
            % в список заработков
            Wages ),
            % если нет заработка
            Wages = [],
            % то расчет от ставки при формировании структуры
            AvgWage is 0,
            !.
        calc_avg_wage(Scope, PK, AvgWage, Rule) :-
            % - для больничных (от ставки / по среднему заработку / по не полным месяцам)
            Scope = wg_avg_wage_sick,
            Rules = [by_rate, by_avg_wage, by_not_full],
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % есть рабочие периоды
            \+ Periods = [],
            get_param(Scope, run, pMonthQty-MonthQty),
            % есть требуемое количество месяцев
            ( length(Periods, MonthQty) -> true
            % или признак Справка
            ; get_param_list(Scope, run, [pIsAvgWageDoc-1 | PK])
            ),
            % собрать расчет по разным вариантам
            findall( AvgWage0-Rule0,
                     ( member(Rule0, Rules),
                       calc_avg_wage_sick(Scope, PK, Periods, AvgWage0, Rule0),
                       AvgWage0 > 0
                     ),
            % в список расчетов
            AvgWageList),
            % выбор по более выгодному варианту
            max_member(AvgWage1-Rule, AvgWageList),
              % от ставки - расчет при формировании структуры
            ( memberchk(Rule, [by_rate])
             -> AvgWage = 0
            ; % иначе - по выбранному варианту
              AvgWage = AvgWage1
            ),
            !.
        calc_avg_wage(Scope, PK, AvgWage, Rule) :-
            % - для больничных (от ставки без периодов со справкой)
            Scope = wg_avg_wage_sick, Rule = by_rate,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % если нет рабочих периодов
            Periods = [],
            % но есть признак Справка
            get_param_list(Scope, run, [pIsAvgWageDoc-1 | PK]),
            % то расчет от ставки
            calc_avg_wage_sick(Scope, PK, Periods, AvgWage, Rule),
            !.
        calc_avg_wage(Scope, PK, AvgWage, Rule) :-
            % - для больничных (от БПМ)
            Scope = wg_avg_wage_sick, Rule = by_budget,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % нет требуемого количества месяцев
            get_param(Scope, run, pMonthQty-MonthQty),
            \+ length(Periods, MonthQty),
            % расчет от БПМ при формировании структуры
            AvgWage is 0,
            !.
        calc_avg_wage(Scope, PK, AvgWage, Variant) :-
            % - для начисления по-среднему (по часам или дням)
            Scope = wg_avg_wage_avg,
            % подготовка временных данных для расчета
            prep_avg_wage(Scope, PK, Periods),
            % взять заработок
            findall( Wage1,
                       % за каждый период проверки
                     ( member(Y1-M1, Periods),
                       % взять данные по заработку
                       get_month_wage(Scope, PK, Y1, M1, _, Wage1),
                       % где значение больше 0
                       Wage1 > 0 ),
            % в список заработков
            Wages ),
              % есть требуемое количество месяцев
            ( get_param(Scope, run, pMonthQty-MonthQty),
              length(Wages, MonthQty)
            -> true
            ; % или первый период проверки
              Periods = [Y-M|_],
              % и период последнего приема на работу
              get_last_hire(Scope, PK, DateIn),
              % совпадают
              atom_date(DateIn, date(Y, M, _))
            ),
            % итоговый заработок
            sum_list(Wages, Amount),
            % признак расчета по часам
            get_param(Scope, run, pCalcByHoure-CalcByHoure),
            ( CalcByHoure = 1 -> Variant = avg_houre ; Variant = avg_day),
            % взять отработанное время
            findall( TWork,
                       % за период проверки
                     ( member(Y2-M2, Periods),
                       % взять данные по дням и часам за месяц
                       get_month_norm_tab(Scope, PK, Y2-M2, _, TDays, _, THoures),
                       % для заработка
                       get_month_wage(Scope, PK, Y2, M2, _, Wage2),
                       % значение которого больше 0
                       Wage2 > 0,
                       % признаку расчета по часам
                       ( CalcByHoure = 1 -> TWork = THoures ; TWork = TDays ) ),
            % в список
            TWorkList),
            % всего отработано по табелю
            sum_list(TWorkList, TotalTab),
            % средний заработок
            catch( AvgWage0 is Amount / TotalTab, _, fail ),
            AvgWage is round(AvgWage0),
            !.
        calc_avg_wage(Scope, PK, AvgWage, Variant) :-
            % - для начисления по-среднему (нужно больше месяцев)
            Scope = wg_avg_wage_avg,
            % периоды для проверки
            get_periods(Scope, PK, [Y-M|_]),
            atom_date(FirstDate, date(Y, M, 1)),
            % для даты последнего приема на работу
            get_last_hire(Scope, PK, DateIn),
            % если дата последнего приема на работу меньше первой даты расчета
            DateIn @< FirstDate,
            % и не превышен лимит
            get_param_list(Scope, run, [pMonthLimitQty-MonthLimitQty, pMonthBefore-MonthBefore]),
            \+ MonthBefore > MonthLimitQty,
            % то для расчета нужно больше месяцев
            AvgWage = 0, Variant = need_more,
            !.
        calc_avg_wage(Scope, PK, AvgWage, Variant) :-
            % - для начисления по-среднему (по начислению за текущий месяц)
            Scope = wg_avg_wage_avg,
            % нет периодов для проверки
            get_periods(Scope, PK, []),
            % если следующий период
            append(PK, [pDateCalcTo-DateTo], Pairs),
            get_param_list(Scope, run, Pairs),
            atom_date(DateTo, date(Y, M, _)),
            % и период последнего приема на работу
            get_last_hire(Scope, PK, DateIn),
            % совпадают
            atom_date(DateIn, date(Y, M, _)),
            % то требуется итоговый расчет для текущего месяца
            AvgWage = 0, Variant = by_current_month,
            !.
        calc_avg_wage(Scope, PK, AvgWage, Variant) :-
            % - для начисления по-среднему (нет требуемого количества месяцев)
            Scope = wg_avg_wage_avg,
            % периоды для проверки
            get_periods(Scope, PK, [Y-M|_]),
            atom_date(FirstDate, date(Y, M, 1)),
            % взять дату последнего приема на работу
            get_last_hire(Scope, PK, DateIn),
            % если дата последнего приема на работу не меньше первой даты расчета
            \+ DateIn @< FirstDate,
            % то для расчета нет требуемого количества месяцев
            AvgWage = 0, Variant = no_data,
            !.
        
        % выбор варианта расчета среднедневного заработка
        % - для больничных
        calc_avg_wage_sick(Scope, PK, Periods, AvgWage, Rule) :-
            % от ставки
            Rule = by_rate,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % взять данные по среднедневной ставке (окладу)
            findall( AvgWage0,
                     ( member(Y-M, Periods),
                       atom_date(TheDate, date(Y, M, 1)),
                       get_avg_wage_rate(Scope, PK, TheDate, AvgWage0)
                     ),
            % в список среднедневных заработков
            AvgWageList),
            % среднедневной заработок
            sum_list(AvgWageList, AvgWageAmount),
            length(Periods, MonthQty),
            catch( AvgWage0 is AvgWageAmount / MonthQty, _, AvgWage0 = 0 ),
            AvgWage is round(AvgWage0),
            !.
        calc_avg_wage_sick(Scope, PK, Periods, AvgWage, Rule) :-
            % по среднему заработку
            Rule = by_avg_wage,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять данные по среднедневному заработку
            findall( AvgSumma,
                     ( member(Y-M, Periods),
                       get_data(Scope, kb, usr_wg_AvgWage, [
                                   fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                                   fCalYear-Y, fCalMonth-M, fAvgSumma-AvgSumma])
                     ),
            % в список среднедневных заработков
            AvgSummaList),
            % максимальный среднедневной заработок
            max_list(AvgSummaList, MaxAvgSumma),
            AvgWage is round(MaxAvgSumma),
            !.
        calc_avg_wage_sick(Scope, PK, Periods, AvgWage, Rule) :-
            % по не полным месяцам
            Rule = by_not_full,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % если есть требуемое количество месяцев
            get_param(Scope, run, pMonthQty-MonthQty),
            length(Periods, MonthQty),
            % то выполнить расчет
            % взять заработок
            findall( Wage,
                       % за каждый период проверки
                     ( member(Y1-M1, Periods),
                       % взять данные по заработку
                       get_month_wage(Scope, PK, Y1, M1, _, Wage) ),
            % в список заработков
            Wages ),
            % итоговый заработок
            sum_list(Wages, Amount),
            % взять расчетные дни
            findall( CalcDays,
                       % за каждый период проверки
                     ( member(Y2-M2, Periods),
                       % взять данные по расчетным дням
                       get_month_days_sick(Scope, PK, Y2, M2, _, CalcDays, _, _) ),
            % в список расчетных дней
            CalcDaysList ),
            % всего расчетных дней
            sum_list(CalcDaysList, TotalCalcDays),
            % среднедневной заработок
            catch( AvgWage0 is Amount / TotalCalcDays, _, fail ),
            AvgWage is round(AvgWage0),
            !.
        
        % правила для учета расчетных дней
        % - для больничных
        rule_month_days_sick(Scope, PK, Periods, Rule) :-
            Rule = by_calc_days_total,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            get_param(Scope, run, pLimitDays-LimitDays),
            findall( CalcDays,
                     ( member(Y-M, Periods),
                       get_month_days_sick(Scope, PK, Y, M, _, CalcDays, _, _)
                     ),
            CalcDaysList ),
            sum_list(CalcDaysList, TotalDays),
            % есть требуемое количество дней
            \+ TotalDays < LimitDays,
            !.
        rule_month_days_sick(Scope, PK, Periods, Rule) :-
            Rule = by_calc_days_any,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % есть хотя бы один полный месяц
            member(Y-M, Periods),
            get_month_days_sick(Scope, PK, Y, M, _, _, IsFullMonth, IsSpecMonth),
            ( IsFullMonth = 1 ; IsSpecMonth = 1 ),
            !.
        rule_month_days_sick(Scope, PK, Periods, Rule) :-
            Rule = by_calc_days_all,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % есть рабочие периоды
            \+ Periods = [],
            % все месяцы полные
            is_full_all_month_sick(Scope, PK, Periods),
            !.
        
        % все месяцы полные
        % - для больничных
        is_full_all_month_sick(_, _, []):-
            % все месяцы проверены
            !.
        is_full_all_month_sick(Scope, PK, [Y-M|Periods]) :-
            % есть данные по расчетным дням для полного месяца
            get_month_days_sick(Scope, PK, Y, M, _, _, IsFullMonth, IsSpecMonth),
            ( IsFullMonth = 1 ; IsSpecMonth = 1 ),
            !,
            % проверить остальные месяцы
            is_full_all_month_sick(Scope, PK, Periods).
        
        % подготовка временных данных для расчета
        prep_avg_wage(Scope, PK, Periods) :-
            % формирование временных данных по графику работы
            make_schedule(Scope, PK),
            % периоды для проверки
            get_periods(Scope, PK, Periods),
            % добавление временных данных по расчету дней и часов
            add_month_norm_tab(Scope, PK, Periods),
            % подготовка дополнительных временных данных
            prep_avg_wage_extra(Scope, PK, Periods),
            % добавление временных данных по расчету заработков
            add_month_wage(Scope, PK, Periods),
            !.
        
        % подготовка дополнительных временных данных
        prep_avg_wage_extra(Scope, _, _) :-
            % - для отпусков
            Scope = wg_avg_wage_vacation,
            !.
        prep_avg_wage_extra(Scope, PK, Periods) :-
            % - для больничных
            Scope = wg_avg_wage_sick,
            % добавление временных данных по расчетным дням
            add_month_days_sick(Scope, PK, Periods),
            !.
        prep_avg_wage_extra(Scope, PK, _) :-
            % - для начисления по-среднему
            Scope = wg_avg_wage_avg,
            % подготовка фактов по начислениям
            prep_TblCharge(Scope, PK),
            !.
        
        % подготовка фактов по начислениям
        prep_TblCharge(Scope, PK) :-
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            PredName/Arity = usr_wg_TblCharge/10,
            once( gd_pl_ds(Scope, kb, PredName, Arity, _) ),
            Args = [EmplKey, FirstMoveKey, _, _, DateBegin,
                    Debit, FeeTypeKey, DOW, HOW, PayPeriod],
            Term =.. [PredName|Args],
            catch( Term, _, fail ), \+ PayPeriod < 2,
            Debit1 is round(Debit / PayPeriod),
            % добавление фактов по начислениям
            add_TblCharge(PayPeriod, [PredName, EmplKey, FirstMoveKey],
                            DateBegin, [Debit1, FeeTypeKey], DOW, HOW),
            fail.
        prep_TblCharge(Scope, PK) :-
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            PredName/Arity = usr_wg_TblChargeBonus/8,
            once( gd_pl_ds(Scope, kb, PredName, Arity, _) ),
            PredName1/Arity1 = usr_wg_TblCharge/10,
            once( gd_pl_ds(Scope, kb, PredName1, Arity1, _) ),
            Args = [EmplKey, FirstMoveKey, _, _, DateBegin,
                    Debit, FeeTypeKey, PayPeriod],
            Term =.. [PredName|Args],
            catch( Term, _, fail ), \+ PayPeriod < 2,
            Debit1 is round(Debit / PayPeriod),
            % добавление фактов по начислениям
            add_TblCharge(PayPeriod, [PredName1, EmplKey, FirstMoveKey],
                            DateBegin, [Debit1, FeeTypeKey], 0, 0),
            fail.
        prep_TblCharge(_, _) :-
            !.
        
        % добавление фактов по начислениям
        add_TblCharge(0, _, _, _, _, _) :-
            !.
        add_TblCharge(PayPeriod, List1, DateBegin, List3, DOW, HOW) :-
            atom_date(DateBegin, date(CalYear, CalMonth, _)),
            List2 = [CalYear, CalMonth, DateBegin],
            append([List1, List2, List3, [DOW, HOW, 1]], List),
            Term =.. List, assertz( Term ),
            PayPeriod1 is PayPeriod - 1,
            date_add(DateBegin, 1, month, DateBegin1),
            !,
            add_TblCharge(PayPeriod1, List1, DateBegin1, List3, 0, 0).
        
        % периоды для проверки
        get_periods(Scope, PK, Periods) :-
            % взять временные данные по списку периодов
            get_param_list(Scope, temp, [pPeriods-Periods|PK]),
            !.
        get_periods(Scope, PK, Periods) :-
            % взять даты ограничения расчета
            append(PK, [pDateCalcFrom-DateFrom, pDateCalcTo-DateTo], Pairs1),
            get_param_list(Scope, run, Pairs1),
            % сформировать список периодов
            make_periods(Scope, PK, DateFrom, DateTo, Periods, 0),
            % добавить временные данные по списку периодов
            append(PK, [pPeriods-Periods], Pairs2),
            new_param_list(Scope, temp, Pairs2),
            !.
        
        % сформировать список периодов
        make_periods(_, _, DateFrom, DateTo, [], _) :-
            DateFrom @>= DateTo,
            !.
        make_periods(Scope, PK, DateFrom, DateTo, [Y-M|Periods], NormOption) :-
            atom_date(DateFrom, date(Y, M, _)),
            % период является рабочим
            is_work_period(Scope, PK, Y-M, NormOption),
            % добавить месяц
            date_add(DateFrom, 1, month, DateFrom1),
            !,
            make_periods(Scope, PK, DateFrom1, DateTo, Periods, NormOption).
        make_periods(Scope, PK, DateFrom, DateTo, Periods, NormOption) :-
            % добавить месяц
            date_add(DateFrom, 1, month, DateFrom1),
            !,
            make_periods(Scope, PK, DateFrom1, DateTo, Periods, NormOption).
        
        %  период является рабочим
        is_work_period(_, _, _, NormOption) :-
            % есть признак расчета нормы времени
            NormOption = 1,
            !.
        is_work_period(Scope, PK, Y-M, _) :-
            % календарных дней в месяце
            month_days(Y, M, MonthDays),
            % последняя дата месяца
            atom_date(LastMonthDate, date(Y, M, MonthDays)),
            % определить дату последнего приема на работу
            get_last_hire(Scope, PK, DateIn),
            % если дата приема на работу не больше последней даты месяца
            DateIn @=< LastMonthDate,
            % то период является рабочим
            !.
        
        % добавление временных данных по расчету дней и часов
        add_month_norm_tab(_, _, []):-
            % больше месяцев для проверки нет
            !.
        add_month_norm_tab(Scope, PK, [Y-M|Periods]) :-
            % проверить данные по графику и табелю за месяц
            get_month_norm_tab(Scope, PK, Y-M, _, _, _, _),
            !,
            % проверить остальные месяцы
            add_month_norm_tab(Scope, PK, Periods).
        add_month_norm_tab(Scope, PK, [_|Periods]) :-
            !,
            % проверить остальные месяцы
            add_month_norm_tab(Scope, PK, Periods).
        
        % добавление временных данных по расчету заработков
        add_month_wage(_, _, []):-
            % больше месяцев для проверки нет
            !.
        add_month_wage(Scope, PK, [Y-M|Periods]) :-
            % проверить данные по заработку
            get_month_wage(Scope, PK, Y, M, _, _),
            !,
            % проверить остальные месяцы
            add_month_wage(Scope, PK, Periods).
        add_month_wage(Scope, PK, [_|Periods]) :-
            !,
            % проверить остальные месяцы
            add_month_wage(Scope, PK, Periods).
        
        % взять данные по заработку за месяц
        get_month_wage(Scope, PK, Y, M, MonthModernCoef, ModernWage) :-
            % - для отпусков
            Scope = wg_avg_wage_vacation,
            % взять из временных параметров данные по заработку
            append(PK, [pYM-Y-M, pModernCoef-MonthModernCoef, pModernWage-ModernWage],
                    Pairs),
            get_param_list(Scope, temp, Pairs),
            !.
        get_month_wage(Scope, PK, Y, M, MonthModernCoef, ModernWage) :-
            % - для отпусков
            Scope = wg_avg_wage_vacation,
            % расчитать заработок за месяц
            cacl_month_wage(Scope, PK, Y, M, Wage, MonthModernCoef, ModernWage, SalaryOld, SalaryNew),
            % записать во временные параметры данные по заработку
            append(PK, [pYM-Y-M,
                        pWage-Wage, pModernCoef-MonthModernCoef, pModernWage-ModernWage,
                        pSalaryOld-SalaryOld, pSalaryNew-SalaryNew],
                    Pairs),
            new_param_list(Scope, temp, Pairs),
            !.
        get_month_wage(Scope, PK, Y, M, 1.0, Wage) :-
            % - для больничных
            Scope = wg_avg_wage_sick,
            % взять из временных параметров данные по заработку
            append(PK, [pYM-Y-M, pWage-Wage],
                    Pairs),
            get_param_list(Scope, temp, Pairs),
            !.
        get_month_wage(Scope, PK, Y, M, 1.0, Wage) :-
            % - для больничных
            Scope = wg_avg_wage_sick,
            % расчитать заработок за месяц
            cacl_month_wage_sick(Scope, PK, Y, M, Wage0),
            % контроль заработка за месяц
            check_month_wage_sick(Scope, PK, Y, M, Wage0, Wage),
            % записать во временные параметры данные по заработку
            append(PK, [pYM-Y-M, pWage-Wage], Pairs),
            new_param_list(Scope, temp, Pairs),
            !.
        get_month_wage(Scope, PK, Y, M, 1.0, Wage) :-
            % - для начисления по-среднему
            Scope = wg_avg_wage_avg,
            % взять из временных параметров данные по заработку
            append(PK, [pYM-Y-M, pWage-Wage],
                    Pairs),
            get_param_list(Scope, temp, Pairs),
            !.
        get_month_wage(Scope, PK, Y, M, 1.0, Wage) :-
            % - для начисления по-среднему
            Scope = wg_avg_wage_avg,
            % расчитать заработок за месяц
            %cacl_month_wage_avg(Scope, PK, Y, M, Wage),
            % по методу для Больничных
            cacl_month_wage_sick(Scope, PK, Y, M, Wage),
            % записать во временные параметры данные по заработку
            append(PK, [pYM-Y-M, pWage-Wage], Pairs),
            new_param_list(Scope, temp, Pairs),
            !.
        
        % контроль заработка за месяц
        check_month_wage_sick(Scope, PK, Y, M, Wage, MonthAvgSalary) :-
            % для декрета
            get_param_list(Scope, run, [pIsPregnancy-1 | PK]),
            % если в периодах
            get_periods(Scope, PK, Periods),
            % есть хоть один месяц
            Periods = [_|_],
            % но нет требуемого количества месяцев
            get_param(Scope, run, pMonthQty-MonthQty),
            \+ length(Periods, MonthQty),
            % взять среднюю зп по РБ
            atom_date(FirstMonthDate, date(Y, M, 1)),
            date_add(FirstMonthDate, 1, month, FirstMonthDate1),
            atom_date(FirstMonthDate1, date(Y1, M1, 1)),
            get_avg_salary_rb(Scope, Y1-M1, MonthAvgSalary0),
            % взять данные по расчетным дням
            get_month_days_sick(Scope, PK, Y, M, MonthDays, CalcDays, IsFullMonth, _),
            % сделать контроль превышения
            ( IsFullMonth =:= 1
             -> MonthAvgSalary is round(MonthAvgSalary0)
            ; MonthAvgSalary is round(MonthAvgSalary0 / MonthDays * CalcDays)
            ),
            Wage > MonthAvgSalary,
            !.
        check_month_wage_sick(_, _, _, _, Wage, Wage) :-
            !.
        
        % расчитать заработок за месяц
        % - для отпусков
        cacl_month_wage(Scope, PK, Y, M, Wage, MonthModernCoef, ModernWage, SalaryOld, SalaryNew) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            findall( ChargeOption-Debits0,
            (
            % параметры выбора начислений
            member(ChargeOption, [tbl_charge, dbf_sums]),
            % взять начисления
            findall( Debit-ModernCoef-SalaryOld0-SalaryNew0,
                  % для начисления по одному из параметров
                  % где дата совпадает с проверяемым месяцем
                  ( usr_wg_TblCharge_mix(Scope, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fCalYear-Y, fCalMonth-M, fDateBegin-TheDay,
                        fDebit-Debit, fFeeTypeKey-FeeTypeKey ],
                                            ChargeOption),
                  % и соответствующего типа
                  once( ( var(FeeTypeKey)
                        ; get_data(Scope, kb, usr_wg_FeeType, [
                                    fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                                    fFeeTypeKey-FeeTypeKey ])
                        ; FeeTypeKey < 10
                        )
                      ),
                  % с коэффициентом осовременивания
                  get_modern_coef(Scope, PK, TheDay, FeeTypeKey, ModernCoef, SalaryOld0, SalaryNew0)
                  ),
            % в список начислений
            Debits0 )
            ),
            Debits0List ),
            % сформировать список начислений
            ( Debits0List = [tbl_charge-Debits1, dbf_sums-[]] ->
              Debits = Debits1
            ; Debits0List = [tbl_charge-Debits1, dbf_sums-Debits2],
              append([Debits1, Debits2], Debits)
            ),
            % всего за месяц
            sum_month_debit(Debits, Wage, ModernWage0),
            % средний за месяц коэффициент осовременивания
            catch( MonthModernCoef0 is ModernWage0 / Wage, _, fail),
            to_currency(MonthModernCoef0, MonthModernCoef, 2),
            % осовремененный заработок
            ModernWage is round(Wage * MonthModernCoef),
            % старый и новый оклады
            ( setof( SalaryOld0-SalaryNew0,
                    Debit ^ ModernCoef ^ member(Debit-ModernCoef-SalaryOld0-SalaryNew0, Debits),
                    [SalaryOld-SalaryNew]
                   )
            ; [SalaryOld-SalaryNew] = [0-0]
            ),
            !.
        
        % итого зарплата и осовремененная зарплата за месяц
        % - для отпусков
        sum_month_debit(Debits, Wage, ModernWage) :-
            sum_month_debit(Debits, Wage, ModernWage, 0, 0),
            !.
        %
        sum_month_debit([], Wage, ModernWage, Wage, ModernWage) :-
            !.
        sum_month_debit([Debit-ModernCoef-_-_ | Debits], Wage, ModernWage, Wage0, ModernWage0) :-
            Wage1 is Wage0 + Debit,
            ModernWage1 is ModernWage0 + Debit * ModernCoef,
            !,
            sum_month_debit(Debits, Wage, ModernWage, Wage1, ModernWage1).
        
        % коэффициент осовременивания
        get_modern_coef(Scope, PK, _, FeeTypeKey, 1.0, 0, 0) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % проверить тип начисления на исключение для осовременивания
            get_data(Scope, kb, usr_wg_FeeTypeNoCoef, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fFeeTypeKeyNoCoef-FeeTypeKey ]),
            !.
        get_modern_coef(Scope, PK, TheDay, _, ModernCoef, SalaryOld, SalaryNew) :-
            % взять параметр коэфициента и дату ограничения расчета
            append(PK, [pDateCalc-DateTo, pCoefOption-CoefOption], Pairs),
            get_param_list(Scope, run, Pairs),
            % сформировать дату ограничения выплаты
            date_add(DateTo, 1, month, DateTo1),
            % сформировать список движений дата-сумма
            findall( Date-Amount,
                     get_modern_coef_data(PK, Scope, Date, Amount, CoefOption, DateTo1),
            Movements ),
            % вычислить коэффициент
            calc_modern_coef(TheDay, Movements, ModernCoef, SalaryOld, SalaryNew),
            !.
        
        % взять данные для расчета коэфициента осовременивания
        %
        get_modern_coef_data(PK, Scope, Date, FCRateSum, CoefOption, DateTo) :-
            % справочник базовых величин - тарифная ставка 1-го разряда
            nonvar(CoefOption), CoefOption = fc_fcratesum,
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять данные из справочника по ставке
            get_data(Scope, kb, usr_wg_FCRate, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fDate-Date, fFCRateSum-FCRateSum ]),
            % где дата меньше расчетной
            Date @< DateTo.
        %
        get_modern_coef_data(PK, Scope, DateBegin, Rate, CoefOption, DateTo) :-
            % движение - тарифная ставка 1-го разряда
            nonvar(CoefOption), CoefOption = ml_rate,
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять данные из движения по ставке
            get_data(Scope, kb, usr_wg_MovementLine, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fDateBegin-DateBegin, fRate-Rate ]),
            % где дата меньше расчетной
            DateBegin @< DateTo.
        %
        get_modern_coef_data(PK, Scope, DateBegin, MSalary, CoefOption, DateTo) :-
            % движение - оклад
            nonvar(CoefOption), CoefOption = ml_msalary,
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять данные из движения по окладу
            get_data(Scope, kb, usr_wg_MovementLine, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fDateBegin-DateBegin, fMSalary-MSalary ]),
            % где дата меньше расчетной
            DateBegin @< DateTo.
        
        % вычислить коэффициент
        calc_modern_coef(_, [ _-Rate | [] ], 1.0, Rate, Rate) :-
            % если последнее движение, то коэффициент 1
            !.
        calc_modern_coef(TheDay, [ Date1-Rate1, Date2-Rate2 | Movements ], ModernCoef, Rate1, RateLast) :-
            % если проверяемая дата больше или равна даты текущего движения
            TheDay @>= Date1,
            % и меньше даты следующего движения
            TheDay @< Date2,
            % то взять последнюю ставку из следующего и всех оставшихся движений
            last([Date2-Rate2 | Movements], _-RateLast),
            % и вычислить коэффициент для текущего движения
            catch( ModernCoef0 is RateLast / Rate1, _, fail),
            ( ModernCoef0 < 1.0, ModernCoef = 1.0 ; ModernCoef = ModernCoef0 ),
            !.
        calc_modern_coef(TheDay, [ _ | Movements ], ModernCoef, Rate, RateLast) :-
            % проверить для остальных движений
            !,
            calc_modern_coef(TheDay, Movements, ModernCoef, Rate, RateLast).
        
        % расчитать заработок за месяц
        % - для больничных
        cacl_month_wage_sick(Scope, PK, Y, M, Wage) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            findall( ChargeOption-Debits0,
            (
            % параметры выбора начислений
            member(ChargeOption, [tbl_charge, dbf_sums]),
            % взять начисления
            findall( Debit-FeeTypeKey,
                  % для начисления по одному из параметров
                  % где дата совпадает с проверяемым месяцем
                  ( usr_wg_TblCharge_mix(Scope, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fCalYear-Y, fCalMonth-M, fDateBegin-_,
                        fDebit-Debit, fFeeTypeKey-FeeTypeKey ],
                                            ChargeOption),
                  % и соответствующего типа
                  once( ( var(FeeTypeKey)
                        ; get_data(Scope, kb, usr_wg_FeeType, [
                                    fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                                    fFeeTypeKey-FeeTypeKey ])
                        ; FeeTypeKey < 10
                        )
                      )
                  ),
            % в список начислений
            Debits0 )
            ),
            Debits0List ),
            % сформировать список начислений
            ( Debits0List = [tbl_charge-Debits1, dbf_sums-[]] ->
              Debits = Debits1
            ; Debits0List = [tbl_charge-Debits1, dbf_sums-Debits2],
              append([Debits1, Debits2], Debits)
            ),
            % всего за месяц
            sum_month_debit_sick(Scope, PK, Y, M, Debits, Wage),
            !.
        cacl_month_wage_sick(_, _, _, _, 0.0) :-
            !.
        
        % итого зарплата за месяц
        % - для больничных
        sum_month_debit_sick(Scope, PK, Y, M, Debits, Wage) :-
            % расчитать сумму начислений
            sum_month_debit_sick(Scope, PK, Y, M, Debits, Wage, 0.0),
            !.
        %
        sum_month_debit_sick(_, _, _, _, [], Wage, Wage) :-
            !.
        sum_month_debit_sick(Scope, PK, Y, M, [Debit-FeeTypeKey | Debits], Wage, Wage0) :-
            nonvar(FeeTypeKey),
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % тип начисления для пропорционального расчета
            ( get_data(Scope, kb, usr_wg_FeeTypeProp, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fFeeTypeKeyProp-FeeTypeKey ])
            -> true
            ; FeeTypeKey = 1 ),
            % взять коэфициент для пропорционального начисления
            get_prop_coef(Scope, PK, Y, M, PropCoef),
            % пропорциональный расчет
            Debit1 is round(Debit * PropCoef),
            Wage1 is Wage0 + Debit1,
            !,
            sum_month_debit_sick(Scope, PK, Y, M, Debits, Wage, Wage1).
        sum_month_debit_sick(Scope, PK, Y, M, [Debit-_ | Debits], Wage, Wage0) :-
            % обычный расчет
            Wage1 is Wage0 + Debit,
            !,
            sum_month_debit_sick(Scope, PK, Y, M, Debits, Wage, Wage1).
        
        % взять коэфициент для пропорционального начисления
        get_prop_coef(Scope, PK, Y, M, PropCoef) :-
            % взять данные по графику и табелю за месяц
            get_month_norm_tab(Scope, PK, Y-M, NDays, TDays, NHoures, THoures),
            % расчитать коэфициент для пропорционального начисления
            calc_prop_coef(TDays, NDays, THoures, NHoures, PropCoef),
            !.
        
        % расчитать коэфициент для пропорционального начисления
        
        calc_prop_coef(TabDays, NormDays, TabHoures, NormHoures, PropCoef) :-
            ( TabDays =:= 0,
              NormHoures > 0
             ->
              PropCoef is TabHoures / NormHoures
            ; TabDays > 0,
              NormDays > 0,
              PropCoef is TabDays / NormDays
            ),
            \+ PropCoef > 1.0,
            !.
        calc_prop_coef(_, _, _, _, 1.0) :-
            !.
        
        % добавление временных данных по расчетным дням
        % - для больничных
        add_month_days_sick(_, _, []):-
            % больше месяцев для проверки нет
            !.
        add_month_days_sick(Scope, PK, [Y-M|Periods]) :-
            % проверить данные по расчетным дням
            get_month_days_sick(Scope, PK, Y, M, _, _, _, _),
            !,
            % проверить остальные месяцы
            add_month_days_sick(Scope, PK, Periods).
        add_month_days_sick(Scope, PK, [_|Periods]) :-
            !,
            % проверить остальные месяцы
            add_month_days_sick(Scope, PK, Periods).
        
        % взять данные по расчетным дням
        % - для больничных
        get_month_days_sick(Scope, PK, Y, M, MonthDays, CalcDays, IsFullMonth, IsSpecMonth) :-
            % взять из временных параметров данные по расчетным дням
            append(PK, [pYM-Y-M, pRule-_,
                        pMonthDays-MonthDays, pExclDays-_,
                        pCalcDays-CalcDays, pIsFullMonth-IsFullMonth,
                        pIsSpecMonth-IsSpecMonth],
                    Pairs),
            get_param_list(Scope, temp, Pairs),
            !.
        get_month_days_sick(Scope, PK, Y, M, MonthDays, CalcDays, IsFullMonth, IsSpecMonth) :-
            % календарных дней в месяце
            month_days(Y, M, MonthDays),
            % исключаемые из месяца дни по правилам
            excl_month_days_sick(Scope, PK, Y, M, ExclDays0, SpecExclDays, Variant),
            % исключаемые из первого месяца работы дни
            excl_first_month_days_sick(Scope, PK, Y, M, ExclDays1),
            % исключаемые дни
            ExclDays is ExclDays0 + ExclDays1,
            % расчетные дни
            CalcDays is MonthDays - ExclDays,
            % полнота месяца
            ( CalcDays = MonthDays -> IsFullMonth = 1 ; IsFullMonth = 0 ),
            % все дни для исключения специальные
            ( ExclDays = SpecExclDays -> IsSpecMonth = 1 ; IsSpecMonth = 0 ),
            % записать во временные параметры данные по расчетным дням
            append(PK, [pYM-Y-M, pRule-Variant,
                        pMonthDays-MonthDays, pExclDays-ExclDays,
                        pCalcDays-CalcDays, pIsFullMonth-IsFullMonth,
                        pIsSpecMonth-IsSpecMonth],
                    Pairs),
            new_param_list(Scope, temp, Pairs),
            !.
        
        % исключаемые из месяца дни
        % - для больничных
        excl_month_days_sick(Scope, PK, Y, M, ExclDays, SpecExclDays, Rule) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % параметры выбора табеля
            member(TabelOption-Rule, [tbl_cal_flex-by_cal_flex, tbl_cal-by_cal]),
            % есть данные в табеле
            usr_wg_TblCalLine_mix(Scope, PK, Y-M, _, _, _, _, TabelOption),
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % взять данные из табеля
            findall( ExclType,
                      % для проверяемого месяца
                    ( usr_wg_TblCalLine_mix(Scope, PK, Y-M, _, _, _, HoureType, TabelOption),
                      % с контролем наличия типа часов
                      HoureType > 0,
                      % по типу часов для исключения из расчета
                      once( get_data(Scope, kb, usr_wg_HourType, [
                                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                                        fID-HoureType, fExcludeForSickList-1,
                                        fExclType-ExclType] ) )
                    ),
            % в список дней для исключения
            ExclDaysList),
            % проверить список дней для исключения
            \+ ExclDaysList = [],
            % всего дней для исключения
            length(ExclDaysList, ExclDays),
            % сбор специальных исключаемых дней
            findall( SpecExclType,
                    ( member(SpecExclType, ExclDaysList),
                      memberchk(SpecExclType, ["kind_day"]) ),
            SpecExclDaysList),
            % всего специальных дней для исключения
            length(SpecExclDaysList, SpecExclDays),
            !.
        excl_month_days_sick(Scope, PK, Y, M, ExclDays, SpecExclDays, Rule) :-
            Rule = by_orders,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % нет данных в табеле
            \+ usr_wg_TblCalLine_mix(Scope, PK, Y-M, _, _, _, _, tbl_cal_flex),
            \+ usr_wg_TblCalLine_mix(Scope, PK, Y-M, _, _, _, _, tbl_cal),
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять данные
            findall( exlc_days([FromDate, ToDate, ExclType, OrderType, ExclWeekDay]),
                     % из приказов по дням исключения
                     get_data(Scope, kb, usr_wg_ExclDays, [
                                fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                                fExclType-ExclType, fOrderType-OrderType,
                                fExclWeekDay-ExclWeekDay,
                                fFromDate-FromDate, fToDate-ToDate] ),
            % в список периодов для исключения
            ExclPeriods),
            % сбор исключаемых дней по списку периодов
            collect_excl_days(ExclPeriods, Y, M, [], LogDays, []),
            % всего дней для исключения
            length(LogDays, ExclDays),
            \+ ExclDays =:= 0,
            % сбор специальных исключаемых дней по списку периодов
            collect_excl_days(ExclPeriods, Y, M, [], LogSpecDays, ["KINDDAYLINE"]),
            % всего специальных дней для исключения
            length(LogSpecDays, SpecExclDays),
            !.
        excl_month_days_sick(_, _, _, _, 0, 0, none) :-
            !.
        
        % сбор исключаемых дней по списку периодов
        collect_excl_days([], _, _, LogDays, LogDays, _) :-
            !.
        collect_excl_days([ExclPeriod|ExclPeriods], Y, M, LogDays0, LogDays2, SpecList) :-
            % сбор исключаемых дней за период
            collect_excl_days(ExclPeriod, Y, M, LogDays0, LogDays1, SpecList),
            !,
            collect_excl_days(ExclPeriods, Y, M, LogDays1, LogDays2, SpecList).
        
        % сбор исключаемых дней за период
        collect_excl_days(exlc_days([FromDate, ToDate | _]), _, _, LogDays, LogDays, _) :-
            FromDate @> ToDate,
            !.
        collect_excl_days(exlc_days([FromDate0|ExclDays]), Y, M, LogDays0, LogDays2, SpecList) :-
            \+ atom_date(FromDate0, date(Y, M, _)),
            date_add(FromDate0, 1, day, FromDate1),
            !,
            collect_excl_days(exlc_days([FromDate1|ExclDays]), Y, M, LogDays0, LogDays2, SpecList).
        collect_excl_days(exlc_days([FromDate0, ToDate, ExclType | ExclDays]), Y, M, LogDays0, LogDays2, SpecList) :-
            % добавление дня для исключения в журнал
            ( ( SpecList = [] ; memberchk(ExclType, SpecList) )
            -> add_excl_day(exlc_days([FromDate0, ExclType | ExclDays]), LogDays0, LogDays1)
            ; true ),
            date_add(FromDate0, 1, day, FromDate1),
            !,
            collect_excl_days(exlc_days([FromDate1, ToDate, ExclType | ExclDays]), Y, M, LogDays1, LogDays2, SpecList).
        
        % добавление дня для исключения в журнал
        add_excl_day(exlc_days([TheDate|_]), LogDays, LogDays) :-
            % при наличии даты в журнале
            memberchk(TheDate, LogDays),
            % журнал не изменять
            !.
        add_excl_day(exlc_days([TheDate, ExclType, OrderType | _]), LogDays, LogDays) :-
            % праздник из отпуска
            ExclType = "LEAVEDOCLINE",
            catch( wg_holiday(TheDate), _, fail ),
            % трудовой отпуск
            OrderType = 1,
            % в журнал не заносить
            !.
        add_excl_day(exlc_days([TheDate, ExclType, _, ExclWeekDay]), LogDays, [TheDate|LogDays]) :-
            % детский день согласно дню недели
            ExclType = "KINDDAYLINE",
            weekday(TheDate, ExclWeekDay),
            % занести в журнал
            !.
        add_excl_day(exlc_days([_, ExclType | _]), LogDays, LogDays) :-
            % прочие даты из приказа о детском дне
            ExclType = "KINDDAYLINE",
            % пропускать
            !.
        add_excl_day(exlc_days([TheDate|_]), LogDays, [TheDate|LogDays]) :-
            % дату для прочих случаев занести в журнал
            !.
        
        % исключаемые из первого месяца работы дни
        % - для больничных
        excl_first_month_days_sick(Scope, PK, Y, M, ExclDays) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % для первого движения по типу 1 (прием на работу)
            % где дата совпадает с проверяемым месяцем
            get_data(Scope, kb, usr_wg_MovementLine, [
                fEmplKey-EmplKey, fDocumentKey-FirstMoveKey, fFirstMoveKey-FirstMoveKey,
                fMoveYear-Y, fMoveMonth-M, fDateBegin-DateBegin, fMovementType-1 ]),
            % и является датой последнего приема на работу
            get_last_hire(Scope, PK, DateBegin),
            % исключить дни до принятия на работу
            atom_date(FirstMonthDate, date(Y, M, 1)),
            date_diff(FirstMonthDate, ExclDays, DateBegin),
            !.
        excl_first_month_days_sick(_, _, _, _, 0) :-
            !.
        
        % расчитать заработок за месяц
        % - для начисления по-среднему
        cacl_month_wage_avg(Scope, PK, Y, M, Wage) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            findall( ChargeOption-Debits0,
            (
            % параметры выбора начислений
            member(ChargeOption, [tbl_charge, dbf_sums]),
            % взять начисления
            findall( Debit,
                  % для начисления по одному из параметров
                  % где дата совпадает с проверяемым месяцем
                  ( usr_wg_TblCharge_mix(Scope, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                        fCalYear-Y, fCalMonth-M, fDateBegin-_,
                        fDebit-Debit, fFeeTypeKey-FeeTypeKey ],
                                            ChargeOption),
                  % и соответствующего типа
                  once( ( var(FeeTypeKey)
                        ; get_data(Scope, kb, usr_wg_FeeType, [
                                    fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                                    fFeeTypeKey-FeeTypeKey ])
                        ; FeeTypeKey < 10
                        )
                      )
                  ),
            % в список начислений
            Debits0 )
            ),
            Debits0List ),
            % сформировать список начислений
            ( Debits0List = [tbl_charge-Debits1, dbf_sums-[]] ->
              Debits = Debits1
            ; Debits0List = [tbl_charge-Debits1, dbf_sums-Debits2],
              append([Debits1, Debits2], Debits)
            ),
            % всего за месяц
            sum_list(Debits, Wage),
            !.
        cacl_month_wage_avg(_, _, _, _, 0.0) :-
            !.
        
        % месяц работы полный
        is_full_month(Scope, PK, Y-M) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % для первого движения по типу 1 (прием на работу)
            % где дата совпадает с проверяемым месяцем
            get_data(Scope, kb, usr_wg_MovementLine, [
                fEmplKey-EmplKey, fDocumentKey-FirstMoveKey, fFirstMoveKey-FirstMoveKey,
                fMoveYear-Y, fMoveMonth-M, fDateBegin-DateBegin, fMovementType-1 ]),
            % и является датой последнего приема на работу
            get_last_hire(Scope, PK, DateBegin),
            !,
            % параметры выбора графика
            member(NormOption, [tbl_cal_flex, tbl_day_norm]),
            % первый рабочий день по графику для проверяемого месяца
            once( usr_wg_TblDayNorm_mix(Scope, PK, Y-M, TheDay, _, 1, NormOption) ),
            !,
            % больше или равен дате первого движения
            TheDay @>= DateBegin,
            % то первый месяц работы полный
            !.
        is_full_month(_, _, _) :-
            % проверяемый месяц не является первым месяцем работы
            !.
        
        % в месяце есть отработанные дни или часы
        is_month_worked(Scope, PK, Y-M) :-
            % если есть хотя бы один рабочий день
            usr_wg_TblCalLine_mix(Scope, PK, Y-M, _, DOW, HOW, _, _),
            % с контролем наличия дней или часов
            once( (DOW > 0 ; HOW > 0 ) ),
            % то в месяце есть отработанные дни или часы
            !.
        
        % в месяце есть оплата
        is_month_paid(Scope, PK, Y-M) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % если есть хотя бы одно начисление
            usr_wg_TblCharge_mix(Scope, [
                fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                fCalYear-Y, fCalMonth-M, fDateBegin-_,
                fDebit-Debit, fFeeTypeKey-FeeTypeKey ],
                                    _),
            % с контролем суммы
            Debit > 0,
            % соответствующего типа
            ( var(FeeTypeKey)
            ; once( get_data(Scope, kb, usr_wg_FeeType, [
                            fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                            fFeeTypeKey-FeeTypeKey ]) )
            ; FeeTypeKey < 10
            ),
            % то в месяце есть оплата
            !.
        
        % взять расчетный месяц
        get_month_incl(Scope, PK, Y, M, Variant) :-
            append(PK, [pMonthIncl-MonthInclList], Pairs),
            get_param_list(Scope, temp, Pairs),
            member(Y-M-Variant, MonthInclList).
        
        % принять месяц для исчисления
        take_month_incl(Scope, PK, Y, M, Variant) :-
            append(PK, [pMonthIncl-MonthInclList], Pairs),
            get_param_list(Scope, temp, Pairs),
            keysort([Y-M-Variant | MonthInclList], MonthInclList1),
            append(PK, [pMonthIncl-MonthInclList1], Pairs1),
            dispose_param_list(Scope, temp, Pairs),
            new_param_list(Scope, temp, Pairs1),
            !.
        take_month_incl(Scope, PK, Y, M, Variant) :-
            append(PK, [pMonthIncl-[Y-M-Variant]], Pairs),
            new_param_list(Scope, temp, Pairs),
            !.
        
        % проверка месяца по табелю
        % - для отпусков
        check_month_tab(_, _, []):-
            % больше месяцев для проверки нет
            !.
        check_month_tab(Scope, PK, [Y-M|Periods]) :-
            % месяц работы полный
            is_full_month(Scope, PK, Y-M),
            % в месяце есть отработанные дни или часы
            is_month_worked(Scope, PK, Y-M),
            % в месяце есть оплата
            is_month_paid(Scope, PK, Y-M),
            % и выполняется одно из правил
            rule_month_tab(Scope, PK, Y-M, Variant),
            % то принять месяц для исчисления
            take_month_incl(Scope, PK, Y, M, Variant),
            !,
            % проверить остальные месяцы
            check_month_tab(Scope, PK, Periods).
        check_month_tab(Scope, PK, [_|Periods]) :-
            !,
            % проверить остальные месяцы
            check_month_tab(Scope, PK, Periods).
        
        % правила включения месяца в расчет
        rule_month_tab(Scope, PK, Y-M, Rule) :-
            % по дням и часам за месяц
            Rule = by_days_houres,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % взять данные по графику и табелю за месяц
            get_month_norm_tab(Scope, PK, Y-M, NDays, TDays, NHoures, THoures),
            % если табель равен графику по дням и часам
            TDays =:= NDays, THoures =:= NHoures,
            % то месяц включается в расчет
            !.
        rule_month_tab(Scope, PK, Y-M, Rule) :-
            % по часам за месяц
            Rule = by_houres,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % взять данные по графику и табелю за месяц
            get_month_norm_tab(Scope, PK, Y-M, _, _, NHoures, THoures),
            % если табель покрывает график по часам
            THoures >= NHoures,
            % то месяц включается в расчет
            !.
        rule_month_tab(Scope, PK, Y-M, Rule) :-
            % по дням за месяц
            Rule = by_days,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % взять данные по графику и табелю за месяц
            get_month_norm_tab(Scope, PK, Y-M, NDays, TDays, _, _),
            % если табель покрывает график по дням
            TDays >= NDays,
            % то месяц включается в расчет
            !.
        
        % взять данные по графику и табелю за месяц
        get_month_norm_tab(Scope, PK, Y-M, NDays, TDays, NHoures, THoures) :-
            % взять из временных параметров дни и часы
            append(PK, [pYM-Y-M,
                        pTDays-TDays, pTHoures-THoures,
                        pNDays-NDays, pNHoures-NHoures],
                        Pairs),
            get_param_list(Scope, temp, Pairs),
            !.
        get_month_norm_tab(Scope, PK, Y-M, NDays, TDays, NHoures, THoures) :-
            % расчитать график и табель за месяц
            calc_month_norm_tab(Scope, PK, Y-M, NDays, TDays, NHoures, THoures),
            % записать во временные параметры дни и часы
            append(PK, [pYM-Y-M,
                        pTDays-TDays, pTHoures-THoures,
                        pNDays-NDays, pNHoures-NHoures],
                        Pairs),
            new_param_list(Scope, temp, Pairs),
            !.
        
        % расчитать график и табель за месяц
        calc_month_norm_tab(Scope, PK, Y-M, NDays, TDays, NHoures, THoures) :-
            % расчитать график за месяц
            calc_month_norm(Scope, PK, Y-M, [tbl_cal_flex, tbl_day_norm], NormDays),
            % сумма дней и часов по графику
            sum_days_houres(NormDays, NDays, NHoures),
            % расчитать табель за месяц
            calc_month_tab(Scope, PK, Y-M, TabDays),
            % сумма дней и часов по табелю
            sum_days_houres(TabDays, TDays, THoures),
            !.
        
        % расчитать график за месяц по одному из параметров
        calc_month_norm(Scope, PK, Y-M, NormOptionList, NormDays) :-
            % параметры выбора графика
            member(NormOption, NormOptionList),
            % взять дату/часы
            findall( TheDay-1-WDuration,
                    % для рабочего дня
                    ( usr_wg_TblDayNorm_mix(Scope, PK, Y-M, TheDay, WDuration, 1, NormOption),
                    % с контролем наличия часов
                    WDuration > 0 ),
            % в список дата/часы графика
            NormDays),
            % проверить список графика
            \+ NormDays = [],
            !.
        calc_month_norm(_, _, _, _, []) :-
            !.
        
        % расчитать график за год по одному из параметров
        calc_year_norm(Scope, PK, NormDays) :-
            get_norm_periods(Scope, PK, Periods),
            calc_year_norm(Periods, Scope, PK, [], NormDays),
            !.
        %
        calc_year_norm([], _, _, NormDays, NormDays) :-
            !.
        calc_year_norm([Y-M|Periods], Scope, PK, NormDays0, NormDays) :-
            calc_month_norm(Scope, PK, Y-M, [tbl_day_norm], NormDays1),
            append(NormDays0, NormDays1, NormDays2),
            !,
            calc_year_norm(Periods, Scope, PK, NormDays2, NormDays).
        
        % нормативные периоды
        get_norm_periods(Scope, PK, Periods) :-
            % взять нормативные даты ограничения расчета
            append(PK, [pDateNormFrom-DateFrom, pDateNormTo-DateTo], Pairs),
            get_param_list(Scope, run, Pairs),
            % сформировать список периодов
            make_periods(Scope, PK, DateFrom, DateTo, Periods, 1),
            !.
        
        % проверка месяца по заработку
        % - для отпусков
        check_month_wage(_, _, []):-
            % больше месяцев для проверки нет
            !.
        check_month_wage(Scope, PK, [Y-M|Periods]) :-
            % если месяц еще не включен в расчет
            \+ get_month_incl(Scope, PK, Y, M, _),
            % и выполняется одно из правил
            rule_month_wage(Scope, PK, Y-M, Variant),
            % то принять месяц для исчисления
            take_month_incl(Scope, PK, Y, M, Variant),
            !,
            % проверить следующий месяц
            check_month_wage(Scope, PK, Periods).
        check_month_wage(Scope, PK, [_|Periods]) :-
            !,
            % проверить следующий месяц
            check_month_wage(Scope, PK, Periods).
        
        % заработок за месяц в сравнении с полными месяцами
        rule_month_wage(Scope, PK, Y-M, Rule) :-
            Shapes = [
                      % покрывает любой из полных месяцев
                      by_month_wage_any - wage_over_any,
                      % покрывает каждый из полных месяцев
                      by_month_wage_all - wage_over_list
                      ],
            member(Rule - Condition, Shapes),
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % варианты правил полных месяцев
            wg_full_month_rules(FullMonthRules),
            % взять заработок и коэффициент осовременивания за проверяемый месяц
            get_month_wage(Scope, PK, Y, M, ModernCoef, Wage),
            % взять заработок
            findall( Wage1,
                      % для расчетного месяца
                    ( get_month_incl(Scope, PK, Y1, M1, Variant1),
                      % который принят для исчисления по варианту полного месяца
                      memberchk(Variant1, FullMonthRules),
                      % с заработком и коэффициентом осовременивания за месяц
                      get_month_wage(Scope, PK, Y1, M1, ModernCoef1, Wage1),
                      % где коэффициенты для проверяемого и расчетного равны
                      ModernCoef =:= ModernCoef1 ),
            % в список заработков
            Wages1 ),
            % если заработок проверяемого месяца соответствует условию
            Term =.. [Condition, Wage, Wages1], Term,
            % то месяц включается в расчет
            !.
        
        % заработок покрывает любое значение из списка
        wage_over_any(Over, [Head|_]) :-
            Over >= Head,
            !.
        wage_over_any(Over, [_|Tail]) :-
            !,
            wage_over_any(Over, Tail).
        
        % заработок покрывает все значения из списка
        wage_over_list(Over, [Head|[]]) :-
            Over >= Head,
            !.
        wage_over_list(Over, [Head|Tail]) :-
            Over >= Head,
            !,
            wage_over_list(Over, Tail).
        
        % проверка месяца по типу начислений и типу часов
        % - для отпусков
        check_month_no_bad_type(_, _, []):-
            % больше месяцев для проверки нет
            !.
        check_month_no_bad_type(Scope, PK, [Y-M|Periods]) :-
            % если месяц еще не включен в расчет
            \+ get_month_incl(Scope, PK, Y, M, _),
            % месяц работы полный
            is_full_month(Scope, PK, Y-M),
            % в месяце есть оплата
            is_month_paid(Scope, PK, Y-M),
            % и выполняется одно из правил
            rule_month_no_bad_type(Scope, PK, Y-M, Variant),
            % то принять месяц для исчисления
            take_month_incl(Scope, PK, Y, M, Variant),
            !,
            % проверить следующий месяц
            check_month_no_bad_type(Scope, PK, Periods).
        check_month_no_bad_type(Scope, PK, [_|Periods]) :-
            !,
            % проверить следующий месяц
            check_month_no_bad_type(Scope, PK, Periods).
        
        % отсутствие плохих типов начислений и часов
        rule_month_no_bad_type(Scope, PK, Y-M, Rule) :-
            Rule = by_month_no_bad_type,
            % правило действительно
            is_valid_rule(Scope, PK, _, Rule),
            % если нет плохих типов начислений и часов
            \+ month_bad_type(Scope, PK, Y-M),
            % то месяц включается в расчет
            !.
        
        % есть плохой тип часов
        month_bad_type(Scope, PK, Y-M) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % если есть хотя бы один день по табелю
            usr_wg_TblCalLine_mix(Scope, PK, Y-M, _, _, _, HoureType, _),
            % с плохим типом часов
            nonvar(HoureType),
            HoureType > 0,
            once( get_data(Scope, kb, usr_wg_BadHourType, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey, fID-HoureType]) ),
            !.
        % есть плохой тип начислений
        month_bad_type(Scope, PK, Y-M) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % если есть хотя бы одно начисление
            % где дата совпадает с проверяемым месяцем
            usr_wg_TblCharge_mix(Scope, [
                fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                fCalYear-Y, fCalMonth-M, fDateBegin-_,
                fDebit-_, fFeeTypeKey-FeeTypeKey ],
                                    _),
            % с плохим типом начисления
            nonvar(FeeTypeKey),
            FeeTypeKey > 0,
            once( get_data(Scope, kb, usr_wg_BadFeeType, [
                        fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey, fID-FeeTypeKey]) ),
            !.
        
        /* реализация - механизм подготовки данных */
        
        %% engine_loop(+Scope, +Type, +PK)
        %
        
        % args handler
        engine_loop(Scope, Type, PK) :-
            \+ ground([Scope, Type, PK]),
            !,
            fail.
        % fail handler
        engine_loop(Scope, _, PK) :-
            engine_fail_step(Type),
            get_param_list(Scope, Type, PK),
            !,
            fail.
        % deal handler
        engine_loop(Scope, Type, PK) :-
            engine_deal_step(Type),
            !,
            get_param_list(Scope, Type, PK),
            !.
        % data handler
        engine_loop(Scope, Type, PK) :-
            engine_data_step(Type, TypeNextStep),
            get_param_list(Scope, Type, PK),
            \+ get_param_list(Scope, TypeNextStep, PK),
            prepare_data(Scope, Type, PK, TypeNextStep),
            !,
            engine_loop(Scope, TypeNextStep, PK).
        engine_loop(Scope, Type, PK) :-
            engine_data_step(Type, TypeNextStep),
            !,
            engine_loop(Scope, TypeNextStep, PK).
        % restart handler
        engine_loop(Scope, Type, PK) :-
            engine_restart_step(Type, TypeNextStep),
            forall( ( get_param_list(Scope, ParamType, PK, Pairs),
                      \+ ParamType = TypeNextStep ),
                    dispose_param_list(Scope, ParamType, Pairs)
                  ),
            !,
            engine_loop(Scope, TypeNextStep, PK).
        % error handler
        engine_loop(Scope, Type, PK) :-
            engine_error_step(TypeNextStep),
            \+ get_param_list(Scope, TypeNextStep, PK),
            get_local_date_time(DT),
            append(PK, [Type, DT], PairsNextStep),
            new_param_list(Scope, TypeNextStep, PairsNextStep),
            !,
            fail.
        
        %
        engine_data_step(in, run).
        engine_data_step(run, query).
        engine_data_step(query, data).
        %
        engine_deal_step(run) :-
            debug_mode,
            !.
        engine_deal_step(data).
        %
        engine_fail_step(out).
        engine_fail_step(error).
        %
        engine_restart_step(restart, in).
        %
        engine_error_step(error).
        
         %
        %%
        
        /* реализация - подготовка данных */
        
        % in-run
        prepare_data(Scope, Type, PK, TypeNextStep) :-
            memberchk(Scope, [wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg]),
            Type = in, TypeNextStep = run,
            % MonthQty, MonthBonusQty, Pairs01, Pairs02
            ( get_param_list(Scope, Type, [pCommon-1], Pairs01) ; Pairs01 = [] ),
            get_param_list(Scope, Type, [pMonthQty-MonthQty], Pairs02),
            ( member_list([pMonthBonusQty-MonthBonusQty], Pairs02) ; MonthBonusQty = 0 ),
            % DateCalc, MonthOffset, MonthBefore, Pairs
            append(PK, [pDateCalc-DateCalc], Pairs03),
            get_param_list(Scope, Type, Pairs03, Pairs),
            ( member_list([pMonthOffset-MonthOffset], Pairs) ; MonthOffset = 0 ),
            ( member_list([pMonthBefore-MonthBefore], Pairs) ; MonthBefore = 0 ),
            % DateCalcFrom, DateCalcTo
            atom_date(DateCalc, date(Y0, M0, _)),
            atom_date(DateCalcTo0, date(Y0, M0, 1)),
            MonthOffset1 is (- MonthOffset),
            date_add(DateCalcTo0, MonthOffset1, month, DateCalcTo),
            MonthAdd is (- (MonthQty + MonthBefore)),
            date_add(DateCalcTo, MonthAdd, month, DateCalcFrom),
            % DateNormFrom, DateNormTo
            date_add(DateCalcTo, -1, day, DateCalcTo1),
            atom_date(DateCalcTo1, date(Y, _, _)),
            atom_date(DateNormFrom, date(Y, 1, 1)),
            Y1 is Y + 1,
            atom_date(DateNormTo, date(Y1, 1, 1)),
            % DateBonusFrom
            MonthBonusQty1 is (- MonthBonusQty),
            date_add(DateCalcFrom, MonthBonusQty1, month, DateBonusFrom),
            % PairsNextStep
            append([Pairs,
                        [
                        pDateCalcFrom-DateCalcFrom, pDateCalcTo-DateCalcTo,
                        pDateNormFrom-DateNormFrom, pDateNormTo-DateNormTo,
                        pDateBonusFrom-DateBonusFrom, pDateBonusTo-DateCalcFrom
                        ],
                    Pairs01, Pairs02
                    ],
                    PairsNextStep),
            new_param_list(Scope, TypeNextStep, PairsNextStep),
            !.
        
        % run-query
        prepare_data(Scope, Type, PK, TypeNextStep) :-
            memberchk(Scope, [wg_avg_wage_vacation, wg_avg_wage_sick, wg_avg_wage_avg]),
            Type = run, TypeNextStep = query,
            get_param_list(Scope, Type, PK, Pairs),
            forall( ( gd_pl_ds(Scope, kb, PredicateName, Arity, _),
                      Query = PredicateName/Arity,
                      is_valid_sql(Query),
                      get_sql(Scope, kb, Query, SQL, Params),
                      member_list(Params, Pairs),
                      prepare_sql(SQL, Params, PrepSQL),
                      append(PK, [pQuery-Query, pSQL-PrepSQL], PairsNextStep),
                      \+ get_param_list(Scope, TypeNextStep, PairsNextStep)
                    ),
                    new_param_list(Scope, TypeNextStep, PairsNextStep)
                  ),
            !.
        
        /* реализация - расширение для клиента */
        
        %  05. Начисление отпусков
        
        % загрузка входных данных по сотруднику
        % CoefOption: fc_fcratesum ; ml_rate ; ml_msalary
        avg_wage_in(EmplKey, FirstMoveKey, DateCalc, MonthOffset, CoefOption) :-
            Scope = wg_avg_wage_vacation, Type = in,
            new_param_list(Scope, Type,
                [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey,
                 pDateCalc-DateCalc, pMonthOffset-MonthOffset,
                 pCoefOption-CoefOption]),
            !.
        
        % выгрузка детальных выходных данных по сотруднику
        avg_wage_det(EmplKey, FirstMoveKey,
                        Period, Rule, Wage, ModernCoef, ModernWage,
                        TabDays, NormDays, TabHoures, NormHoures,
                        SalaryOld, SalaryNew) :-
            % параметры контекста
            Scope = wg_avg_wage_vacation, Type = temp,
            % шаблон первичного ключа
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % для каждого периода
            % взять данные по табелю и графику
            append(PK, [pYM-Y-M,
                            pTDays-TabDays, pTHoures-TabHoures,
                            pNDays-NormDays, pNHoures-NormHoures],
                    Pairs),
            get_param_list(Scope, Type, Pairs),
            once( (
                % если для первого движения по типу 1 (прием на работу)
                % где дата совпадает с проверяемым месяцем
                get_data(Scope, kb, usr_wg_MovementLine, [
                    fEmplKey-EmplKey,
                    fDocumentKey-FirstMoveKey, fFirstMoveKey-FirstMoveKey,
                    fMoveYear-Y, fMoveMonth-M, fDateBegin-Period, fMovementType-1 ]),
                % и является датой последнего приема на работу
                get_last_hire(Scope, PK, Period)
                % то период есть дата начала работы
                ;
                % иначе сформировать дату периода, как первый день месяца
                atom_date(Period, date(Y, M, 1))
                ) ),
            % взять данные по правилам расчета
            append(PK, [pMonthIncl-MonthIncl], Pairs1),
            once( ( get_param_list(Scope, Type, Pairs1) ; MonthIncl = [] ) ),
            once( ( memberchk(Y-M-Rule, MonthIncl) ; Rule = none ) ),
            % взять данные по заработку
            once( ( ( append(PK, [pYM-Y-M,
                                    pWage-Wage, pModernCoef-ModernCoef, pModernWage-ModernWage,
                                    pSalaryOld-SalaryOld, pSalaryNew-SalaryNew],
                                Pairs2),
                      get_param_list(Scope, Type, Pairs2) )
                      ; [Wage, ModernCoef, ModernWage, SalaryOld, SalaryNew] = [0, 1, 0, 0, 0] ) ),
            %
            % есть отработанные часы или заработок
            once( ( TabHoures > 0 ; ModernWage > 0 ) ),
            true.
        
        %  06. Начисление больничных
        
        % загрузка входных данных по сотруднику
        avg_wage_sick_in(EmplKey, FirstMoveKey, DateCalc, IsAvgWageDoc, IsPregnancy) :-
            Scope = wg_avg_wage_sick, Type = in,
            new_param_list(Scope, Type, [
                            pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey,
                            pDateCalc-DateCalc, pIsAvgWageDoc-IsAvgWageDoc,
                            pIsPregnancy-IsPregnancy ]),
            !.
        
        % выгрузка детальных выходных данных по сотруднику
        avg_wage_sick_det(EmplKey, FirstMoveKey,
                            Period, Rule,
                            MonthDays, ExclDays, CalcDays, IsFullMonth, IsSpecMonth,
                            Wage,
                            TabDays, NormDays, TabHoures, NormHoures) :-
            % параметры контекста
            Scope = wg_avg_wage_sick, Type = temp,
            % шаблон первичного ключа
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % для каждого периода
            % взять данные по расчетным дням
            append(PK, [pYM-Y-M, pRule-Rule,
                        pMonthDays-MonthDays, pExclDays-ExclDays,
                        pCalcDays-CalcDays, pIsFullMonth-IsFullMonth,
                        pIsSpecMonth-IsSpecMonth],
                    Pairs),
            get_param_list(Scope, temp, Pairs),
            % взять данные по заработку
            append(PK, [pYM-Y-M, pWage-Wage], Pairs1),
            get_param_list(Scope, Type, Pairs1),
            % взять данные по табелю и графику
            append(PK, [pYM-Y-M,
                            pTDays-TabDays, pTHoures-TabHoures,
                            pNDays-NormDays, pNHoures-NormHoures],
                    Pairs2),
            get_param_list(Scope, Type, Pairs2),
            once( (
                % если для первого движения по типу 1 (прием на работу)
                % где дата совпадает с проверяемым месяцем
                get_data(Scope, kb, usr_wg_MovementLine, [
                    fEmplKey-EmplKey,
                    fDocumentKey-FirstMoveKey, fFirstMoveKey-FirstMoveKey,
                    fMoveYear-Y, fMoveMonth-M, fDateBegin-Period, fMovementType-1 ]),
                % и является датой последнего приема на работу
                get_last_hire(Scope, PK, Period)
                % то период есть дата начала работы
                ;
                % иначе сформировать дату периода, как первый день месяца
                atom_date(Period, date(Y, M, 1))
                ) ),
            true.
        
        %  12. Начисление по-среднему
        
        % загрузка входных данных по сотруднику
        avg_wage_avg_in(EmplKey, FirstMoveKey, DateCalc, CalcByHoure, MonthBefore, MonthOffset) :-
            Scope = wg_avg_wage_avg, Type = in,
            new_param_list(Scope, Type,
                [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey,
                 pDateCalc-DateCalc, pCalcByHoure-CalcByHoure,
                 pMonthBefore-MonthBefore, pMonthOffset-MonthOffset]),
            !.
        
        % выгрузка детальных выходных данных по сотруднику
        avg_wage_avg_det(EmplKey, FirstMoveKey,
                            Period, Wage,
                            TabDays, NormDays, TabHoures, NormHoures) :-
            % параметры контекста
            Scope = wg_avg_wage_avg, Type = temp,
            % шаблон первичного ключа
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % для каждого периода
            % взять данные по заработку
            append(PK, [pYM-Y-M, pWage-Wage], Pairs1),
            get_param_list(Scope, Type, Pairs1),
            % взять данные по табелю и графику
            append(PK, [pYM-Y-M,
                            pTDays-TabDays, pTHoures-TabHoures,
                            pNDays-NormDays, pNHoures-NormHoures],
                    Pairs2),
            get_param_list(Scope, Type, Pairs2),
            once( (
                % если для первого движения по типу 1 (прием на работу)
                % где дата совпадает с проверяемым месяцем
                get_data(Scope, kb, usr_wg_MovementLine, [
                    fEmplKey-EmplKey,
                    fDocumentKey-FirstMoveKey, fFirstMoveKey-FirstMoveKey,
                    fMoveYear-Y, fMoveMonth-M, fDateBegin-Period, fMovementType-1 ]),
                % и является датой последнего приема на работу
                get_last_hire(Scope, PK, Period)
                % то период есть дата начала работы
                ;
                % иначе сформировать дату периода, как первый день месяца
                atom_date(Period, date(Y, M, 1))
                ) ),
            true.
        
        
        %  05, 06, 12
        
        % выгрузка SQL-запросов по сотруднику
        avg_wage_sql(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL) :-
            Type = query, TypeNextStep = data,
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            Query = PredicateName/Arity,
            append(PK, [pQuery-Query, pSQL-SQL], Pairs),
            get_param_list(Scope, Type, Pairs),
            \+ get_param_list(Scope, TypeNextStep, Pairs).
        
        % подтвеждение формирования фактов по сотруднику
        avg_wage_kb(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL) :-
            Type = query, TypeNextStep = data,
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            Query = PredicateName/Arity,
            append(PK, [pQuery-Query, pSQL-SQL], Pairs),
            get_param_list(Scope, Type, Pairs),
            \+ get_param_list(Scope, TypeNextStep, Pairs),
            new_param_list(Scope, TypeNextStep, Pairs),
            !.
        
        % выгрузка данных выполнения по сотруднику
        avg_wage_run(Scope, EmplKey, FirstMoveKey, DateCalcFrom, DateCalcTo) :-
            Type = run,
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            append(PK, [pDateCalcFrom-DateCalcFrom, pDateCalcTo-DateCalcTo], Pairs),
            get_param_list(Scope, Type, Pairs).
        
        % выгрузка выходных данных по сотруднику
        avg_wage_out(Scope, EmplKey, FirstMoveKey, AvgWage, Variant) :-
            Type = out,
            % шаблон первичного ключа
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % взять данные по результатам расчета
            append(PK, [pAvgWage-AvgWage, pVariant-Variant], Pairs),
            get_param_list(Scope, Type, Pairs).
        
        % удаление данных по сотруднику
        avg_wage_clean(Scope, EmplKey, FirstMoveKey) :-
            gd_pl_ds(Scope, Type, Name, _, _),
            del_data(Scope, Type, Name, [fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey]),
            fail.
        avg_wage_clean(Scope, EmplKey, FirstMoveKey) :-
            get_param_list(Scope, Type, [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey], Pairs),
            dispose_param_list(Scope, Type, Pairs),
            fail.
        avg_wage_clean(_, _, _) :-
            !.
        
        avg_wage_err(Scope, ErrMessage) :-
            Type = error,
            get_param(Scope, Type, pError-ErrMessage),
            true.
        
        /**/
        
        % section twg_struct
        % расчет структуры
        % - для отпусков
        % - для больничных
        %
        
        /* реализация */
        
        %
        struct_vacation_sql(DocKey, DateBegin, DateEnd, PredicateName, Arity, SQL) :-
            Scope = wg_struct_vacation, NextType = run,
            Pairs = [pDocKey-DocKey, pDateBegin-DateBegin, pDateEnd-DateEnd],
            get_sql(Scope, kb, Query, SQL0, Params),
            is_valid_sql(Query),
            Query = PredicateName/Arity,
            member_list(Params, Pairs),
            prepare_sql(SQL0, Params, SQL),
            Pairs1 = [pDocKey-DocKey, pQuery-Query, pSQL-SQL],
            new_param_list(Scope, NextType, Pairs1).
        
        %
        struct_vacation_in(DateCalc, _, _, AvgWage, _) :-
            wg_vacation_compensation(DateFrom, Duration, 1),
            atom_date(DateCalc, date(Year, Month, _)),
            month_days(Year, Month, Days),
            atom_date(AccDate, date(Year, Month, Days)),
            atom_date(DateFrom, date(Y, M, _)),
            atom_date(IncludeDate, date(Y, M, 1)),
            Summa is Duration * AvgWage,
            OutPairs = [
                        pAccDate-AccDate, pIncludeDate-IncludeDate,
                        pDuration-Duration, pSumma-Summa,
                        pDateBegin-AccDate, pDateEnd-AccDate,
                        pVcType-0
                        ],
            new_param_list(struct_vacation, out, OutPairs),
            !.
        struct_vacation_in(DateCalc, DateBegin, DateEnd, AvgWage, SliceOption) :-
            atom_date(DateCalc, date(Year, Month, _)),
            month_days(Year, Month, Days),
            atom_date(AccDate, date(Year, Month, Days)),
            once( (SliceOption = 0, FilterVcType = 0 ; true) ),
            findall( VcType-Slice,
                        ( wg_vacation_slice(VcType, Slice), VcType = FilterVcType ),
                     SliceList0 ),
            keysort(SliceList0, [Slice0|SliceList1]),
            append(SliceList1, [Slice0], SliceList),
            struct_vacation_calc(SliceList, _-0, AccDate, DateBegin, DateEnd, AvgWage),
            !.
        
        %
        struct_vacation_calc([Slice|SliceList], _-Slice0, AccDate, DateBegin, DateEnd, AvgWage) :-
            Slice0 =:= 0,
            !,
            struct_vacation_calc(SliceList, Slice, AccDate, DateBegin, DateEnd, AvgWage).
        struct_vacation_calc(_, _, _, '', '', _) :-
            !.
        struct_vacation_calc([], _-Slice, _, _, _, _) :-
            Slice =:= 0,
            !.
        struct_vacation_calc(SliceList, VcType-Slice, AccDate, DateBegin, DateEnd, AvgWage) :-
            make_period(DateBegin, DateEnd, DateBegin1, DateEnd1, DateBegin2, DateEnd2, Slice, Slice2),
            atom_date(DateBegin1, date(Y, M, _)),
            atom_date(IncludeDate, date(Y, M, 1)),
            sum_vacation_days(DateBegin1, DateEnd1, 1, Duration),
            Summa is Duration * AvgWage,
            OutPairs = [
                        pAccDate-AccDate, pIncludeDate-IncludeDate,
                        pDuration-Duration, pSumma-Summa,
                        pDateBegin-DateBegin1, pDateEnd-DateEnd1,
                        pVcType-VcType
                        ],
            new_param_list(struct_vacation, out, OutPairs),
            !,
            struct_vacation_calc(SliceList, VcType-Slice2, AccDate, DateBegin2, DateEnd2, AvgWage).
        
        %
        sum_vacation_days(DateBegin, DateBegin, Duration0, Duration1) :-
            ( catch( wg_holiday(DateBegin), _, fail ), Duration1 is Duration0 - 1
            ; Duration1 = Duration0 ),
            !.
        sum_vacation_days(DateBegin, DateEnd, Duration0, Duration) :-
            date_add(DateBegin, 1, day, DateBegin1),
            ( catch( wg_holiday(DateBegin), _, fail ), Duration1 = Duration0
            ; Duration1 is Duration0 + 1 ),
            !,
            sum_vacation_days(DateBegin1, DateEnd, Duration1, Duration).
        
        %
        struct_sick_sql(EmplKey, FirstMoveKey, DateBegin, DateEnd, PredicateName, Arity, SQL) :-
            Scope = wg_struct_sick, Type = in, NextType = run,
            % формирование параметров выполнения
            DateCalcFrom = DateBegin,
            date_add(DateEnd, 1, day, DateCalcTo),
            atom_date(DateBegin, date(Y, M, _)),
            atom_date(DateNormFrom, date(Y, M, 1)),
            date_add(DateEnd, 1, month, DateEnd1),
            atom_date(DateEnd1, date(Y1, M1, _)),
            atom_date(DateNormTo, date(Y1, M1, 1)),
            ParamPairs = [
                          pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey,
                          pDateCalcFrom-DateCalcFrom, pDateCalcTo-DateCalcTo,
                          pDateNormFrom-DateNormFrom, pDateNormTo-DateNormTo
                         ],
            ( get_param_list(Scope, Type, [pCommon-1], CommonPairs) -> true
            ; CommonPairs = []
            ),
            ( get_param_list(Scope, Type, [pBudgetPart-_], InPairs) -> true
            ; InPairs = []
            ),
            append([ParamPairs, CommonPairs, InPairs], Pairs),
            new_param_list(Scope, NextType, Pairs),
            % формирование SQL-запроса
            get_sql(Scope, kb, Query, SQL0, Params),
            is_valid_sql(Query),
            Query = PredicateName/Arity,
            member_list(Params, Pairs),
            prepare_sql(SQL0, Params, SQL),
            % добавление SQL-запроса к параметрам выполнения
            SQLPairs = [
                        pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey,
                        pQuery-Query, pSQL-SQL
                       ],
            new_param_list(Scope, NextType, SQLPairs),
            true.
        
        %
        struct_sick_err(ErrMessage) :-
            Scope = wg_struct_sick, Type = error,
            get_param(Scope, Type, pError-ErrMessage),
            true.
        
        %
        struct_sick_in(
            DateCalc, DateBegin, DateEnd, AvgWage, CalcType0,
            BudgetOption, ByRateOption, IsPregnancy, IllType,
            ViolatDB, ViolatDE
        ) :-
            Scope = wg_struct_sick, Type = in, NextType = run,
            % шаблон первичного ключа
            PK = [pEmplKey-_, pFirstMoveKey-_],
            % по сотруднику из параметров выполнения
            get_param_list(Scope, NextType, PK),
            % формирование временных данных по графику работы
            make_schedule(Scope, PK),
            % формирование временных данных параметров расчета
            Pairs0 = [
                      pBudgetOption-BudgetOption, pByRateOption-ByRateOption,
                      pIsPregnancy-IsPregnancy, pIllType-IllType,
                      pViolatDB-ViolatDB, pViolatDE-ViolatDE
                     ],
            append(PK, Pairs0, Pairs),
            new_param_list(Scope, temp, Pairs),
            % дата начисления
            atom_date(DateCalc, date(Year, Month, _)),
            month_days(Year, Month, Days),
            atom_date(AccDate, date(Year, Month, Days)),
            % количество дней
            date_diff(DateBegin, Duration0, DateEnd),
            Duration is Duration0 + 1,
            % тип расчета
            ( BudgetOption = 1
             -> get_param(Scope, Type, pBugetCalcType-CalcType)
            ; CalcType = CalcType0
            ),
            % формирование списка отрезков
            sick_slice_list(Scope, Type, CalcType, Duration, SliceList0),
            % переходящие дни
            date_diff(DateCalc, DurationBefore, DateBegin),
            % исключение из списка отрезков
            sick_slice_list_excl(SliceList0, SliceList, DurationBefore),
            % расчет структуры
            struct_sick_calc(SliceList, _-0, AccDate, DateBegin, DateEnd, AvgWage, Scope, PK),
            !.
        
        % формирование списка отрезков
        sick_slice_list(Scope, Type, CalcType, Duration, SliceList) :-
            Params = [
                      pFirstCalcType-FirstCalcType,
                      pFirstDuration-FirstDuration,
                      pFirstPart-FirstPart
                     ],
            get_param_list(Scope, Type, Params),
            sick_slice_list(Scope, Type, [1.0-Duration], CalcType, FirstCalcType, FirstPart-FirstDuration, SliceList),
            !.
        %
        sick_slice_list(_, _, SliceList0, CalcType, CalcType, FirstSlice, [FirstSlice|SliceList0]) :-
            !.
        sick_slice_list(Scope, Type, [_-Duration], CalcType, _, FirstPart-FirstDuration, SliceList) :-
            Params = [
                      pCutCalcType-CalcType,
                      pCutDuration-CutDuration,
                      pCutPart-CutPart
                     ],
            get_param_list(Scope, Type, Params),
            Part2 is FirstPart * CutPart,
            Duration2 is FirstDuration - CutDuration,
            append([[0.0-CutDuration], [Part2-Duration2], [CutPart-Duration]], SliceList),
            !.
        sick_slice_list(_, _, SliceList, _, _, _, SliceList) :-
            !.
        
        % исключение из списка отрезков
        sick_slice_list_excl(SliceList, SliceList, 0) :-
            !.
        sick_slice_list_excl([LastSlice|[]], [LastSlice], _) :-
            !.
        sick_slice_list_excl([Slice|SliceList], [Slice1|SliceList1], DurationBefore) :-
            sick_slice_excl(Slice, Slice1, DurationBefore, DurationBefore1),
            !,
            sick_slice_list_excl(SliceList, SliceList1, DurationBefore1).
        
        % исключение отрезка
        sick_slice_excl(Part-Duration, Part-Duration1, DurationBefore, DurationBefore1) :-
            Duration0 is Duration - DurationBefore,
            ( Duration0 > 0
             -> Duration1 = Duration0
            ; Duration1 = 0
            ),
            DurationBefore0 is DurationBefore - Duration,
            ( DurationBefore0 > 0
             -> DurationBefore1 = DurationBefore0
            ; DurationBefore1 = 0
            ),
            !.
        
        % расчет структуры
        struct_sick_calc([Slice|SliceList], _-Slice0, AccDate, DateBegin, DateEnd, AvgWage, Scope, PK) :-
            Slice0 =:= 0,
            !,
            struct_sick_calc(SliceList, Slice, AccDate, DateBegin, DateEnd, AvgWage, Scope, PK).
        struct_sick_calc(_, _, _, '', '', _, _, _) :-
            !.
        struct_sick_calc([], _-Slice, _, _, _, _, _, _) :-
            Slice =:= 0,
            !.
        struct_sick_calc(SliceList, SickPart0-Slice, AccDate, DateBegin, DateEnd, AvgWage0, Scope, PK) :-
            % сформировать период
            make_period(
                DateBegin, DateEnd,
                DateBegin1, DateEnd1,
                DateBegin2, DateEnd2,
                Slice, Slice2,
                Scope, PK, SickPart1
            ),
            % дата начисления
            atom_date(DateBegin1, date(Y, M, _)),
            atom_date(IncludeDate, date(Y, M, 1)),
            % взять временные данные параметров расчета
            Pairs0 = [
                      pBudgetOption-BudgetOption, pByRateOption-ByRateOption,
                      pIsPregnancy-IsPregnancy, pIllType-IllType
                     ],
            append(PK, Pairs0, Pairs),
            get_param_list(Scope, temp, Pairs),
            % расчет части периода с учетом нарушения режима
            SickPart is SickPart0 * 1.0 * SickPart1,
            Percent is SickPart * 100,
            date_add(DateEnd1, 1, day, DateEnd11),
            % сумма дней и часов периода
            sum_sick_days(DateBegin1, DateEnd11, 0, DOI, 0, HOI, IllType, Scope, PK),
              % если расчет от БПМ
            ( BudgetOption = 1,
              get_avg_wage_budget(Scope, in, Y-M, AvgWage),
              Summa is round(DOI * AvgWage * SickPart)
            ; % или расчет от Ставки при отсутствии заработка
              ByRateOption = 1,
              AvgWage0 =:= 0,
              get_avg_wage_rate(Scope, PK, IncludeDate, AvgWage),
              Summa is round(DOI * AvgWage * SickPart)
              % или есть признак Декретный
            ; IsPregnancy = 1,
              Summa is round(DOI * AvgWage0 * SickPart)
              % иначе проверка на превышение по среднему заработку в РБ
            ; Summa0 is round(DOI * AvgWage0 * SickPart),
              % для среднедневной зп для месяца по среднемесячной зп в РБ
              avg_wage_by_avg_salary(Scope, Y-M, AvgWage1),
              % процент не учитывается
              Summa1 is round(DOI * AvgWage1),
              % берется минимальная сумма
              Summa is min(Summa0, Summa1)
            ),
            OutPairs = [
                        pAccDate-AccDate, pIncludeDate-IncludeDate,
                        pPercent-Percent, pDOI-DOI, pHOI-HOI, pSumma-Summa,
                        pDateBegin-DateBegin1, pDateEnd-DateEnd1
                        ],
            new_param_list(Scope, out, OutPairs),
            !,
            struct_sick_calc(SliceList, SickPart0-Slice2, AccDate, DateBegin2, DateEnd2, AvgWage0, Scope, PK).
        
        %
        make_period(
            DateBegin, DateEnd,
            DateBegin1, DateEnd1,
            DateBegin2, DateEnd2,
            Slice, Slice2
        ) :-
            make_period(
                DateBegin, DateEnd,
                DateBegin1, DateEnd1,
                DateBegin2, DateEnd2,
                Slice, Slice2,
                '', [], _
            ),
            !.
        %
        make_period(
            DateBegin, DateEnd,
            DateBegin, DateEnd1,
            DateBegin2, DateEnd2,
            Slice, Slice2,
            Scope, PK, SickPart1
        ) :-
            head_period(DateBegin, DateEnd, DateEnd1, Slice, Slice2, Scope, PK, SickPart1),
            teil_period(DateEnd, DateEnd1, DateBegin2, DateEnd2),
            !.
        
        %
        head_period(DateBegin, DateEnd, DateBegin, Slice, Slice2, Scope, PK, SickPart1) :-
           % следующий день
           date_add(DateBegin, 1, day, DateBegin1),
           atom_date(DateBegin, date(Y, M, _)),
             % является днем следующего месяца
           ( \+ atom_date(DateBegin1, date(Y, M, _)),
             next_slice(DateBegin, Slice, Slice2)
             % больше даты окончания
           ; DateBegin1 @> DateEnd,
             Slice2 = 0
             % достигнут конец отрезка
           ; Slice =:= 1,
             next_slice(DateBegin, Slice, Slice2)
             % является днем начала нарушения режима
           ; violat_date(begin, DateBegin1, Scope, PK, _),
             next_slice(DateBegin, Slice, Slice2)
             % или текущий день является днем окончания нарушения режима
           ; violat_date(end, DateBegin, Scope, PK, _),
             next_slice(DateBegin, Slice, Slice2)
           ),
           % проверка на вхождение в период нарушения режима
           violat_date(period, DateBegin, Scope, PK, SickPart1),
           !.
        head_period(DateBegin, DateEnd, DateEnd1, Slice0, Slice2, Scope, PK, SickPart1) :-
           date_add(DateBegin, 1, day, DateBegin1),
           next_slice(DateBegin, Slice0, Slice1),
           !,
           head_period(DateBegin1, DateEnd, DateEnd1, Slice1, Slice2, Scope, PK, SickPart1).
        
        %
        violat_date(period, _, '', [], 1.0) :-
            !.
        violat_date(CheckType, InDate, Scope, PK, ViolatPart) :-
            get_param(Scope, in, pViolatPart-ViolatPart),
            get_param_list(Scope, temp, [pViolatDB-ViolatDB, pViolatDE-ViolatDE | PK]),
            is_date(ViolatDB), ViolatDB @> '1994-01-01',
            is_date(ViolatDE), ViolatDE @> '1994-01-01',
            ( CheckType = begin,
              InDate =@= ViolatDB
            ; CheckType = end,
              InDate =@= ViolatDE
            ; CheckType = period,
              InDate @>= ViolatDB,
              InDate @=< ViolatDE
            ),
            !.
        violat_date(period, _, _, _, 1.0) :-
            !.
        
        %
        next_slice(DateBegin, Slice, Slice) :-
           catch( wg_holiday(DateBegin), _, fail ),
           !.
        next_slice(_, Slice, Slice2) :-
           Slice2 is Slice - 1,
           !.
        
        %
        teil_period(DateEnd, DateEnd, '', '') :-
            !.
        teil_period(DateEnd, DateEnd1, DateBegin2, DateEnd) :-
            date_add(DateEnd1, 1, day, DateBegin2),
            !.
        
        % сумма дней и часов периода
        sum_sick_days(DateBegin, DateBegin, DOI, DOI, HOI, HOI, _, _, _) :-
            !.
        sum_sick_days(DateBegin, DateEnd, DOI0, DOI, HOI0, HOI, IllType, Scope, PK) :-
            add_sick_norm(DateBegin, DOI0, HOI0, DOI1, HOI1, IllType, Scope, PK),
            date_add(DateBegin, 1, day, DateBegin1),
            !,
            sum_sick_days(DateBegin1, DateEnd, DOI1, DOI, HOI1, HOI, IllType, Scope, PK).
        
        %
        add_sick_norm(TheDay, DOI0, HOI0, DOI1, HOI1, IllType, Scope, PK) :-
            ( member(NormOption, [tbl_cal_flex, tbl_day_norm]),
              usr_wg_TblDayNorm_mix(Scope, PK, _, TheDay, WDuration, 1, NormOption),
              WDuration > 0,
              DOI1 is DOI0 + 1, HOI1 is HOI0 + WDuration
            ;
              ( catch( wg_job_ill_type(IllType), _, fail),
                DOI1 = DOI0
              ; DOI1 is DOI0 + 1
              ), HOI1 = HOI0
            ),
            !.
        
        %
        struct_vacation_out(AccDate, IncludeDate, Duration, Summa, DateBegin, DateEnd, VcType) :-
            OutPairs = [
                        pAccDate-AccDate, pIncludeDate-IncludeDate,
                        pDuration-Duration, pSumma-Summa,
                        pDateBegin-DateBegin, pDateEnd-DateEnd,
                        pVcType-VcType
                       ],
            get_param_list(struct_vacation, out, OutPairs).
        
        %
        struct_sick_out(AccDate, IncludeDate, Percent, DOI, HOI, Summa, DateBegin, DateEnd) :-
            Scope = wg_struct_sick,
            OutPairs = [
                        pAccDate-AccDate, pIncludeDate-IncludeDate,
                        pPercent-Percent, pDOI-DOI, pHOI-HOI, pSumma-Summa,
                        pDateBegin-DateBegin, pDateEnd-DateEnd
                       ],
            get_param_list(Scope, out, OutPairs).
        
        % взять среднедневную ставку на текущий месяц
        get_avg_wage_rate(Scope, PK, TheDate, AvgWage) :-
            % разложить первичный ключ
            PK = [pEmplKey-EmplKey, pFirstMoveKey-FirstMoveKey],
            % текущий месяц
            atom_date(TheDate, date(Y, M, _)),
            % календарных дней в текущем месяце
            month_days(Y, M, MonthDays),
            atom_date(LastDate, date(Y, M, MonthDays)),
            % взять данные по ставке
            findall( PayFormKey0-SalaryKey0-TSalary0-THoureRate0,
                       % из данных по движению
                     ( get_data(Scope, kb, usr_wg_MovementLine, [
                                 fEmplKey-EmplKey, fFirstMoveKey-FirstMoveKey,
                                 fDateBegin-DateBegin,
                                 fPayFormKey-PayFormKey0, fSalaryKey-SalaryKey0,
                                 fTSalary-TSalary0, fTHoureRate-THoureRate0 ]),
                       % где дата меньше или равна последней дате месяца
                       DateBegin @=< LastDate ),
            % в список ставок
            RateList ),
            % взять последние данные по ставке
            last(RateList, PayFormKey-SalaryKey-TSalary-THoureRate),
              % если форма оплаты оклад
            ( PayFormKey = SalaryKey,
              % то расчет по тарифному окладу
              AvgWage is TSalary / MonthDays
            ; % иначе
              % расчитать график за месяц
              calc_month_norm(Scope, PK, Y-M, [tbl_cal_flex, tbl_day_norm], NormDays),
              % сумма дней и часов по графику
              sum_days_houres(NormDays, _, NHoures),
              % расчет от часовой тарифной ставки
              AvgWage is NHoures * THoureRate / MonthDays
            ),
            !.
        
        % взять среднедневной БПМ на текущий месяц
        get_avg_wage_budget(Scope, Type, Y-M, AvgWageBudget) :-
            % первая дата месяца
            atom_date(FirstMonthDate, date(Y, M, 1)),
            % взять БПМ
            findall( Budget0,
                          % взять данные по БПМ
                        ( get_data(Scope, kb, gd_const_budget, [
                                    fConstDate-ConstDate, fBudget-Budget0]),
                          % где дата константы меньше или равна первой дате месяца
                          ConstDate @=< FirstMonthDate
                        ),
            % в список БПМ
            BudgetList),
            % проверить список БПМ
            \+ BudgetList = [],
            % последние данные по БПМ за месяц
            last(BudgetList, MonthBudget),
            % календарных дней в месяце
            month_days(Y, M, MonthDays),
            % коэфициент для расчета по БПМ
            get_param(Scope, Type, pBudgetPart-BudgetPart),
            % среднедневной БПМ
            AvgWageBudget is MonthBudget * BudgetPart / MonthDays,
            !.
        get_avg_wage_budget(Scope, _, _, 0) :-
            new_param_list(Scope, error, [
                            pError-"Введите константу 'Бюджет прожиточного минимума'"]),
            !.
        
        % взять среднюю зп по РБ
        get_avg_salary_rb(Scope, Y-M, MonthAvgSalary) :-
            % первая дата месяца
            atom_date(FirstMonthDate, date(Y, M, 1)),
            % взять среднюю зп
            findall( AvgSalary0,
                          % взять данные по средней зп
                        ( get_data(Scope, kb, gd_const_AvgSalaryRB, [
                                    fConstDate-ConstDate, fAvgSalaryRB-AvgSalary0]),
                          % где дата константы меньше первой даты месяца
                          ConstDate @< FirstMonthDate
                        ),
            % в список средних зп
            AvgSalaryList),
            % проверить список средних зп
            \+ AvgSalaryList = [],
            % последние данные средней зп за месяц
            last(AvgSalaryList, MonthAvgSalary),
            !.
        get_avg_salary_rb(Scope, _, 0) :-
            new_param_list(Scope, error, [pError-"Введите константу 'Средняя зарплата по РБ'"]),
            !.
        
        % среднедневная зп для месяца по среднемесячной зп в РБ
        avg_wage_by_avg_salary(Scope, Y-M, MonthAvgWage) :-
            % взять среднюю зп по РБ
            get_avg_salary_rb(Scope, Y-M, MonthAvgSalary),
            % взять расчетный коэфициент
            get_param(Scope, in, pAvgSalaryRB_Coef-AvgSalaryRB_Coef),
            % календарных дней в месяце
            month_days(Y, M, MonthDays),
            % расчитать среднедневную зп для месяца
            MonthAvgWage is round(MonthAvgSalary * AvgSalaryRB_Coef / MonthDays),
            !.
        
        % section twg_rule
        % Правила расчета
        %
        
        % настроить правила
        wg_config_rules(Scope) :-
            memberchk(Scope, [wg_avg_wage_vacation, wg_avg_wage_sick]),
            findall( Rules, wg_valid_rules(Rules), RulesList),
            append(RulesList, RulesSet),
            wg_change_rules(Scope, RulesSet, RulesSet1),
            retractall( wg_valid_rules(_) ),
            assertz( wg_valid_rules(RulesSet1) ),
            !.
        wg_config_rules(_).
        
        wg_change_rules(_, [], []) :-
            !.
        wg_change_rules(Scope, [Rule0|Rules], [Rule1|Rules1]) :-
            ( Rule0 = -Rule -> true ; Rule0 = Rule ),
            atom_string(Rule, Atom),
            get_data(Scope, kb, usr_wg_pl_Rule, [fAtom-Atom, fEnabled-Enabled]),
            ( Enabled = 0, Rule1 = -Rule ; Rule1 = Rule ),
            !,
            wg_change_rules(Scope, Rules, Rules1).
        wg_change_rules(Scope, [Rule|Rules], [Rule|Rules1]) :-
            !,
            wg_change_rules(Scope, Rules, Rules1).
        
        /**/
        
         %
        %%
        
        
      DISPLAYSCRIPT: ~
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: ~
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-12-11T10:25:51+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151189469_18175251 lib"
          - 
            ADDFUNCTIONKEY: "151189468_18175251 params"
          - 
            ADDFUNCTIONKEY: "151042959_187967073 wg_data_mix"
          - 
            ADDFUNCTIONKEY: "151189470_18175251 twg_avg_wage_sql"
          - 
            ADDFUNCTIONKEY: "151189471_18175251 twg_avg_wage_in_params"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 156299481_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151163587_5956463
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalary_CoefOption"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_WageSettings
        
        Sub wg_AvgSalary_CoefOption(ByRef Sender)
        '
          Dim InflType, InflFCType
          Dim rbFCRate, rbRateInf, rbMovementRate, rbSalaryInf
          
          InflType = wg_WageSettings.Inflation.InflType
          InflFCType = wg_WageSettings.Inflation.InflFCType
          '
          'От оклада
          Set rbSalaryInf = Sender.GetComponent("usrg_rbSalaryInf")
          rbSalaryInf.Checked = False
          'От ставки 1-го разряда
          Set rbRateInf = Sender.FindComponent("usrg_rbRateInf")
          rbRateInf.Checked = False
          '  справочника
          Set rbFCRate = Sender.FindComponent("usrg_rbFCRate")
          rbFCRate.Checked = False
          '  кадрового движения
          Set rbMovementRate = Sender.FindComponent("usrg_rbMovementRate")
          rbMovementRate.Checked = False
          '
          Select Case InflType
            'usrg_rbSalaryInf - От оклада
            Case 0
              rbSalaryInf.Checked = True
            'usrg_rbRateInf - От ставки 1-го разряда
            Case 1
              rbRateInf.Checked = True
              '
              Select Case InflFCType
                'usrg_rbFCRate - справочника
                Case 0
                  rbFCRate.Checked = True
                'usrg_rbMovementRate - кадрового движения
                Case 2
                  rbMovementRate.Checked = True
              End Select
              '
          End Select
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARY_COEFOPTION
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-02-27T10:57:15+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147016040_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151163587_5956463
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_EnableFieldChange"
      COMMENT: ~
      SCRIPT: | 
        option explicit
        
        sub wg_CheckVariableExists(ByRef Self, ByVal VarName)
          if not Self.VariableExists(VarName) then
            Self.AddVariableItem(VarName)
            Self.Variables(VarName) = 0
          end if
        end sub
        
        sub wg_CheckObjectExists(ByRef Self, ByVal VarName, ByRef O)
          if not Self.ObjectExists(VarName) then
            Self.AddObjectItem(VarName)
            Self.Objects(VarName) = O
          end if
        end sub
        
        sub wg_EnableFieldChange(ByRef Self, ByVal VarName)
          call wg_CheckVariableExists(Self, VarName)
          if Self.Variables(VarName) > 0 then
            Self.Variables(VarName) = Self.Variables(VarName) - 1
          end if
        end sub
        
        sub wg_DisableFieldChange(ByRef Self, ByVal VarName)
          call wg_CheckVariableExists(Self, VarName)
          Self.Variables(VarName) = Self.Variables(VarName) + 1
        end sub
        
        function wg_EnabledFieldChange(ByRef Self, ByVal VarName)
          call wg_CheckVariableExists(Self, VarName)
          wg_EnabledFieldChange = (Self.Variables(VarName) = 0)
        end function
        
      DISPLAYSCRIPT: | 
        WG_CHECKVARIABLEEXISTS
        WG_CHECKOBJECTEXISTS
        WG_ENABLEFIELDCHANGE
        WG_DISABLEFIELDCHANGE
        WG_ENABLEDFIELDCHANGE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QEAAAAU0VMRgQAAABTRUxGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNU
        BwAAAFZBUk5BTUUHAAAAVkFSTkFNRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2007-03-13T16:49:05+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147019760_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151163587_5956463
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_WageSettings"
      COMMENT: ~
      SCRIPT: | 
        option explicit
        function wg_WageSettings
          if not Assigned(wg_WageSettings_) then
            set wg_WageSettings_ = New Twg_WageSettings
          end if
          
          set wg_WageSettings = wg_WageSettings_
        end function
        
      DISPLAYSCRIPT: | 
        WG_WAGESETTINGS
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: ~
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2004-12-24T12:23:47+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151163587_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_WageSettings
        '#include wg_EnableFieldChange
        '#include pl_GetScriptIDByName
        '#include wg_AvgSalary_CoefOption
        
        Function wg_AvgSalaryStrGenerate_pl(ByRef Sender, ByVal CalcType)
        '
          Dim T, T1, T2
          
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim gdcObject, gdcSalary
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile, Scope
          'avg_wage
          Dim P_main, Tv_main, Q_main
          'avg_wage_in
          Dim P_in, Tv_in, Q_in
          Dim EmplKey, FirstMoveKey, DateCalc
          Dim InflType, InflFCType
          Dim MonthOffset, CoefOption
          'avg_wage_run, avg_wage_sql
          Dim P_run, Tv_run, Q_run, P_sql, Tv_sql, Q_sql, P_kb
          Dim DateCalcFrom, DateCalcTo
          Dim PredicateName, Arity, SQL
          'avg_wage_out, avg_wage_det
          Dim P_out, Tv_out, Q_out, P_det, Tv_det, Q_det
          Dim AvgWage, AvgWageRule
          Dim Period, PeriodRule, Wage, ModernWage, ModernCoef
          Dim TabDays, TabHoures, NormDays, NormHoures
          Dim SalaryOld, SalaryNew
          Dim IsFull, IsCheck
        
          T1 = Timer
          wg_AvgSalaryStrGenerate_pl = False
          Set Creator = New TCreator
          
          Sender.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.gdcObject
          '
          EmplKey = gdcObject.FieldByName("usr$emplkey").AsInteger
          FirstMoveKey = gdcObject.FieldByName("usr$firstmovekey").AsInteger
          '
          if CalcType = 0 then
            dim IBSQL
            set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
            IBSQL.Transaction = gdcBaseManager.ReadTransaction
            IBSQL.SQL.Text = _
              "select " & _
              "  t.USR$DATEBEGIN " & _
              "from " & _
              "  usr$wg_total t " & _
              "where " & _
              "  t.DOCUMENTKEY = :TDK "
            IBSQL.ParamByName("TDK").asInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
            IBSQL.ExecQuery
            DateCalc = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          else
            DateCalc = gdcObject.FieldByName("usr$from").AsDateTime
          end if
          '
          MonthOffset = 0
          '
          InflType = wg_WageSettings.Inflation.InflType
          InflFCType = wg_WageSettings.Inflation.InflFCType
          'CoefOption: fc_fcratesum ; ml_rate ; ml_msalary
          Select Case InflType
            'usrg_rbSalaryInf - От оклада
            Case 0
              CoefOption = "ml_msalary"
            'usrg_rbRateInf - От ставки 1-го разряда
            Case 1
              Select Case InflFCType
                'usrg_rbFCRate - справочника
                Case 0
                  CoefOption = "fc_fcratesum"
                'usrg_rbMovementRate - кадрового движения
                Case 2
                  CoefOption = "ml_rate"
              End Select
          End Select
          '
        
          'проблема wg_WageSettings
          'CoefOption = "ml_rate" 'только для ММК, иначе эту строку закомментировать
        
          wg_AvgSalary_CoefOption(Sender)
        
          'init
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          Scope = "wg_avg_wage_vacation"
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          Set gdcSalary = Sender.GetComponent("usrg_gdcAvgSalaryStr")
          '
          Call wg_DisableFieldChange(gdcSalary, "AVGSALARYCALC")
          '
          gdcSalary.First
          While Not gdcSalary.EOF
            gdcSalary.Delete
          Wend
          '
          gdcObject.FieldByName("USR$AVGSUMMA").Clear
          '
          Sender.Repaint
        
          'avg_wage_in(EmplKey, FirstMoveKey, DateCalc, MonthOffset, CoefOption)
          P_in = "avg_wage_in"
          Set Tv_in = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutInteger 0, EmplKey
          Tv_in.PutInteger 1, FirstMoveKey
          Tv_in.PutDate 2, DateCalc
          Tv_in.PutInteger 3, MonthOffset
          Tv_in.PutAtom 4, CoefOption
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'avg_wage(Scope) - prepare data
          P_main = "avg_wage"
          Set Tv_main = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_main = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_main.PredicateName = P_main
          Q_main.Termv = Tv_main
          '
          Tv_main.PutAtom 0, Scope
          '
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_run(Scope, EmplKey, FirstMoveKey, DateCalcFrom, DateCalcTo)
          P_run = "avg_wage_run"
          Set Tv_run = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_run = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_run.PredicateName = P_run
          Q_run.Termv = Tv_run
          'avg_wage_sql(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL)
          P_sql = "avg_wage_sql"
          P_kb = "avg_wage_kb"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Tv_run.PutAtom 0, Scope
          '
          Q_run.OpenQuery
          If Q_run.EOF Then
            Exit Function
          End If
          '
          Append = False
          '
          Do Until Q_run.EOF
            EmplKey = Tv_run.ReadInteger(1)
            FirstMoveKey = Tv_run.ReadInteger(2)
            DateCalcFrom = Tv_run.ReadDate(3)
            DateCalcTo = Tv_run.ReadDate(4)
            '
            Tv_sql.Reset
            Tv_sql.PutAtom 0, Scope
            Tv_sql.PutInteger 1, EmplKey
            Tv_sql.PutInteger 2, FirstMoveKey
            Q_sql.OpenQuery
            '
            Do Until Q_sql.EOF
              PredicateName = Tv_sql.ReadAtom(3)
              Arity = Tv_sql.ReadInteger(4)
              SQL = Tv_sql.ReadString(5)
              '
              Ret =  PL.MakePredicatesOfSQLSelect _
                        (SQL, _
                        gdcBaseManager.ReadTransaction, _
                        PredicateName, PredicateName, Append)
              If Ret >= 0 Then
                 Ret = PL.Call(P_kb, Tv_sql)
              End If
              '
              Q_sql.NextSolution
            Loop
            Q_sql.Close
            '
            Append = True
            '
            Q_run.NextSolution
          Loop
          Q_run.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage(Scope) - calc result
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_out(Scope, EmplKey, FirstMoveKey, AvgWage, AvgWageVariant)
          P_out = "avg_wage_out"
          Set Tv_out = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          'avg_wage_det(EmplKey, FirstMoveKey,
          '   Period, PeriodRule, Wage, ModernCoef, ModernWage,
          '   TabDays, NormDays, TabHoures, NormHoures,
          '   SalaryOld, SalaryNew)
          P_det = "avg_wage_det"
          Set Tv_det = Creator.GetObject(13, "TgsPLTermv", "")
          Set Q_det = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_det.PredicateName = P_det
          Q_det.Termv = Tv_det
          '
          Tv_out.PutAtom 0, Scope
          '
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            EmplKey = Tv_out.ReadInteger(1)
            FirstMoveKey = Tv_out.ReadInteger(2)
            AvgWage = Tv_out.ReadFloat(3)
            AvgWageRule = Tv_out.ReadAtom(4)
            '
            Tv_det.Reset
            Tv_det.PutInteger 0, EmplKey
            Tv_det.PutInteger 1, FirstMoveKey
            Q_det.OpenQuery
            '
            Do Until Q_det.EOF
              Period = Tv_det.ReadDate(2)
              PeriodRule = Tv_det.ReadAtom(3)
              IsFull = _
                Abs( PeriodRule = "by_days_houres" _
                    Or PeriodRule = "by_houres" _
                    Or PeriodRule = "by_days" )
              IsCheck = Abs( Not (PeriodRule = "none") )
              '
              If AvgWageRule = "by_calc_month" Then
                Select Case PeriodRule
                  Case "by_days_houres"
                    PeriodRule = "табель равен графику по дням и часам"
                  Case "by_days"
                    PeriodRule = "табель покрывает график по дням"
                  Case "by_houres"
                    PeriodRule = "табель покрывает график по часам"
                  Case "by_month_wage_all"
                    PeriodRule = "по размеру заработка (не меньше всех полных)"
                  Case "by_month_wage_any"
                    PeriodRule = "по размеру заработка (не меньше любого полного)"
                  Case "by_month_no_bad_type"
                    PeriodRule = "виды начислений и типы часов в норме"
                  Case Else
                    PeriodRule = ""
                End Select
              ElseIf AvgWageRule = "by_avg_houre" Then
                PeriodRule = "по среднечасовому"
              End If
              '
              Wage = Tv_det.ReadFloat(4)
              ModernCoef = Tv_det.ReadFloat(5)
              ModernWage = Tv_det.ReadFloat(6)
              TabDays = Tv_det.ReadFloat(7)
              NormDays = Tv_det.ReadFloat(8)
              TabHoures = Tv_det.ReadFloat(9)
              NormHoures = Tv_det.ReadFloat(10)
              SalaryOld = Tv_det.ReadFloat(11)
              SalaryNew = Tv_det.ReadFloat(12)
              '
              gdcSalary.Append
              gdcSalary.FieldByName("USR$DATE").AsVariant = Period
              gdcSalary.FieldByName("USR$SALARY").AsVariant = Wage
              gdcSalary.FieldByName("USR$COEFF").AsVariant = ModernCoef
              gdcSalary.FieldByName("USR$MODERNSALARY").AsVariant = ModernWage
              gdcSalary.FieldByName("USR$DOW").AsVariant = TabDays
              gdcSalary.FieldByName("USR$HOW").AsVariant = TabHoures
              gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = NormDays
              gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = NormHoures
              gdcSalary.FieldByName("USR$ISCHECK").AsVariant = IsCheck
              gdcSalary.FieldByName("USR$ISFULL").AsVariant = IsFull
              gdcSalary.FieldByName("USR$DESCRIPTION").AsVariant = PeriodRule
              gdcSalary.FieldByName("USR$OLDSALARY").AsVariant = SalaryOld
              gdcSalary.FieldByName("USR$NEWSALARY").AsVariant = SalaryNew
              gdcSalary.Post
              '
              Q_det.NextSolution
            Loop
            Q_det.Close
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
        
          gdcSalary.First
          '
          Call wg_EnableFieldChange(gdcSalary, "AVGSALARYCALC")
          '
          If AvgWage > 0 Then
            gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = AvgWage
            gdcObject.Post
          End If
          '
        
          wg_AvgSalaryStrGenerate_pl = True
          
          T2 = Timer
          T = T2 - T1
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        UFJTVAgAAABDQUxDVFlQRQgAAABDQUxDVFlQRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-10-07T13:23:53+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
          - 
            ADDFUNCTIONKEY: "156299481_119200397 wg_AvgSalary_CoefOption"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 156300136_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryDetailGenerate_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include pl_GetScriptIDByName
        
        Function wg_AvgSalaryDetailGenerate_pl(ByRef Sender)
        '
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim gdcObject, gdcDetail
          '
          Dim PL, Ret, Pred, Tv, Append
          'struct_vacation_sql
          Dim P_sql, Tv_sql, Q_sql
          Dim DocKey, DateBegin, DateEnd, PredicateName, Arity, SQL
          'struct_vacation_in
          Dim P_in, Tv_in, Q_in
          Dim DateCalc, AvgWage, SliceOption
          'struct_vacation_out
          Dim P_out, Tv_out, Q_out
          Dim AccDate, IncludeDate, Duration, Summa, VcType
        
          wg_AvgSalaryDetailGenerate_pl = False
          Set Creator = New TCreator
        
          Sender.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.gdcObject
          '
          DocKey = gdcObject.FieldByName("DOCUMENTKEY").AsInteger
          DateBegin = gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime
          DateEnd = gdcObject.FieldByName("USR$DATEEND").AsDateTime
          AvgWage = gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency
          SliceOption = 0
          '
          Dim IBSQL
          Set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = gdcBaseManager.ReadTransaction
          IBSQL.SQL.Text = _
              "select " & _
              "  t.USR$DATEBEGIN " & _
              "from " & _
              "  usr$wg_total t " & _
              "where " & _
              "  t.DOCUMENTKEY = :TDK "
          IBSQL.ParamByName("TDK").asInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
          IBSQL.ExecQuery
          DateCalc = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          '
        
          'init
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          Set gdcDetail = Sender.gdcDetailObject
          '
          gdcDetail.First
          While Not gdcDetail.EOF
            gdcDetail.Delete
          Wend
          '
          Sender.Repaint
        
          'struct_vacation_sql(DocKey, DateBegin, DateEnd, PredicateName, Arity, SQL)
          P_sql = "struct_vacation_sql"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Append = False
          '
          Tv_sql.PutInteger 0, DocKey
          Tv_sql.PutDate 1, DateBegin
          Tv_sql.PutDate 2, DateEnd
          '
          Q_sql.OpenQuery
          If Q_sql.EOF Then
            Exit Function
          End If
          '
          Do Until Q_sql.EOF
            PredicateName = Tv_sql.ReadAtom(3)
            Arity = Tv_sql.ReadInteger(4)
            SQL = Tv_sql.ReadString(5)
            '
            Ret =  PL.MakePredicatesOfSQLSelect _
                      (SQL, _
                      gdcBaseManager.ReadTransaction, _
                      PredicateName, PredicateName, Append)
            '
            Q_sql.NextSolution
          Loop
          Q_sql.Close
          '
        
          'struct_vacation_in(DateCalc, DateBegin, DateEnd, AvgWage, SliceOption)
          P_in = "struct_vacation_in"
          Set Tv_in = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutDate 0, DateCalc
          Tv_in.PutDate 1, DateBegin
          Tv_in.PutDate 2, DateEnd
          Tv_in.PutFloat 3, AvgWage
          Tv_in.PutInteger 4, SliceOption
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'struct_vacation_out(AccDate, IncludeDate, Duration, Summa, DateBegin, DateEnd, VcType)
          P_out = "struct_vacation_out"
          Set Tv_out = Creator.GetObject(7, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            '
            AccDate = Tv_out.ReadDate(0)
            IncludeDate = Tv_out.ReadDate(1)
            Duration = Tv_out.ReadFloat(2)
            Summa = Tv_out.ReadFloat(3)
            DateBegin = Tv_out.ReadDate(4)
            DateEnd = Tv_out.ReadDate(5)
            VcType = Tv_out.ReadInteger(6)
            '
            gdcDetail.Append
            gdcDetail.FieldByName("USR$ACCDATE").AsVariant = AccDate
            gdcDetail.FieldByName("USR$INCLUDEDATE").AsVariant = IncludeDate
            gdcDetail.FieldByName("USR$DURATION").AsVariant = Duration
            gdcDetail.FieldByName("USR$SUMMA").AsVariant = Summa
            gdcDetail.FieldByName("USR$DATEBEGIN").AsVariant = DateBegin
            gdcDetail.FieldByName("USR$DATEEND").AsVariant = DateEnd
            'gdcDetail.FieldByName("USR$VCTYPE").AsVariant = VcType
            gdcDetail.Post
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
          gdcDetail.First
        
          wg_AvgSalaryDetailGenerate_pl = True
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYDETAILGENERATE_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-08-25T13:13:33+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123484_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      PARENT: "147240236_1234867257 GLOBAL\\DFM\\Tgdc_dlgUserComplexDocument"
      NAME: "147020774_119619099"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: | 
        object gdc_dlgUserComplexDocument147020774_119619099: Tgdc_dlgUserComplexDocument
          Left = -4
          Top = -4
          Width = 1288
          Height = 988
          ActiveControl = nil
          PixelsPerInch = 96
          TextHeight = 13
          object btnAccess: TButton
            Top = 926
            TabOrder = 3
          end
          object btnNew: TButton
            Top = 926
            TabOrder = 4
          end
          object btnHelp: TButton
            Top = 926
            TabOrder = 5
          end
          object btnOK: TButton
            Left = 1184
            Top = 926
            Anchors = [akRight, akBottom]
            TabOrder = 1
          end
          object btnCancel: TButton
            Left = 1276
            Top = 926
            Anchors = [akRight, akBottom]
            TabOrder = 2
          end
          object pnlMain: TPanel
            Width = 1280
            Height = 923
            TabOrder = 0
            object splMain: TSplitter
              Width = 1280
            end
            object usrg_Splitter1: TSplitter
              Tag = 0
              Left = 575
              Top = 287
              Width = 6
              Height = 636
              Cursor = crHSplit
              Hint = ''
              Align = alLeft
              AutoSnap = True
              Beveled = False
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              MinSize = 30
              ParentColor = True
              ResizeStyle = rsPattern
              Visible = True
            end
            object pnlDetail: TPanel
              Left = 0
              Top = 287
              Width = 575
              Height = 636
              Align = alLeft
              Alignment = taLeftJustify
              Anchors = [akLeft, akTop, akBottom]
              AutoSize = False
              TabOrder = 2
              object ibgrDetail: TgsIBGrid
                Left = 0
                Width = 575
                Height = 610
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                ReadOnly = True
                Expands = <>
                Conditions = <>
                ScaleColumns = False
                MinColWidth = 12
                ColumnEditors = <>
                Aliases = <>
                Columns = <
                  item
                    Expanded = False
                    FieldName = 'USR$ACCDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата начисления'
                    Width = 108
                    Visible = True
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$INCLUDEDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата зачисления'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$DURATION'
                    ReadOnly = False
                    Title.Caption = 'Дни'
                    Width = 36
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$SUMMA'
                    ReadOnly = False
                    Title.Caption = 'Сумма'
                    Width = 72
                    Visible = True
                    DisplayFormat = '#.##'
                    TotalType = ttSum
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEBEGIN'
                    ReadOnly = False
                    Title.Caption = 'Дата начала'
                    Width = 108
                    Visible = True
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEEND'
                    ReadOnly = False
                    Title.Caption = 'Дата окончания'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'SUMNCU'
                    ReadOnly = False
                    Title.Caption = 'sumncu'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DESCRIPTION'
                    ReadOnly = False
                    Title.Caption = 'Описание'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$SORTNUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер для сортировки'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'ID'
                    ReadOnly = False
                    Title.Caption = 'Ключ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PARENT'
                    ReadOnly = False
                    Title.Caption = 'Родитель'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип транзакции'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRANSACTIONKEY'
                    ReadOnly = False
                    Title.Caption = 'Транзакция'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'NUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMCURR'
                    ReadOnly = False
                    Title.Caption = 'Сумма в валюте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DELAYED'
                    ReadOnly = False
                    Title.Caption = 'Отложенный'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CURRKEY'
                    ReadOnly = False
                    Title.Caption = 'Валюта'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'COMPANYKEY'
                    ReadOnly = False
                    Title.Caption = 'Компания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто создал'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата создания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто исправил'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата изменения'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PRINTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата печати'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DISABLED'
                    ReadOnly = False
                    Title.Caption = 'Отключено'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED'
                    ReadOnly = False
                    Title.Caption = 'Зарезервировано'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTKEY'
                    Title.Caption = 'Ключ документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'MASTERKEY'
                    Title.Caption = 'Родитель (Начисление отпусков(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED1'
                    Title.Caption = 'Зарезервировано (Начисление отпусков(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMEQ'
                    ReadOnly = False
                    Title.Caption = 'Сумма в эквиваленте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$EQRATE'
                    ReadOnly = False
                    Title.Caption = 'Курс экв.'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AFULL'
                    ReadOnly = False
                    Title.Caption = 'Полный доступ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'ACHAG'
                    ReadOnly = False
                    Title.Caption = 'Просмотр и редактирование'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AVIEW'
                    ReadOnly = False
                    Title.Caption = 'Только просмотр'
                    Width = -1
                    Visible = False
                  end>
              end
              object tbdTop: TTBDock
                Width = 575
                object tbDetail: TTBToolbar
                  Align = alClient
                  Anchors = [akLeft, akTop, akRight, akBottom]
                  DockPos = 0
                  SavedAtRunTime = True
                  object tbNew: TTBItem
                  end
                  object tbEdit: TTBItem
                  end
                  object tbDelete: TTBItem
                  end
                  object tbDuplicate: TTBItem
                  end
                  object tbiDetailProperties: TTBItem
                  end
                  object TBSeparatorItem1: TTBSeparatorItem
                  end
                  object tbCopy: TTBItem
                  end
                  object tbCut: TTBItem
                  end
                  object tbPaste: TTBItem
                  end
                  object TBSeparatorItem2: TTBSeparatorItem
                  end
                  object tbMacro: TTBItem
                  end
                  object usrg_TBSeparatorItem1: TTBSeparatorItem
                    Tag = 0
                    Blank = False
                    Hint = ''
                    Visible = True
                  end
                  object usrg_TBItem6: TTBItem
                    Tag = 0
                    Action = usrg_actGenerate
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_TBItem1: TTBItem
                    Tag = 0
                    Action = usrg_actGenStr
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_tbFeesByEmpl: TTBItem
                    Tag = 0
                    Action = nil
                    AutoCheck = False
                    Caption = 'Итоговое'
                    Checked = False
                    DisplayMode = nbdmDefault
                    Enabled = True
                    GroupIndex = 0
                    HelpContext = 0
                    Hint = ''
                    ImageIndex = -1
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                    ShortCut = 0
                    Visible = True
                  end
                end
              end
              object tbdLeft: TTBDock
                Left = 0
                Width = 0
                Height = 610
              end
              object tbdRight: TTBDock
                Left = 575
                Width = 0
                Height = 610
              end
              object tbdBottom: TTBDock
                Top = 636
                Width = 575
                Height = 0
              end
            end
            object pnlMaster: TPanel
              Width = 1280
              TabOrder = 0
              object pnlHolding: TPanel
                Width = 1280
                TabOrder = 1
                object lblCompany: TLabel
                  Width = 64
                  Caption = 'Органзация:'
                end
                object iblkCompany: TgsIBLookupComboBox
                end
              end
              object usrg_PageControl1: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 1280
                Height = 283
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet1
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet1: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Основные'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_GroupBox1: TGroupBox
                    Tag = 0
                    Left = 0
                    Top = 121
                    Width = 1272
                    Height = 134
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    Caption = ' Средний заработок '
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ParentBiDiMode = True
                    ParentColor = True
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 0
                    TabStop = False
                    Visible = True
                    object usrat_DBEdit_USR_AVGPERIOD_Label: TLabel
                      Left = 13
                      Top = 44
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY_Label: TLabel
                      Left = 13
                      Top = 20
                    end
                    object usrat_DBEdit_USR_AVGSUMMA_Label: TLabel
                      Left = 14
                      Top = 69
                    end
                    object usrg_chboxCoefInflation: TCheckBox
                      Tag = 0
                      Left = 669
                      Top = 51
                      Width = 225
                      Height = 17
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      TabStop = True
                      Action = nil
                      Alignment = taRightJustify
                      AllowGrayed = False
                      Anchors = [akLeft, akTop]
                      Caption = 'Коэ-т инфляции от ставки 1 разряда'
                      Checked = True
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = True
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      State = cbChecked
                      TabOrder = 4
                      Visible = False
                    end
                    object usrg_GroupBox2: TGroupBox
                      Tag = 0
                      Left = 341
                      Top = 10
                      Width = 225
                      Height = 101
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      Caption = 'Осовременивание'
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DockSite = False
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = False
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      TabOrder = 5
                      TabStop = False
                      Visible = True
                      object usrg_rbSalaryInf: TRadioButton
                        Tag = 0
                        Left = 12
                        Top = 17
                        Width = 169
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'От оклада'
                        Checked = False
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 0
                        TabStop = False
                        Visible = True
                      end
                      object usrg_rbRateInf: TRadioButton
                        Tag = 0
                        Left = 12
                        Top = 36
                        Width = 169
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'От ставки 1-го разряда'
                        Checked = True
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 1
                        TabStop = True
                        Visible = True
                      end
                    end
                    object usrg_rbPersCoeffInf: TRadioButton
                      Tag = 0
                      Left = 796
                      Top = 23
                      Width = 241
                      Height = 17
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      Action = nil
                      Alignment = taRightJustify
                      Anchors = [akLeft, akTop]
                      Caption = 'От персонального коэффициента'
                      Checked = True
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = True
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      TabOrder = 7
                      TabStop = True
                      Visible = False
                    end
                    object usrg_Panel2: TPanel
                      Tag = 0
                      Left = 377
                      Top = 59
                      Width = 177
                      Height = 49
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      Align = alNone
                      Alignment = taCenter
                      Anchors = [akLeft, akTop]
                      AutoSize = False
                      BevelInner = bvNone
                      BevelOuter = bvNone
                      BevelWidth = 1
                      BorderWidth = 0
                      BorderStyle = bsNone
                      Caption = ''
                      Color = clBtnFace
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      Ctl3D = False
                      UseDockManager = True
                      DockSite = False
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = False
                      FullRepaint = True
                      Locked = False
                      ParentBiDiMode = True
                      ParentColor = False
                      ParentCtl3D = False
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      TabOrder = 6
                      TabStop = False
                      Visible = True
                      object usrg_rbFCRate: TRadioButton
                        Tag = 0
                        Left = 6
                        Top = 9
                        Width = 113
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'справочника'
                        Checked = True
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 0
                        TabStop = True
                        Visible = True
                      end
                      object usrg_rbMovementRate: TRadioButton
                        Tag = 0
                        Left = 6
                        Top = 27
                        Width = 161
                        Height = 17
                        Cursor = crDefault
                        Hint = ''
                        HelpContext = 0
                        Action = nil
                        Alignment = taRightJustify
                        Anchors = [akLeft, akTop]
                        Caption = 'кадрового движения'
                        Checked = False
                        Constraints.MaxHeight = 0
                        Constraints.MaxWidth = 0
                        Constraints.MinHeight = 0
                        Constraints.MinWidth = 0
                        DragCursor = crDrag
                        DragKind = dkDrag
                        DragMode = dmManual
                        Enabled = True
                        ParentBiDiMode = True
                        ParentColor = True
                        ParentCtl3D = True
                        ParentFont = True
                        ParentShowHint = True
                        PopupMenu = nil
                        TabOrder = 1
                        TabStop = False
                        Visible = True
                      end
                    end
                    object usrat_DBEdit_USR_AVGPERIOD: TxDBCalculatorEdit
                      Left = 243
                      Top = 40
                      Width = 76
                      Cursor = crIBeam
                      TabOrder = 1
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY: TgsIBLookupComboBox
                      Left = 139
                      Top = 16
                      Width = 180
                      ListTable = 
                        'USR$WG_FEEGROUP fg LEFT JOIN USR$WG_FEEGROUP fg1 ON fg.lb > fg1.' +
                        'lb AND fg.rb < fg1.rb'
                      Condition = 'fg1.id = <RUID XID = 147274328 DBID = 274788016/>'
                      TabOrder = 0
                    end
                    object usrat_DBCheckBox_USR_MODERNSALARY: TDBCheckBox
                      Left = 677
                      Top = 19
                      Width = 106
                      Caption = 'Осовременивать'
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_DBEdit_USR_AVGSUMMA: TxDBCalculatorEdit
                      Left = 179
                      Top = 65
                      Cursor = crIBeam
                      ReadOnly = True
                      TabOrder = 3
                    end
                  end
                  object usrg_Panel1: TPanel
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 1272
                    Height = 121
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alTop
                    Alignment = taCenter
                    Anchors = [akLeft, akTop, akRight]
                    AutoSize = False
                    BevelInner = bvRaised
                    BevelOuter = bvLowered
                    BevelWidth = 1
                    BorderWidth = 0
                    BorderStyle = bsNone
                    Caption = ''
                    Color = clBtnFace
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    UseDockManager = True
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    FullRepaint = True
                    Locked = False
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 1
                    TabStop = False
                    Visible = True
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY_Label: TLabel
                      Top = 12
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY_Label: TLabel
                      Top = 37
                    end
                    object usrat_gsIBLookupComboBox_USR_VACATIONTYPE_Label: TLabel
                      Top = 62
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY_Label: TLabel
                      Left = 5
                      Top = 87
                      Width = 76
                      Caption = 'По должности:'
                    end
                    object usrat_xDateDBEdit_USR_DATEEND_Label: TLabel
                      Left = 317
                      Top = 62
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN_Label: TLabel
                      Left = 317
                      Top = 37
                    end
                    object usrat_xDateDBEdit_USR_FROM_Label: TLabel
                      Left = 317
                      Top = 11
                    end
                    object usrat_DBEdit_USR_DURATION_Label: TLabel
                      Left = 501
                      Top = 12
                    end
                    object usrat_DBEdit_USR_EXTRADURATION_Label: TLabel
                      Left = 501
                      Top = 36
                    end
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY: TgsIBLookupComboBox
                      Left = 100
                      Top = 8
                      Width = 180
                      ListTable = 
                        'usr$wg_total t LEFT JOIN GD_DOCUMENT doc ON doc.id = t.documentk' +
                        'ey'
                      ListField = 'usr$name'
                      KeyField = 'documentkey'
                      SortOrder = soAsc
                      Condition = 'parent is null and doc.companykey = <companykey/>'
                      gdClassName = 'TgdcUserDocument'
                      SubType = '147567052_119619099'
                      DropDownCount = 8
                      ParentShowHint = False
                      ShowHint = True
                      TabOrder = 0
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY: TgsIBLookupComboBox
                      Left = 100
                      Top = 33
                      Width = 180
                      Fields = 'usr$wg_listnum'
                      ListTable = 'GD_CONTACT C'
                      SortOrder = soAsc
                      Condition = 
                        'ID in (SELECT usr$emplkey FROM usr$wg_emplworkterm term LEFT JOI' +
                        'N GD_DOCUMENT doc ON doc.id = term.usr$firstmovekey WHERE usr$da' +
                        'tebegin <= :dateend AND (usr$dateend >= :datebegin or usr$dateen' +
                        'd is NULL) AND doc.companykey = <COMPANYKEY/>)'
                      SubType = ''
                      TabOrder = 1
                    end
                    object usrat_gsIBLookupComboBox_USR_VACATIONTYPE: TgsIBLookupComboBox
                      Left = 100
                      Top = 58
                      Width = 180
                      Condition = 'USR$TYPE <> 3'
                      TabOrder = 2
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY: TgsIBLookupComboBox
                      Left = 100
                      Top = 83
                      Width = 180
                      Fields = 'l.POSNAME, l.DEPTNAME, l.KINDOFWORKNAME'
                      ListTable = 'USR$WG_P_FMKLOOKUPSETTINGS (:emplkey, :dateend)  l'
                      ListField = 'l.POSID'
                      KeyField = 'l.FMK'
                      Condition = ''
                      gdClassName = ''
                      ParentShowHint = False
                      ShowHint = True
                      TabOrder = 3
                    end
                    object usrat_DBCheckBox_USR_COMPENSATION: TDBCheckBox
                      Left = 317
                      Top = 87
                      TabOrder = 4
                    end
                    object usrat_xDateDBEdit_USR_FROM: TxDateDBEdit
                      Left = 411
                      Top = 8
                      Width = 68
                      TabOrder = 5
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN: TxDateDBEdit
                      Left = 411
                      Top = 33
                      Width = 68
                      TabOrder = 6
                    end
                    object usrat_xDateDBEdit_USR_DATEEND: TxDateDBEdit
                      Left = 411
                      Top = 58
                      Width = 68
                      TabOrder = 7
                    end
                    object usrat_DBEdit_USR_DURATION: TxDBCalculatorEdit
                      Left = 656
                      Top = 8
                      Width = 60
                      Cursor = crIBeam
                      TabOrder = 8
                    end
                    object usrat_DBEdit_USR_EXTRADURATION: TxDBCalculatorEdit
                      Left = 656
                      Top = 33
                      Width = 60
                      Cursor = crArrow
                      TabOrder = 9
                    end
                  end
                end
                object usrg_TabSheet2: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Атрибуты'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object atContainer: TatContainer
                    Top = 0
                    Width = 1272
                    Height = 255
                    VertScrollBar.Position = 177
                    TabOrder = 0
                    object usrat_DBEdit_NUMBER_Label: TLabel
                      Left = 5
                      Top = -146
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE_Label: TLabel
                      Top = -169
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER_Label: TLabel
                      Left = 5
                      Top = -124
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE_Label: TLabel
                      Top = 238
                    end
                    object usrat_DBEdit_NUMBER: TDBEdit
                      Left = 131
                      Top = -149
                      Width = 100
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE: TxDateDBEdit
                      Left = 131
                      Top = -172
                      Width = 100
                      TabOrder = 1
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER: TxDBCalculatorEdit
                      Left = 131
                      Top = -126
                      Width = 100
                      Cursor = crIBeam
                      TabOrder = 0
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE: TxDBCalculatorEdit
                      Top = 234
                      Cursor = crIBeam
                      TabOrder = 3
                    end
                  end
                end
              end
            end
            object usrg_pAvgSalary: TPanel
              Tag = 0
              Left = 581
              Top = 287
              Width = 699
              Height = 636
              Cursor = crDefault
              Hint = ''
              HelpContext = 0
              Align = alClient
              Alignment = taCenter
              Anchors = [akLeft, akTop, akRight, akBottom]
              AutoSize = False
              BevelInner = bvNone
              BevelOuter = bvNone
              BevelWidth = 1
              BorderWidth = 0
              BorderStyle = bsNone
              Caption = ''
              Color = clBtnFace
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              UseDockManager = True
              DockSite = False
              DragCursor = crDrag
              DragKind = dkDrag
              DragMode = dmManual
              Enabled = True
              FullRepaint = True
              Locked = False
              ParentBiDiMode = True
              ParentColor = False
              ParentCtl3D = True
              ParentFont = True
              ParentShowHint = True
              PopupMenu = nil
              TabOrder = 1
              TabStop = False
              Visible = True
              object usrg_PageControl2: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 699
                Height = 636
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet3
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet3: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Расчет структуры ср. заработка'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_grAvgSalaryStr: TgsIBGrid
                    Tag = 0
                    Left = 0
                    Top = 26
                    Width = 691
                    Height = 582
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    TabStop = True
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    BorderStyle = bsNone
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DataSource = usrg_dsAvgSalaryStr
                    DefaultDrawing = True
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ImeMode = imDontCare
                    ImeName = ''
                    Options = [dgEditing, dgTitles, dgIndicator, dgColumnResize, dgColLines, dgRowLines, dgTabs, dgConfirmDelete, dgCancelOnExit]
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    ReadOnly = True
                    TabOrder = 0
                    Visible = True
                    TableColor = clWindow
                    SelectedColor = clHighlight
                    TitleColor = clBtnFace
                    RefreshType = rtCloseOpen
                    Striped = True
                    StripeOdd = 15201271
                    StripeEven = 14084071
                    InternalMenuKind = imkWithSeparator
                    Expands = <
                      item
                        DisplayField = 'USR$DOW'
                        FieldName = 'USR$HOW'
                        LineCount = 1
                        Options = [ceoAddField]
                      end
                      item
                        DisplayField = 'USR$SCHEDULERDOW'
                        FieldName = 'USR$SCHEDULERHOW'
                        LineCount = 1
                        Options = [ceoAddField]
                      end
                      item
                        DisplayField = 'USR$NEWSALARY'
                        FieldName = 'USR$OLDSALARY'
                        LineCount = 1
                        Options = [ceoAddField]
                      end
                      item
                        DisplayField = 'USR$SALARY'
                        FieldName = 'USR$MODERNSALARY'
                        LineCount = 1
                        Options = [ceoAddField]
                      end>
                    ExpandsActive = False
                    ExpandsSeparate = False
                    TitlesExpanding = False
                    Conditions = <>
                    ConditionsActive = False
                    CheckBox.DisplayField = ''
                    CheckBox.FieldName = ''
                    CheckBox.Visible = True
                    CheckBox.CheckList.Strings = (
                      '')
                    CheckBox.FirstColumn = False
                    ScaleColumns = False
                    MinColWidth = 40
                    ToolBar = nil
                    FinishDrawing = True
                    RememberPosition = True
                    SaveSettings = True
                    ColumnEditors = <
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISCHECK'
                        DisplayField = 'USR$ISCHECK'
                        ValueList.Strings = (
                          'Нет=0'
                          'Да=1')
                        DropDownCount = 3
                      end
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISFULL'
                        DisplayField = 'USR$ISFULL'
                        ValueList.Strings = (
                          'Да=1'
                          'Нет=0')
                        DropDownCount = 3
                      end>
                    Aliases = <>
                    ShowFooter = False
                    ShowTotals = True
                    Columns = <
                      item
                        Expanded = False
                        FieldName = 'USR$ISFULL'
                        ReadOnly = False
                        Title.Caption = 'Полный месяц'
                        Width = 48
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$ISCHECK'
                        ReadOnly = False
                        Title.Caption = 'Вкл.'
                        Width = 48
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = 72
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$SALARY'
                        ReadOnly = False
                        Title.Caption = 'Зарплата'
                        Width = 72
                        Visible = True
                        DisplayFormat = '#.##'
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$COEFF'
                        ReadOnly = False
                        Title.Caption = 'Коэф-т'
                        Width = 52
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$MODERNSALARY'
                        ReadOnly = False
                        Title.Caption = 'Современная зарплата'
                        Width = 84
                        Visible = True
                        DisplayFormat = '#.##'
                        TotalType = ttSum
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$DOW'
                        ReadOnly = False
                        Title.Caption = 'Дни'
                        Width = 36
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERDOW'
                        ReadOnly = False
                        Title.Caption = 'Дней по гр.'
                        Width = 72
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$HOW'
                        ReadOnly = False
                        Title.Caption = 'Часы'
                        Width = 43
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERHOW'
                        ReadOnly = False
                        Title.Caption = 'Часов по гр.'
                        Width = 76
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DESCRIPTION'
                        ReadOnly = False
                        Title.Caption = 'Описание'
                        Width = 222
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$OLDSALARY'
                        ReadOnly = False
                        Title.Caption = 'Оклад'
                        Width = -1
                        Visible = False
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$NEWSALARY'
                        ReadOnly = False
                        Title.Caption = 'Текущий оклад'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'ID'
                        Title.Caption = 'Идентификатор'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DOCUMENTKEY'
                        ReadOnly = False
                        Title.Caption = 'Документ'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_NUMBER'
                        ReadOnly = False
                        Title.Caption = 'Номер'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOCUMENTDATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOC2715260478'
                        ReadOnly = False
                        Title.Caption = 'Тип документа'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$CALCDAYS'
                        ReadOnly = False
                        Title.Caption = 'Дни расчет.'
                        Width = -1
                        Visible = False
                      end>
                  end
                  object usrg_TBDock1: TTBDock
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 691
                    Height = 26
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    AllowDrag = True
                    Background = nil
                    BackgroundOnToolbars = True
                    BoundLines = []
                    Color = clBtnFace
                    FixAlign = False
                    LimitToOneRow = False
                    PopupMenu = nil
                    Position = dpTop
                    Visible = True
                    object usrg_TBToolbar1: TTBToolbar
                      Tag = 0
                      Left = 0
                      Top = 0
                      Cursor = crDefault
                      HelpContext = 0
                      ActivateParent = True
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      AutoResize = True
                      BorderStyle = bsSingle
                      Caption = 'tbDetail'
                      ChevronMoveItems = True
                      ChevronPriorityForNewItems = tbcpHighest
                      CloseButton = False
                      CloseButtonWhenDocked = False
                      Color = clBtnFace
                      DefaultDock = nil
                      DockableTo = [dpTop, dpBottom, dpLeft, dpRight]
                      DockMode = dmCannotFloatOrChangeDocks
                      DockPos = 0
                      DockRow = 0
                      DragHandleStyle = dhSingle
                      FloatingMode = fmOnTopOfParentForm
                      FloatingWidth = 0
                      FullSize = False
                      HideWhenInactive = True
                      Images = dmImages.il16x16
                      LinkSubitems = nil
                      MenuBar = False
                      Options = []
                      ParentFont = True
                      ParentShowHint = False
                      PopupMenu = nil
                      ProcessShortCuts = False
                      Resizable = True
                      ShowCaption = True
                      ShowHint = True
                      ShrinkMode = tbsmChevron
                      SmoothDrag = True
                      Stretch = True
                      SystemFont = True
                      TabOrder = 0
                      UpdateActions = True
                      UseLastDock = True
                      Visible = True
                      SavedAtRunTime = True
                      object usrg_TBItem2: TTBItem
                        Tag = 0
                        Action = usrg_actAvgNew
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem3: TTBItem
                        Tag = 0
                        Action = usrg_actAvgEdit
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem4: TTBItem
                        Tag = 0
                        Action = usrg_actAvgDelete
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem5: TTBItem
                        Tag = 0
                        Action = usrg_actAvgCopy
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = dmImages.il16x16
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBSeparatorItem3: TTBSeparatorItem
                        Tag = 0
                        Blank = False
                        Hint = ''
                        Visible = True
                      end
                      object usrg_TBItem11: TTBItem
                        Tag = 0
                        Action = usrg_actAvgGenerate
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                    end
                  end
                end
              end
            end
          end
          object alBase: TActionList
            Left = 388
            Top = 8
            object actNew: TAction
            end
            object actHelp: TAction
            end
            object actSecurity: TAction
            end
            object actOk: TAction
            end
            object actCancel: TAction
            end
            object actNextRecord: TAction
            end
            object actPrevRecord: TAction
            end
            object actApply: TAction
            end
            object actFirstRecord: TAction
            end
            object actLastRecord: TAction
            end
            object actProperty: TAction
            end
            object actCopySettingsFromUser: TAction
            end
            object actAddToSetting: TAction
            end
            object actDocumentType: TAction
            end
            object actDistributeUserSettings: TAction
            end
            object actHistory: TAction
            end
            object actDetailNew: TAction
            end
            object actDetailEdit: TAction
            end
            object actDetailDelete: TAction
            end
            object actDetailDuplicate: TAction
            end
            object actDetailPrint: TAction
            end
            object actDetailCut: TAction
            end
            object actDetailCopy: TAction
            end
            object actDetailPaste: TAction
            end
            object actDetailMacro: TAction
            end
            object actDetailProp: TAction
            end
            object usrg_actGenStr: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'usrg_actGenStr'
              Checked = False
              Enabled = False
              HelpContext = 0
              Hint = ''
              ImageIndex = -1
              ShortCut = 0
              Visible = False
            end
            object usrg_actAvgNew: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Новый'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Новый'
              ImageIndex = 0
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgEdit: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Редактировать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Редактировать'
              ImageIndex = 1
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgDelete: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Удалить'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Удалить'
              ImageIndex = 2
              ShortCut = 0
              Visible = True
            end
            object usrg_actGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Рассчитать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Рассчитать ср. заработок'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать ср. заработок'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgCopy: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Копировать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = ''
              ImageIndex = 3
              ShortCut = 0
              Visible = True
            end
          end
          object dsgdcBase: TDataSource
            Left = 421
            Top = 7
          end
          object pm_dlgG: TPopupMenu
            Left = 144
            Top = 232
            object actSecurity1: TMenuItem
            end
            object actHistory1: TMenuItem
            end
            object N1: TMenuItem
            end
            object sepFirst: TMenuItem
            end
            object actNextRecord1: TMenuItem
            end
            object actPrevRecord1: TMenuItem
            end
            object actFirstRecord1: TMenuItem
            end
            object actLastRecord1: TMenuItem
            end
            object sepSecond: TMenuItem
            end
            object actApply1: TMenuItem
            end
            object sepThird: TMenuItem
            end
            object actProperty1: TMenuItem
            end
            object actCopySettings1: TMenuItem
            end
            object nAddToSetting1: TMenuItem
            end
          end
          object ibtrCommon: TIBTransaction
            Params.Strings = (
              'read_committed'
              'rec_version'
              'nowait')
            Left = 752
            Top = 256
          end
          object dsDetail: TDataSource
            Left = 461
            Top = 14
          end
          object gdMacrosMenu: TgdMacrosMenu
            Left = 729
            Top = 119
          end
          object usrg_gdcAvgSalaryStr: TgdcAttrUserDefined
            Tag = 0
            ForcedRefresh = False
            AutoCalcFields = True
            ObjectView = False
            AllowStreamedActive = False
            SubType = 'USR$WG_AVGSALARYSTR'
            MasterSource = dsgdcBase
            MasterField = 'ID'
            DetailField = 'parent'
            SubSet = 'ByParent'
            SetTable = ''
            Active = True
            CachedUpdates = False
            ReadTransaction = gdcUserDocument.ibtrInternal
            Filtered = False
            Left = 684
            Top = 256
          end
          object usrg_dsAvgSalaryStr: TDataSource
            Tag = 0
            AutoEdit = True
            DataSet = usrg_gdcAvgSalaryStr
            Enabled = True
            Left = 717
            Top = 252
          end
        end
        
      EDITIONDATE: 2014-12-08T13:04:40+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147368587_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_GetAvgSalarySum"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        option explicit
        function wg_GetAvgSalarySum(ByRef DataSet)
        
          dim BookMark, Sum, DoW, M, D
        
          BookMark = DataSet.GetBookMark
          DataSet.DisableControls
          DataSet.Cancel
        
          except wg_GetAvgSalarySum_except(DataSet, BookMark)
        
          dim LYear, LMonth, MCount, OnlyNotFull
          LYear = 0
          LMonth = 0
          
          dim wdays
          dim IsFull, NotFull
          IsFull = 0
          NotFull = 0
        
          Sum = 0
          MCount = 0       ' кол-во месяцев, задействованных в расчете
          DataSet.First
          while not DataSet.EOF
            if DataSet.FieldByName("usr$ischeck").AsInteger > 0 then
              if DataSet.FieldByName("usr$isfull").AsInteger = 1 then
                IsFull = IsFull + 1
              else
                NotFull = NotFull + 1
              end if
              Sum = Sum + DataSet.FieldByName("USR$MODERNSALARY").AsCurrency
              if (LYear <> Year(DataSet.FieldByName("USR$DATE").AsDateTime)) or (LMonth <> Month(DataSet.FieldByName("USR$DATE").AsDateTime)) then
                MCount = MCount + 1
                LYear = Year(DataSet.FieldByName("USR$DATE").AsDateTime)
                LMonth = Month(DataSet.FieldByName("USR$DATE").AsDateTime)
              end if
              Wdays = Wdays +  DataSet.FieldByName("USR$DOW").AsInteger
            end if
            DataSet.Next
          wend
          DataSet.First
        
          dim NeedPost
          NeedPost = false
          set M = DataSet.OwnerForm.gdcObject
          if M.State <> dsEdit and M.State <> dsInsert then
            M.Edit
            NeedPost = true
          end if
          if MCount > 0 then
            if IsFull > 0 then
              M.FieldByName("USR$AVGSUMMA").AsCurrency = Round(Sum / MCount / wg_WageSettings.Wage.AvgDayInMonth) '29.7
            else
              if Wdays > 0 then
                M.FieldByName("USR$AVGSUMMA").AsCurrency = Sum / Wdays
              else
                M.FieldByName("USR$AVGSUMMA").AsCurrency = 0
              end if
            end if
          else
            M.FieldByName("USR$AVGSUMMA").AsCurrency = 0
          end if
          if NeedPost then M.Post
        
          DataSet.GotoBookMark(BookMark)
          DataSet.FreeBookmark(BookMark)
          DataSet.EnableControls
        end function
        
        sub wg_GetAvgSalarySum_except(D, B)
          D.GotoBookMark(B)
          D.FreeBookmark(B)
          D.EnableControls
        end sub
        
      DISPLAYSCRIPT: | 
        WG_GETAVGSALARYSUM
        WG_GETAVGSALARYSUM_EXCEPT
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAREFUQVNFVAcAAABEQVRBU0VUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2013-08-21T14:37:38+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147021903_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      NAME: "gdc_dlgUserComplexDocument147020774_119619099"
      DESCRIPTION: ~
      PARENT: ~
      OBJECTTYPE: 0
      MACROSGROUPKEY: "147021904_119619099 Локальные макросы"
      REPORTGROUPKEY: "147021905_119619099 Отчеты(gdc_dlgUserComplexDocument147020774_119619099)"
      CLASSNAME: ""
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      SUBTYPE: ""
      EDITIONDATE: 2004-05-05T14:36:35+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147489128_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_EnableFieldChange
        '#include wg_GetAvgSalarySum
        '#include wg_WageSettings
        option explicit
        function wg_AvgSalaryStrGenerate(ByRef Sender, ByVal CalcType)
        
          dim gdcObject, wg_AvgWage, P, gdcSalary ' wg_Periods,
          dim Avg, i
          dim Creator
          set Creator = New TCreator
        
          Sender.GetComponent("actApply").Execute
        
          set gdcObject = Sender.gdcObject
        
        '  set wg_Periods = New Twg_Periods
          set wg_AvgWage = New Twg_AvgWage
          wg_AvgWage.EmployeeKey = gdcObject.FieldByName("usr$emplkey").AsInteger
            wg_AvgWage.EmployeeKey = gdcObject.FieldByName("usr$emplkey").AsInteger
          if CalcType = 0 then
            wg_AvgWage.FirstMoveKey = gdcObject.FieldByName("usr$firstmovekey").AsInteger
            dim IBSQL
            set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
            IBSQL.Transaction = gdcBaseManager.ReadTransaction
            IBSQL.SQL.Text = _
              "select " & _
              "  t.USR$DATEBEGIN " & _
              "from " & _
              "  usr$wg_total t " & _
              "where " & _
              "  t.DOCUMENTKEY = :TDK "
            IBSQL.ParamByName("TDK").asInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
            IBSQL.ExecQuery
            wg_AvgWage.BeginDate = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          else
            wg_AvgWage.BeginDate = gdcObject.FieldByName("usr$from").AsVariant
          end if
          wg_AvgWage.EndDate =  gdcObject.FieldByName("usr$dateend").AsVariant
          wg_AvgWage.Compensation = (gdcObject.FieldByName("USR$COMPENSATION").AsInteger = 1 )
          wg_AvgWage.FeeGroupKey = gdcObject.FieldByName("USR$FEEGROUPKEY").AsInteger
          wg_AvgWage.Period = gdcObject.FieldByName("USR$AVGPERIOD").AsInteger
          wg_AvgWage.CalcType = CalcType
        
          Avg = wg_AvgWage.AvgWage
          set P = wg_AvgWage.Periods
        
          ' если больничные - только сумма и выходим
          if CalcType = 1 then
            gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = Avg
            exit function
          end if
        
          set gdcSalary = Sender.GetComponent("usrg_gdcAvgSalaryStr")
          call wg_DisableFieldChange(gdcSalary, "AVGSALARYCALC")
        
          gdcSalary.First
          while not gdcSalary.EOF
            gdcSalary.Delete
          wend
        
          for i = 1 to P.Count
            if not ((P.Item(i).Sum = 0) and (P.Item(i).WorkDays =0) and (P.Item(i).WorkHours = 0)) and P.Item(i).ExistMove then
              gdcSalary.Append
              gdcSalary.FieldByName("USR$DATE").AsVariant = P.Item(i).DateBegin
              gdcSalary.FieldByName("USR$SALARY").AsVariant = P.Item(i).Sum
              gdcSalary.FieldByName("USR$COEFF").AsVariant = P.Item(i).coeff
              gdcSalary.FieldByName("USR$DOW").AsVariant = P.Item(i).WorkDays 'wg_WageSettings.Wage.AvgDayInMonth '29.7
              gdcSalary.FieldByName("USR$HOW").AsVariant = P.Item(i).WorkHours
              gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = P.Item(i).SchedulerWorkDays 'wg_WageSettings.Wage.AvgDayInMonth '29.7
              gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = P.Item(i).SchedulerWorkHours
              gdcSalary.FieldByName("USR$OLDSALARY").AsVariant = P.Item(i).OldSalary
              gdcSalary.FieldByName("USR$NEWSALARY").AsVariant = P.Item(i).NewSalary
              gdcSalary.FieldByName("USR$ISCHECK").AsVariant = Abs(CInt(P.Item(i).IsCheck))
              gdcSalary.FieldByName("USR$ISFULL").AsVariant = Abs(CInt(P.Item(i).IsFull))
              gdcSalary.Post
            end if
          next
          gdcSalary.First
        
          call wg_EnableFieldChange(gdcSalary, "AVGSALARYCALC")
          wg_GetAvgSalarySum(gdcSalary)
        end function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        UFJTVAgAAABDQUxDVFlQRQgAAABDQUxDVFlQRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-22T14:33:31+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "147368587_274788016 wg_GetAvgSalarySum"
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151164077_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros151164077_5956463"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate
        
        Sub Macros151164077_5956463(OwnerForm)
          'Dim Ret
          
          call wg_AvgSalaryStrGenerate(OwnerForm, 0)
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS151164077_5956463
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-01-10T16:42:52+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147489128_336327731 wg_AvgSalaryStrGenerate"
  - 
    Properties: 
      Class: "TgdcMacrosGroup"
      RUID: 147021904_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151164075_5956463
    Fields: 
      HASCHILDREN: 1
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTPARENT: ~
      CLASSNAME: ""
      SUBTYPE: ""
      PARENT: ~
      NAME: "Локальные макросы"
      ISGLOBAL: 0
      DESCRIPTION: ~
      EDITIONDATE: 2004-05-05T14:36:35+03:00
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 151164075_5956463
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MACROSGROUPKEY: "147021904_119619099 Локальные макросы"
      FUNCTIONKEY: "151164077_5956463 Macros151164077_5956463"
      NAME: "Рассчитать ср. заработок"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-01-10T16:42:52+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147488902_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147488903_336327731
    Fields: 
      NAME: "usrg_actAvgGenerate"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actAvgGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-03-17T12:29:19+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147488905_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147488903_336327731
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actAvgGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_AvgSalaryStrGenerate_pl
        option explicit
        sub usrg_actAvgGenerateOnExecute(ByVal Sender)
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          Dim Ret
          Ret = wg_AvgSalaryStrGenerate_pl(Sender.OwnerForm, 0)
        
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_ACTAVGGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-01-10T16:18:57+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151163587_5956463 wg_AvgSalaryStrGenerate_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147488903_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actAvgGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147488902_336327731 gdc_dlgUserComplexDocument147020774_119619099\\usrg_actAvgGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147488905_336327731 usrg_actAvgGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2005-06-30T10:58:02+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147352480_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147352481_274788016
    Fields: 
      NAME: "usrg_actGenerate"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-01-20T15:51:14+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147352483_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147352481_274788016
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#wg_LastDayInMonth
        '#include wg_AvgSalaryDetailGenerate_pl
        
        sub usrg_actGenerateOnExecute(ByVal Sender)
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          Dim Ret
          Ret = wg_AvgSalaryDetailGenerate_pl(Sender.OwnerForm)
        
          'Sender.OwnerForm.GetComponent("ibgrDetail").SetFocus
          'set wg_Structure = Sender.OwnerForm.Objects("Structure")
          'call wg_Structure.CreateHolidayStructure(Sender.OwnerForm)
        
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_ACTGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-13T18:35:55+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "156300136_119200397 wg_AvgSalaryDetailGenerate_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147352481_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147352480_274788016 gdc_dlgUserComplexDocument147020774_119619099\\usrg_actGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147352483_274788016 usrg_actGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-03-13T18:35:56+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147107645_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147107643_584838465
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "gdc_dlgUserComplexDocument147020774_119619099OnLoadSettingsAfterCreate"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        '#include wg_AvgSalary_CoefOption
        
        sub gdc_dlgUserComplexDocument147020774_119619099OnLoadSettingsAfterCreate(ByVal Sender)
        '*** Данный код необходим для вызова встроенного обработчика ***
        '*** В случае его удаления возможно нарушение работы системы ***
          call   Inherited(Sender, "OnLoadSettingsAfterCreate", Array(Sender))
        '*** конец кода поддержки встроенного обработчика            ***
          set S = wg_WageSettings
        
          ''оключено
          'set chboxCoefInflation = Sender.GetComponent("usrg_chboxCoefInflation")
          'chboxCoefInflation.Checked = S.Wage.CoefInflation
          ''сейчас используется
          wg_AvgSalary_CoefOption(Sender)
          '
        
          'Устарело
          if not Sender.VariableExists("Coeff") then
           Sender.AddVariableItem("Coeff")
          end if
          Sender.Variables("Coeff") = S.Wage.CoefInflation
          'Новые
          set rbSalaryInf = Sender.GetComponent("usrg_rbSalaryInf")
          set rbRateInf = Sender.GetComponent("usrg_rbRateInf")
          set rbPersCoeffInf = Sender.GetComponent("usrg_rbPersCoeffInf")
          select case S.Inflation.InflType
            case 0
              Sender.GetComponent("usrg_rbSalaryInf").Checked = True
            case 1
              Sender.GetComponent("usrg_rbRateInf").Checked = True
            case 2
              Sender.GetComponent("usrg_rbPersCoeffInf").Checked = True
          end select
          if not Sender.VariableExists("NewCoeff") then
            Sender.AddVariableItem("NewCoeff")
          end if
          Sender.Variables("NewCoeff") = S.Inflation.InflType
        end sub
        
      DISPLAYSCRIPT: | 
        GDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099ONLOADSETTINGSAFTERCREATE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONLOADSETTINGSAFTERCREATE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-26T14:18:46+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
          - 
            ADDFUNCTIONKEY: "156299481_119200397 wg_AvgSalary_CoefOption"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147107643_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      PARENTNAME: ~
      OBJECTKEY: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      EVENTNAME: "ONLOADSETTINGSAFTERCREATE"
      FUNCTIONKEY: "147107645_584838465 gdc_dlgUserComplexDocument147020774_119619099OnLoadSettingsAfterCreate"
      DISABLE: ~
      EDITIONDATE: 2014-03-26T14:18:46+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147107754_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147107903_584838465
    Fields: 
      NAME: "usrg_chboxCoefInflation"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_chboxCoefInflation"
      SUBTYPE: ""
      EDITIONDATE: 2006-06-15T10:53:41+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147107905_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147107903_584838465
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_chboxCoefInflationOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        sub usrg_chboxCoefInflationOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          set S = wg_WageSettings
          set chboxCoefInflation = Sender
          S.Wage.CoefInflation = chboxCoefInflation.Checked
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_CHBOXCOEFINFLATIONONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:26:40+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147107903_584838465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_chboxCoefInflation"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147107754_584838465 gdc_dlgUserComplexDocument147020774_119619099\\usrg_chboxCoefInflation"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147107905_584838465 usrg_chboxCoefInflationOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:26:41+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147036259_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036260_781744915
    Fields: 
      NAME: "usrg_rbPersCoeffInf"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_rbPersCoeffInf"
      SUBTYPE: ""
      EDITIONDATE: 2007-04-02T14:55:25+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147036262_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036260_781744915
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_rbPersCoeffInfOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        option explicit
        sub usrg_rbPersCoeffInfOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          dim S
          set S = wg_WageSettings
          if Sender.Checked then
            S.Inflation.InflType = 2
          end if
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_RBPERSCOEFFINFONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:06:09+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147036260_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_rbPersCoeffInf"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147036259_781744915 gdc_dlgUserComplexDocument147020774_119619099\\usrg_rbPersCoeffInf"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147036262_781744915 usrg_rbPersCoeffInfOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:06:09+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147036255_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036256_781744915
    Fields: 
      NAME: "usrg_rbRateInf"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_rbRateInf"
      SUBTYPE: ""
      EDITIONDATE: 2007-04-02T14:55:17+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147036258_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036256_781744915
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_rbRateInfOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        option explicit
        sub usrg_rbRateInfOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          dim S
          set S = wg_WageSettings
          if Sender.Checked then
            S.Inflation.InflType = 1
          end if
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_RBRATEINFONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:26:35+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147036256_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_rbRateInf"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147036255_781744915 gdc_dlgUserComplexDocument147020774_119619099\\usrg_rbRateInf"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147036258_781744915 usrg_rbRateInfOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:26:35+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147036251_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036252_781744915
    Fields: 
      NAME: "usrg_rbSalaryInf"
      DESCRIPTION: ~
      PARENT: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_rbSalaryInf"
      SUBTYPE: ""
      EDITIONDATE: 2007-04-02T14:55:00+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147036254_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147036252_781744915
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_rbSalaryInfOnClick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_WageSettings
        option explicit
        sub usrg_rbSalaryInfOnClick(ByVal Sender)
          Exit Sub 'работает OnLoadSettingsAfterCreate
          dim S
          set S = wg_WageSettings
          if Sender.Checked then
            S.Inflation.InflType = 0
          end if
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_RBSALARYINFONCLICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONCLICK"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021903_119619099 gdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-03T15:26:29+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147019760_119619099 wg_WageSettings"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147036252_781744915
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_rbSalaryInf"
      PARENTNAME: "gdc_dlgUserComplexDocument147020774_119619099"
      OBJECTKEY: "147036251_781744915 gdc_dlgUserComplexDocument147020774_119619099\\usrg_rbSalaryInf"
      EVENTNAME: "ONCLICK"
      FUNCTIONKEY: "147036254_781744915 usrg_rbSalaryInfOnClick"
      DISABLE: 1
      EDITIONDATE: 2014-03-03T15:26:29+03:00
  - 
    Properties: 
      Class: "TgdcAttrUserDefinedLBRBTree"
      SubType: "USR$WG_FEEGROUP"
      RUID: 147757383_84733194
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      PARENT: "147071456_274788016 Все начисления\\Ср. заработок\\Ср. заработок для отпусков"
      DISABLED: 0
      EDITIONDATE: 2014-01-08T18:30:20+03:00
      USR$NAME: "Ср. заработок для отпусков - не осовременивать"
      USR$DESCRIPTION: ~
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123486_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      PARENT: "147240236_1234867257 GLOBAL\\DFM\\Tgdc_dlgUserComplexDocument"
      NAME: "147022845_119619099"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: | 
        object gdc_dlgUserComplexDocument147022845_119619099: Tgdc_dlgUserComplexDocument
          Left = -8
          Top = -8
          ActiveControl = nil
          WindowState = wsMaximized
          PixelsPerInch = 96
          TextHeight = 13
          object btnAccess: TButton
            TabOrder = 3
          end
          object btnNew: TButton
            TabOrder = 4
          end
          object btnHelp: TButton
            TabOrder = 5
          end
          object btnOK: TButton
            TabOrder = 1
          end
          object btnCancel: TButton
            TabOrder = 2
          end
          object pnlMain: TPanel
            TabOrder = 0
            object splMain: TSplitter
            end
            object usrg_Splitter1: TSplitter
              Tag = 0
              Left = 541
              Top = 291
              Width = 6
              Height = 388
              Cursor = crHSplit
              Hint = ''
              Align = alLeft
              AutoSnap = True
              Beveled = False
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              MinSize = 30
              ParentColor = True
              ResizeStyle = rsPattern
              Visible = True
            end
            object pnlDetail: TPanel
              Width = 541
              Align = alLeft
              Anchors = [akLeft, akTop, akBottom]
              TabOrder = 1
              object ibgrDetail: TgsIBGrid
                Left = 0
                Width = 541
                Height = 362
                ReadOnly = True
                Expands = <>
                Conditions = <>
                ColumnEditors = <>
                Aliases = <>
                Columns = <
                  item
                    Expanded = False
                    FieldName = 'USR$INCLUDEDATE'
                    ReadOnly = False
                    Title.Caption = 'Месяц зачисления'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$PERCENT'
                    ReadOnly = False
                    Title.Caption = '%'
                    Width = 36
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$DOI'
                    ReadOnly = False
                    Title.Caption = 'Дни'
                    Width = 48
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$HOI'
                    ReadOnly = False
                    Title.Caption = 'Часы'
                    Width = 48
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'USR$SUMMA'
                    ReadOnly = False
                    Title.Caption = 'Сумма'
                    Width = 72
                    Visible = True
                    TotalType = ttSum
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEBEGIN'
                    ReadOnly = False
                    Title.Caption = 'Дата начала'
                    Width = 84
                    Visible = True
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$DATEEND'
                    ReadOnly = False
                    Title.Caption = 'Дата окончания'
                    Width = 108
                    Visible = True
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'SUMNCU'
                    ReadOnly = False
                    Title.Caption = 'Начислено'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DESCRIPTION'
                    ReadOnly = False
                    Title.Caption = 'Описание'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$SORTNUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер для сортировки'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'ID'
                    ReadOnly = False
                    Title.Caption = 'Ключ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PARENT'
                    ReadOnly = False
                    Title.Caption = 'Родитель'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRTYPEKEY'
                    ReadOnly = False
                    Title.Caption = 'Тип транзакции'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'TRANSACTIONKEY'
                    ReadOnly = False
                    Title.Caption = 'Транзакция'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'NUMBER'
                    ReadOnly = False
                    Title.Caption = 'Номер'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMCURR'
                    ReadOnly = False
                    Title.Caption = 'Сумма в валюте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DELAYED'
                    ReadOnly = False
                    Title.Caption = 'Отложенный'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CURRKEY'
                    ReadOnly = False
                    Title.Caption = 'Валюта'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'COMPANYKEY'
                    ReadOnly = False
                    Title.Caption = 'Компания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто создал'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'CREATIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата создания'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITORKEY'
                    ReadOnly = False
                    Title.Caption = 'Кто исправил'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'EDITIONDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата изменения'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'PRINTDATE'
                    ReadOnly = False
                    Title.Caption = 'Дата печати'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DISABLED'
                    ReadOnly = False
                    Title.Caption = 'Отключено'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED'
                    ReadOnly = False
                    Title.Caption = 'Зарезервировано'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'DOCUMENTKEY'
                    Title.Caption = 'Ключ документа'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'MASTERKEY'
                    Title.Caption = 'Родитель (05.Начисление болничных(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'RESERVED1'
                    Title.Caption = 'Зарезервировано (05.Начисление болничных(позиция))'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$ACCDATE'
                    ReadOnly = False
                    Title.Caption = 'Месяц начисления'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'SUMEQ'
                    ReadOnly = False
                    Title.Caption = 'Сумма в эквиваленте'
                    Width = -1
                    Visible = False
                  end
                  item
                    Expanded = False
                    FieldName = 'USR$EQRATE'
                    ReadOnly = False
                    Title.Caption = 'Курс экв.'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AFULL'
                    ReadOnly = False
                    Title.Caption = 'Полный доступ'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'ACHAG'
                    ReadOnly = False
                    Title.Caption = 'Просмотр и редактирование'
                    Width = -1
                    Visible = False
                  end
                  item
                    Alignment = taRightJustify
                    Expanded = False
                    FieldName = 'AVIEW'
                    ReadOnly = False
                    Title.Caption = 'Только просмотр'
                    Width = -1
                    Visible = False
                  end>
              end
              object tbdTop: TTBDock
                Width = 541
                object tbDetail: TTBToolbar
                  DockPos = 1
                  SavedAtRunTime = True
                  object tbNew: TTBItem
                  end
                  object tbEdit: TTBItem
                  end
                  object tbDelete: TTBItem
                  end
                  object tbDuplicate: TTBItem
                  end
                  object tbiDetailProperties: TTBItem
                  end
                  object TBSeparatorItem1: TTBSeparatorItem
                  end
                  object tbCopy: TTBItem
                  end
                  object tbCut: TTBItem
                  end
                  object tbPaste: TTBItem
                  end
                  object TBSeparatorItem2: TTBSeparatorItem
                  end
                  object tbMacro: TTBItem
                  end
                  object usrg_TBSeparatorItem1: TTBSeparatorItem
                    Tag = 0
                    Blank = False
                    Hint = ''
                    Visible = True
                  end
                  object usrg_TBItem2: TTBItem
                    Tag = 0
                    Action = usrg_actGenerate
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_TBItem1: TTBItem
                    Tag = 0
                    Action = usrg_actStrGen
                    AutoCheck = False
                    DisplayMode = nbdmDefault
                    GroupIndex = 0
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                  end
                  object usrg_tbFeesByEmpl: TTBItem
                    Tag = 0
                    Action = nil
                    AutoCheck = False
                    Caption = 'Итоговое'
                    Checked = False
                    DisplayMode = nbdmDefault
                    Enabled = True
                    GroupIndex = 0
                    HelpContext = 0
                    Hint = ''
                    ImageIndex = -1
                    Images = nil
                    InheritOptions = True
                    MaskOptions = []
                    Options = []
                    RadioItem = False
                    ShortCut = 0
                    Visible = True
                  end
                end
              end
              object tbdLeft: TTBDock
                Width = 0
                Height = 362
              end
              object tbdRight: TTBDock
                Left = 541
                Width = 0
                Height = 362
              end
              object tbdBottom: TTBDock
                Top = 388
                Width = 541
                Height = 0
              end
            end
            object pnlMaster: TPanel
              Constraints.MinHeight = 215
              TabOrder = 0
              object pnlHolding: TPanel
                Width = 1366
                TabOrder = 1
                object lblCompany: TLabel
                end
                object iblkCompany: TgsIBLookupComboBox
                end
              end
              object usrg_PageControl1: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 1366
                Height = 287
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet1
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet1: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Основные'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_GroupBox1: TGroupBox
                    Tag = 0
                    Left = 0
                    Top = 128
                    Width = 1358
                    Height = 131
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    Caption = ' Средний заработок '
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ParentBiDiMode = True
                    ParentColor = True
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 1
                    TabStop = False
                    Visible = True
                    object usrat_DBEdit_USR_AVGPERIOD_Label: TLabel
                      Left = 7
                      Top = 44
                      Width = 119
                      Caption = 'Период формирования:'
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY_Label: TLabel
                      Left = 7
                      Top = 20
                    end
                    object usrat_DBEdit_USR_AVGSUMMA_Label: TLabel
                      Left = 373
                      Top = 20
                    end
                    object usrat_DBEdit_USR_AVGPERIOD: TxDBCalculatorEdit
                      Left = 143
                      Top = 40
                      Width = 100
                      Cursor = crIBeam
                      TabOrder = 1
                    end
                    object usrat_gsIBLookupComboBox_USR_FEEGROUPKEY: TgsIBLookupComboBox
                      Left = 143
                      Top = 16
                      Width = 212
                      ListTable = 
                        'USR$WG_FEEGROUP fg LEFT JOIN USR$WG_FEEGROUP fg1 ON fg.lb > fg1.' +
                        'lb AND fg.rb < fg1.rb'
                      Condition = 'fg1.id = <RUID XID = 147274328 DBID = 274788016/>'
                      TabOrder = 0
                    end
                    object usrat_DBEdit_USR_AVGSUMMA: TxDBCalculatorEdit
                      Left = 467
                      Top = 16
                      Width = 93
                      Cursor = crIBeam
                      ReadOnly = True
                      TabOrder = 4
                    end
                    object usrat_DBCheckBox_USR_BYSTAFFSALARY: TDBCheckBox
                      Left = 375
                      Top = 56
                      Width = 161
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_DBCheckBox_USR_CALCBYHOUR: TDBCheckBox
                      Left = 375
                      Top = 73
                      Width = 114
                      TabOrder = 3
                      ValueChecked = '1'
                      ValueUnchecked = '0'
                      Visible = False
                    end
                    object usrat_DBCheckBox_USR_CALCBYBUDGET: TDBCheckBox
                      Left = 8
                      Top = 86
                      Hint = '50% от БМП'
                      Caption = '50% от БПМ'
                      ReadOnly = True
                    end
                    object usrat_DBCheckBox_USR_THIRDMETHOD: TDBCheckBox
                      Left = 8
                      Top = 67
                      Width = 117
                      Caption = 'Расчёт от ставки'
                      ReadOnly = True
                    end
                    object usrat_DBCheckBox_USR_REFERENCE: TDBCheckBox
                      Left = 143
                      Top = 77
                      TabOrder = 7
                    end
                    object usrat_DBCheckBox_USR_AVERAGE: TDBCheckBox
                      Left = 8
                      Top = 103
                      Width = 149
                      Caption = 'От среднего заработка'
                      ReadOnly = True
                      TabOrder = 8
                    end
                  end
                  object usrg_Panel1: TPanel
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 1358
                    Height = 128
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    Align = alTop
                    Alignment = taCenter
                    Anchors = [akLeft, akTop, akRight]
                    AutoSize = False
                    BevelInner = bvRaised
                    BevelOuter = bvLowered
                    BevelWidth = 1
                    BorderWidth = 0
                    BorderStyle = bsNone
                    Caption = ''
                    Color = clBtnFace
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    UseDockManager = True
                    DockSite = False
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    FullRepaint = True
                    Locked = False
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    TabOrder = 0
                    TabStop = False
                    Visible = True
                    object usrg_Label1: TLabel
                      Tag = 0
                      Left = 7
                      Top = 80
                      Width = 66
                      Height = 13
                      Cursor = crDefault
                      Hint = ''
                      Align = alNone
                      Alignment = taLeftJustify
                      Anchors = [akLeft, akTop]
                      AutoSize = True
                      Caption = 'Тип расчета:'
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      Enabled = True
                      FocusControl = nil
                      ParentBiDiMode = True
                      ParentColor = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      ShowAccelChar = True
                      Transparent = True
                      Layout = tlTop
                      Visible = True
                      WordWrap = False
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY_Label: TLabel
                      Left = 7
                      Top = 35
                    end
                    object usrat_xDateDBEdit_USR_FROM_Label: TLabel
                      Left = 317
                      Top = 12
                    end
                    object usrat_gsIBLookupComboBox_USR_ILLTYPEKEY_Label: TLabel
                      Left = 7
                      Top = 58
                    end
                    object usrat_xDateDBEdit_USR_DATEEND_Label: TLabel
                      Left = 317
                      Top = 58
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN_Label: TLabel
                      Left = 317
                      Top = 35
                    end
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY_Label: TLabel
                      Left = 7
                      Top = 12
                    end
                    object usrat_DBEdit_USR_PERCENT_Label: TLabel
                      Left = 317
                      Top = 81
                      Width = 91
                      Caption = 'Процент пособия:'
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY_Label: TLabel
                      Left = 8
                      Top = 104
                      Width = 76
                      Caption = 'По должности:'
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDE_Label: TLabel
                      Left = 586
                      Top = 58
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDB_Label: TLabel
                      Left = 587
                      Top = 35
                    end
                    object usrg_cbCalcType: TComboBox
                      Tag = 0
                      Left = 133
                      Top = 77
                      Width = 156
                      Height = 21
                      Cursor = crDefault
                      Hint = ''
                      HelpContext = 0
                      TabStop = True
                      Style = csDropDownList
                      Anchors = [akLeft, akTop]
                      Color = clWindow
                      Constraints.MaxHeight = 0
                      Constraints.MaxWidth = 0
                      Constraints.MinHeight = 0
                      Constraints.MinWidth = 0
                      DragCursor = crDrag
                      DragKind = dkDrag
                      DragMode = dmManual
                      DropDownCount = 3
                      Enabled = True
                      ImeMode = imDontCare
                      ImeName = ''
                      ItemHeight = 13
                      MaxLength = 0
                      ParentBiDiMode = True
                      ParentColor = False
                      ParentCtl3D = True
                      ParentFont = True
                      ParentShowHint = True
                      PopupMenu = nil
                      Sorted = False
                      TabOrder = 3
                      Text = '12 дн. 80%, ост. 100%'
                      Visible = True
                      Items.Strings = (
                        '12 дн. 80%, ост. 100%'
                        'Все дни 100%'
                        '12 дн. 40% (6 дн. не оплач), ост. 50%'
                        '12 дн. 40%, ост. 50%')
                    end
                    object usrat_gsIBLookupComboBox_USR_EMPLKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 31
                      Width = 156
                      ListTable = 
                        'GD_CONTACT C JOIN GD_CONTACT CC ON CC.LB <= C.LB AND CC.RB >= C.' +
                        'RB'
                      SortOrder = soAsc
                      Condition = 'c.contacttype = 2 AND cc.id = <COMPANYKEY/>'
                      SubType = ''
                      TabOrder = 1
                    end
                    object usrat_xDateDBEdit_USR_FROM: TxDateDBEdit
                      Left = 491
                      Top = 8
                      Width = 68
                      TabOrder = 5
                    end
                    object usrat_gsIBLookupComboBox_USR_ILLTYPEKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 54
                      Width = 156
                      TabOrder = 2
                    end
                    object usrat_xDateDBEdit_USR_DATEBEGIN: TxDateDBEdit
                      Left = 491
                      Top = 31
                      Width = 68
                      TabOrder = 6
                    end
                    object usrat_xDateDBEdit_USR_DATEEND: TxDateDBEdit
                      Left = 491
                      Top = 54
                      Width = 68
                      TabOrder = 7
                    end
                    object usrat_gsIBLookupComboBox_USR_TOTALDOCKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 8
                      Width = 156
                      ListTable = 
                        'usr$wg_total t LEFT JOIN GD_DOCUMENT doc ON doc.id = t.documentk' +
                        'ey'
                      ListField = 'usr$name'
                      KeyField = 'documentkey'
                      SortOrder = soAsc
                      Condition = 'parent is null and doc.companykey = <companykey/>'
                      gdClassName = 'TgdcUserDocument'
                      SubType = '147567052_119619099'
                      ParentShowHint = False
                      ShowHint = True
                      TabOrder = 0
                    end
                    object usrat_DBEdit_USR_PERCENT: TxDBCalculatorEdit
                      Left = 491
                      Top = 77
                      Width = 69
                      Cursor = crIBeam
                      TabOrder = 8
                    end
                    object usrat_gsIBLookupComboBox_USR_FIRSTMOVEKEY: TgsIBLookupComboBox
                      Left = 133
                      Top = 101
                      Width = 156
                      Fields = 'l.POSNAME, l.DEPTNAME, l.KINDOFWORKNAME'
                      ListTable = 'USR$WG_P_FMKLOOKUPSETTINGS (:emplkey, :dateend)  l'
                      ListField = 'l.POSID'
                      KeyField = 'l.FMK'
                      Condition = ''
                      TabOrder = 4
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDB: TxDateDBEdit
                      Left = 716
                      Top = 31
                      Width = 68
                      TabOrder = 9
                    end
                    object usrat_xDateDBEdit_USR_VIOLATDE: TxDateDBEdit
                      Left = 716
                      Top = 54
                      Width = 68
                      TabOrder = 10
                    end
                  end
                end
                object usrg_TabSheet2: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Атрибуты'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object atContainer: TatContainer
                    Top = 0
                    Width = 1358
                    Height = 234
                    VertScrollBar.Position = 274
                    TabOrder = 0
                    Visible = False
                    object usrat_DBEdit_USR_DURATION_Label: TLabel
                      Top = -58
                      Visible = False
                    end
                    object usrat_DBEdit_USR_CALCTYPE_Label: TLabel
                      Left = 29
                      Top = -169
                      Visible = False
                    end
                    object usrat_DBEdit_NUMBER_Label: TLabel
                      Left = 5
                      Top = -242
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE_Label: TLabel
                      Top = -266
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER_Label: TLabel
                      Left = 5
                      Top = -213
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE_Label: TLabel
                      Top = 217
                    end
                    object usrat_DBEdit_USR_DURATION: TxDBCalculatorEdit
                      Top = -62
                      Cursor = crIBeam
                      TabOrder = 4
                      Visible = False
                    end
                    object usrat_DBEdit_USR_CALCTYPE: TxDBCalculatorEdit
                      Left = 157
                      Top = -173
                      Width = 156
                      Cursor = crIBeam
                      TabOrder = 3
                      Visible = False
                    end
                    object usrat_DBEdit_NUMBER: TDBEdit
                      Left = 163
                      Top = -246
                      Width = 101
                      TabOrder = 2
                      Visible = False
                    end
                    object usrat_xDateDBEdit_DOCUMENTDATE: TxDateDBEdit
                      Left = 163
                      Top = -270
                      Width = 102
                      TabOrder = 1
                      Visible = False
                    end
                    object usrat_DBEdit_USR_SORTNUMBER: TxDBCalculatorEdit
                      Left = 163
                      Top = -213
                      Cursor = crIBeam
                      TabOrder = 0
                      Visible = False
                    end
                    object usrat_DBEdit_USR_EQRATE: TxDBCalculatorEdit
                      Top = 213
                      Cursor = crIBeam
                      TabOrder = 5
                    end
                  end
                end
              end
            end
            object usrg_pAvgSalary: TPanel
              Tag = 0
              Left = 547
              Top = 291
              Width = 819
              Height = 388
              Cursor = crDefault
              Hint = ''
              HelpContext = 0
              Align = alClient
              Alignment = taCenter
              Anchors = [akLeft, akTop, akRight, akBottom]
              AutoSize = False
              BevelInner = bvNone
              BevelOuter = bvNone
              BevelWidth = 1
              BorderWidth = 0
              BorderStyle = bsNone
              Caption = ''
              Color = clBtnFace
              Constraints.MaxHeight = 0
              Constraints.MaxWidth = 0
              Constraints.MinHeight = 0
              Constraints.MinWidth = 0
              UseDockManager = True
              DockSite = False
              DragCursor = crDrag
              DragKind = dkDrag
              DragMode = dmManual
              Enabled = True
              FullRepaint = True
              Locked = False
              ParentBiDiMode = True
              ParentColor = False
              ParentCtl3D = True
              ParentFont = True
              ParentShowHint = True
              PopupMenu = nil
              TabOrder = 2
              TabStop = False
              Visible = True
              object usrg_PageControl2: TPageControl
                Tag = 0
                Left = 0
                Top = 0
                Width = 819
                Height = 388
                Cursor = crDefault
                Hint = ''
                HelpContext = 0
                ActivePage = usrg_TabSheet3
                Align = alClient
                Anchors = [akLeft, akTop, akRight, akBottom]
                Constraints.MaxHeight = 0
                Constraints.MaxWidth = 0
                Constraints.MinHeight = 0
                Constraints.MinWidth = 0
                DockSite = False
                DragCursor = crDrag
                DragKind = dkDrag
                DragMode = dmManual
                Enabled = True
                HotTrack = False
                Images = nil
                MultiLine = False
                OwnerDraw = False
                ParentBiDiMode = True
                ParentFont = True
                ParentShowHint = True
                PopupMenu = nil
                RaggedRight = False
                ScrollOpposite = False
                Style = tsTabs
                TabHeight = 0
                TabOrder = 0
                TabPosition = tpTop
                TabStop = True
                TabWidth = 0
                Visible = True
                object usrg_TabSheet3: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Расчет структуры ср. заработка'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = True
                  object usrg_grAvgSalaryStr: TgsIBGrid
                    Tag = 0
                    Left = 0
                    Top = 26
                    Width = 811
                    Height = 334
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    TabStop = True
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    BorderStyle = bsNone
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    DataSource = usrg_dsAvgSalaryStr
                    DefaultDrawing = True
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ImeMode = imDontCare
                    ImeName = ''
                    Options = [dgEditing, dgTitles, dgIndicator, dgColumnResize, dgColLines, dgRowLines, dgTabs, dgConfirmDelete, dgCancelOnExit, dgMultiSelect]
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = True
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    ReadOnly = True
                    TabOrder = 0
                    Visible = True
                    TableColor = clWindow
                    SelectedColor = clHighlight
                    TitleColor = clBtnFace
                    RefreshType = rtCloseOpen
                    Striped = True
                    StripeOdd = 15201271
                    StripeEven = 14084071
                    InternalMenuKind = imkWithSeparator
                    Expands = <>
                    ExpandsActive = False
                    ExpandsSeparate = False
                    TitlesExpanding = False
                    Conditions = <>
                    ConditionsActive = False
                    CheckBox.DisplayField = 'USR$ISCHECK'
                    CheckBox.FieldName = 'USR$ISCHECK'
                    CheckBox.Visible = False
                    CheckBox.FirstColumn = False
                    ScaleColumns = False
                    MinColWidth = 40
                    ToolBar = nil
                    FinishDrawing = True
                    RememberPosition = True
                    SaveSettings = True
                    ColumnEditors = <
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISCHECK'
                        DisplayField = 'USR$ISCHECK'
                        ValueList.Strings = (
                          'Нет=0'
                          'Да=1')
                        DropDownCount = 3
                      end
                      item
                        Lookup.Distinct = False
                        EditorStyle = cesValueList
                        FieldName = 'USR$ISFULL'
                        DisplayField = 'USR$ISFULL'
                        ValueList.Strings = (
                          'Да=1'
                          'Нет=0')
                        DropDownCount = 3
                      end>
                    Aliases = <>
                    ShowFooter = False
                    ShowTotals = True
                    Columns = <
                      item
                        Expanded = False
                        FieldName = 'USR$ISFULL'
                        ReadOnly = False
                        Title.Caption = 'Полный месяц'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = 72
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$CALCDAYS'
                        ReadOnly = False
                        Title.Caption = 'Дни расчет.'
                        Width = 78
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$SALARY'
                        ReadOnly = False
                        Title.Caption = 'Зарплата'
                        Width = 72
                        Visible = True
                        DisplayFormat = '#.##'
                        TotalType = ttSum
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$DOW'
                        ReadOnly = False
                        Title.Caption = 'Дни работы'
                        Width = 78
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERDOW'
                        ReadOnly = False
                        Title.Caption = 'Дней по графику'
                        Width = 84
                        Visible = True
                      end
                      item
                        Alignment = taRightJustify
                        Expanded = False
                        FieldName = 'USR$HOW'
                        ReadOnly = False
                        Title.Caption = 'Часы работы'
                        Width = 66
                        Visible = True
                        TotalType = ttSum
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$SCHEDULERHOW'
                        ReadOnly = False
                        Title.Caption = 'Часов по графику'
                        Width = 90
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DESCRIPTION'
                        ReadOnly = False
                        Title.Caption = 'Описание'
                        Width = 121
                        Visible = True
                      end
                      item
                        Color = clWhite
                        Expanded = False
                        FieldName = 'USR$MODERNSALARY'
                        ReadOnly = False
                        Title.Caption = 'Современная зарплата'
                        Width = -1
                        Visible = False
                        DisplayFormat = '#.##'
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$COEFF'
                        ReadOnly = False
                        Title.Caption = 'Коэф-т'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$ISCHECK'
                        ReadOnly = False
                        Title.Caption = 'Вкл.'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$OLDSALARY'
                        ReadOnly = False
                        Title.Caption = 'Оклад'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$NEWSALARY'
                        ReadOnly = False
                        Title.Caption = 'Ставка'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'ID'
                        Title.Caption = 'Идентификатор'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'USR$DOCUMENTKEY'
                        ReadOnly = False
                        Title.Caption = 'Документ'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_NUMBER'
                        ReadOnly = False
                        Title.Caption = 'Номер'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOCUMENTDATE'
                        ReadOnly = False
                        Title.Caption = 'Дата'
                        Width = -1
                        Visible = False
                      end
                      item
                        Expanded = False
                        FieldName = 'Z_USR$DOCUMENTKEY_DOC2715260478'
                        ReadOnly = False
                        Title.Caption = 'Тип документа'
                        Width = -1
                        Visible = False
                      end>
                  end
                  object usrg_TBDock1: TTBDock
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 811
                    Height = 26
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    AllowDrag = True
                    Background = nil
                    BackgroundOnToolbars = True
                    BoundLines = []
                    Color = clBtnFace
                    FixAlign = False
                    LimitToOneRow = False
                    PopupMenu = nil
                    Position = dpTop
                    Visible = True
                    object usrg_TBToolbar1: TTBToolbar
                      Tag = 0
                      Left = 0
                      Top = 0
                      Cursor = crDefault
                      HelpContext = 0
                      ActivateParent = True
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      AutoResize = True
                      BorderStyle = bsSingle
                      Caption = 'tbDetail'
                      ChevronMoveItems = True
                      ChevronPriorityForNewItems = tbcpHighest
                      CloseButton = False
                      CloseButtonWhenDocked = False
                      Color = clBtnFace
                      DefaultDock = nil
                      DockableTo = [dpTop, dpBottom, dpLeft, dpRight]
                      DockMode = dmCannotFloatOrChangeDocks
                      DockPos = 0
                      DockRow = 0
                      DragHandleStyle = dhSingle
                      FloatingMode = fmOnTopOfParentForm
                      FloatingWidth = 0
                      FullSize = False
                      HideWhenInactive = True
                      Images = dmImages.il16x16
                      LinkSubitems = nil
                      MenuBar = False
                      Options = []
                      ParentFont = True
                      ParentShowHint = False
                      PopupMenu = nil
                      ProcessShortCuts = False
                      Resizable = True
                      ShowCaption = True
                      ShowHint = True
                      ShrinkMode = tbsmChevron
                      SmoothDrag = True
                      Stretch = True
                      SystemFont = True
                      TabOrder = 0
                      UpdateActions = True
                      UseLastDock = True
                      Visible = True
                      SavedAtRunTime = True
                      object usrg_TBItem3: TTBItem
                        Tag = 0
                        Action = usrg_actAvgSalaryNew
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem4: TTBItem
                        Tag = 0
                        Action = usrg_actAvgSalaryEdit
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem5: TTBItem
                        Tag = 0
                        Action = usrg_actAvgSalaryDelete
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                      object usrg_TBItem6: TTBItem
                        Tag = 0
                        Action = nil
                        AutoCheck = False
                        Caption = 'Дубликат'
                        Checked = False
                        DisplayMode = nbdmDefault
                        Enabled = True
                        GroupIndex = 0
                        HelpContext = 0
                        Hint = 'Дубликат'
                        ImageIndex = 3
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                        ShortCut = 49237
                        Visible = False
                      end
                      object usrg_TBSeparatorItem2: TTBSeparatorItem
                        Tag = 0
                        Blank = False
                        Hint = ''
                        Visible = True
                      end
                      object usrg_TBItem7: TTBItem
                        Tag = 0
                        Action = usrg_actAvgGenerate
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = nil
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                    end
                  end
                end
                object usrg_TabSheet4: TTabSheet
                  Tag = 0
                  Cursor = crDefault
                  Hint = ''
                  HelpContext = 0
                  BorderWidth = 0
                  Caption = 'Структура больничного'
                  DragMode = dmManual
                  Enabled = True
                  Highlighted = False
                  ImageIndex = 0
                  Constraints.MaxHeight = 0
                  Constraints.MaxWidth = 0
                  Constraints.MinHeight = 0
                  Constraints.MinWidth = 0
                  ParentFont = True
                  ParentShowHint = True
                  PopupMenu = nil
                  TabVisible = False
                  object usrg_TBDock2: TTBDock
                    Tag = 0
                    Left = 0
                    Top = 0
                    Width = 811
                    Height = 26
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    AllowDrag = True
                    Background = nil
                    BackgroundOnToolbars = True
                    BoundLines = []
                    Color = clBtnFace
                    FixAlign = False
                    LimitToOneRow = False
                    PopupMenu = nil
                    Position = dpTop
                    Visible = True
                    object usrg_TBToolbar2: TTBToolbar
                      Tag = 0
                      Left = 0
                      Top = 0
                      Cursor = crDefault
                      HelpContext = 0
                      ActivateParent = True
                      Align = alNone
                      Anchors = [akLeft, akTop]
                      AutoResize = True
                      BorderStyle = bsSingle
                      Caption = 'usrg_TBToolbar2'
                      ChevronMoveItems = True
                      ChevronPriorityForNewItems = tbcpHighest
                      CloseButton = False
                      CloseButtonWhenDocked = False
                      Color = clBtnFace
                      DefaultDock = nil
                      DockableTo = [dpTop, dpBottom, dpLeft, dpRight]
                      DockMode = dmCannotFloatOrChangeDocks
                      DockPos = -1
                      DockRow = 0
                      DragHandleStyle = dhSingle
                      FloatingMode = fmOnTopOfParentForm
                      FloatingWidth = 0
                      FullSize = False
                      HideWhenInactive = True
                      Images = dmImages.il16x16
                      LinkSubitems = nil
                      MenuBar = False
                      Options = []
                      ParentFont = True
                      ParentShowHint = False
                      PopupMenu = nil
                      ProcessShortCuts = False
                      Resizable = True
                      ShowCaption = True
                      ShowHint = True
                      ShrinkMode = tbsmChevron
                      SmoothDrag = True
                      Stretch = True
                      SystemFont = True
                      TabOrder = 0
                      UpdateActions = True
                      UseLastDock = True
                      Visible = True
                      SavedAtRunTime = True
                      object usrg_TBItem8: TTBItem
                        Tag = 0
                        Action = usrg_actStrCalcOnUpdate
                        AutoCheck = False
                        DisplayMode = nbdmDefault
                        GroupIndex = 0
                        Images = dmImages.il16x16
                        InheritOptions = True
                        MaskOptions = []
                        Options = []
                        RadioItem = False
                      end
                    end
                  end
                  object usrg_grSickStr: TgsDBGrid
                    Tag = 0
                    Left = 0
                    Top = 26
                    Width = 811
                    Height = 334
                    Cursor = crDefault
                    Hint = ''
                    HelpContext = 0
                    TabStop = True
                    Align = alClient
                    Anchors = [akLeft, akTop, akRight, akBottom]
                    BorderStyle = bsSingle
                    Constraints.MaxHeight = 0
                    Constraints.MaxWidth = 0
                    Constraints.MinHeight = 0
                    Constraints.MinWidth = 0
                    Ctl3D = True
                    DataSource = usrg_dsSickStr
                    DefaultDrawing = True
                    DragCursor = crDrag
                    DragKind = dkDrag
                    DragMode = dmManual
                    Enabled = True
                    ImeMode = imDontCare
                    ImeName = ''
                    Options = [dgEditing, dgTitles, dgIndicator, dgColumnResize, dgColLines, dgTabs, dgConfirmDelete, dgCancelOnExit]
                    ParentBiDiMode = True
                    ParentColor = False
                    ParentCtl3D = False
                    ParentFont = True
                    ParentShowHint = True
                    PopupMenu = nil
                    ReadOnly = False
                    RefreshType = rtCloseOpen
                    TabOrder = 1
                    Visible = True
                    TableColor = clWindow
                    SelectedColor = clHighlight
                    TitleColor = clBtnFace
                    Striped = True
                    StripeOdd = 15201271
                    StripeEven = 14084071
                    InternalMenuKind = imkWithSeparator
                    Expands = <>
                    ExpandsActive = False
                    ExpandsSeparate = False
                    TitlesExpanding = False
                    Conditions = <>
                    ConditionsActive = False
                    CheckBox.DisplayField = ''
                    CheckBox.FieldName = ''
                    CheckBox.Visible = False
                    CheckBox.FirstColumn = False
                    ScaleColumns = True
                    MinColWidth = 40
                    ToolBar = nil
                    FinishDrawing = True
                    RememberPosition = True
                    SaveSettings = True
                    ShowTotals = True
                    ShowFooter = False
                    Columns = <
                      item
                        Expanded = False
                        FieldName = 'Дата'
                        Width = 83
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'Рабочий день'
                        Width = 75
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'Часы'
                        Width = 66
                        Visible = True
                      end
                      item
                        Expanded = False
                        FieldName = 'Процент'
                        Width = 567
                        Visible = True
                      end>
                  end
                end
              end
            end
          end
          object alBase: TActionList
            Left = 548
            Top = 8
            object actNew: TAction
            end
            object actHelp: TAction
            end
            object actSecurity: TAction
            end
            object actOk: TAction
            end
            object actCancel: TAction
            end
            object actNextRecord: TAction
            end
            object actPrevRecord: TAction
            end
            object actApply: TAction
            end
            object actFirstRecord: TAction
            end
            object actLastRecord: TAction
            end
            object actProperty: TAction
            end
            object actCopySettingsFromUser: TAction
            end
            object actAddToSetting: TAction
            end
            object actDocumentType: TAction
            end
            object actDistributeUserSettings: TAction
            end
            object actHistory: TAction
            end
            object actDetailNew: TAction
            end
            object actDetailEdit: TAction
            end
            object actDetailDelete: TAction
            end
            object actDetailDuplicate: TAction
            end
            object actDetailPrint: TAction
            end
            object actDetailCut: TAction
            end
            object actDetailCopy: TAction
            end
            object actDetailPaste: TAction
            end
            object actDetailMacro: TAction
            end
            object actDetailProp: TAction
            end
            object usrg_actAvgSalaryNew: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Добавить'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Добавить'
              ImageIndex = 0
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgSalaryEdit: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Редактировать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Редактировать'
              ImageIndex = 1
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgSalaryDelete: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Удалить'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Удалить'
              ImageIndex = 2
              ShortCut = 0
              Visible = True
            end
            object usrg_actStrGen: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'usrg_actStrGen'
              Checked = False
              Enabled = False
              HelpContext = 0
              Hint = ''
              ImageIndex = -1
              ShortCut = 0
              Visible = False
            end
            object usrg_actGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Рассчитать'
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actAvgGenerate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = ''
              Checked = False
              Enabled = True
              HelpContext = 0
              Hint = 'Рассчитать ср. заработок'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
            object usrg_actStrCalcOnUpdate: TgsAction
              Tag = 0
              Category = 'wage'
              Caption = 'Расчитать по структуре'
              Checked = False
              Enabled = False
              HelpContext = 0
              Hint = 'Расчитать по структуре'
              ImageIndex = 236
              ShortCut = 0
              Visible = True
            end
          end
          object dsgdcBase: TDataSource
            Left = 589
            Top = 7
          end
          object pm_dlgG: TPopupMenu
            Left = 472
            Top = 8
            object actSecurity1: TMenuItem
            end
            object actHistory1: TMenuItem
            end
            object N1: TMenuItem
            end
            object sepFirst: TMenuItem
            end
            object actNextRecord1: TMenuItem
            end
            object actPrevRecord1: TMenuItem
            end
            object actFirstRecord1: TMenuItem
            end
            object actLastRecord1: TMenuItem
            end
            object sepSecond: TMenuItem
            end
            object actApply1: TMenuItem
            end
            object sepThird: TMenuItem
            end
            object actProperty1: TMenuItem
            end
            object actCopySettings1: TMenuItem
            end
            object nAddToSetting1: TMenuItem
            end
          end
          object ibtrCommon: TIBTransaction
            Active = False
            Params.Strings = (
              'read_committed'
              'rec_version'
              'nowait')
            Left = 504
            Top = 8
          end
          object dsDetail: TDataSource
            Left = 293
            Top = 342
          end
          object gdMacrosMenu: TgdMacrosMenu
            Left = 441
            Top = 7
          end
          object usrg_gdcAvgSalaryStr: TgdcAttrUserDefined
            Tag = 0
            ForcedRefresh = False
            AutoCalcFields = True
            ObjectView = False
            AllowStreamedActive = False
            SubType = 'USR$WG_AVGSALARYSTR'
            MasterSource = dsgdcBase
            MasterField = 'id'
            DetailField = 'parent'
            SubSet = 'ByParent'
            SetTable = ''
            Active = True
            CachedUpdates = False
            ReadTransaction = gdcUserDocument.ibtrInternal
            Filtered = False
            Left = 644
            Top = 208
          end
          object usrg_dsAvgSalaryStr: TDataSource
            Tag = 0
            AutoEdit = True
            DataSet = usrg_gdcAvgSalaryStr
            Enabled = True
            Left = 675
            Top = 208
          end
          object usrg_dsSickStr: TDataSource
            Tag = 0
            AutoEdit = True
            Enabled = True
            Left = 769
            Top = 424
          end
        end
        
      EDITIONDATE: 2014-11-28T10:14:45+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147043669_974374174
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_GetConstByIDAndDate"
      COMMENT: ~
      SCRIPT: | 
        option explicit
        function wg_GetConstByIDAndDate(ID, aDate)
          dim Creator, gdcConst
          set Creator = New TCreator
          set gdcConst = Creator.GetObject(nil, "TgdcConst", "")
          wg_GetConstByIDAndDate = gdcConst.QGetValueByIDAndDate(ID, aDate)
        end function
        
      DISPLAYSCRIPT: | 
        WG_GETCONSTBYIDANDDATE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QCAAAASUQCAAAASUQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVFBSU1QFAAAA
        QURBVEUFAAAAQURBVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVEZMUFI=
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2013-12-19T17:03:12+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147022904_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      NAME: "gdc_dlgUserComplexDocument147022845_119619099"
      DESCRIPTION: ~
      PARENT: ~
      OBJECTTYPE: 0
      MACROSGROUPKEY: "147022905_119619099 Локальные макросы"
      REPORTGROUPKEY: "147022906_119619099 Отчеты(gdc_dlgUserComplexDocument147022845_119619099)"
      CLASSNAME: ""
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      SUBTYPE: ""
      EDITIONDATE: 2004-05-07T12:05:09+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 520236113_2108071301
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate_Sick_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include pl_GetScriptIDByName
        '#include wg_GetConstByIDAndDate
        
        Function wg_AvgSalaryStrGenerate_Sick_pl(ByRef gdcObject, ByRef gdcSalary)
        '
          Dim T, T1, T2
          '
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile, Scope
          'avg_wage
          Dim P_main, Tv_main, Q_main
          'avg_wage_sick_in
          Dim P_in, Tv_in, Q_in
          Dim EmplKey, FirstMoveKey, DateCalc, IsAvgWageDoc, IsPregnancy
          'avg_wage_run, avg_wage_sql
          Dim P_run, Tv_run, Q_run, P_sql, Tv_sql, Q_sql, P_kb
          Dim DateCalcFrom, DateCalcTo
          Dim PredicateName, Arity, SQL
          'avg_wage_err
          Dim P_err, Tv_err, Q_err
          Dim ErrMessage
          'avg_wage_out, avg_wage_sick_det
          Dim P_out, Tv_out, Q_out, P_det, Tv_det, Q_det
          Dim AvgWage, AvgWageRule
          Dim Period, PeriodRule, MonthDays, ExclDays, CalcDays, IsFullMonth, IsSpecMonth
          Dim Wage
          Dim TabDays, TabHoures, NormDays, NormHoures
        
          T1 = Timer
          wg_AvgSalaryStrGenerate_Sick_pl = False
        
          'init
          Set Creator = New TCreator
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          Scope = "wg_avg_wage_sick"
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          'params
          EmplKey = gdcObject.FieldByName("USR$EMPLKEY").AsInteger
          FirstMoveKey = gdcObject.FieldByName("USR$FIRSTMOVEKEY").AsInteger
          DateCalc = gdcObject.FieldByName("USR$FROM").AsDateTime
          IsAvgWageDoc = gdcObject.FieldByName("USR$REFERENCE").AsInteger
          IsPregnancy = abs(gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger = _
                 gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID))
        
          'clean
          gdcSalary.First
          While Not gdcSalary.EOF
            gdcSalary.Delete
          Wend
          '
          gdcSalary.OwnerForm.Repaint
        
          'avg_wage_sick_in(EmplKey, FirstMoveKey, DateCalc, IsAvgWageDoc, IsPregnancy)
          P_in = "avg_wage_sick_in"
          Set Tv_in = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutInteger 0, EmplKey
          Tv_in.PutInteger 1, FirstMoveKey
          Tv_in.PutDate 2, DateCalc
          Tv_in.PutInteger 3, IsAvgWageDoc
          Tv_in.PutInteger 4, IsPregnancy
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'avg_wage(Scope) - prepare data
          P_main = "avg_wage"
          Set Tv_main = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_main = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_main.PredicateName = P_main
          Q_main.Termv = Tv_main
          '
          Tv_main.PutAtom 0, Scope
          '
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage_run(Scope, EmplKey, FirstMoveKey, DateCalcFrom, DateCalcTo)
          P_run = "avg_wage_run"
          Set Tv_run = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_run = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_run.PredicateName = P_run
          Q_run.Termv = Tv_run
          'avg_wage_sql(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL)
          P_sql = "avg_wage_sql"
          P_kb = "avg_wage_kb"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Tv_run.PutAtom 0, Scope
          '
          Q_run.OpenQuery
          If Q_run.EOF Then
            Exit Function
          End If
          '
          Append = False
          '
          Do Until Q_run.EOF
            EmplKey = Tv_run.ReadInteger(1)
            FirstMoveKey = Tv_run.ReadInteger(2)
            DateCalcFrom = Tv_run.ReadDate(3)
            DateCalcTo = Tv_run.ReadDate(4)
            '
            Tv_sql.Reset
            Tv_sql.PutAtom 0, Scope
            Tv_sql.PutInteger 1, EmplKey
            Tv_sql.PutInteger 2, FirstMoveKey
            Q_sql.OpenQuery
            '
            Do Until Q_sql.EOF
              PredicateName = Tv_sql.ReadAtom(3)
              Arity = Tv_sql.ReadInteger(4)
              SQL = Tv_sql.ReadString(5)
              '
              Ret =  PL.MakePredicatesOfSQLSelect _
                        (SQL, _
                        gdcBaseManager.ReadTransaction, _
                        PredicateName, PredicateName, Append)
              If Ret >= 0 Then
                 Ret = PL.Call(P_kb, Tv_sql)
              End If
              '
              Q_sql.NextSolution
            Loop
            Q_sql.Close
            '
            Append = True
            '
            Q_run.NextSolution
          Loop
          Q_run.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage(Scope) - calc result
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_err(Scope, ErrMessage)
          P_err = "avg_wage_err"
          Set Tv_err = Creator.GetObject(2, "TgsPLTermv", "")
          Set Q_err = Creator.GetObject(nil, "TgsPLQuery", "")
          '
          Q_err.PredicateName = P_err
          Q_err.Termv = Tv_err
          '
          Tv_err.PutAtom 0, Scope
          '
          Q_err.OpenQuery
          If Not Q_err.EOF Then
            Do Until Q_err.EOF
              '
              ErrMessage = Tv_err.ReadString(1)
              Call MsgBox(ErrMessage, vbCritical + vbOKOnly, "Ошибка!")
              '
              Q_err.NextSolution
            Loop
            Exit Function
          End If
          Q_err.Close
        
          'avg_wage_out(Scope, EmplKey, FirstMoveKey, AvgWage, AvgWageVariant)
          P_out = "avg_wage_out"
          Set Tv_out = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          'avg_wage_sick_det(EmplKey, FirstMoveKey,
          '                  Period, Rule,
          '                  MonthDays, ExclDays, CalcDays, IsFullMonth, IsSpecMonth,
          '                  Wage,
          '                  TabDays, NormDays, TabHoures, NormHoures) :-
          P_det = "avg_wage_sick_det"
          Set Tv_det = Creator.GetObject(14, "TgsPLTermv", "")
          Set Q_det = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_det.PredicateName = P_det
          Q_det.Termv = Tv_det
          '
          Tv_out.PutAtom 0, Scope
          '
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            EmplKey = Tv_out.ReadInteger(1)
            FirstMoveKey = Tv_out.ReadInteger(2)
            AvgWage = Tv_out.ReadFloat(3)
            AvgWageRule = Tv_out.ReadAtom(4)
            '
            Tv_det.Reset
            Tv_det.PutInteger 0, EmplKey
            Tv_det.PutInteger 1, FirstMoveKey
            Q_det.OpenQuery
            '
            Do Until Q_det.EOF
              Period = Tv_det.ReadDate(2)
              PeriodRule = Tv_det.ReadAtom(3)
              MonthDays = Tv_det.ReadInteger(4)
              ExclDays= Tv_det.ReadInteger(5)
              CalcDays = Tv_det.ReadInteger(6)
              IsFullMonth = Tv_det.ReadInteger(7)
              IsSpecMonth = Tv_det.ReadInteger(8)
              Wage = Tv_det.ReadFloat(9)
              TabDays = Tv_det.ReadFloat(10)
              NormDays = Tv_det.ReadFloat(11)
              TabHoures = Tv_det.ReadFloat(12)
              NormHoures = Tv_det.ReadFloat(13)
              '
              Select Case AvgWageRule
                Case "by_calc_days_total", "by_calc_days", "by_calc_days_doc"
                  Select Case PeriodRule
                    Case "by_cal_flex"
                      PeriodRule = "по табелю мастера"
                    Case "by_cal"
                      PeriodRule = "по табелю"
                    Case "by_orders"
                      PeriodRule = "по приказам"
                    Case Else
                      PeriodRule = ""
                  End Select
                  '
                  If Not IsFullMonth = 1 And IsSpecMonth = 1 Then
                    PeriodRule = "условно полный"
                  End If
                  '
                Case "by_budget"
                  PeriodRule = "от БПМ"
                Case "by_avg_wage"
                  PeriodRule = "по среднему заработку"
                Case "by_rate", "by_rate_doc"
                  PeriodRule = "от ставки (оклада)"
                Case "by_not_full"
                  PeriodRule = "по не полным месяцам"
                Case Else
                  PeriodRule = ""
              End Select
              '
              gdcSalary.Append
              gdcSalary.FieldByName("USR$ISFULL").AsVariant = IsFullMonth
              gdcSalary.FieldByName("USR$DATE").AsVariant = Period
              gdcSalary.FieldByName("USR$CALCDAYS").AsVariant = CalcDays
              gdcSalary.FieldByName("USR$SALARY").AsVariant = Wage
              gdcSalary.FieldByName("USR$DOW").AsVariant = TabDays
              gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = NormDays
              gdcSalary.FieldByName("USR$HOW").AsVariant = TabHoures
              gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = NormHoures
              gdcSalary.FieldByName("USR$DESCRIPTION").AsVariant = PeriodRule
              gdcSalary.Post
              '
              Q_det.NextSolution
            Loop
            Q_det.Close
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
        
          gdcSalary.First
        
          If AvgWage > 0 then
            gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = AvgWage
          End If
          '
          Select Case AvgWageRule
            Case "by_budget"
              gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1
            Case "by_rate"
              gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger = 1
            Case "by_avg_wage"
              gdcObject.FieldByName("USR$AVERAGE").AsInteger = 1
          End select
          '
          gdcObject.Post
        
          wg_AvgSalaryStrGenerate_Sick_pl = True
        
          T2 = Timer
          T = T2 - T1
        '
        End Function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE_SICK_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAR0RDT0JKRUNUCQAAAEdEQ09CSkVDVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AABGTlNUUFJTVAkAAABHRENTQUxBUlkJAAAAR0RDU0FMQVJZAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-12-03T09:19:53+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
          - 
            ADDFUNCTIONKEY: "147043669_974374174 wg_GetConstByIDAndDate"
  - 
    Properties: 
      Class: "TgdcMacrosGroup"
      RUID: 147022905_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      HASCHILDREN: 1
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTPARENT: ~
      CLASSNAME: ""
      SUBTYPE: ""
      PARENT: ~
      NAME: "Локальные макросы"
      ISGLOBAL: 0
      DESCRIPTION: ~
      EDITIONDATE: 2004-05-07T12:05:09+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151515573_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryStrGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_EmplMoveList
        
        function wg_AvgSalaryStrGenerate_Sick(ByRef Sender)
        '
        'Есть 3 варианта расчета, которые зависят от того в какой момент произошло изменение оклада (ставки):
        ' 1. Расчет стандартный:
        '    - последнее повышение было до периода расчета среднего заработка
        ' 2. Период расчета: с момента повышения зрп до начала нетрудоспособности
        '    - повышение попало с первого числа месяца расчета ср. заработка и до начала нетрудоспособности
        ' 3. Расчет стандартный, но сумма увеличивается на коэффициент повышения оклада (ставки)
        '    - повышение попало на период нетрудоспособности
          Sender.GetComponent("actApply").Execute
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          set gdcObject = Sender.gdcObject
          set gdcAvgStr = Sender.FindComponent("usrg_gdcAvgSalaryStr")
          
          gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0
        
          'Выключаем автоперерасчет среднего заработка
          gdcAvgStr.Tag = 1
          'Удалим старые значения
          gdcAvgStr.First
          while not gdcAvgStr.Eof
            gdcAvgStr.Delete
        '    gdcAvgStr.Next
          wend
          'Дата начала нетрудоспособности
          DateFrom = gdcObject.FieldByName("usr$from").AsDateTime
          'Первое число месяца больничного
          FirstDateBeginIll = DateSerial(Year(DateFrom), Month(DateFrom), 1)
          DateEnd = gdcObject.FieldByName("usr$dateend").AsDateTime
          AddDuration = DateDiff("m", DateFrom, DateEnd) + 1
        
          'Расчет по часам
          ByHourFlg = (gdcObject.FieldByName("usr$calcbyhour").AsInteger = 1)
        
          'Определим по карточке сотрудника (на дату окончания) прослеживать изменения оклада или ставки
          BySalaryFlg = False
          set EmplMoveList = wg_EmplMoveList.MoveCardList(gdcObject.FieldByName("usr$emplkey").AsInteger, Null)
          if Assigned(EmplMoveList) then
            set MoveCard = EmplMoveList.ExistMoveCardByDate(DateEnd)
            if Assigned(MoveCard) then
              BySalaryFlg = MoveCard.PayFormKey = gdcBaseManager.GetIDByRUIDString(wg_PayForm_Salary_RUID)
              if IsNull(BySalaryFlg) then BySalaryFlg = 0
            end if
          end if
          set AvgPeriodsObj = New Twg_AvgPeriods
          AvgPeriodsObj.EmplKey = gdcObject.FieldByName("usr$emplkey").AsInteger
          AvgPeriodsObj.FirstMoveKey = gdcObject.FieldByName("usr$firstmovekey").AsInteger
          Duration = gdcObject.FieldByName("usr$avgperiod").AsInteger
          AvgPeriodsObj.DateBegin = DateAdd("m", - Duration, FirstDateBeginIll)
          AvgPeriodsObj.Duration = Duration '+ AddDuration
          AvgPeriodsObj.FeeGroupKey = gdcObject.FieldByName("usr$feegroupkey").Value
          AvgPeriodsObj.BySalary = BySalaryFlg
          AvgPeriodsObj.ByStaffSalary = (gdcObject.FieldByName("usr$bystaffsalary").AsInteger = 1)
          AvgPeriodsObj.DateFrom = DateFrom
          AvgPeriodsObj.IsPregnancy = _
              (gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger = _
                 gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID))
        
          set AvgPeriodItems = AvgPeriodsObj.Items
          AvgPeriodItemsArr = AvgPeriodItems.Items
          'Дата последнего изменения
          LastDateChange = AvgPeriodsObj.LastDateChange
        
          NoMovingFlg = False
          ChangeOnIllPeriodFlg = False
          if IsNull(LastDateChange) then
            'Движений за период расчета и больничного не было
            LastDateChange = AvgPeriodsObj.DateBegin
            NoMovingFlg = True
          else
            ChangeOnIllPeriodFlg = (LastDateChange >= DateFrom and LastDateChange <= DateEnd)
            if ChangeOnIllPeriodFlg then _
              NoMovingFlg = True
          end if
        
          Coeff = 1
          NewSalary = 0
          AllSum = 0
          AllWorkDay = 0
          AllWorkHour = 0
          for i = AvgPeriodItems.Count - 1 to 0 step -1
            'Интересуют все месяцы, кроме тех, которые идут после начала больничного без движений
            if AvgPeriodItemsArr(i).DateChange <= FirstDateBeginIll or _
                (AvgPeriodItemsArr(i).DateChange > FirstDateBeginIll and AvgPeriodItemsArr(i).DateChange <= DateEnd and AvgPeriodItemsArr(i).IsChange) then
        
              'Подсчет коэффициента изменения оклада (ставки)
              if NewSalary > 0 and AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll and Coeff = 1 then
                if AvgPeriodsObj.BySalary then
                  Coeff = NewSalary / AvgPeriodItemsArr(i).Salary
                else
                  Coeff = NewSalary / AvgPeriodItemsArr(i).FCRate
                end if
              end if
        
              gdcAvgStr.Insert
        '      gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 0
              gdcAvgStr.FieldByName("usr$date").AsDateTime = AvgPeriodItemsArr(i).DateBegin
              gdcAvgStr.FieldByName("usr$salary").AsCurrency = AvgPeriodItemsArr(i).SumByGroup
              gdcAvgStr.FieldByName("usr$oldsalary").AsCurrency = AvgPeriodItemsArr(i).Salary
              gdcAvgStr.FieldByName("usr$newsalary").AsCurrency = AvgPeriodItemsArr(i).FCRate
              gdcAvgStr.FieldByName("usr$dow").AsCurrency = AvgPeriodItemsArr(i).WorkDays
              gdcAvgStr.FieldByName("usr$how").AsCurrency = AvgPeriodItemsArr(i).WorkHours
              gdcAvgStr.FieldByName("usr$schedulerdow").AsCurrency = AvgPeriodItemsArr(i).SchedulerDays
              gdcAvgStr.FieldByName("usr$schedulerhow").AsCurrency = AvgPeriodItemsArr(i).SchedulerHours
              gdcAvgStr.FieldByName("usr$coeff").AsCurrency = Coeff
              gdcAvgStr.FieldByName("usr$description").AsString = AvgPeriodItemsArr(i).Description
        
              ' added 19.07.13
              ' если декретный или дата > 11.07.13, то признак во всех периодах =1
              if DateFrom >= CDate("11.07.2013") or AvgPeriodsObj.IsPregnancy then
                gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
              else
                gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 0
              end if
              ' end added
        
        
        '      if (NoMovingFlg and AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll) or _
        '          (AvgPeriodItemsArr(i).DateChange >= LastDateChange) then
        '        gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
        '      end if
        
              if AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll then
              'Периоды, до начала месяца болезни
                if AvgPeriodItemsArr(i).DateChange >= LastDateChange or LastDateChange >= DateFrom then
                  gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
                end if
              else
                if AvgPeriodItemsArr(i).DateChange < DateFrom and AvgPeriodItemsArr(i).DateChange >= LastDateChange and (not NoMovingFlg) then
                  gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1
                end if
              end if
        
        '      IsCheck = AvgPeriodItemsArr(i).DateChange < FirstDateBeginIll
        
              if ChangeOnIllPeriodFlg and AvgPeriodItemsArr(i).DateChange = LastDateChange then
               'Изменение попадает в период болезни, т.е. сумма будет проиндексирована
                if AvgPeriodsObj.BySalary then
                  NewSalary = AvgPeriodItemsArr(i).Salary
                else
                  NewSalary = AvgPeriodItemsArr(i).FCRate
                end if
              end if
              if gdcAvgStr.FieldByName("usr$ischeck").AsInteger = 1 then
                AllSum = AllSum + gdcAvgStr.FieldByName("usr$salary").AsCurrency
                AllWorkDay = AllWorkDay + gdcAvgStr.FieldByName("usr$dow").AsCurrency
                AllWorkHour = AllWorkHour + gdcAvgStr.FieldByName("usr$how").AsCurrency
              end if
              gdcAvgStr.Post
            end if
          next
          AvgSum = 0
          if ByHourFlg then
            AllWorkPoint = AllWorkHour
          else
            AllWorkPoint = AllWorkDay
          end if
          if AllWorkPoint > 0 then
            AvgSum = AllSum / AllWorkPoint
          end if
          gdcAvgStr.Tag = 0
        
          gdcObject.FieldByName("usr$thirdmethod").AsInteger = 0
          if gdcObject.OwnerForm.Name = "gdc_dlgUserComplexDocument147022845_119619099" and (gdcObject.FieldByName("usr$reference").AsInteger = 1 or gdcAvgStr.RecordCount = 6) then
            dim q, Creator
            set Creator = new TCreator
            set q = Creator.GetObject(null, "TIBSQL", "")
            q.Transaction = gdcObject.Transaction
        '    q.SQL.Text = _
        '    "SELECT * " & _
        '    "FROM USR$WG_AVGSALARYSTR " & _
        '    "WHERE " & _
        '    "  USR$DOCUMENTKEY = :parent " & _
        '    " AND " & _
        '    "  EXTRACT(DAY FROM DATEADD(DAY, -1, CAST(EXTRACT(YEAR FROM USR$DATE)||'.'||(EXTRACT(MONTH FROM USR$DATE)+1)||'.01' AS DATE))) = USR$DOW "
        '    q.ParamByName("parent").AsInteger = gdcObject.ID
        '    q.ExecQuery
        
            q.SQL.Text = _
                "EXECUTE BLOCK( " & _
                "  PARENT INTEGER = :PARENT) " & _
                "RETURNS " & _
                "( " & _
                "  OK INTEGER " & _
                ") " & _
                " AS " & _
                "DECLARE VARIABLE EMPLKEY INTEGER; " & _
                "DECLARE VARIABLE FDATE DATE; " & _
                "DECLARE VARIABLE DOW INTEGER; " & _
                "DECLARE VARIABLE LEAVEDAY INTEGER; " & _
                "DECLARE VARIABLE MONTHDAY INTEGER; " & _
                "DECLARE VARIABLE TempM INTEGER; " & _
                "DECLARE VARIABLE TempY INTEGER; " & _
                "DECLARE VARIABLE TempNextDate DATE; " & _
                "BEGIN " & _
                "  OK = 0; " & _
                "  FOR " & _
                "    SELECT LIST.USR$EMPLKEY, STR.USR$DATE, STR.USR$DOW " & _
                "    FROM USR$WG_AVGSALARYSTR STR " & _
                "    JOIN USR$WG_SICKLIST LIST ON LIST.DOCUMENTKEY = STR.USR$DOCUMENTKEY " & _
                "    WHERE " & _
                "      USR$DOCUMENTKEY = :parent " & _
                "    INTO :EMPLKEY, :FDATE, :DOW " & _
                "  DO " & _
                "  BEGIN " & _
                "   " & _
                "    TempM = EXTRACT(MONTH FROM CAST(:FDATE AS DATE)); " & _
                "    TempY = EXTRACT(YEAR FROM CAST(:FDATE AS DATE)); " & _
                "    TempM = TempM + 1; " & _
                "    IF (TempM = 13) THEN " & _
                "    BEGIN " & _
                "      TempY = TempY + 1; " & _
                "      TempM = 1; " & _
                "    END " & _
                "    TempNextDate = CAST('01.' ||  RIGHT('0' || TempM, 2) || '.' || TempY  AS DATE); " & _
                "    MONTHDAY = EXTRACT(DAY FROM( DATEADD(DAY, -1, TempNextDate))); " & _
                "    SELECT " & _
                "      SUM(CASE " & _
                "      WHEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) = EXTRACT(MONTH FROM U.USR$DATEEND) THEN U.USR$DATEEND - U.USR$DATEBEGIN + 1 " & _
                "      WHEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) < EXTRACT(MONTH FROM U.USR$DATEEND) AND EXTRACT(MONTH FROM U.USR$DATEBEGIN) = EXTRACT(MONTH FROM CAST(:FDATE AS DATE)) THEN DATEADD(DAY, -1, :TempNextDate) - U.USR$DATEBEGIN + 1 " & _
                "      WHEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) < EXTRACT(MONTH FROM U.USR$DATEEND) AND EXTRACT(MONTH FROM U.USR$DATEEND) = EXTRACT(MONTH FROM CAST(:FDATE AS DATE)) THEN U.USR$DATEEND - :FDATE + 1 " & _
                "      END) AS LEAVEDAY " & _
                "    FROM GD_DOCUMENT Z " & _
                "    JOIN USR$WG_LEAVEDOCLINE U ON Z.ID = U.DOCUMENTKEY " & _
                "    WHERE " & _
                "      Z.DOCUMENTTYPEKEY = 328606656 " & _
                "     AND " & _
                "      U.USR$EMPLKEY = :EMPLKEY " & _
                "     AND " & _
                "      EXTRACT(MONTH FROM CAST(:FDATE AS DATE)) BETWEEN EXTRACT(MONTH FROM U.USR$DATEBEGIN) AND EXTRACT(MONTH FROM U.USR$DATEEND) " & _
                "    INTO :LEAVEDAY; " & _
                "    IF (LEAVEDAY IS NULL) THEN " & _
                "        LEAVEDAY = 0; " & _
                " " & _
                " " & _
                "    IF (DOW + LEAVEDAY = MONTHDAY) THEN " & _
                "        OK = OK + 1; " & _
                "  END " & _
                "  SUSPEND; " & _
                "END "
        
        
            q.ParamByName("parent").AsInteger = gdcObject.ID
            q.ExecQuery
        
            if q.FieldByName("OK").AsInteger = 0 or (gdcObject.FieldByName("usr$reference").AsInteger = 1) then
              q.Close
              q.SQL.Text = _
              "SELECT FIRST 1 COALESCE(ML.USR$THOURRATE, 0) AS RATE " & _
              "FROM USR$WG_TOTAL T " & _
              "JOIN USR$WG_MOVEMENTLINE ML ON ML.USR$DATEBEGIN <= T.USR$DATEBEGIN " & _
              "WHERE " & _
              "  T.DOCUMENTKEY = :totalkey " & _
              "  AND ML.USR$EMPLKEY = :emplkey " & _
              "ORDER BY ML.USR$DATEBEGIN DESC "
              q.ParamByName("totalkey").AsInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
              q.ParamByName("emplkey").AsInteger = gdcObject.FieldByName("USR$EMPLKEY").AsInteger
              q.ExecQuery
        
              gdcObject.FieldByName("usr$thirdmethod").AsInteger = 1
        
              if not q.EOF then
                AvgSum = 8*q.FieldByName("RATE").AsCurrency
              else
                AvgSum = 0
              end if
            end if
          end if
          gdcObject.FieldByName("usr$avgsumma").AsCurrency = Round(AvgSum)
        end function
        
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYSTRGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:26:34+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147743985_374487969 wg_EmplMoveList"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 520236116_2108071301
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 520236114_2108071301
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_AvgSalaryStrGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate_Sick
        
        Sub Macros_AvgSalaryStrGenerate_Sick(OwnerForm)
        '
          call wg_AvgSalaryStrGenerate_Sick(OwnerForm)
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS_AVGSALARYSTRGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:00:17+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151515573_101633588 wg_AvgSalaryStrGenerate_Sick"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 520236114_2108071301
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MACROSGROUPKEY: "147022905_119619099 Локальные макросы"
      FUNCTIONKEY: "520236116_2108071301 Macros_AvgSalaryStrGenerate_Sick"
      NAME: "Расчет структуры ср. заработка"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-04-03T15:20:01+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 528605649_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 528605678_99701464
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryDetailGenerate_Sick_pl"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include pl_GetScriptIDByName
        
        Function wg_AvgSalaryDetailGenerate_Sick_pl(ByRef gdcObject, ByRef gdcDetail)
        '
          Dim Creator, IsDebug
          IsDebug = True
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile
          'struct_sick_sql
          Dim P_sql, Tv_sql, Q_sql
          Dim EmplKey, FirstMoveKey, DateBegin, DateEnd, PredicateName, Arity, SQL
          'struct_sick_in
          Dim P_in, Tv_in, Q_in
          Dim DateCalc, AvgWage, CalcType
          Dim BudgetOption, ByRateOption, IsPregnancy, IllType
          Dim ViolatDB, ViolatDE
          'struct_sick_err
          Dim P_err, Tv_err, Q_err
          Dim ErrMessage
          'struct_sick_out
          Dim P_out, Tv_out, Q_out
          Dim AccDate, IncludeDate, Percent, DOI, HOI, Summa
        
          wg_AvgSalaryDetailGenerate_Sick_pl = False
        
          'init
          Set Creator = New TCreator
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (False And IsDebug And plGlobalDebug)
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = (True And IsDebug And plGlobalDebug)
        
          'params
          EmplKey = gdcObject.FieldByName("USR$EMPLKEY").AsInteger
          FirstMoveKey = gdcObject.FieldByName("USR$FIRSTMOVEKEY").AsInteger
          DateCalc = gdcObject.FieldByName("USR$FROM").AsDateTime
          DateBegin = gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime
          DateEnd = gdcObject.FieldByName("USR$DATEEND").AsDateTime
          AvgWage = gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency
          BudgetOption = gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger
          ByRateOption = gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger
          IsPregnancy = abs(gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger = _
                 gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID))
          IllType = gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger
          ViolatDB = gdcObject.FieldByName("USR$VIOLATDB").AsDateTime
          ViolatDE = gdcObject.FieldByName("USR$VIOLATDE").AsDateTime
          
          Dim IBSQL
          '
          Set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = gdcBaseManager.ReadTransaction
          IBSQL.SQL.Text = _
              "SELECT " & _
              "  it.USR$CALCTYPE " & _
              "FROM " & _
              "  USR$WG_ILLTYPE it " & _
              "WHERE " & _
              "  it.ID = :ILLTYPEKEY "
          IBSQL.ParamByName("ILLTYPEKEY").AsInteger = IllType
          IBSQL.ExecQuery
          '
          CalcType = IBSQL.FieldByName("USR$CALCTYPE").AsInteger
          '
          IBSQL.Close
        
          'clean
          gdcDetail.First
          While Not gdcDetail.EOF
            gdcDetail.Delete
          Wend
          '
          gdcDetail.OwnerForm.Repaint
        
          'struct_sick_sql(EmplKey, FirstMoveKey, DateBegin, DateEnd, PredicateName, Arity, SQL)
          P_sql = "struct_sick_sql"
          Set Tv_sql = Creator.GetObject(7, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Append = False
          '
          Tv_sql.PutInteger 0, EmplKey
          Tv_sql.PutInteger 1, FirstMoveKey
          Tv_sql.PutDate 2, DateBegin
          Tv_sql.PutDate 3, DateEnd
          '
          Q_sql.OpenQuery
          If Q_sql.EOF Then
            Exit Function
          End If
          '
          Do Until Q_sql.EOF
            PredicateName = Tv_sql.ReadAtom(4)
            Arity = Tv_sql.ReadInteger(5)
            SQL = Tv_sql.ReadString(6)
            '
            Ret =  PL.MakePredicatesOfSQLSelect _
                      (SQL, _
                      gdcBaseManager.ReadTransaction, _
                      PredicateName, PredicateName, Append)
            '
            Q_sql.NextSolution
          Loop
          Q_sql.Close
          
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'struct_sick_in(DateCalc, DateBegin, DateEnd, AvgWage, CalcType, BudgetOption, ByRateOption, IsPregnancy, IllType, ViolatDB, ViolatDE)
          P_in = "struct_sick_in"
          Set Tv_in = Creator.GetObject(11, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutDate 0, DateCalc
          Tv_in.PutDate 1, DateBegin
          Tv_in.PutDate 2, DateEnd
          Tv_in.PutFloat 3, AvgWage
          Tv_in.PutInteger 4, CalcType
          Tv_in.PutInteger 5, BudgetOption
          Tv_in.PutInteger 6, ByRateOption
          Tv_in.PutInteger 7, IsPregnancy
          Tv_in.PutInteger 8, IllType
          Tv_in.PutDate 9, ViolatDB
          Tv_in.PutDate 10, ViolatDE
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'struct_sick_err(ErrMessage)
          P_err = "struct_sick_err"
          Set Tv_err = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_err = Creator.GetObject(nil, "TgsPLQuery", "")
          '
          Q_err.PredicateName = P_err
          Q_err.Termv = Tv_err
          '
          Q_err.OpenQuery
          If Not Q_err.EOF Then
            Do Until Q_err.EOF
              '
              ErrMessage = Tv_err.ReadString(0)
              Call MsgBox(ErrMessage, vbCritical + vbOKOnly, "Ошибка!")
              '
              Q_err.NextSolution
            Loop
            Exit Function
          End If
          Q_err.Close
          
          'struct_sick_out(AccDate, IncludeDate, Percent, DOI, HOI, Summa, DateBegin, DateEnd)
          P_out = "struct_sick_out"
          Set Tv_out = Creator.GetObject(8, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            '
            AccDate = Tv_out.ReadDate(0)
            IncludeDate = Tv_out.ReadDate(1)
            Percent = Tv_out.ReadFloat(2)
            DOI = Tv_out.ReadFloat(3)
            HOI = Tv_out.ReadFloat(4)
            Summa = Tv_out.ReadFloat(5)
            DateBegin = Tv_out.ReadDate(6)
            DateEnd = Tv_out.ReadDate(7)
            '
            gdcDetail.Append
            gdcDetail.FieldByName("USR$ACCDATE").AsVariant = AccDate
            gdcDetail.FieldByName("USR$INCLUDEDATE").AsVariant = IncludeDate
            gdcDetail.FieldByName("USR$PERCENT").AsVariant = Percent
            gdcDetail.FieldByName("USR$DOI").AsVariant = DOI
            gdcDetail.FieldByName("USR$HOI").AsVariant = HOI
            gdcDetail.FieldByName("USR$SUMMA").AsVariant = Summa
            gdcDetail.FieldByName("USR$DATEBEGIN").AsVariant = DateBegin
            gdcDetail.FieldByName("USR$DATEEND").AsVariant = DateEnd
            gdcDetail.Post
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
          gdcDetail.First
        
          wg_AvgSalaryDetailGenerate_Sick_pl = True
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYDETAILGENERATE_SICK_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAR0RDT0JKRUNUCQAAAEdEQ09CSkVDVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AABGTlNUUFJTVAkAAABHRENERVRBSUwJAAAAR0RDREVUQUlMAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-12-03T10:52:12+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151515700_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_AvgSalaryDetailGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_LastDayInMonth
        sub wg_AvgSalaryDetailGenerate_Sick(ByVal Sender)
          if not Sender.OwnerForm.gdcObject.VariableExists("DontRecalcLine") then
            Sender.OwnerForm.gdcObject.AddVariableItem("DontRecalcLine")
          end if
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = True
          'Сбрасываем кэш для Переменных
          set wg_Variable_ = Nothing
        
          ' added 18.07.13   FromDate checking
          if gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = _
             Sender.OwnerForm.gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger or _
             Sender.OwnerForm.gdcObject.FieldByName("USR$FROM").AsDateTime >= CDate("11.07.2013")   then
            if Sender.OwnerForm.gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0 then
              dim gdcAvgStr, MonthNum
              set gdcAvgStr = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
              gdcAvgStr.First
              while not gdcAvgStr.EoF
                gdcAvgStr.Next
              wend
              MonthNum = gdcAvgStr.RecNo
              if MonthNum < Sender.OwnerForm.gdcObject.FieldByName("USR$AVGPERIOD").AsInteger then
                if Application.MessageBox("Позиций среднего заработка " & MonthNum & _
                  " , это меньше, чем период формирования ( " & _
                  Sender.OwnerForm.gdcObject.FieldByName("USR$AVGPERIOD").AsInteger& " )." & VBCR & _
                  "Рассчитать средний заработок как 50% от бюджета прожиточного минимума?", _
                  "Внимание", vbSystemModal + vbYesNo) = vbYes then
                  if not (Sender.OwnerForm.gdcObject.State = dsEdit or Sender.OwnerForm.gdcObject.State = dsInsert) then
                    Sender.OwnerForm.gdcObject.Edit
                  end if
                  Sender.OwnerForm.gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1
                  Sender.OwnerForm.gdcObject.Post
                end if
              end if
            end if
          end if
          Sender.OwnerForm.GetComponent("ibgrDetail").SetFocus
        
          set wg_Structure = Sender.OwnerForm.Objects("Structure")
          call wg_Structure.CreateSickStructure(Sender.OwnerForm)
        
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = False
        end sub
        
      DISPLAYSCRIPT: | 
        WG_AVGSALARYDETAILGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:45:34+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147022228_119619099 wg_LastDayInMonth"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 528605680_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 528605678_99701464
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_AvgSalaryDetailGenerate_Sick"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryDetailGenerate_Sick
        
        Sub Macros_AvgSalaryDetailGenerate_Sick(OwnerForm)
        '
          Call wg_AvgSalaryDetailGenerate_Sick(OwnerForm)
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS_AVGSALARYDETAILGENERATE_SICK
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-04-03T17:43:26+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151515700_101633588 wg_AvgSalaryDetailGenerate_Sick"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 528605678_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MACROSGROUPKEY: "147022905_119619099 Локальные макросы"
      FUNCTIONKEY: "528605680_99701464 Macros_AvgSalaryDetailGenerate_Sick"
      NAME: "Расчет структуры больничного"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-04-03T17:43:26+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147489068_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489069_336327731
    Fields: 
      NAME: "usrg_actAvgGenerate"
      DESCRIPTION: ~
      PARENT: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actAvgGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-03-18T12:54:01+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147489071_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489069_336327731
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actAvgGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate_Sick_pl
        '#include wg_Prolog
        
        Sub usrg_actAvgGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcSalary, Ret
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Call wg_Prolog.SyncField(Sender.OwnerForm.gdcObject, True)
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          '
          gdcObject.FieldByName("USR$AVGSUMMA").Clear
          gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger = 0
          gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0
          gdcObject.FieldByName("USR$AVERAGE").AsInteger = 0
          
          Set gdcSalary = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
        
          Ret = wg_AvgSalaryStrGenerate_Sick_pl(gdcObject, gdcSalary)
        
          Call wg_Prolog.SyncField(Sender.OwnerForm.gdcObject, False)
        '
        End Sub
        
        
        
        
      DISPLAYSCRIPT: | 
        USRG_ACTAVGGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-05-05T12:05:20+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "520236113_2108071301 wg_AvgSalaryStrGenerate_Sick_pl"
          - 
            ADDFUNCTIONKEY: "528612032_99701464 wg_Prolog"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147489069_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actAvgGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147489068_336327731 gdc_dlgUserComplexDocument147022845_119619099\\usrg_actAvgGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147489071_336327731 usrg_actAvgGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-05-05T12:05:20+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147015827_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368562_274788016
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_dayInMonth"
      COMMENT: ~
      SCRIPT: | 
        option explicit
        function wg_dayInMonth(ByVal TheDate)
        ' возвращает количество дней в месяце
        
          wg_dayInMonth = Day(DateSerial(Year(TheDate), Month(TheDate) + 1, 1) -1)
          
        end function
        
      DISPLAYSCRIPT: | 
        WG_DAYINMONTH
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAVEhFREFURQcAAABUSEVEQVRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2005-03-24T10:25:24+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147022228_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368562_274788016
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_LastDayInMonth"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_dayInMonth
        function wg_LastDayInMonth(ByVal TheDate)
        ' проверяет, является ли дата TheDate последним днем месяца
        
          D = Day(TheDate)
          wg_LastDayInMonth = (D = wg_DayInMonth(TheDate))
        
        end function
        
      DISPLAYSCRIPT: | 
        WG_LASTDAYINMONTH
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAVEhFREFURQcAAABUSEVEQVRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2005-03-24T10:25:35+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147015827_119619099 wg_dayInMonth"
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147368561_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368562_274788016
    Fields: 
      NAME: "usrg_actGenerate"
      DESCRIPTION: ~
      PARENT: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2005-01-26T11:39:41+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147368564_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368562_274788016
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryDetailGenerate_Sick_pl
        
        Sub usrg_actGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcDetail, Ret
        
          If Not Sender.OwnerForm.gdcObject.VariableExists("DontRecalcLine") Then
            Sender.OwnerForm.gdcObject.AddVariableItem("DontRecalcLine")
          End If
          '
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = True
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          Set gdcDetail = Sender.OwnerForm.gdcDetailObject
        
          Ret = wg_AvgSalaryDetailGenerate_Sick_pl(gdcObject, gdcDetail)
        
          Sender.OwnerForm.gdcObject.Variables("DontRecalcLine") = False
        '
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_ACTGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-04-03T17:42:33+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "528605649_99701464 wg_AvgSalaryDetailGenerate_Sick_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147368562_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147368561_274788016 gdc_dlgUserComplexDocument147022845_119619099\\usrg_actGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147368564_274788016 usrg_actGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-04-03T17:42:33+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147302770_531940465
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489065_336327731
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_SetSilkAvgSum"
      COMMENT: ~
      SCRIPT: | 
        function wg_SetSilkAvgSum(ByRef DataSet)
          'Ф-ция расчитывает и записывает средний заработок
          'Нужно получить (только для записей включенных в расчет):
          'сумму, кол-во дней, кол-во часов
          if DataSet.Tag <> 1 then
            AvgSumma = 0
            if Assigned(DataSet.MasterSource) then
              call gdcBaseManager.ExecSingleQueryResult(_
                "SELECT SUM(usr$modernsalary), SUM(usr$dow), SUM(usr$how) " & _
                "FROM USR$WG_AVGSALARYSTR " & _
                "WHERE usr$ischeck = 1 and usr$documentkey = :masterkey ", _
                  DataSet.FieldByName("usr$documentkey").AsInteger, Result, DataSet.ReadTransaction)
              if not IsEmpty(Result) then
                AllSum = Result(0,0)
                AllWDay = Result(1,0)
                AllWHour = Result(2,0)
                if DataSet.MasterSource.DataSet.FieldByName("usr$calcbyhour").AsInteger = 0 then
                  WPoint = AllWDay
                else
                  WPoint = AllWHour
                end if
                if WPoint > 0 then
                  AvgSumma = AllSum / WPoint
                end if
              end if
            end if
            if DataSet.MasterSource.DataSet.State = dsBrowse then
              DataSet.MasterSource.DataSet.Edit
            end if
            DataSet.MasterSource.DataSet.FieldByName("usr$avgsumma").AsCurrency = Round(AvgSumma)
            
          end if
        end function
        
      DISPLAYSCRIPT: | 
        WG_SETSILKAVGSUM
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAREFUQVNFVAcAAABEQVRBU0VUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2013-08-21T14:36:43+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147368583_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489065_336327731
    Fields: 
      NAME: "usrg_gdcAvgSalaryStr"
      DESCRIPTION: ~
      PARENT: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_gdcAvgSalaryStr"
      SUBTYPE: ""
      EDITIONDATE: 2005-01-26T12:28:17+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147489067_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147489065_336327731
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_gdcAvgSalaryStrAfterDelete"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_GetAvgSalarySum
        '#include wg_EnableFieldChange
        '#include wg_SetSilkAvgSum
        option explicit
        sub usrg_gdcAvgSalaryStrAfterDelete(ByVal DataSet)
          Exit Sub 'отключено
        ' пересчитываем сумму среднего заработка
          wg_SetSilkAvgSum(DataSet)
        '  if wg_EnabledFieldChange(DataSet, "AVGSALARYCALC") then
        '    wg_GetAvgSalarySum(DataSet)
        '  end if
        
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_GDCAVGSALARYSTRAFTERDELETE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "AFTERDELETE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAREFUQVNFVAcAAABEQVRBU0VUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-12T10:57:53+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147368587_274788016 wg_GetAvgSalarySum"
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "147302770_531940465 wg_SetSilkAvgSum"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147489065_336327731
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_gdcAvgSalaryStr"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147368583_274788016 gdc_dlgUserComplexDocument147022845_119619099\\usrg_gdcAvgSalaryStr"
      EVENTNAME: "AFTERDELETE"
      FUNCTIONKEY: "147489067_336327731 usrg_gdcAvgSalaryStrAfterDelete"
      DISABLE: 1
      EDITIONDATE: 2014-03-12T10:57:53+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147368586_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368584_274788016
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_gdcAvgSalaryStrAfterPost"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_GetAvgSalarySum
        '#include wg_EnableFieldChange
        '#include wg_SetSilkAvgSum
        option explicit
        sub usrg_gdcAvgSalaryStrAfterPost(ByVal DataSet)
          Exit Sub 'отключено
        ' пересчитываем сумму среднего заработка
        '  if wg_EnabledFieldChange(DataSet, "AVGSALARYCALC") then
        '    wg_GetAvgSalarySum(DataSet)
        '  end if
          call wg_SetSilkAvgSum(DataSet)
        end sub
        
      DISPLAYSCRIPT: | 
        USRG_GDCAVGSALARYSTRAFTERPOST
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "AFTERPOST"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022904_119619099 gdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QHAAAAREFUQVNFVAcAAABEQVRBU0VUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZO
        U1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-12T10:46:17+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147368587_274788016 wg_GetAvgSalarySum"
          - 
            ADDFUNCTIONKEY: "147016040_119619099 wg_EnableFieldChange"
          - 
            ADDFUNCTIONKEY: "147302770_531940465 wg_SetSilkAvgSum"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147368584_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_gdcAvgSalaryStr"
      PARENTNAME: "gdc_dlgUserComplexDocument147022845_119619099"
      OBJECTKEY: "147368583_274788016 gdc_dlgUserComplexDocument147022845_119619099\\usrg_gdcAvgSalaryStr"
      EVENTNAME: "AFTERPOST"
      FUNCTIONKEY: "147368586_274788016 usrg_gdcAvgSalaryStrAfterPost"
      DISABLE: 1
      EDITIONDATE: 2014-03-12T10:46:18+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147022925_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368574_274788016
    Fields: 
      NAME: "Tgdc_dlgUserComplexDocument147022845_119619099"
      DESCRIPTION: ~
      PARENT: "147005312_31587988 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument"
      OBJECTTYPE: 1
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: "Tgdc_dlgUserComplexDocument"
      OBJECTNAME: ""
      SUBTYPE: "147022845_119619099"
      EDITIONDATE: 2004-05-07T14:03:57+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147368576_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147368574_274788016
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147022845_119619099"
      MODULE: "METHOD"
      LANGUAGE: "VBScript"
      NAME: "Tgdc_dlgUserComplexDocument147022845_119619099SyncField"
      COMMENT: ~
      SCRIPT: | 
        '#include WG_GETCONSTBYIDANDDATE
        '#include WG_CALCSICLLISTCOEFF
        '#include wg_SetWageDocLookupParams
        '#include wg_MonthHour
        '#include wg_RoundSum
        '#include wg_CalcSchedulerWorkTime
        '#include wg_Total
        '#include wg_Prolog
        option explicit
        sub Tgdc_dlgUserComplexDocument147022845_119619099SyncField(Self, Field, SyncList)
        '*** Данный код необходим для вызова кода определенного в gdc-классе.***
        '*** При его удаления  возможно нарушение  правильной работы системы.***
          call Inherited(Self, "SyncField", Array(Self, Field, SyncList))
        '***               Конец кода поддержки gdc-класса.                  ***
          dim MoveCardList, TotalDateEnd, MoveCard, LineSum
          dim gdcDetailObject, gdcObject, FeeTypeKey, IBSQL
          dim LimitPercent, ByHour, ByBudget, DateFrom, AvgSalaryByRB, LastDay
          dim Creator, DT, Pregnancy, DB, DE, WorkDays, WorkHours
          dim Scheduler, ShedulerKey, wg_EmployeeMovement
          dim K
        
          set Creator = New TCreator
          set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = Self.gdcObject.ReadTransaction
          IBSQL.SQL.Text = " SELECT " + _
            " USR$DATEBEGIN, USR$DATEEND " + _
            " FROM USR$WG_SICKLIST SICK " + _
            " WHERE SICK.USR$FROM = :DT " + _
            " AND SICK.USR$EMPLKEY = :emplkey "
            
          dim q
          set q = creator.GetObject(nil, "TIBSQL", "")
          q.Transaction = Self.gdcObject.ReadTransaction
        
          if Field.DataSet.Self = Self.gdcObject.Self then
            select case Field.FieldName
              case "USR$TOTALDOCKEY"
                wg_SetWageDocLookupParams(Self)
                
        
        
              case "USR$EMPLKEY"
                'Определим карточку сотрудника на конец месяца начисления
                if not Self.gdcObject.FieldByName("usr$totaldockey").IsNull then
                  Self.gdcObject.FieldByName("usr$calcbyhour").AsInteger = 0
                  set MoveCardList = wg_EmplMoveList.MoveCardList(Field.AsInteger, Null)
                  if Assigned(MoveCardList) then
                    TotalDateEnd = wg_Total.DateEnd(Self.gdcObject.FieldByName("usr$totaldockey").AsInteger)
                    set MoveCard = MoveCardList.ExistMoveCardByDate(TotalDateEnd)
                    if Assigned(MoveCard) then
                      if MoveCard.PayFormKey = gdcBaseManager.GetIDByRUIDString(wg_PayForm_Salary_RUID) and not(MoveCard.ByHour) then
                        Self.gdcObject.FieldByName("usr$calcbyhour").AsInteger = 0
                      end if
                    end if
                  end if
                end if
        
        
                wg_SetWageDocLookupParams(Self)
        
              case "USR$ILLTYPEKEY"
                q.Close
                q.SQL.Text = _
                "select it.USR$CALCTYPE as ctype " & _
                "from USR$WG_ILLTYPE it " & _
                "where it.ID = :id "
                q.ParamByName("id").AsInteger = Field.AsInteger
                q.ExecQuery
                Self.GetComponent("usrg_cbCalcType").ItemIndex = q.FieldByName("ctype").AsInteger
                Field.DataSet.FieldByName("usr$calctype").AsInteger = q.FieldByName("ctype").AsInteger
        
                  Pregnancy = (gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = Self.gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger)
                  if Pregnancy then
                    Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 6
                    Self.GetComponent("usrg_cbCalcType").ItemIndex = wg_SickType100
                    Field.DataSet.FieldByName("usr$calctype").AsInteger = wg_SickType100
                    Field.DataSet.FieldByName("USR$CALCBYHOUR").AsInteger = 0
                  'added 18.07.13
                  elseif Field.DataSet.FieldByName("USR$FROM").AsDateTime < CDate("11.07.2013") then
                    Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 2
                  elseif Field.DataSet.FieldByName("USR$FROM").AsDateTime >= CDate("11.07.2013") then
                    Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 6
                  'end added
                  end if
        
            'added 18.07.13
            case "USR$FROM"
              Pregnancy = (gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = Self.gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger)
              if Field.DataSet.FieldByName("USR$FROM").AsDateTime >= CDate("11.07.2013") or Pregnancy then
                Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 6
              else
                Field.DataSet.FieldByName("USR$AVGPERIOD").AsInteger = 2
              end if
            ' added end
                
              case wg_Prolog.SyncField_Name(Self.gdcObject, "USR$AVGSUMMA")
                set gdcDetailObject = Self.gdcDetailObject
                set gdcObject = Self.gdcObject
                FeeTypeKey = gdcBaseManager.GetIDByRUIDString(wg_FeeType_SickList_RUID)
                'Декретный или нет
                Pregnancy = (gdcBaseManager.GetIDByRUIDString(wg_SickType_Pregnancy_RUID) = gdcObject.FieldByName("USR$ILLTYPEKEY").AsInteger)
                gdcDetailObject.Cancel
                gdcDetailObject.First
                if not gdcObject.FieldByName("usr$percent").IsNull then
                  LimitPercent = gdcObject.FieldByName("usr$percent").AsCurrency
                else
                  LimitPercent = 100
                end if
                ByHour = (gdcObject.FieldByName("usr$calcbyhour").AsInteger = 1)
                ByBudget = (gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1)
        
                'Максимальный размер пособий, исчисленных в соответствии с настоящим Положением,
                'кроме пособий по беременности и родам, исчисленных в соответствии с пунктами 39 и 40 настоящего Положения,
                'за календарный месяц по каждому месту работы устанавливается в размере трехкратной величины
                'средней заработной платы рабочих и служащих в республике в месяце, предшествующем каждому месяцу
                'временной нетрудоспособности, отпуска по беременности и родам.
                '
                'Максимальный размер пособий за неполный месяц устанавливается в размере величины,
                'получаемой путем деления трехкратной величины средней заработной платы рабочих и служащих в
                'республике в месяце, предшествующем месяцу временной нетрудоспособности, отпуска по беременности и родам,
                'на количество рабочих дней (часов) по графику работы работника в месяце временной нетрудоспособности,
                'отпуска по беременности и родам с последующим умножением полученного результата на
                'количество рабочих дней (часов) временной нетрудоспособности, отпуска по беременности и родам, в этом месяце.
        
                while (not gdcDetailObject.EOF)
                  gdcDetailObject.Edit
                  if not ByBudget then
                    if not ByHour then
                      LineSum = _
                        gdcDetailObject.FieldByName("USR$DOI").AsCurrency * gdcDetailObject.FieldByName("USR$PERCENT").AsCurrency * _
                        Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency / 100
                    else
                      LineSum = _
                        gdcDetailObject.FieldByName("USR$HOI").AsCurrency * gdcDetailObject.FieldByName("USR$PERCENT").AsCurrency * _
                        Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency / 100
                    end if
                    K = wg_CalcSiclListCoeff(gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime, _
                      gdcDetailObject.FieldByName("USR$DATEBEGIN").AsDateTime)
        
                    LineSum = LineSum * LimitPercent / 100 * K
                  else
                    LastDay = Day(DateAdd("m", 1, DateSerial( _
                      Year(gdcDetailObject.FieldByName("USR$DATEBEGIN").AsDateTime), _
                      Month(gdcDetailObject.FieldByName("USR$DATEBEGIN").AsDateTime), 1)) - 1)
                    if LastDay > 0 then
                      LineSum = _
                        Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency * _
                        gdcDetailObject.FieldByName("USR$DOI").AsInteger / LastDay
                    else
                      LineSum = 0
                    end if
                  end if
                  'if not Pregnancy then
                    set wg_EmployeeMovement = wg_EmplMoveList.MoveCardList(gdcObject.FieldByName("USR$EMPLKEY").AsInteger, Null)
                    if Assigned(wg_EmployeeMovement) then
                      'Зредняя зрп за месяц предыдущий месяцу болезни
                      DateFrom = gdcDetailObject.FieldByName("USR$INCLUDEDATE").AsDateTime
                      set MoveCard = wg_EmployeeMovement.ExistMoveCardByDate(DateFrom)
                      if Assigned(MoveCard) then
                        WorkDays = 0
                        WorkHours = 0
                        ' определяем период начала и конца итогового начисления
                        DB = wg_Total.DateBegin(wg_Total.TotalDocByDate(DateFrom))
                        DE = wg_Total.DateEnd(wg_Total.TotalDocByDate(DateFrom))
                        call wg_CalcSchedulerWorkTime(gdcObject.FieldByName("usr$emplkey").AsInteger, _
                          MoveCard.FirstMoveKey, DB, DE, gdcObject.ReadTransaction, True, WorkDays, WorkHours)
        
                        if not ByHour then
                          if WorkDays > 0 then
                            AvgSalaryByRB = 3 * wg_MonthHour.AvgSalaryByRB(_
                              DateSerial(Year(DateFrom), Month(DateFrom), 1) -1) / WorkDays * gdcDetailObject.FieldByName("USR$DOI").AsCurrency
                          else
                            AvgSalaryByRB = 0
                          end if
                        else
                          if WorkHours > 0 then
                            AvgSalaryByRB = 3 * wg_MonthHour.AvgSalaryByRB(_
                              DateSerial(Year(DateFrom), Month(DateFrom), 1) -1) / WorkHours * gdcDetailObject.FieldByName("USR$HOI").AsCurrency
                          else
                            AvgSalaryByRB = 0
                          end if
                        end if
                        
                        if AvgSalaryByRB <> 0 and LineSum > AvgSalaryByRB then
                          LineSum = AvgSalaryByRB
                        end if
                      end if
                   ' end if
                  end if
                  Self.gdcDetailObject.FieldByName("usr$summa").AsCurrency = wg_RoundSum(FeeTypeKey, LineSum)
                  gdcDetailObject.Post
                  gdcDetailObject.Next
                wend
                gdcDetailObject.First
        
              ' 50% от бюджета прожиточного минимума
              ' срабатывает, если при пересчете декрета пользователь выбрал "50% БМП"
              case wg_Prolog.SyncField_Name(Self.gdcObject, "USR$CALCBYBUDGET")
                if Field.AsInteger = 0 then
                  Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency = 0
                else
                  dim gdcAvgStr
                  set gdcAvgStr = Self.GetComponent("usrg_gdcAvgSalaryStr")
                  'Выключаем автоперерасчет среднего заработка
                  gdcAvgStr.Tag = 1
                  'Удалим старые значения
                  gdcAvgStr.First
                  while not gdcAvgStr.Eof
                    gdcAvgStr.Delete
                  wend
                  call Tgdc_dlgUserComplexDocument147022845_119619099SyncField_CalcAvgSumBudget(Self.gdcObject)
                  gdcAvgStr.Tag = 0
                end if
              case "USR$FROM"
                if (not Field.IsNull) and Self.gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 1 then
                  call Tgdc_dlgUserComplexDocument147022845_119619099SyncField_CalcAvgSumBudget(Self.gdcObject)
                end if
            end select
          end if
        end sub
        
        ' 50% от бюджета прожиточного минимума
        sub Tgdc_dlgUserComplexDocument147022845_119619099SyncField_CalcAvgSumBudget(gdcO)
          dim AvgSum, OnDate
          if gdcO.FieldByName("USR$FROM").IsNull then
            OnDate = Date
          else
            OnDate = gdcO.FieldByName("USR$FROM").AsDateTime
          end if
          ' бюджет прожиточного минимума
          AvgSum = wg_GetConstByIDAndDate(gdcBaseManager.GetIDByRUIDString(wg_cnst_LivingWage_RUID), OnDate)
          gdcO.FieldByName("usr$avgsumma").AsCurrency = Round(AvgSum  / 2)
        end sub
        
      DISPLAYSCRIPT: | 
        TGDC_DLGUSERCOMPLEXDOCUMENT147022845_119619099SYNCFIELD
        TGDC_DLGUSERCOMPLEXDOCUMENT147022845_119619099SYNCFIELD_CALCAVGSUMBUDGET
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147022925_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QEAAAAU0VMRgQAAABTRUxGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNU
        BQAAAEZJRUxEBQAAAEZJRUxEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNUCAAAAFNZ
        TkNMSVNUCAAAAFNZTkNMSVNUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-03-26T13:18:56+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147043669_974374174 wg_GetConstByIDAndDate"
          - 
            ADDFUNCTIONKEY: "155074107_1698257362 wg_CalcSiclListCoeff"
          - 
            ADDFUNCTIONKEY: "147025267_449804462 wg_SetWageDocLookupParams"
          - 
            ADDFUNCTIONKEY: "147019334_119619099 wg_MonthHour"
          - 
            ADDFUNCTIONKEY: "147804276_375143752 wg_RoundSum"
          - 
            ADDFUNCTIONKEY: "147523125_336327731 wg_CalcSchedulerWorkTime"
          - 
            ADDFUNCTIONKEY: "147586119_119619099 wg_Total"
          - 
            ADDFUNCTIONKEY: "528612032_99701464 wg_Prolog"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147368574_274788016
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147022845_119619099"
      PARENTNAME: "Tgdc_dlgUserComplexDocument"
      OBJECTKEY: "147022925_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147022845_119619099"
      EVENTNAME: "SYNCFIELD"
      FUNCTIONKEY: "147368576_274788016 Tgdc_dlgUserComplexDocument147022845_119619099SyncField"
      DISABLE: ~
      EDITIONDATE: 2014-03-26T13:18:58+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 147063986_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "990010_17 USER - Administrator"
      NAME: "gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2010-04-20T13:32:16+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648252_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "WS"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 2
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2013-08-12T19:08:11+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648251_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Width"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 1382
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-09T14:06:53+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648250_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Left"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-09T14:06:53+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648249_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Top"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-09T14:06:53+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648248_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063986_1439110857
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 744
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-09T14:06:53+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 147063987_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "ibgrDetail(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2010-04-20T13:32:16+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123779_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063987_1439110857
    Fields: 
      PARENT: "147063987_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)\\ibgrDetail(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4ACAgOAAgOAQhFeHBhbmRlZAgJRmllbGROYW1lBgtVU1IkQUNDREFURQ1UaXRsZS5D
        YXB0aW9uBg/E4PLgIO3g9+jx6+Xt6P8FV2lkdGgCbAdWaXNpYmxlCQABCEV4cGFuZGVkCAlGaWVs
        ZE5hbWUGD1VTUiRJTkNMVURFREFURQ1UaXRsZS5DYXB0aW9uBg/E4PLgIOfg9+jx6+Xt6P8FV2lk
        dGgCbAdWaXNpYmxlCQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5kZWQICUZpZWxk
        TmFtZQYMVVNSJERVUkFUSU9ODVRpdGxlLkNhcHRpb24GA8Tt6AVXaWR0aAIkB1Zpc2libGUJCVRv
        dGFsVHlwZQcFdHRTdW0AAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVs
        ZE5hbWUGCVVTUiRTVU1NQQ1UaXRsZS5DYXB0aW9uBgXR8+zs4AVXaWR0aAJIB1Zpc2libGUJDURp
        c3BsYXlGb3JtYXQGBCMuIyMJVG90YWxUeXBlBwV0dFN1bQABCEV4cGFuZGVkCAlGaWVsZE5hbWUG
        DVVTUiREQVRFQkVHSU4NVGl0bGUuQ2FwdGlvbgYLxODy4CDt4Pfg6+AFV2lkdGgCbAdWaXNpYmxl
        CQABCEV4cGFuZGVkCAlGaWVsZE5hbWUGC1VTUiREQVRFRU5EDVRpdGxlLkNhcHRpb24GDsTg8uAg
        7uru7ffg7ej/BVdpZHRoAmwHVmlzaWJsZQkAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4
        cGFuZGVkCAlGaWVsZE5hbWUGBlNVTU5DVQ1UaXRsZS5DYXB0aW9uBgZzdW1uY3UFV2lkdGgC/wdW
        aXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGDERPQ1VNRU5UREFURQ1UaXRsZS5DYXB0aW9u
        BgTE4PLgBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgtERVNDUklQVElP
        Tg1UaXRsZS5DYXB0aW9uBgjO7+jx4O3o5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYOVVNSJFNPUlROVU1CRVIIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GFM3u7OXwIOTr
        /yDx7vDy6PDu4uroBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgJJRA1U
        aXRsZS5DYXB0aW9uBgTK6/73BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1l
        BgZQQVJFTlQNVGl0bGUuQ2FwdGlvbgYI0O7k6PLl6/wFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGD0RPQ1VNRU5UVFlQRUtFWQ1UaXRsZS5DYXB0aW9uBg3S6O8g5O7q8+zl
        7fLgBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBglUUlRZUEVLRVkNVGl0
        bGUuQ2FwdGlvbgYO0ujvIPLw4O3n4Or26OgFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlG
        aWVsZE5hbWUGDlRSQU5TQUNUSU9OS0VZDVRpdGxlLkNhcHRpb24GCtLw4O3n4Or26P8FV2lkdGgC
        /wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGBk5VTUJFUg1UaXRsZS5DYXB0aW9uBgXN
        7uzl8AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYHU1VNQ1VSUg1UaXRs
        ZS5DYXB0aW9uBg7R8+zs4CDiIOLg6/7y5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYHREVMQVlFRA1UaXRsZS5DYXB0aW9uBgrO8uvu5uXt7fvpBVdpZHRoAv8HVmlzaWJs
        ZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgdDVVJSS0VZDVRpdGxlLkNhcHRpb24GBsLg6/7y4AVX
        aWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKQ09NUEFOWUtFWQ1UaXRsZS5D
        YXB0aW9uBgjK7uzv4O3o/wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYK
        Q1JFQVRPUktFWQ1UaXRsZS5DYXB0aW9uBgrK8u4g8e7n5ODrBVdpZHRoAv8HVmlzaWJsZQgAAQhF
        eHBhbmRlZAgJRmllbGROYW1lBgxDUkVBVElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYNxODy4CDx7ufk
        4O3o/wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYJRURJVE9SS0VZDVRp
        dGxlLkNhcHRpb24GDMry7iDo8e/w4OLo6wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYLRURJVElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYOxODy4CDo5+zl7eXt6P8FV2lkdGgC
        /wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGCVBSSU5UREFURQ1UaXRsZS5DYXB0aW9u
        BgvE4PLgIO/l9+Dy6AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYIRElT
        QUJMRUQNVGl0bGUuQ2FwdGlvbgYJzvLq6/735e3uBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRl
        ZAgJRmllbGROYW1lBghSRVNFUlZFRA1UaXRsZS5DYXB0aW9uBg/H4PDl5+Xw4ujw7uLg7e4FV2lk
        dGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGC0RPQ1VNRU5US0VZCFJlYWRPbmx5
        CQ1UaXRsZS5DYXB0aW9uBg7K6/73IOTu6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYJTUFTVEVSS0VZCFJlYWRPbmx5CQ1UaXRsZS5DYXB0aW9uBifQ7uTo8uXr
        /CAozeD36PHr5e3o5SDu8u/z8eru4ijv7ufo9uj/KSkFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGCVJFU0VSVkVEMQhSZWFkT25seQkNVGl0bGUuQ2FwdGlvbgYux+Dw5efl
        8OLo8O7i4O3uICjN4Pfo8evl7ejlIO7y7/Px6u7iKO/u5+j26P8pKQVXaWR0aAL/B1Zpc2libGUI
        AAEIRXhwYW5kZWQICUZpZWxkTmFtZQYFU1VNRVENVGl0bGUuQ2FwdGlvbgYT0fPs7OAg4iD96uLo
        4uDr5e3y5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKVVNSJEVRUkFU
        RQ1UaXRsZS5DYXB0aW9uBgnK8/DxIP3q4i4FV2lkdGgC/wdWaXNpYmxlCAABCUFsaWdubWVudAcO
        dGFSaWdodEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYFQUZVTEwNVGl0bGUuQ2FwdGlvbgYN
        z+7r7fvpIOTu8fLz7wVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlm
        eQhFeHBhbmRlZAgJRmllbGROYW1lBgVBQ0hBRw1UaXRsZS5DYXB0aW9uBhnP8O7x7O7y8CDoIPDl
        5ODq8ujw7uLg7ejlBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5
        CEV4cGFuZGVkCAlGaWVsZE5hbWUGBUFWSUVXDVRpdGxlLkNhcHRpb24GD9Lu6/zq7iDv8O7x7O7y
        8AVXaWR0aAL/B1Zpc2libGUIAAAICP0cCQg=
      EDITIONDATE: 2014-02-26T15:58:19+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 154648246_77029543
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "pnlMaster(TPanel)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2013-08-12T19:08:11+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 154648247_119200397
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 154648246_77029543
    Fields: 
      PARENT: "154648246_77029543 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)\\pnlMaster(TPanel)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 283
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-08-20T15:26:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 147063989_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "147063986_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "usrg_grAvgSalaryStr(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2010-04-20T13:32:16+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 147123780_1439110857
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 147063989_1439110857
    Fields: 
      PARENT: "147063989_1439110857 USER - Administrator\\gdc_dlgUserComplexDocument147020774_119619099(Tgdc_dlgUserComplexDocument)\\usrg_grAvgSalaryStr(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4BDERpc3BsYXlGaWVsZAYHVVNSJERPVwlGaWVsZE5hbWUGB1VTUiRIT1cJTGluZUNv
        dW50AgEHT3B0aW9ucwsLY2VvQWRkRmllbGQAAAEMRGlzcGxheUZpZWxkBhBVU1IkU0NIRURVTEVS
        RE9XCUZpZWxkTmFtZQYQVVNSJFNDSEVEVUxFUkhPVwlMaW5lQ291bnQCAQdPcHRpb25zCwtjZW9B
        ZGRGaWVsZAAAAQxEaXNwbGF5RmllbGQGDVVTUiRORVdTQUxBUlkJRmllbGROYW1lBg1VU1IkT0xE
        U0FMQVJZCUxpbmVDb3VudAIBB09wdGlvbnMLC2Nlb0FkZEZpZWxkAAABDERpc3BsYXlGaWVsZAYK
        VVNSJFNBTEFSWQlGaWVsZE5hbWUGEFVTUiRNT0RFUk5TQUxBUlkJTGluZUNvdW50AgEHT3B0aW9u
        cwsLY2VvQWRkRmllbGQAAAAICA4ACA4BCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgpVU1IkSVNGVUxMCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgzP7uvt++kg
        7OXx//YFV2lkdGgCMAdWaXNpYmxlCQABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgtVU1IkSVNDSEVDSwhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYEwurrLgVX
        aWR0aAIwB1Zpc2libGUJCVRvdGFsVHlwZQcFdHRTdW0AAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3Rp
        ZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYIVVNSJERBVEUIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24G
        BMTg8uAFV2lkdGgCSAdWaXNpYmxlCQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYKVVNSJFNBTEFSWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYIx+Dw7+vg
        8uAFV2lkdGgCSAdWaXNpYmxlCQ1EaXNwbGF5Rm9ybWF0BgQjLiMjAAEJQWxpZ25tZW50Bw50YVJp
        Z2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBglVU1IkQ09FRkYIUmVhZE9ubHkIDVRpdGxl
        LkNhcHRpb24GBsru/fQt8gVXaWR0aAI0B1Zpc2libGUJAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVz
        dGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1IkTU9ERVJOU0FMQVJZCFJlYWRPbmx5CA1UaXRs
        ZS5DYXB0aW9uBhTR7uLw5ezl7e3g/yDn4PDv6+Dy4AVXaWR0aAJUB1Zpc2libGUJDURpc3BsYXlG
        b3JtYXQGBCMuIyMJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkI
        RXhwYW5kZWQICUZpZWxkTmFtZQYHVVNSJERPVwhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYDxO3o
        BVdpZHRoAiQHVmlzaWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcNdGFMZWZ0SnVz
        dGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1IkU0NIRURVTEVSRE9XCFJlYWRPbmx5CA1UaXRs
        ZS5DYXB0aW9uBgvE7eXpIO/uIOPwLgVXaWR0aAJIB1Zpc2libGUJAAEJQWxpZ25tZW50Bw50YVJp
        Z2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBgdVU1IkSE9XCFJlYWRPbmx5CA1UaXRsZS5D
        YXB0aW9uBgTX4PH7BVdpZHRoAisHVmlzaWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVu
        dAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1IkU0NIRURVTEVSSE9XCFJl
        YWRPbmx5CA1UaXRsZS5DYXB0aW9uBgzX4PHu4iDv7iDj8C4FV2lkdGgCTAdWaXNpYmxlCQABCUFs
        aWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBg9VU1IkREVTQ1JJUFRJ
        T04IUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GCM7v6PHg7ejlBVdpZHRoA94AB1Zpc2libGUJAAEJ
        QWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBg1VU1IkT0xEU0FM
        QVJZCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgXO6uvg5AVXaWR0aAL/B1Zpc2libGUIAAEJQWxp
        Z25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBg1VU1IkTkVXU0FMQVJZ
        CFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBg3S5erz+ejpIO7q6+DkBVdpZHRoAv8HVmlzaWJsZQgA
        AQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYCSUQNVGl0bGUu
        Q2FwdGlvbgYNyOTl7fLo9Ojq4PLu8AVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw10YUxl
        ZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGD1VTUiRET0NVTUVOVEtFWQhSZWFkT25seQgN
        VGl0bGUuQ2FwdGlvbgYIxO7q8+zl7fIFV2lkdGgC/wdWaXNpYmxlCAABCUFsaWdubWVudAcNdGFM
        ZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhhaX1VTUiRET0NVTUVOVEtFWV9OVU1CRVII
        UmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBc3u7OXwBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1l
        bnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYeWl9VU1IkRE9DVU1FTlRLRVlf
        RE9DVU1FTlREQVRFCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgTE4PLgBVdpZHRoAv8HVmlzaWJs
        ZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYfWl9VU1Ik
        RE9DVU1FTlRLRVlfRE9DMjcxNTI2MDQ3OAhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYN0ujvIOTu
        6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGDFVTUiRDQUxDREFZUwhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYLxO3o
        IPDg8ffl8i4FV2lkdGgC/wdWaXNpYmxlCAAACAj9DAkI
      EDITIONDATE: 2014-10-28T09:48:51+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 394420819_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "990010_17 USER - Administrator"
      NAME: "gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2012-02-21T12:09:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420826_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "WS"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 2
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-11-28T10:08:54+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420825_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Width"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 1382
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-08T17:59:50+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420824_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Left"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-08T17:59:50+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420823_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Top"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: -8
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-08T17:59:50+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420822_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420819_99701464
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 744
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-08T17:59:50+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 497125569_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "ibgrDetail(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2013-09-12T10:36:15+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 497125570_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 497125569_99701464
    Fields: 
      PARENT: "497125569_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)\\ibgrDetail(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4ACAgOAAgOAQhFeHBhbmRlZAgJRmllbGROYW1lBg9VU1IkSU5DTFVERURBVEUNVGl0
        bGUuQ2FwdGlvbgYQzOXx//Yg5+D36PHr5e3o/wVXaWR0aAJsB1Zpc2libGUJAAEJQWxpZ25tZW50
        Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBgtVU1IkUEVSQ0VOVA1UaXRsZS5D
        YXB0aW9uBgElBVdpZHRoAiQHVmlzaWJsZQkAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4
        cGFuZGVkCAlGaWVsZE5hbWUGB1VTUiRET0kNVGl0bGUuQ2FwdGlvbgYDxO3oBVdpZHRoAjAHVmlz
        aWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYHVVNSJEhPSQ1UaXRsZS5DYXB0aW9uBgTX4PH7BVdpZHRoAjAHVmlzaWJs
        ZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5kZWQI
        CUZpZWxkTmFtZQYJVVNSJFNVTU1BDVRpdGxlLkNhcHRpb24GBdHz7OzgBVdpZHRoAkgHVmlzaWJs
        ZQkJVG90YWxUeXBlBwV0dFN1bQABCEV4cGFuZGVkCAlGaWVsZE5hbWUGDVVTUiREQVRFQkVHSU4N
        VGl0bGUuQ2FwdGlvbgYLxODy4CDt4Pfg6+AFV2lkdGgCVAdWaXNpYmxlCQABCEV4cGFuZGVkCAlG
        aWVsZE5hbWUGC1VTUiREQVRFRU5EDVRpdGxlLkNhcHRpb24GDsTg8uAg7uru7ffg7ej/BVdpZHRo
        AmwHVmlzaWJsZQkAAQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5h
        bWUGBlNVTU5DVQ1UaXRsZS5DYXB0aW9uBgnN4Pfo8evl7e4FV2lkdGgC/wdWaXNpYmxlCAABCEV4
        cGFuZGVkCAlGaWVsZE5hbWUGDERPQ1VNRU5UREFURQ1UaXRsZS5DYXB0aW9uBgTE4PLgBVdpZHRo
        Av8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgtERVNDUklQVElPTg1UaXRsZS5DYXB0
        aW9uBgjO7+jx4O3o5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYOVVNS
        JFNPUlROVU1CRVIIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GFM3u7OXwIOTr/yDx7vDy6PDu4uro
        BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgJJRA1UaXRsZS5DYXB0aW9u
        BgTK6/73BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgZQQVJFTlQNVGl0
        bGUuQ2FwdGlvbgYI0O7k6PLl6/wFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5h
        bWUGD0RPQ1VNRU5UVFlQRUtFWQ1UaXRsZS5DYXB0aW9uBg3S6O8g5O7q8+zl7fLgBVdpZHRoAv8H
        VmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBglUUlRZUEVLRVkNVGl0bGUuQ2FwdGlvbgYO
        0ujvIPLw4O3n4Or26OgFV2lkdGgC/wdWaXNpYmxlCAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGDlRS
        QU5TQUNUSU9OS0VZDVRpdGxlLkNhcHRpb24GCtLw4O3n4Or26P8FV2lkdGgC/wdWaXNpYmxlCAAB
        CEV4cGFuZGVkCAlGaWVsZE5hbWUGBk5VTUJFUg1UaXRsZS5DYXB0aW9uBgXN7uzl8AVXaWR0aAL/
        B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYHU1VNQ1VSUg1UaXRsZS5DYXB0aW9uBg7R
        8+zs4CDiIOLg6/7y5QVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYHREVM
        QVlFRA1UaXRsZS5DYXB0aW9uBgrO8uvu5uXt7fvpBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgdDVVJSS0VZDVRpdGxlLkNhcHRpb24GBsLg6/7y4AVXaWR0aAL/B1Zpc2li
        bGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKQ09NUEFOWUtFWQ1UaXRsZS5DYXB0aW9uBgjK7uzv
        4O3o/wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYKQ1JFQVRPUktFWQ1U
        aXRsZS5DYXB0aW9uBgrK8u4g8e7n5ODrBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmll
        bGROYW1lBgxDUkVBVElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYNxODy4CDx7ufk4O3o/wVXaWR0aAL/
        B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYJRURJVE9SS0VZDVRpdGxlLkNhcHRpb24G
        DMry7iDo8e/w4OLo6wVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYLRURJ
        VElPTkRBVEUNVGl0bGUuQ2FwdGlvbgYOxODy4CDo5+zl7eXt6P8FV2lkdGgC/wdWaXNpYmxlCAAB
        CEV4cGFuZGVkCAlGaWVsZE5hbWUGCVBSSU5UREFURQ1UaXRsZS5DYXB0aW9uBgvE4PLgIO/l9+Dy
        6AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFtZQYIRElTQUJMRUQNVGl0bGUu
        Q2FwdGlvbgYJzvLq6/735e3uBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1l
        BghSRVNFUlZFRA1UaXRsZS5DYXB0aW9uBg/H4PDl5+Xw4ujw7uLg7e4FV2lkdGgC/wdWaXNpYmxl
        CAABCEV4cGFuZGVkCAlGaWVsZE5hbWUGC0RPQ1VNRU5US0VZCFJlYWRPbmx5CQ1UaXRsZS5DYXB0
        aW9uBg7K6/73IOTu6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAEIRXhwYW5kZWQICUZpZWxkTmFt
        ZQYJTUFTVEVSS0VZCFJlYWRPbmx5CQ1UaXRsZS5DYXB0aW9uBivQ7uTo8uXr/CAoMDUuzeD36PHr
        5e3o5SDh7uvt6Pft+/Uo7+7n6Pbo/ykpBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmll
        bGROYW1lBglSRVNFUlZFRDEIUmVhZE9ubHkJDVRpdGxlLkNhcHRpb24GMsfg8OXn5fDi6PDu4uDt
        7iAoMDUuzeD36PHr5e3o5SDh7uvt6Pft+/Uo7+7n6Pbo/ykpBVdpZHRoAv8HVmlzaWJsZQgAAQhF
        eHBhbmRlZAgJRmllbGROYW1lBgtVU1IkQUNDREFURQ1UaXRsZS5DYXB0aW9uBhDM5fH/9iDt4Pfo
        8evl7ej/BVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRlZAgJRmllbGROYW1lBgVTVU1FUQ1UaXRs
        ZS5DYXB0aW9uBhPR8+zs4CDiIP3q4uji4Ovl7fLlBVdpZHRoAv8HVmlzaWJsZQgAAQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgpVU1IkRVFSQVRFDVRpdGxlLkNhcHRpb24GCcrz8PEg/eriLgVXaWR0aAL/
        B1Zpc2libGUIAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1l
        BgVBRlVMTA1UaXRsZS5DYXB0aW9uBg3P7uvt++kg5O7x8vPvBVdpZHRoAv8HVmlzaWJsZQgAAQlB
        bGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGBUFDSEFHDVRpdGxl
        LkNhcHRpb24GGc/w7vHs7vLwIOgg8OXk4Ory6PDu4uDt6OUFV2lkdGgC/wdWaXNpYmxlCAABCUFs
        aWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYFQVZJRVcNVGl0bGUu
        Q2FwdGlvbgYP0u7r/OruIO/w7vHs7vLwBVdpZHRoAv8HVmlzaWJsZQgAAAgI/RwJCA==
      EDITIONDATE: 2014-04-08T17:59:41+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 394420820_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "pnlMaster(TPanel)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2012-02-21T12:09:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 394420821_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 394420820_99701464
    Fields: 
      PARENT: "394420820_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)\\pnlMaster(TPanel)"
      NAME: "Height"
      DATA_TYPE: "I"
      STR_DATA: ~
      INT_DATA: 304
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2014-12-09T10:54:27+03:00
  - 
    Properties: 
      Class: "TgdcStorageFolder"
      RUID: 489119204_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
    Fields: 
      PARENT: "394420819_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)"
      NAME: "usrg_grAvgSalaryStr(TgsIBGrid)"
      DATA_TYPE: "F"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: ~
      EDITIONDATE: 2013-07-30T17:00:30+03:00
  - 
    Properties: 
      Class: "TgdcStorageValue"
      RUID: 489119205_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: True
      HeadObject: 489119204_99701464
    Fields: 
      PARENT: "489119204_99701464 USER - Administrator\\gdc_dlgUserComplexDocument147022845_119619099(Tgdc_dlgUserComplexDocument)\\usrg_grAvgSalaryStr(TgsIBGrid)"
      NAME: "data"
      DATA_TYPE: "B"
      STR_DATA: ~
      INT_DATA: ~
      DATETIME_DATA: ~
      CURR_DATA: ~
      BLOB_DATA: !!binary > 
        VFBGMAYNR1JJRF9TVFJFQU1fNAEGBlRhaG9tYQYMY2xXaW5kb3dUZXh0AvUAAggAA8wAAAYIY2xX
        aW5kb3cBBgZUYWhvbWEGD2NsSGlnaGxpZ2h0VGV4dAL1AAIIAAPMAAAGC2NsSGlnaGxpZ2h0AQYG
        VGFob21hBgxjbFdpbmRvd1RleHQC9QACCAADzAAABgljbEJ0bkZhY2UJBgkkMDBFN0YzRjcGCSQw
        MEQ2RTdFNw4ACAgOAAgOAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxk
        TmFtZQYKVVNSJElTRlVMTAhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYMz+7r7fvpIOzl8f/2BVdp
        ZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxk
        TmFtZQYIVVNSJERBVEUIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBMTg8uAFV2lkdGgCSAdWaXNp
        YmxlCQABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBgxVU1Ik
        Q0FMQ0RBWVMIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GC8Tt6CDw4PH35fIuBVdpZHRoAk4HVmlz
        aWJsZQkJVG90YWxUeXBlBwV0dFN1bQABCUFsaWdubWVudAcOdGFSaWdodEp1c3RpZnkIRXhwYW5k
        ZWQICUZpZWxkTmFtZQYKVVNSJFNBTEFSWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYIx+Dw7+vg
        8uAFV2lkdGgCSAdWaXNpYmxlCQ1EaXNwbGF5Rm9ybWF0BgQjLiMjCVRvdGFsVHlwZQcFdHRTdW0A
        AQlBbGlnbm1lbnQHDnRhUmlnaHRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGB1VTUiRET1cI
        UmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GCsTt6CDw4OHu8vsFV2lkdGgCTgdWaXNpYmxlCQlUb3Rh
        bFR5cGUHBXR0U3VtAAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5h
        bWUGEFVTUiRTQ0hFRFVMRVJET1cIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GD8Tt5ekg7+4g4/Dg
        9Ojq8wVXaWR0aAJUB1Zpc2libGUJAAEJQWxpZ25tZW50Bw50YVJpZ2h0SnVzdGlmeQhFeHBhbmRl
        ZAgJRmllbGROYW1lBgdVU1IkSE9XCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgvX4PH7IPDg4e7y
        +wVXaWR0aAJMB1Zpc2libGUJCVRvdGFsVHlwZQcFdHRTdW0AAQlBbGlnbm1lbnQHDXRhTGVmdEp1
        c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYQVVNSJFNDSEVEVUxFUkhPVwhSZWFkT25seQgNVGl0
        bGUuQ2FwdGlvbgYQ1+Dx7uIg7+4g4/Dg9Ojq8wVXaWR0aAJgB1Zpc2libGUJAAEJQWxpZ25tZW50
        Bw10YUxlZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGD1VTUiRERVNDUklQVElPTghSZWFk
        T25seQgNVGl0bGUuQ2FwdGlvbgYIzu/o8eDt6OUFV2lkdGgCeQdWaXNpYmxlCQABCUFsaWdubWVu
        dAcNdGFMZWZ0SnVzdGlmeQVDb2xvcgcHY2xXaGl0ZQhFeHBhbmRlZAgJRmllbGROYW1lBhBVU1Ik
        TU9ERVJOU0FMQVJZCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBhTR7uLw5ezl7e3g/yDn4PDv6+Dy
        4AVXaWR0aAL/B1Zpc2libGUIDURpc3BsYXlGb3JtYXQGBCMuIyMAAQlBbGlnbm1lbnQHDXRhTGVm
        dEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYJVVNSJENPRUZGCFJlYWRPbmx5CA1UaXRsZS5D
        YXB0aW9uBgbK7v30LfIFV2lkdGgC/wdWaXNpYmxlCAABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlm
        eQhFeHBhbmRlZAgJRmllbGROYW1lBgtVU1IkSVNDSEVDSwhSZWFkT25seQgNVGl0bGUuQ2FwdGlv
        bgYEwurrLgVXaWR0aAL/B1Zpc2libGUIAAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFu
        ZGVkCAlGaWVsZE5hbWUGDVVTUiRPTERTQUxBUlkIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBc7q
        6+DkBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQI
        CUZpZWxkTmFtZQYNVVNSJE5FV1NBTEFSWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYG0fLg4urg
        BVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZp
        ZWxkTmFtZQYCSUQNVGl0bGUuQ2FwdGlvbgYNyOTl7fLo9Ojq4PLu8AVXaWR0aAL/B1Zpc2libGUI
        AAEJQWxpZ25tZW50Bw10YUxlZnRKdXN0aWZ5CEV4cGFuZGVkCAlGaWVsZE5hbWUGD1VTUiRET0NV
        TUVOVEtFWQhSZWFkT25seQgNVGl0bGUuQ2FwdGlvbgYIxO7q8+zl7fIFV2lkdGgC/wdWaXNpYmxl
        CAABCUFsaWdubWVudAcNdGFMZWZ0SnVzdGlmeQhFeHBhbmRlZAgJRmllbGROYW1lBhhaX1VTUiRE
        T0NVTUVOVEtFWV9OVU1CRVIIUmVhZE9ubHkIDVRpdGxlLkNhcHRpb24GBc3u7OXwBVdpZHRoAv8H
        VmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQICUZpZWxkTmFtZQYe
        Wl9VU1IkRE9DVU1FTlRLRVlfRE9DVU1FTlREQVRFCFJlYWRPbmx5CA1UaXRsZS5DYXB0aW9uBgTE
        4PLgBVdpZHRoAv8HVmlzaWJsZQgAAQlBbGlnbm1lbnQHDXRhTGVmdEp1c3RpZnkIRXhwYW5kZWQI
        CUZpZWxkTmFtZQYfWl9VU1IkRE9DVU1FTlRLRVlfRE9DMjcxNTI2MDQ3OAhSZWFkT25seQgNVGl0
        bGUuQ2FwdGlvbgYN0ujvIOTu6vPs5e3y4AVXaWR0aAL/B1Zpc2libGUIAAAICP0cCQg=
      EDITIONDATE: 2014-12-09T11:30:19+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 151516266_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 151516264_101633588
    Fields: 
      OBJECTNAME: "gdc_frmUserComplexDocument147022845_119619099"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_Sick_Recalc"
      COMMENT: ~
      SCRIPT: | 
        Option Explicit
        '#include wg_AvgSalaryStrGenerate_Sick_pl
        '#include wg_Prolog
        '#include wg_AvgSalaryDetailGenerate_Sick_pl
        
        Sub Macros_Sick_Recalc(OwnerForm)
        '
          Dim gdcObject, gdcDetail, gdcAvgStr, Creator, inID, Ret
          Set gdcObject = OwnerForm.gdcObject
          Set gdcDetail = OwnerForm.gdcDetailObject
        
          Call wg_Prolog.SyncField(OwnerForm.gdcObject, True)
        
          If Not OwnerForm.gdcObject.VariableExists("DontRecalcLine") Then
            OwnerForm.gdcObject.AddVariableItem("DontRecalcLine")
          End If
          '
          OwnerForm.gdcObject.Variables("DontRecalcLine") = True
        
          gdcObject.First
          inID = ""
          '
          While Not gdcObject.eof
            If inID = "" Then
              inID = gdcObject.ID
            Else
              inID = inID & ", " & gdcObject.ID
            End If
            '
            gdcObject.Next
          Wend
          '
          inID = "(" & inID & ")"
          gdcObject.ExtraConditions.Add(" z.id in " & inID )
        
          Set Creator = New TCreator
          Set gdcAvgStr = Creator.GetObject(OwnerForm, "TgdcAttrUserDefined", "")
          gdcAvgStr.SubType = "USR$WG_AVGSALARYSTR"
          gdcAvgStr.Transaction = gdcObject.Transaction
          gdcAvgStr.ReadTransaction = gdcObject.ReadTransaction
          gdcAvgStr.SubSet = "ByParent"
          gdcAvgStr.MasterSource = OwnerForm.GetComponent("dsMain")
          gdcAvgStr.MasterField = "ID"
          gdcAvgStr.DetailField = "PARENT"
          gdcAvgStr.Open
        
          gdcObject.First
          '
          While Not gdcObject.EOF
            gdcObject.Edit
            gdcObject.FieldByName("USR$AVGSUMMA").Clear
            gdcObject.FieldByName("USR$THIRDMETHOD").AsInteger = 0
            gdcObject.FieldByName("USR$CALCBYBUDGET").AsInteger = 0
            gdcObject.FieldByName("USR$AVERAGE").AsInteger = 0
        
            Ret = wg_AvgSalaryStrGenerate_Sick_pl(gdcObject, gdcAvgStr)
            Ret = wg_AvgSalaryDetailGenerate_Sick_pl(gdcObject, gdcDetail)
            '
            gdcObject.Next
          Wend
        
          OwnerForm.gdcObject.Variables("DontRecalcLine") = False
          Call wg_Prolog.SyncField(OwnerForm.gdcObject, False)
          gdcObject.ExtraConditions.Clear
        '
        End Sub
        
      DISPLAYSCRIPT: | 
        MACROS_SICK_RECALC
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147014155_274788016 gdc_frmUserComplexDocument147022845_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-05-05T12:05:29+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "520236113_2108071301 wg_AvgSalaryStrGenerate_Sick_pl"
          - 
            ADDFUNCTIONKEY: "528612032_99701464 wg_Prolog"
          - 
            ADDFUNCTIONKEY: "528605649_99701464 wg_AvgSalaryDetailGenerate_Sick_pl"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 151516264_101633588
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_frmUserComplexDocument147022845_119619099"
      MACROSGROUPKEY: "147071380_375139087 Локальные макросы"
      FUNCTIONKEY: "151516266_101633588 Macros_Sick_Recalc"
      NAME: "Пересчет больничных (Пролог-скрипт)"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-05-05T12:05:29+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcTableCalendar"
      RUID: 156913837_131572570
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Ненормированный график"
      MON: 1
      TUE: 1
      WED: 1
      THU: 1
      FRI: 1
      SAT: 0
      SUN: 0
      HOLIDAYISWORK: 0
      W1_OFFSET: 0
      W1_START1: 1899-12-30T00:00:00+03:00
      W1_END1: 1899-12-30T00:00:00+03:00
      W1_START2: 1899-12-30T00:00:00+03:00
      W1_END2: 1899-12-30T00:00:00+03:00
      W1_START3: 1899-12-30T00:00:00+03:00
      W1_END3: 1899-12-30T00:00:00+03:00
      W1_START4: 1899-12-30T00:00:00+03:00
      W1_END4: 1899-12-30T00:00:00+03:00
      W2_OFFSET: 0
      W2_START1: 1899-12-30T00:00:00+03:00
      W2_END1: 1899-12-30T00:00:00+03:00
      W2_START2: 1899-12-30T00:00:00+03:00
      W2_END2: 1899-12-30T00:00:00+03:00
      W2_START3: 1899-12-30T00:00:00+03:00
      W2_END3: 1899-12-30T00:00:00+03:00
      W2_START4: 1899-12-30T00:00:00+03:00
      W2_END4: 1899-12-30T00:00:00+03:00
      W3_OFFSET: 0
      W3_START1: 1899-12-30T00:00:00+03:00
      W3_END1: 1899-12-30T00:00:00+03:00
      W3_START2: 1899-12-30T00:00:00+03:00
      W3_END2: 1899-12-30T00:00:00+03:00
      W3_START3: 1899-12-30T00:00:00+03:00
      W3_END3: 1899-12-30T00:00:00+03:00
      W3_START4: 1899-12-30T00:00:00+03:00
      W3_END4: 1899-12-30T00:00:00+03:00
      W4_OFFSET: 0
      W4_START1: 1899-12-30T00:00:00+03:00
      W4_END1: 1899-12-30T00:00:00+03:00
      W4_START2: 1899-12-30T00:00:00+03:00
      W4_END2: 1899-12-30T00:00:00+03:00
      W4_START3: 1899-12-30T00:00:00+03:00
      W4_END3: 1899-12-30T00:00:00+03:00
      W4_START4: 1899-12-30T00:00:00+03:00
      W4_END4: 1899-12-30T00:00:00+03:00
      W5_OFFSET: 0
      W5_START1: 1899-12-30T00:00:00+03:00
      W5_END1: 1899-12-30T00:00:00+03:00
      W5_START2: 1899-12-30T00:00:00+03:00
      W5_END2: 1899-12-30T00:00:00+03:00
      W5_START3: 1899-12-30T00:00:00+03:00
      W5_END3: 1899-12-30T00:00:00+03:00
      W5_START4: 1899-12-30T00:00:00+03:00
      W5_END4: 1899-12-30T00:00:00+03:00
      W6_OFFSET: 0
      W6_START1: 1899-12-30T00:00:00+03:00
      W6_END1: 1899-12-30T00:00:00+03:00
      W6_START2: 1899-12-30T00:00:00+03:00
      W6_END2: 1899-12-30T00:00:00+03:00
      W6_START3: 1899-12-30T00:00:00+03:00
      W6_END3: 1899-12-30T00:00:00+03:00
      W6_START4: 1899-12-30T00:00:00+03:00
      W6_END4: 1899-12-30T00:00:00+03:00
      W7_OFFSET: 0
      W7_START1: 1899-12-30T00:00:00+03:00
      W7_END1: 1899-12-30T00:00:00+03:00
      W7_START2: 1899-12-30T00:00:00+03:00
      W7_END2: 1899-12-30T00:00:00+03:00
      W7_START3: 1899-12-30T00:00:00+03:00
      W7_END3: 1899-12-30T00:00:00+03:00
      W7_START4: 1899-12-30T00:00:00+03:00
      W7_END4: 1899-12-30T00:00:00+03:00
      W8_OFFSET: 0
      W8_START1: 1899-12-30T00:00:00+03:00
      W8_END1: 1899-12-30T00:00:00+03:00
      W8_START2: 1899-12-30T00:00:00+03:00
      W8_END2: 1899-12-30T00:00:00+03:00
      W8_START3: 1899-12-30T00:00:00+03:00
      W8_END3: 1899-12-30T00:00:00+03:00
      W8_START4: 1899-12-30T00:00:00+03:00
      W8_END4: 1899-12-30T00:00:00+03:00
      EDITIONDATE: 2014-03-14T15:54:21+03:00
      USR$WAGE_OLDKEY: ~
      USR$DAYCICLECOUNT: 7
      USR$CALENDARTYPE: ~
      USR$FIRSTDAYDATE: ~
      USR$HOLIDAYISWORK: 0
      USR$DAYSDATA: ~
      USR$ISLINKDAYWEEK: 1
      USR$MON: 0
      USR$TUE: 0
      USR$WED: 0
      USR$THU: 0
      USR$FRI: 0
      USR$SAT: 0
      USR$SUN: 0
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 540049114_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "APPLICATION"
      MODULE: "UNKNOWN"
      LANGUAGE: "VBScript"
      NAME: "wg_CalcAvgAddPay_pl"
      COMMENT: ~
      SCRIPT: | 
        '#include pl_GetScriptIDByName
        Option Explicit
        
        Function wg_CalcAvgAddPay_pl(ByRef gdcObject, ByRef gdcDetailObject, ByRef gdcSalary, _
                                     ByVal MonthBefore, ByVal MonthOffset)
        '
          Dim T, T1, T2
          '
          Dim Creator
          '
          Dim PL, Ret, Pred, Tv, Append
          Dim PredFile, Scope
          'avg_wage
          Dim P_main, Tv_main, Q_main
          'avg_wage_avg_in
          Dim P_in, Tv_in, Q_in
          Dim EmplKey, FirstMoveKey, DateCalc, CalcByHoure
          'avg_wage_run, avg_wage_sql
          Dim P_run, Tv_run, Q_run, P_sql, Tv_sql, Q_sql, P_kb
          Dim DateCalcFrom, DateCalcTo
          Dim PredicateName, Arity, SQL
          'avg_wage_out, avg_wage_avg_det
          Dim P_out, Tv_out, Q_out, P_det, Tv_det, Q_det
          Dim AvgWage, AvgWageRule
          Dim Period, Wage
          Dim TabDays, TabHoures, NormDays, NormHoures
        
          T1 = Timer
          wg_CalcAvgAddPay_pl = ""
        
          'init
          Set Creator = New TCreator
          Set PL = Creator.GetObject(nil, "TgsPLClient", "")
          Ret = PL.Initialise("")
          If Not Ret Then
            Exit Function
          End If
          'debug
          PL.Debug = True
          'load
          Ret = PL.LoadScript(pl_GetScriptIDByName("twg_avg_wage"))
          If Not Ret Then
            Exit Function
          End If
          Scope = "wg_avg_wage_avg"
        
          'params
          CalcByHoure = gdcObject.FieldByName("USR$CALCBYHOUR").AsInteger
          EmplKey = gdcDetailObject.FieldByName("usr$emplkey").AsInteger
          FirstMoveKey = gdcDetailObject.FieldByName("usr$firstmovekey").AsInteger
          '
          Dim IBSQL
          '
          Set IBSQL = Creator.GetObject(nil, "TIBSQL", "")
          IBSQL.Transaction = gdcBaseManager.ReadTransaction
          IBSQL.SQL.Text = _
              "SELECT " & _
              "  t.USR$DATEBEGIN " & _
              "FROM " & _
              "  USR$WG_TOTAL t " & _
              "WHERE " & _
              "  t.DOCUMENTKEY = :TDK "
          IBSQL.ParamByName("TDK").AsInteger = gdcObject.FieldByName("USR$TOTALDOCKEY").AsInteger
          IBSQL.ExecQuery
          '
          DateCalc = IBSQL.FieldByName("USR$DATEBEGIN").AsDateTime
          '
          IBSQL.Close
          '
        
          'clean
          gdcSalary.First
          While Not gdcSalary.EOF
            gdcSalary.Delete
          Wend
          '
          gdcSalary.OwnerForm.Repaint
        
          'avg_wage_avg_in(EmplKey, FirstMoveKey, DateCalc, CalcByHoure, MonthBefore, MonthOffset)
          P_in = "avg_wage_avg_in"
          Set Tv_in = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_in = Creator.GetObject(nil, "TgsPLQuery", "")
          Tv_in.PutInteger 0, EmplKey
          Tv_in.PutInteger 1, FirstMoveKey
          Tv_in.PutDate 2, DateCalc
          Tv_in.PutInteger 3, CalcByHoure
          Tv_in.PutInteger 4, MonthBefore
          Tv_in.PutInteger 5, MonthOffset
          '
          Q_in.PredicateName = P_in
          Q_in.Termv = Tv_in
          '
          Q_in.OpenQuery
          If Q_in.EOF Then
            Exit Function
          End If
          Q_in.Close
        
          'avg_wage(Scope) - prepare data
          P_main = "avg_wage"
          Set Tv_main = Creator.GetObject(1, "TgsPLTermv", "")
          Set Q_main = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_main.PredicateName = P_main
          Q_main.Termv = Tv_main
          '
          Tv_main.PutAtom 0, Scope
          '
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage_run(Scope, EmplKey, FirstMoveKey, DateCalcFrom, DateCalcTo)
          P_run = "avg_wage_run"
          Set Tv_run = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_run = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_run.PredicateName = P_run
          Q_run.Termv = Tv_run
          'avg_wage_sql(Scope, EmplKey, FirstMoveKey, PredicateName, Arity, SQL)
          P_sql = "avg_wage_sql"
          P_kb = "avg_wage_kb"
          Set Tv_sql = Creator.GetObject(6, "TgsPLTermv", "")
          Set Q_sql = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_sql.PredicateName = P_sql
          Q_sql.Termv = Tv_sql
          '
          Tv_run.PutAtom 0, Scope
          '
          Q_run.OpenQuery
          If Q_run.EOF Then
            Exit Function
          End If
          '
          Append = False
          '
          Do Until Q_run.EOF
            EmplKey = Tv_run.ReadInteger(1)
            FirstMoveKey = Tv_run.ReadInteger(2)
            DateCalcFrom = Tv_run.ReadDate(3)
            DateCalcTo = Tv_run.ReadDate(4)
            '
            Tv_sql.Reset
            Tv_sql.PutAtom 0, Scope
            Tv_sql.PutInteger 1, EmplKey
            Tv_sql.PutInteger 2, FirstMoveKey
            Q_sql.OpenQuery
            '
            Do Until Q_sql.EOF
              PredicateName = Tv_sql.ReadAtom(3)
              Arity = Tv_sql.ReadInteger(4)
              SQL = Tv_sql.ReadString(5)
              '
              Ret =  PL.MakePredicatesOfSQLSelect _
                        (SQL, _
                        gdcBaseManager.ReadTransaction, _
                        PredicateName, PredicateName, Append)
              If Ret >= 0 Then
                 Ret = PL.Call(P_kb, Tv_sql)
              End If
              '
              Q_sql.NextSolution
            Loop
            Q_sql.Close
            '
            Append = True
            '
            Q_run.NextSolution
          Loop
          Q_run.Close
        
          'save param_list
          If PL.Debug Then
            Pred = "param_list"
            PredFile = "param_list"
            Set Tv = Creator.GetObject(3, "TgsPLTermv", "")
            PL.SavePredicatesToFile Pred, Tv, PredFile
          End If
        
          'avg_wage(Scope) - calc result
          Q_main.OpenQuery
          If Q_main.EOF Then
            Exit Function
          End If
          Q_main.Close
        
          'avg_wage_out(Scope, EmplKey, FirstMoveKey, AvgWage, AvgWageVariant)
          P_out = "avg_wage_out"
          Set Tv_out = Creator.GetObject(5, "TgsPLTermv", "")
          Set Q_out = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_out.PredicateName = P_out
          Q_out.Termv = Tv_out
          'avg_wage_avg_det(EmplKey, FirstMoveKey,
          '                  Period, Wage,
          '                  TabDays, NormDays, TabHoures, NormHoures) :-
          P_det = "avg_wage_avg_det"
          Set Tv_det = Creator.GetObject(8, "TgsPLTermv", "")
          Set Q_det = Creator.GetObject(nil, "TgsPLQuery", "")
          Q_det.PredicateName = P_det
          Q_det.Termv = Tv_det
          '
          Tv_out.PutAtom 0, Scope
          '
          Q_out.OpenQuery
          If Q_out.EOF Then
            Exit Function
          End If
          '
          Do Until Q_out.EOF
            EmplKey = Tv_out.ReadInteger(1)
            FirstMoveKey = Tv_out.ReadInteger(2)
            AvgWage = Tv_out.ReadFloat(3)
            AvgWageRule = Tv_out.ReadAtom(4)
            '
            wg_CalcAvgAddPay_pl = AvgWageRule
            Select Case AvgWageRule
              Case "avg_houre", "avg_day"
                '
              Case Else
                Exit Function
            End Select
            '
            Tv_det.Reset
            Tv_det.PutInteger 0, EmplKey
            Tv_det.PutInteger 1, FirstMoveKey
            Q_det.OpenQuery
            '
            Do Until Q_det.EOF
              Period = Tv_det.ReadDate(2)
              Wage = Tv_det.ReadFloat(3)
              TabDays = Tv_det.ReadFloat(4)
              NormDays = Tv_det.ReadFloat(5)
              TabHoures = Tv_det.ReadFloat(6)
              NormHoures = Tv_det.ReadFloat(7)
              '
              gdcSalary.Append
              gdcSalary.FieldByName("USR$ISCHECK").AsVariant = Abs( Wage > 0 )
              gdcSalary.FieldByName("USR$DATE").AsVariant = Period
              If Wage > 0 Then
                gdcSalary.FieldByName("USR$SALARY").AsVariant = Wage
                gdcSalary.FieldByName("USR$DOW").AsVariant = TabDays
                gdcSalary.FieldByName("USR$SCHEDULERDOW").AsVariant = NormDays
                gdcSalary.FieldByName("USR$HOW").AsVariant = TabHoures
                gdcSalary.FieldByName("USR$SCHEDULERHOW").AsVariant = NormHoures
              End If
              gdcSalary.Post
              '
              Q_det.NextSolution
            Loop
            Q_det.Close
            '
            Q_out.NextSolution
          Loop
          Q_out.Close
          '
        
          gdcSalary.First
        
          gdcDetailObject.Edit
          gdcDetailObject.FieldByName("USR$AVGSUM").AsCurrency = AvgWage
          gdcDetailObject.Post
        
          T2 = Timer
          T = T2 - T1
        '
        End function
        
      DISPLAYSCRIPT: | 
        WG_CALCAVGADDPAY_PL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "1010001_17 APPLICATION"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAR0RDT0JKRUNUCQAAAEdEQ09CSkVDVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
        AABGTlNUUFJTVA8AAABHRENERVRBSUxPQkpFQ1QPAAAAR0RDREVUQUlMT0JKRUNUAAAAAAAAAAAA
        AAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNUCQAAAEdEQ1NBTEFSWQkAAABHRENTQUxBUlkAAAAAAAAA
        AAAAAAAAAAAAAAAAAAAAAAAARk5TVFBSU1QLAAAATU9OVEhCRUZPUkULAAAATU9OVEhCRUZPUkUA
        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVFBSU1QLAAAATU9OVEhPRkZTRVQLAAAATU9OVEhP
        RkZTRVQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVEZMUFI=
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-09-10T16:17:36+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "151158419_5956463 pl_GetScriptIDByName"
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147113651_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049106_99701464
    Fields: 
      NAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      DESCRIPTION: ~
      PARENT: ~
      OBJECTTYPE: 0
      MACROSGROUPKEY: "147113652_1354510846 Локальные макросы"
      REPORTGROUPKEY: "147113653_1354510846 Отчеты(gdc_dlgUserComplexDocument147113610_1354510846)"
      CLASSNAME: ""
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      SUBTYPE: ""
      EDITIONDATE: 2010-03-31T16:02:14+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 540049108_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049106_99701464
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_CalcAvgAddPay"
      COMMENT: ~
      SCRIPT: | 
        '#include WG_CALCAVGADDPAY
        option explicit
        sub Macros_CalcAvgAddPay(OwnerForm)
          call wg_CalcAvgAddPay(OwnerForm)
        end sub
        
        
      DISPLAYSCRIPT: | 
        MACROS_CALCAVGADDPAY
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-06-06T11:40:43+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147113827_1354510846 wg_CalcAvgAddPay"
  - 
    Properties: 
      Class: "TgdcMacrosGroup"
      RUID: 147113652_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049106_99701464
    Fields: 
      HASCHILDREN: 1
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTPARENT: ~
      CLASSNAME: ""
      SUBTYPE: ""
      PARENT: ~
      NAME: "Локальные макросы"
      ISGLOBAL: 0
      DESCRIPTION: ~
      EDITIONDATE: 2010-03-31T16:02:14+03:00
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 540049106_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MACROSGROUPKEY: "147113652_1354510846 Локальные макросы"
      FUNCTIONKEY: "540049108_99701464 Macros_CalcAvgAddPay"
      NAME: "Расчет структуры ср. заработка"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-06-06T11:40:43+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 540049113_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 540049109_99701464
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "MACROS"
      LANGUAGE: "VBScript"
      NAME: "Macros_CalcAvgAddPay_Total"
      COMMENT: ~
      SCRIPT: | 
        '#include WG_CALCAVGADDPAY
        option explicit
        sub Macros_CalcAvgAddPay_Total(OwnerForm)
          dim gdcObject, gdcDetailObject
          set gdcObject = OwnerForm.gdcObject
          set gdcDetailObject = OwnerForm.gdcDetailObject
        
          if (gdcObject.State = dsEdit) then gdcObject.Post
          if (gdcDetailObject.State = dsEdit) or (gdcDetailObject.State = dsInsert) then gdcDetailObject.Post
          gdcDetailObject.First
          while not gdcDetailObject.EoF
            call wg_CalcAvgAddPay(OwnerForm)
            gdcDetailObject.Next
          wend
        end sub
        
        
      DISPLAYSCRIPT: | 
        MACROS_CALCAVGADDPAY_TOTAL
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: 0
      EDITIONDATE: 2014-06-06T11:46:26+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147113827_1354510846 wg_CalcAvgAddPay"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 540049109_99701464
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MACROSGROUPKEY: "147113652_1354510846 Локальные макросы"
      FUNCTIONKEY: "540049113_99701464 Macros_CalcAvgAddPay_Total"
      NAME: "Произвести итоговый расчет"
      SERVERKEY: ~
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      EXECUTEDATE: ~
      SHORTCUT: 0
      EDITIONDATE: 2014-06-06T11:46:26+03:00
      DISPLAYINMENU: 1
      RUNONLOGIN: 0
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147113745_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113746_1354510846
    Fields: 
      NAME: "usrg_actAvgGenerate"
      DESCRIPTION: ~
      PARENT: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actAvgGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2010-03-31T16:53:56+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147113748_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113746_1354510846
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actAvgGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_CalcAvgAddPay_pl
        Option Explicit
        
        Sub usrg_actAvgGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcDetailObject, gdcSalary, Ret
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          Set gdcDetailObject = Sender.OwnerForm.gdcDetailObject
          Set gdcSalary = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
        
          Dim MonthBefore, MonthOffset
          MonthBefore = 0
          MonthOffset = 0
          Do
            Ret = wg_CalcAvgAddPay_pl(gdcObject, gdcDetailObject, gdcSalary, MonthBefore, MonthOffset)
            Select Case Ret
              Case "need_more"
                MonthBefore = MonthBefore + 1
              Case "by_current_month"
                '
                If Not MonthOffset < 0 Then
                  '
                  Dim Msg
                  Msg = "Сотрудник: " & _
                        gdcDetailObject.FieldByName("U_USR$EMPLKEY_NAME").AsString & _
                        vbCrLf & _
                        "Требуется итоговый расчет для текущего месяца." & _
                        vbCrLf & _
                        "Продолжить?"
                  '
                  If MsgBox(Msg, vbExclamation + vbYesNoCancel, "Предупреждение") = vbYes Then
                    MonthBefore = 0
                    MonthOffset = -1
                  Else
                    Exit Do
                  End If
                  '
                Else
                  Exit Do
                End If
                '
              Case Else
                Exit Do
            End Select
          Loop
        '
        End Sub
        
        
        
      DISPLAYSCRIPT: | 
        USRG_ACTAVGGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-09-10T16:20:07+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "540049114_99701464 wg_CalcAvgAddPay_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147113746_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actAvgGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTKEY: "147113745_1354510846 gdc_dlgUserComplexDocument147113610_1354510846\\usrg_actAvgGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147113748_1354510846 usrg_actAvgGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-06-06T11:36:53+03:00
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147113836_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113842_1354510846
    Fields: 
      NAME: "usrg_actGenerate"
      DESCRIPTION: ~
      PARENT: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTTYPE: 0
      MACROSGROUPKEY: ~
      REPORTGROUPKEY: ~
      CLASSNAME: ""
      OBJECTNAME: "usrg_actGenerate"
      SUBTYPE: ""
      EDITIONDATE: 2010-03-31T18:03:13+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147113844_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147113842_1354510846
    Fields: 
      OBJECTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      MODULE: "EVENTS"
      LANGUAGE: "VBScript"
      NAME: "usrg_actGenerateOnExecute"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_CalcAvgAddPay_pl
        Option Explicit
        
        Sub usrg_actGenerateOnExecute(ByVal Sender)
        '
          Dim gdcObject, gdcDetailObject, gdcSalary, Ret
        
          Sender.OwnerForm.GetComponent("actApply").Execute
        
          Set gdcObject = Sender.OwnerForm.gdcObject
          Set gdcDetailObject = Sender.OwnerForm.gdcDetailObject
          Set gdcSalary = Sender.OwnerForm.GetComponent("usrg_gdcAvgSalaryStr")
        
          Dim MonthBefore, MonthOffset
        
          gdcDetailObject.First
          While Not gdcDetailObject.EoF
            '
          MonthBefore = 0
          MonthOffset = 0
          Do
            Ret = wg_CalcAvgAddPay_pl(gdcObject, gdcDetailObject, gdcSalary, MonthBefore, MonthOffset)
            Select Case Ret
              Case "need_more"
                MonthBefore = MonthBefore + 1
              Case "by_current_month"
                '
                If Not MonthOffset < 0 Then
                  '
                  Dim Msg
                  Msg = "Сотрудник: " & _
                        gdcDetailObject.FieldByName("U_USR$EMPLKEY_NAME").AsString & _
                        vbCrLf & _
                        "Требуется итоговый расчет для текущего месяца." & _
                        vbCrLf & _
                        "Продолжить?"
                  '
                  If MsgBox(Msg, vbExclamation + vbYesNoCancel, "Предупреждение") = vbYes Then
                    MonthBefore = 0
                    MonthOffset = -1
                  Else
                    Exit Do
                  End If
                  '
                Else
                  Exit Do
                End If
                '
              Case Else
                Exit Do
            End Select
          Loop
            '
            gdcDetailObject.Next
          Wend
        '
        End Sub
        
        
      DISPLAYSCRIPT: | 
        USRG_ACTGENERATEONEXECUTE
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: "ONEXECUTE"
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147113651_1354510846 gdc_dlgUserComplexDocument147113610_1354510846"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAU0VOREVSBgAAAFNFTkRFUgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-09-10T17:51:25+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "540049114_99701464 wg_CalcAvgAddPay_pl"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147113842_1354510846
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "usrg_actGenerate"
      PARENTNAME: "gdc_dlgUserComplexDocument147113610_1354510846"
      OBJECTKEY: "147113836_1354510846 gdc_dlgUserComplexDocument147113610_1354510846\\usrg_actGenerate"
      EVENTNAME: "ONEXECUTE"
      FUNCTIONKEY: "147113844_1354510846 usrg_actGenerateOnExecute"
      DISABLE: ~
      EDITIONDATE: 2014-06-06T11:46:22+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147021956_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147021954_119619099
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147020774_119619099"
      MODULE: "METHOD"
      LANGUAGE: "VBScript"
      NAME: "Tgdc_dlgUserComplexDocument147020774_119619099SyncField"
      COMMENT: ~
      SCRIPT: | 
        '#include wg_SetWageDocLookupParams
        '#include wg_RoundSum
        option explicit
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField(Self, Field, SyncList)
          call Inherited(Self, "SyncField", Array(Self, Field, SyncList))
          
          call Tgdc_dlgUserComplexDocument147020774_119619099SyncField_(Self, Field, SyncList)
        end sub
        
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField_(Self, Field, SyncList)
          dim Creator
          set Creator = New TCreator
          
          if Assigned(Field) then
            ' шапка
            if Field.DataSet.Self = Self.gdcObject.Self then
              select case Field.FieldName
                case "USR$TOTALDOCKEY"
        '          Self.gdcObject.FieldByName("usr$emplkey").value = Null
        '          Self.gdcObject.FieldByName("usr$firstmovekey").value = Null
                  wg_SetWageDocLookupParams(Self)
                case "USR$EMPLKEY"
                  wg_SetWageDocLookupParams(Self)
                case "USR$FROM"
                  if Field.AsDateTime < Self.gdcObject.FieldByName("USR$DATEBEGIN").AsDateTime then
                    Self.gdcObject.FieldByName("usr$datebegin").AsDateTime = Field.AsDateTime
                  end if
                case "USR$DATEBEGIN"
                  if Field.AsDateTime > Self.gdcObject.FieldByName("USR$DATEEND").AsDateTime then
                    Self.gdcObject.FieldByName("USR$DATEEND").AsDateTime = Field.AsDateTime
                  else
                    Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(Self)
                  end if
                case "USR$DATEEND"
                  Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(Self)
        '        case "USR$DURATION"
        
                'Вид отпуска
                case "USR$VACATIONTYPE"
                  Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(Self)
                  
                ' ср. заработок - пересчитываем сумму отпускных
                case "USR$AVGSUMMA"
                  Tgdc_dlgUserComplexDocument147020774_119619099SyncField_ReCalcStrSum(Self.gdcDetailObject)
              end select
        
            else           ' позиция
              select case Field.FieldName
                case "USR$DURATION"
                  Self.gdcDetailObject.FieldByName("usr$summa").AsCurrency = wg_RoundSum(gdcBaseManager.GetIDByRUIDString(wg_FeeType_Holiday_RUID), _
                    Field.AsCurrency * Self.gdcObject.FieldByName("USR$AVGSUMMA").AsCurrency)
              end select
            end if
          end if
        end sub
        
        ' расчет продолжительности отпуска
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField_CalcDuration(ByRef Self)
          dim gdcObject, wg_Structure
          set gdcObject = Self.gdcObject
        
          if not gdcObject.FieldByName("USR$DATEEND").IsNull and _
             not gdcObject.FieldByName("USR$DATEBEGIN").IsNull then
        
             set wg_Structure = Self.Objects("Structure")
             
        '     if Self.gdcObject.FieldByName("USR$VACATIONTYPE").asInteger = _
        '        gdcBaseManager.GetIDByRUIDString("147480589_336327731") then
        
                gdcObject.FieldByName("USR$DURATION").AsInteger = _
                  wg_Structure.CalcHolidayDuration( _
                    gdcObject.FieldByName("usr$datebegin").AsVariant, _
                    gdcObject.FieldByName("usr$dateend").AsVariant,_
                    gdcObject.FieldByName("usr$vacationtype").asInteger)
        '     else
        '       gdcObject.FieldByName("USR$DURATION").AsInteger = _
        '         gdcObject.FieldByName("usr$dateend").AsVariant - _
        '         gdcObject.FieldByName("usr$datebegin").AsVariant + 1
        '     end if
             
          else
            gdcObject.FieldByName("USR$DURATION").AsInteger = 0
          end if
        end sub
        
        sub Tgdc_dlgUserComplexDocument147020774_119619099SyncField_ReCalcStrSum(ByRef DataSet)
        ' пересохраняем позиции начисления для перерасчета сумм
        
          DataSet.Cancel
          DataSet.First
          while not DataSet.EOF
            DataSet.Edit
            DataSet.FieldByName("USR$DURATION").AsCurrency = _
              DataSet.FieldByName("USR$DURATION").AsCurrency
            DataSet.Post
            DataSet.Next
          wend
          DataSet.First
        end sub
        
      DISPLAYSCRIPT: | 
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD_
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD_CALCDURATION
        TGDC_DLGUSERCOMPLEXDOCUMENT147020774_119619099SYNCFIELD_RECALCSTRSUM
        
      MODIFYDATE: ~
      OWNERNAME: ~
      FUNCTIONTYPE: ~
      EVENT: ~
      LOCALNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      GROUPNAME: ~
      MODULECODE: "147021953_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147020774_119619099"
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QEAAAAU0VMRgQAAABTRUxGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNU
        BQAAAEZJRUxEBQAAAEZJRUxEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNUCAAAAFNZ
        TkNMSVNUCAAAAFNZTkNMSVNUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RGTFBS
      INHERITEDRULE: 0
      USEDEBUGINFO: ~
      EDITIONDATE: 2014-09-22T16:55:27+03:00
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "147025267_449804462 wg_SetWageDocLookupParams"
          - 
            ADDFUNCTIONKEY: "147804276_375143752 wg_RoundSum"
  - 
    Properties: 
      Class: "TgdcEvent"
      RUID: 147021954_119619099
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      OBJECTNAME: "Tgdc_dlgUserComplexDocument147020774_119619099"
      PARENTNAME: "Tgdc_dlgUserComplexDocument"
      OBJECTKEY: "147021953_119619099 TgdcCreateableForm\\Tgdc_dlgG\\Tgdc_dlgTR\\Tgdc_dlgHGR\\Tgdc_dlgUserComplexDocument\\Tgdc_dlgUserComplexDocument147020774_119619099"
      EVENTNAME: "SYNCFIELD"
      FUNCTIONKEY: "147021956_119619099 Tgdc_dlgUserComplexDocument147020774_119619099SyncField"
      DISABLE: ~
      EDITIONDATE: 2014-09-22T16:55:27+03:00